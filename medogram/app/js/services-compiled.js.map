{"version":3,"sources":["services.js"],"names":[],"mappings":"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","file":"services-compiled.js","sourcesContent":["/*!\n * Webogram v0.5.5 - messaging web application for MTProto\n * https://github.com/zhukov/webogram\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\n * https://github.com/zhukov/webogram/blob/master/LICENSE\n */\n\n'use strict'\n\n/* Services */\n\nangular.module('myApp.services', ['myApp.i18n', 'izhukov.utils'])\n\n  .service('AppUsersManager', function ($rootScope, $modal, $modalStack, $filter, $q, qSync, MtpApiManager, RichTextProcessor, ServerTimeManager, Storage, _) {\n    var users = {}\n    var usernames = {}\n    var userAccess = {}\n    var cachedPhotoLocations = {}\n    var contactsIndex = SearchIndexManager.createIndex()\n    var contactsFillPromise\n    var contactsList\n    var myID\n\n    MtpApiManager.getUserID().then(function (id) {\n      myID = id\n    })\n\n    function fillContacts () {\n      if (contactsFillPromise) {\n        return contactsFillPromise\n      }\n      return contactsFillPromise = MtpApiManager.invokeApi('contacts.getContacts', {\n        hash: ''\n      }).then(function (result) {\n        var userID, searchText\n        var i\n        contactsList = []\n        saveApiUsers(result.users)\n\n        for (var i = 0; i < result.contacts.length; i++) {\n          userID = result.contacts[i].user_id\n          contactsList.push(userID)\n          SearchIndexManager.indexObject(userID, getUserSearchText(userID), contactsIndex)\n        }\n\n        return contactsList\n      })\n    }\n\n    function getUserSearchText (id) {\n      var user = users[id]\n      if (!user) {\n        return false\n      }\n\n      return (user.first_name || '') + ' ' + (user.last_name || '') + ' ' + (user.phone || '') + ' ' + (user.username || '')\n    }\n\n    function getContacts (query) {\n      return fillContacts().then(function (contactsList) {\n        if (angular.isString(query) && query.length) {\n          var results = SearchIndexManager.search(query, contactsIndex)\n          var filteredContactsList = []\n\n          for (var i = 0; i < contactsList.length; i++) {\n            if (results[contactsList[i]]) {\n              filteredContactsList.push(contactsList[i])\n            }\n          }\n          contactsList = filteredContactsList\n        }\n\n        return contactsList\n      })\n    }\n\n    function resolveUsername (username) {\n      return usernames[username] || 0\n    }\n\n    function saveApiUsers (apiUsers) {\n      angular.forEach(apiUsers, saveApiUser)\n    }\n\n    function saveApiUser (apiUser, noReplace) {\n      if (!angular.isObject(apiUser) ||\n        noReplace && angular.isObject(users[apiUser.id]) && users[apiUser.id].first_name) {\n        return\n      }\n\n      var userID = apiUser.id\n      var result = users[userID]\n\n      if (apiUser.pFlags === undefined) {\n        apiUser.pFlags = {}\n      }\n\n      if (apiUser.pFlags.min) {\n        if (result !== undefined) {\n          return\n        }\n      }\n\n      if (apiUser.phone) {\n        apiUser.rPhone = $filter('phoneNumber')(apiUser.phone)\n      }\n\n      apiUser.num = (Math.abs(userID) % 8) + 1\n\n      if (apiUser.first_name) {\n        apiUser.rFirstName = RichTextProcessor.wrapRichText(apiUser.first_name, {noLinks: true, noLinebreaks: true})\n        apiUser.rFullName = apiUser.last_name ? RichTextProcessor.wrapRichText(apiUser.first_name + ' ' + (apiUser.last_name || ''), {noLinks: true, noLinebreaks: true}) : apiUser.rFirstName\n      } else {\n        apiUser.rFirstName = RichTextProcessor.wrapRichText(apiUser.last_name, {noLinks: true, noLinebreaks: true}) || apiUser.rPhone || _('user_first_name_deleted')\n        apiUser.rFullName = RichTextProcessor.wrapRichText(apiUser.last_name, {noLinks: true, noLinebreaks: true}) || apiUser.rPhone || _('user_name_deleted')\n      }\n\n      if (apiUser.username) {\n        var searchUsername = SearchIndexManager.cleanUsername(apiUser.username)\n        usernames[searchUsername] = userID\n      }\n\n      apiUser.sortName = apiUser.pFlags.deleted ? '' : SearchIndexManager.cleanSearchText(apiUser.first_name + ' ' + (apiUser.last_name || ''))\n\n      var nameWords = apiUser.sortName.split(' ')\n      var firstWord = nameWords.shift()\n      var lastWord = nameWords.pop()\n      apiUser.initials = firstWord.charAt(0) + (lastWord ? lastWord.charAt(0) : firstWord.charAt(1))\n\n      if (apiUser.status) {\n        if (apiUser.status.expires) {\n          apiUser.status.expires -= ServerTimeManager.serverTimeOffset\n        }\n        if (apiUser.status.was_online) {\n          apiUser.status.was_online -= ServerTimeManager.serverTimeOffset\n        }\n      }\n      if (apiUser.pFlags.bot) {\n        apiUser.sortStatus = -1\n      } else {\n        apiUser.sortStatus = getUserStatusForSort(apiUser.status)\n      }\n\n      var result = users[userID]\n      if (result === undefined) {\n        result = users[userID] = apiUser\n      } else {\n        safeReplaceObject(result, apiUser)\n      }\n      $rootScope.$broadcast('user_update', userID)\n\n      if (cachedPhotoLocations[userID] !== undefined) {\n        safeReplaceObject(cachedPhotoLocations[userID], apiUser && apiUser.photo && apiUser.photo.photo_small || {empty: true})\n      }\n    }\n\n    function saveUserAccess (id, accessHash) {\n      userAccess[id] = accessHash\n    }\n\n    function getUserStatusForSort (status) {\n      if (status) {\n        var expires = status.expires || status.was_online\n        if (expires) {\n          return expires\n        }\n        var timeNow = tsNow(true)\n        switch (status._) {\n          case 'userStatusRecently':\n            return timeNow - 86400 * 3\n          case 'userStatusLastWeek':\n            return timeNow - 86400 * 7\n          case 'userStatusLastMonth':\n            return timeNow - 86400 * 30\n        }\n      }\n\n      return 0\n    }\n\n    function getUser (id) {\n      if (angular.isObject(id)) {\n        return id\n      }\n      return users[id] || {id: id, deleted: true, num: 1, access_hash: userAccess[id]}\n    }\n\n    function getSelf () {\n      return getUser(myID)\n    }\n\n    function isBot (id) {\n      return users[id] && users[id].pFlags.bot\n    }\n\n    function hasUser (id, allowMin) {\n      var user = users[id]\n      return angular.isObject(user) && (allowMin || !user.pFlags.min)\n    }\n\n    function getUserPhoto (id) {\n      var user = getUser(id)\n\n      if (id == 333000) {\n        return {\n          placeholder: 'img/placeholders/DialogListAvatarSystem@2x.png'\n        }\n      }\n\n      if (cachedPhotoLocations[id] === undefined) {\n        cachedPhotoLocations[id] = user && user.photo && user.photo.photo_small || {empty: true}\n      }\n\n      return {\n        num: user.num,\n        placeholder: 'img/placeholders/UserAvatar' + user.num + '@2x.png',\n        location: cachedPhotoLocations[id]\n      }\n    }\n\n    function getUserString (id) {\n      var user = getUser(id)\n      return 'u' + id + (user.access_hash ? '_' + user.access_hash : '')\n    }\n\n    function getUserInput (id) {\n      var user = getUser(id)\n      if (user.pFlags.self) {\n        return {_: 'inputUserSelf'}\n      }\n      return {\n        _: 'inputUser',\n        user_id: id,\n        access_hash: user.access_hash || 0\n      }\n    }\n\n    function updateUsersStatuses () {\n      var timestampNow = tsNow(true)\n      angular.forEach(users, function (user) {\n        if (user.status &&\n          user.status._ == 'userStatusOnline' &&\n          user.status.expires < timestampNow) {\n          user.status = user.status.wasStatus ||\n          {_: 'userStatusOffline', was_online: user.status.expires}\n          delete user.status.wasStatus\n          $rootScope.$broadcast('user_update', user.id)\n        }\n      })\n    }\n\n    function forceUserOnline (id) {\n      if (isBot(id)) {\n        return\n      }\n      var user = getUser(id)\n      if (user &&\n        user.status &&\n        user.status._ != 'userStatusOnline' &&\n        user.status._ != 'userStatusEmpty') {\n        var wasStatus\n        if (user.status._ != 'userStatusOffline') {\n          delete user.status.wasStatus\n          wasStatus = angular.copy(user.status)\n        }\n        user.status = {\n          _: 'userStatusOnline',\n          expires: tsNow(true) + 60,\n          wasStatus: wasStatus\n        }\n        user.sortStatus = getUserStatusForSort(user.status)\n        $rootScope.$broadcast('user_update', id)\n      }\n    }\n\n    function wrapForFull (id) {\n      var user = getUser(id)\n\n      return user\n    }\n\n    function openUser (userID, override) {\n      var scope = $rootScope.$new()\n      scope.userID = userID\n      scope.override = override || {}\n\n      var modalInstance = $modal.open({\n        templateUrl: templateUrl('user_modal'),\n        controller: 'UserModalController',\n        scope: scope,\n        windowClass: 'user_modal_window mobile_modal',\n        backdrop: 'single'\n      })\n    }\n\n    function importContact (phone, firstName, lastName) {\n      return MtpApiManager.invokeApi('contacts.importContacts', {\n        contacts: [{\n          _: 'inputPhoneContact',\n          client_id: '1',\n          phone: phone,\n          first_name: firstName,\n          last_name: lastName\n        }],\n        replace: false\n      }).then(function (importedContactsResult) {\n        saveApiUsers(importedContactsResult.users)\n\n        var foundUserID = false\n        angular.forEach(importedContactsResult.imported, function (importedContact) {\n          onContactUpdated(foundUserID = importedContact.user_id, true)\n        })\n\n        return foundUserID || false\n      })\n    }\n\n    function importContacts (contacts) {\n      var inputContacts = [],\n        i\n      var j\n\n      for (i = 0; i < contacts.length; i++) {\n        for (j = 0; j < contacts[i].phones.length; j++) {\n          inputContacts.push({\n            _: 'inputPhoneContact',\n            client_id: (i << 16 | j).toString(10),\n            phone: contacts[i].phones[j],\n            first_name: contacts[i].first_name,\n            last_name: contacts[i].last_name\n          })\n        }\n      }\n\n      return MtpApiManager.invokeApi('contacts.importContacts', {\n        contacts: inputContacts,\n        replace: false\n      }).then(function (importedContactsResult) {\n        saveApiUsers(importedContactsResult.users)\n\n        var result = []\n        angular.forEach(importedContactsResult.imported, function (importedContact) {\n          onContactUpdated(importedContact.user_id, true)\n          result.push(importedContact.user_id)\n        })\n\n        return result\n      })\n    }\n\n    function deleteContacts (userIDs) {\n      var ids = []\n      angular.forEach(userIDs, function (userID) {\n        ids.push(getUserInput(userID))\n      })\n      return MtpApiManager.invokeApi('contacts.deleteContacts', {\n        id: ids\n      }).then(function () {\n        angular.forEach(userIDs, function (userID) {\n          onContactUpdated(userID, false)\n        })\n      })\n    }\n\n    function onContactUpdated (userID, isContact) {\n      userID = parseInt(userID)\n      if (angular.isArray(contactsList)) {\n        var curPos = curIsContact = contactsList.indexOf(userID)\n        var curIsContact = curPos != -1\n\n        if (isContact != curIsContact) {\n          if (isContact) {\n            contactsList.push(userID)\n            SearchIndexManager.indexObject(userID, getUserSearchText(userID), contactsIndex)\n          } else {\n            contactsList.splice(curPos, 1)\n          }\n          $rootScope.$broadcast('contacts_update', userID)\n        }\n      }\n    }\n\n    function openImportContact () {\n      return $modal.open({\n        templateUrl: templateUrl('import_contact_modal'),\n        controller: 'ImportContactModalController',\n        windowClass: 'md_simple_modal_window mobile_modal'\n      }).result.then(function (foundUserID) {\n        if (!foundUserID) {\n          return $q.reject()\n        }\n        return foundUserID\n      })\n    }\n\n    function setUserStatus (userID, offline) {\n      if (isBot(userID)) {\n        return\n      }\n      var user = users[userID]\n      if (user) {\n        var status = offline ? {\n          _: 'userStatusOffline',\n          was_online: tsNow(true)\n        } : {\n          _: 'userStatusOnline',\n          expires: tsNow(true) + 500\n        }\n\n        user.status = status\n        user.sortStatus = getUserStatusForSort(user.status)\n        $rootScope.$broadcast('user_update', userID)\n      }\n    }\n\n    $rootScope.$on('apiUpdate', function (e, update) {\n      // console.log('on apiUpdate', update)\n      switch (update._) {\n        case 'updateUserStatus':\n          var userID = update.user_id\n          var user = users[userID]\n          if (user) {\n            user.status = update.status\n            if (user.status) {\n              if (user.status.expires) {\n                user.status.expires -= ServerTimeManager.serverTimeOffset\n              }\n              if (user.status.was_online) {\n                user.status.was_online -= ServerTimeManager.serverTimeOffset\n              }\n            }\n            user.sortStatus = getUserStatusForSort(user.status)\n            $rootScope.$broadcast('user_update', userID)\n          }\n          break\n\n        case 'updateUserPhoto':\n          var userID = update.user_id\n          var user = users[userID]\n          if (user) {\n            forceUserOnline(userID)\n            if (!user.photo) {\n              user.photo = update.photo\n            } else {\n              safeReplaceObject(user.photo, update.photo)\n            }\n\n            if (cachedPhotoLocations[userID] !== undefined) {\n              safeReplaceObject(cachedPhotoLocations[userID], update.photo && update.photo.photo_small || {empty: true})\n            }\n\n            $rootScope.$broadcast('user_update', userID)\n          }\n          break\n\n        case 'updateContactLink':\n          onContactUpdated(update.user_id, update.my_link._ == 'contactLinkContact')\n          break\n      }\n    })\n\n    $rootScope.$on('user_auth', function (e, userAuth) {\n      myID = userAuth && userAuth.id || 0\n    })\n\n    setInterval(updateUsersStatuses, 60000)\n\n    $rootScope.$on('stateSynchronized', updateUsersStatuses)\n\n    return {\n      getContacts: getContacts,\n      saveApiUsers: saveApiUsers,\n      saveApiUser: saveApiUser,\n      saveUserAccess: saveUserAccess,\n      getUser: getUser,\n      getSelf: getSelf,\n      getUserInput: getUserInput,\n      setUserStatus: setUserStatus,\n      forceUserOnline: forceUserOnline,\n      getUserPhoto: getUserPhoto,\n      getUserString: getUserString,\n      getUserSearchText: getUserSearchText,\n      hasUser: hasUser,\n      isBot: isBot,\n      importContact: importContact,\n      importContacts: importContacts,\n      deleteContacts: deleteContacts,\n      wrapForFull: wrapForFull,\n      openUser: openUser,\n      resolveUsername: resolveUsername,\n      openImportContact: openImportContact\n    }\n  })\n\n  .service('PhonebookContactsService', function ($q, $modal, $sce, FileManager) {\n    return {\n      isAvailable: isAvailable,\n      openPhonebookImport: openPhonebookImport,\n      getPhonebookContacts: getPhonebookContacts\n    }\n\n    function isAvailable () {\n      if (Config.Mobile && Config.Navigator.ffos && Config.Modes.packed) {\n        try {\n          return navigator.mozContacts && navigator.mozContacts.getAll\n        } catch (e) {\n          console.error(dT(), 'phonebook n/a', e)\n          return false\n        }\n      }\n      return false\n    }\n\n    function openPhonebookImport () {\n      return $modal.open({\n        templateUrl: templateUrl('phonebook_modal'),\n        controller: 'PhonebookModalController',\n        windowClass: 'phonebook_modal_window mobile_modal'\n      })\n    }\n\n    function getPhonebookContacts () {\n      try {\n        var request = window.navigator.mozContacts.getAll({})\n      } catch (e) {\n        return $q.reject(e)\n      }\n\n      var deferred = $q.defer()\n      var contacts = []\n      var count = 0\n\n      request.onsuccess = function () {\n        if (this.result) {\n          var contact = {\n            id: count,\n            first_name: (this.result.givenName || []).join(' '),\n            last_name: (this.result.familyName || []).join(' '),\n            phones: []\n          }\n\n          if (this.result.tel != undefined) {\n            for (var i = 0; i < this.result.tel.length; i++) {\n              contact.phones.push(this.result.tel[i].value)\n            }\n          }\n          if (this.result.photo && this.result.photo[0]) {\n            try {\n              contact.photo = FileManager.getUrl(this.result.photo[0])\n            } catch (e) {}\n          }\n          if (!contact.photo) {\n            contact.photo = 'img/placeholders/UserAvatar' + ((Math.abs(count) % 8) + 1) + '@2x.png'\n          }\n          contact.photo = $sce.trustAsResourceUrl(contact.photo)\n\n          count++\n          contacts.push(contact)\n        }\n\n        if (!this.result || count >= 1000) {\n          deferred.resolve(contacts)\n          return\n        }\n\n        this['continue']()\n      }\n\n      request.onerror = function (e) {\n        console.log('phonebook error', e, e.type, e.message)\n        deferred.reject(e)\n      }\n\n      return deferred.promise\n    }\n  })\n\n  .service('AppChatsManager', function ($q, $rootScope, $modal, _, MtpApiManager, AppUsersManager, AppPhotosManager, RichTextProcessor) {\n    var chats = {}\n    var usernames = {}\n    var channelAccess = {}\n    var megagroups = {}\n    var cachedPhotoLocations = {}\n\n    function saveApiChats (apiChats) {\n      angular.forEach(apiChats, saveApiChat)\n    }\n\n    function saveApiChat (apiChat) {\n      if (!angular.isObject(apiChat)) {\n        return\n      }\n      apiChat.rTitle = RichTextProcessor.wrapRichText(apiChat.title, {noLinks: true, noLinebreaks: true}) || _('chat_title_deleted')\n\n      var result = chats[apiChat.id]\n      var titleWords = SearchIndexManager.cleanSearchText(apiChat.title || '').split(' ')\n      var firstWord = titleWords.shift()\n      var lastWord = titleWords.pop()\n      apiChat.initials = firstWord.charAt(0) + (lastWord ? lastWord.charAt(0) : firstWord.charAt(1))\n\n      apiChat.num = (Math.abs(apiChat.id >> 1) % 8) + 1\n\n      if (apiChat.pFlags === undefined) {\n        apiChat.pFlags = {}\n      }\n      if (apiChat.pFlags.min) {\n        if (result !== undefined) {\n          return\n        }\n      }\n\n      if (apiChat.username) {\n        var searchUsername = SearchIndexManager.cleanUsername(apiChat.username)\n        usernames[searchUsername] = apiChat.id\n      }\n\n      if (result === undefined) {\n        result = chats[apiChat.id] = apiChat\n      } else {\n        safeReplaceObject(result, apiChat)\n        $rootScope.$broadcast('chat_update', apiChat.id)\n      }\n\n      if (cachedPhotoLocations[apiChat.id] !== undefined) {\n        safeReplaceObject(cachedPhotoLocations[apiChat.id], apiChat && apiChat.photo && apiChat.photo.photo_small || {empty: true})\n      }\n    }\n\n    function getChat (id) {\n      return chats[id] || {id: id, deleted: true, access_hash: channelAccess[id]}\n    }\n\n    function hasRights (id, action) {\n      if (chats[id] === undefined) {\n        return false\n      }\n      var chat = getChat(id)\n      if (chat._ == 'chatForbidden' ||\n        chat._ == 'channelForbidden' ||\n        chat.pFlags.kicked ||\n        chat.pFlags.left) {\n        return false\n      }\n      if (chat.pFlags.creator) {\n        return true\n      }\n\n      switch (action) {\n        case 'send':\n          if (chat._ == 'channel' &&\n            !chat.pFlags.megagroup &&\n            !chat.pFlags.editor) {\n            return false\n          }\n          break\n\n        case 'edit_title':\n        case 'edit_photo':\n        case 'invite':\n          if (chat._ == 'channel') {\n            if (chat.pFlags.megagroup) {\n              if (!chat.pFlags.editor &&\n                !(action == 'invite' && chat.pFlags.democracy)) {\n                return false\n              }\n            } else {\n              return false\n            }\n          } else {\n            if (chat.pFlags.admins_enabled &&\n              !chat.pFlags.admin) {\n              return false\n            }\n          }\n          break\n      }\n      return true\n    }\n\n    function resolveUsername (username) {\n      return usernames[username] || 0\n    }\n\n    function saveChannelAccess (id, accessHash) {\n      channelAccess[id] = accessHash\n    }\n\n    function saveIsMegagroup (id) {\n      megagroups[id] = true\n    }\n\n    function isChannel (id) {\n      var chat = chats[id]\n      if (chat && (chat._ == 'channel' || chat._ == 'channelForbidden') ||\n        channelAccess[id]) {\n        return true\n      }\n      return false\n    }\n\n    function isMegagroup (id) {\n      if (megagroups[id]) {\n        return true\n      }\n      var chat = chats[id]\n      if (chat && chat._ == 'channel' && chat.pFlags.megagroup) {\n        return true\n      }\n      return false\n    }\n\n    function getChatInput (id) {\n      return id || 0\n    }\n\n    function getChannelInput (id) {\n      if (!id) {\n        return {_: 'inputChannelEmpty'}\n      }\n      return {\n        _: 'inputChannel',\n        channel_id: id,\n        access_hash: getChat(id).access_hash || channelAccess[id] || 0\n      }\n    }\n\n    function hasChat (id, allowMin) {\n      var chat = chats[id]\n      return angular.isObject(chat) && (allowMin || !chat.pFlags.min)\n    }\n\n    function getChatPhoto (id) {\n      var chat = getChat(id)\n\n      if (cachedPhotoLocations[id] === undefined) {\n        cachedPhotoLocations[id] = chat && chat.photo && chat.photo.photo_small || {empty: true}\n      }\n\n      return {\n        placeholder: 'img/placeholders/GroupAvatar' + Math.ceil(chat.num / 2) + '@2x.png',\n        location: cachedPhotoLocations[id]\n      }\n    }\n\n    function getChatString (id) {\n      var chat = getChat(id)\n      if (isChannel(id)) {\n        return (isMegagroup(id) ? 's' : 'c') + id + '_' + chat.access_hash\n      }\n      return 'g' + id\n    }\n\n    function wrapForFull (id, fullChat) {\n      var chatFull = angular.copy(fullChat)\n      var chat = getChat(id)\n\n      if (chatFull.participants && chatFull.participants._ == 'chatParticipants') {\n        MtpApiManager.getUserID().then(function (myID) {\n          var isAdmin = chat.pFlags.creator || chat.pFlags.admins_enabled && chat.pFlags.admin\n          angular.forEach(chatFull.participants.participants, function (participant) {\n            participant.canLeave = myID == participant.user_id\n            participant.canKick = !participant.canLeave && (\n              chat.pFlags.creator ||\n              participant._ == 'chatParticipant' && (isAdmin || myID == participant.inviter_id)\n            )\n\n            // just for order by last seen\n            participant.user = AppUsersManager.getUser(participant.user_id)\n          })\n        })\n      }\n      if (chatFull.participants && chatFull.participants._ == 'channelParticipants') {\n        var isAdmin = chat.pFlags.creator || chat.pFlags.editor || chat.pFlags.moderator\n        angular.forEach(chatFull.participants.participants, function (participant) {\n          participant.canLeave = !chat.pFlags.creator && participant._ == 'channelParticipantSelf'\n          participant.canKick = isAdmin && participant._ == 'channelParticipant'\n\n          // just for order by last seen\n          participant.user = AppUsersManager.getUser(participant.user_id)\n        })\n      }\n\n      if (chatFull.about) {\n        chatFull.rAbout = RichTextProcessor.wrapRichText(chatFull.about, {noLinebreaks: true})\n      }\n\n      chatFull.peerString = getChatString(id)\n      chatFull.chat = chat\n\n      return chatFull\n    }\n\n    function openChat (chatID, accessHash) {\n      var scope = $rootScope.$new()\n      scope.chatID = chatID\n\n      if (isChannel(chatID)) {\n        var modalInstance = $modal.open({\n          templateUrl: templateUrl('channel_modal'),\n          controller: 'ChannelModalController',\n          scope: scope,\n          windowClass: 'chat_modal_window channel_modal_window mobile_modal'\n        })\n      } else {\n        var modalInstance = $modal.open({\n          templateUrl: templateUrl('chat_modal'),\n          controller: 'ChatModalController',\n          scope: scope,\n          windowClass: 'chat_modal_window mobile_modal'\n        })\n      }\n    }\n\n    $rootScope.$on('apiUpdate', function (e, update) {\n      // console.log('on apiUpdate', update)\n      switch (update._) {\n        case 'updateChannel':\n          var channelID = update.channel_id\n          $rootScope.$broadcast('channel_settings', {channelID: channelID})\n          break\n      }\n    })\n\n    return {\n      saveApiChats: saveApiChats,\n      saveApiChat: saveApiChat,\n      getChat: getChat,\n      isChannel: isChannel,\n      isMegagroup: isMegagroup,\n      hasRights: hasRights,\n      saveChannelAccess: saveChannelAccess,\n      saveIsMegagroup: saveIsMegagroup,\n      getChatInput: getChatInput,\n      getChannelInput: getChannelInput,\n      getChatPhoto: getChatPhoto,\n      getChatString: getChatString,\n      resolveUsername: resolveUsername,\n      hasChat: hasChat,\n      wrapForFull: wrapForFull,\n      openChat: openChat\n    }\n  })\n\n  .service('AppPeersManager', function ($q, qSync, AppUsersManager, AppChatsManager, MtpApiManager) {\n    function getInputPeer (peerString) {\n      var firstChar = peerString.charAt(0)\n      var peerParams = peerString.substr(1).split('_')\n\n      if (firstChar == 'u') {\n        AppUsersManager.saveUserAccess(peerParams[0], peerParams[1])\n        return {\n          _: 'inputPeerUser',\n          user_id: peerParams[0],\n          access_hash: peerParams[1]\n        }\n      }\n      else if (firstChar == 'c' || firstChar == 's') {\n        AppChatsManager.saveChannelAccess(peerParams[0], peerParams[1])\n        if (firstChar == 's') {\n          AppChatsManager.saveIsMegagroup(peerParams[0])\n        }\n        return {\n          _: 'inputPeerChannel',\n          channel_id: peerParams[0],\n          access_hash: peerParams[1] || 0\n        }\n      }else {\n        return {\n          _: 'inputPeerChat',\n          chat_id: peerParams[0]\n        }\n      }\n    }\n\n    function getInputPeerByID (peerID) {\n      if (!peerID) {\n        return {_: 'inputPeerEmpty'}\n      }\n      if (peerID < 0) {\n        var chatID = -peerID\n        if (!AppChatsManager.isChannel(chatID)) {\n          return {\n            _: 'inputPeerChat',\n            chat_id: chatID\n          }\n        } else {\n          return {\n            _: 'inputPeerChannel',\n            channel_id: chatID,\n            access_hash: AppChatsManager.getChat(chatID).access_hash || 0\n          }\n        }\n      }\n      return {\n        _: 'inputPeerUser',\n        user_id: peerID,\n        access_hash: AppUsersManager.getUser(peerID).access_hash || 0\n      }\n    }\n\n    function getPeerSearchText (peerID) {\n      var text\n      if (peerID > 0) {\n        text = '%pu ' + AppUsersManager.getUserSearchText(peerID)\n      } else if (peerID < 0) {\n        var chat = AppChatsManager.getChat(-peerID)\n        text = '%pg ' + (chat.title || '')\n      }\n      return text\n    }\n\n    function getPeerString (peerID) {\n      if (peerID > 0) {\n        return AppUsersManager.getUserString(peerID)\n      }\n      return AppChatsManager.getChatString(-peerID)\n    }\n\n    function getOutputPeer (peerID) {\n      if (peerID > 0) {\n        return {_: 'peerUser', user_id: peerID}\n      }\n      var chatID = -peerID\n      if (AppChatsManager.isChannel(chatID)) {\n        return {_: 'peerChannel', channel_id: chatID}\n      }\n      return {_: 'peerChat', chat_id: chatID}\n    }\n\n    function resolveUsername (username) {\n      var searchUserName = SearchIndexManager.cleanUsername(username)\n      if (searchUserName.match(/^\\d+$/)) {\n        return qSync.when(false)\n      }\n      var foundUserID\n      var foundChatID, foundPeerID\n      var foundUsername\n      if (foundUserID = AppUsersManager.resolveUsername(searchUserName)) {\n        foundUsername = AppUsersManager.getUser(foundUserID).username\n        if (SearchIndexManager.cleanUsername(foundUsername) == searchUserName) {\n          return qSync.when(foundUserID)\n        }\n      }\n      if (foundChatID = AppChatsManager.resolveUsername(searchUserName)) {\n        foundUsername = AppChatsManager.getChat(foundChatID).username\n        if (SearchIndexManager.cleanUsername(foundUsername) == searchUserName) {\n          return qSync.when(-foundChatID)\n        }\n      }\n\n      return MtpApiManager.invokeApi('contacts.resolveUsername', {username: username}).then(function (resolveResult) {\n        AppUsersManager.saveApiUsers(resolveResult.users)\n        AppChatsManager.saveApiChats(resolveResult.chats)\n        return getPeerID(resolveResult.peer)\n      })\n    }\n\n    function getPeerID (peerString) {\n      if (angular.isObject(peerString)) {\n        return peerString.user_id\n          ? peerString.user_id\n          : -(peerString.channel_id || peerString.chat_id)\n      }\n      var isUser = peerString.charAt(0) == 'u'\n      var peerParams = peerString.substr(1).split('_')\n\n      return isUser ? peerParams[0] : -peerParams[0] || 0\n    }\n\n    function getPeer (peerID) {\n      return peerID > 0\n        ? AppUsersManager.getUser(peerID)\n        : AppChatsManager.getChat(-peerID)\n    }\n\n    function getPeerPhoto (peerID) {\n      return peerID > 0\n        ? AppUsersManager.getUserPhoto(peerID)\n        : AppChatsManager.getChatPhoto(-peerID)\n    }\n\n    function isChannel (peerID) {\n      return (peerID < 0) && AppChatsManager.isChannel(-peerID)\n    }\n\n    function isMegagroup (peerID) {\n      return (peerID < 0) && AppChatsManager.isMegagroup(-peerID)\n    }\n\n    function isBot (peerID) {\n      return (peerID > 0) && AppUsersManager.isBot(peerID)\n    }\n\n    return {\n      getInputPeer: getInputPeer,\n      getInputPeerByID: getInputPeerByID,\n      getPeerSearchText: getPeerSearchText,\n      getPeerString: getPeerString,\n      getOutputPeer: getOutputPeer,\n      getPeerID: getPeerID,\n      getPeer: getPeer,\n      getPeerPhoto: getPeerPhoto,\n      resolveUsername: resolveUsername,\n      isChannel: isChannel,\n      isMegagroup: isMegagroup,\n      isBot: isBot\n    }\n  })\n\n  .service('AppProfileManager', function ($q, $rootScope, AppUsersManager, AppChatsManager, AppPeersManager, AppPhotosManager, NotificationsManager, MtpApiManager, ApiUpdatesManager, RichTextProcessor) {\n    var botInfos = {}\n    var chatsFull = {}\n    var chatFullPromises = {}\n\n    function saveBotInfo (botInfo) {\n      var botID = botInfo && botInfo.user_id\n      if (!botID) {\n        return false\n      }\n      var commands = {}\n      angular.forEach(botInfo.commands, function (botCommand) {\n        commands[botCommand.command] = botCommand.description\n      })\n      return botInfos[botID] = {\n        id: botID,\n        version: botInfo.version,\n        shareText: botInfo.share_text,\n        description: botInfo.description,\n        commands: commands\n      }\n    }\n\n    function getProfile (id, override) {\n      return MtpApiManager.invokeApi('users.getFullUser', {\n        id: AppUsersManager.getUserInput(id)\n      }).then(function (userFull) {\n        if (override && override.phone_number) {\n          userFull.user.phone = override.phone_number\n          if (override.first_name || override.last_name) {\n            userFull.user.first_name = override.first_name\n            userFull.user.last_name = override.last_name\n          }\n          AppUsersManager.saveApiUser(userFull.user)\n        } else {\n          AppUsersManager.saveApiUser(userFull.user, true)\n        }\n\n        if (userFull.profile_photo) {\n          AppPhotosManager.savePhoto(userFull.profile_photo, {\n            user_id: id\n          })\n        }\n\n        if (userFull.about !== undefined) {\n          userFull.rAbout = RichTextProcessor.wrapRichText(userFull.about, {noLinebreaks: true})\n        }\n\n        NotificationsManager.savePeerSettings(id, userFull.notify_settings)\n\n        if (userFull.bot_info) {\n          userFull.bot_info = saveBotInfo(userFull.bot_info)\n        }\n\n        return userFull\n      })\n    }\n\n    function getPeerBots (peerID) {\n      var peerBots = []\n      if (peerID >= 0 && !AppUsersManager.isBot(peerID) ||\n        (AppPeersManager.isChannel(peerID) && !AppPeersManager.isMegagroup(peerID))) {\n        return $q.when(peerBots)\n      }\n      if (peerID >= 0) {\n        return getProfile(peerID).then(function (userFull) {\n          var botInfo = userFull.bot_info\n          if (botInfo && botInfo._ != 'botInfoEmpty') {\n            peerBots.push(botInfo)\n          }\n          return peerBots\n        })\n      }\n\n      return getChatFull(-peerID).then(function (chatFull) {\n        angular.forEach(chatFull.bot_info, function (botInfo) {\n          peerBots.push(saveBotInfo(botInfo))\n        })\n        return peerBots\n      })\n    }\n\n    function getChatFull (id) {\n      if (AppChatsManager.isChannel(id)) {\n        return getChannelFull(id)\n      }\n      if (chatsFull[id] !== undefined) {\n        var chat = AppChatsManager.getChat(id)\n        if (chat.version == chatsFull[id].participants.version ||\n          chat.pFlags.left) {\n          return $q.when(chatsFull[id])\n        }\n      }\n      if (chatFullPromises[id] !== undefined) {\n        return chatFullPromises[id]\n      }\n      console.trace(dT(), 'Get chat full', id, AppChatsManager.getChat(id))\n      return chatFullPromises[id] = MtpApiManager.invokeApi('messages.getFullChat', {\n        chat_id: AppChatsManager.getChatInput(id)\n      }).then(function (result) {\n        AppChatsManager.saveApiChats(result.chats)\n        AppUsersManager.saveApiUsers(result.users)\n        var fullChat = result.full_chat\n        if (fullChat && fullChat.chat_photo.id) {\n          AppPhotosManager.savePhoto(fullChat.chat_photo)\n        }\n        NotificationsManager.savePeerSettings(-id, fullChat.notify_settings)\n        delete chatFullPromises[id]\n        chatsFull[id] = fullChat\n        $rootScope.$broadcast('chat_full_update', id)\n\n        return fullChat\n      })\n    }\n\n    function getChatInviteLink (id, force) {\n      return getChatFull(id).then(function (chatFull) {\n        if (!force &&\n          chatFull.exported_invite &&\n          chatFull.exported_invite._ == 'chatInviteExported') {\n          return chatFull.exported_invite.link\n        }\n        var promise\n        if (AppChatsManager.isChannel(id)) {\n          promise = MtpApiManager.invokeApi('channels.exportInvite', {\n            channel: AppChatsManager.getChannelInput(id)\n          })\n        } else {\n          promise = MtpApiManager.invokeApi('messages.exportChatInvite', {\n            chat_id: AppChatsManager.getChatInput(id)\n          })\n        }\n        return promise.then(function (exportedInvite) {\n          if (chatsFull[id] !== undefined) {\n            chatsFull[id].exported_invite = exportedInvite\n          }\n          return exportedInvite.link\n        })\n      })\n    }\n\n    function getChannelParticipants (id) {\n      return MtpApiManager.invokeApi('channels.getParticipants', {\n        channel: AppChatsManager.getChannelInput(id),\n        filter: {_: 'channelParticipantsRecent'},\n        offset: 0,\n        limit: AppChatsManager.isMegagroup(id) ? 50 : 200\n      }).then(function (result) {\n        AppUsersManager.saveApiUsers(result.users)\n        var participants = result.participants\n\n        var chat = AppChatsManager.getChat(id)\n        if (!chat.pFlags.kicked && !chat.pFlags.left) {\n          var myID = AppUsersManager.getSelf().id\n          var myIndex = false\n          var myParticipant\n          for (var i = 0, len = participants.length; i < len; i++) {\n            if (participants[i].user_id == myID) {\n              myIndex = i\n              break\n            }\n          }\n          if (myIndex !== false) {\n            myParticipant = participants[i]\n            participants.splice(i, 1)\n          } else {\n            myParticipant = {_: 'channelParticipantSelf', user_id: myID}\n          }\n          participants.unshift(myParticipant)\n        }\n\n        return participants\n      })\n    }\n\n    function getChannelFull (id, force) {\n      if (chatsFull[id] !== undefined && !force) {\n        return $q.when(chatsFull[id])\n      }\n      if (chatFullPromises[id] !== undefined) {\n        return chatFullPromises[id]\n      }\n\n      return chatFullPromises[id] = MtpApiManager.invokeApi('channels.getFullChannel', {\n        channel: AppChatsManager.getChannelInput(id)\n      }).then(function (result) {\n        AppChatsManager.saveApiChats(result.chats)\n        AppUsersManager.saveApiUsers(result.users)\n        var fullChannel = result.full_chat\n        var chat = AppChatsManager.getChat(id)\n        if (fullChannel && fullChannel.chat_photo.id) {\n          AppPhotosManager.savePhoto(fullChannel.chat_photo)\n        }\n        NotificationsManager.savePeerSettings(-id, fullChannel.notify_settings)\n        var participantsPromise\n        if (fullChannel.flags & 8) {\n          participantsPromise = getChannelParticipants(id).then(function (participants) {\n            delete chatFullPromises[id]\n            fullChannel.participants = {\n              _: 'channelParticipants',\n              participants: participants\n            }\n          }, function (error) {\n            error.handled = true\n          })\n        } else {\n          participantsPromise = $q.when()\n        }\n        return participantsPromise.then(function () {\n          delete chatFullPromises[id]\n          chatsFull[id] = fullChannel\n          $rootScope.$broadcast('chat_full_update', id)\n\n          return fullChannel\n        })\n      }, function (error) {\n        switch (error.type) {\n          case 'CHANNEL_PRIVATE':\n            var channel = AppChatsManager.getChat(id)\n            channel = {_: 'channelForbidden', access_hash: channel.access_hash, title: channel.title}\n            ApiUpdatesManager.processUpdateMessage({\n              _: 'updates',\n              updates: [{\n                _: 'updateChannel',\n                channel_id: id\n              }],\n              chats: [channel],\n              users: []\n            })\n            break\n        }\n        return $q.reject(error)\n      })\n    }\n\n    $rootScope.$on('apiUpdate', function (e, update) {\n      // console.log('on apiUpdate', update)\n      switch (update._) {\n        case 'updateChatParticipants':\n          var participants = update.participants\n          var chatFull = chatsFull[participants.id]\n          if (chatFull !== undefined) {\n            chatFull.participants = update.participants\n            $rootScope.$broadcast('chat_full_update', chatID)\n          }\n          break\n\n        case 'updateChatParticipantAdd':\n          var chatFull = chatsFull[update.chat_id]\n          if (chatFull !== undefined) {\n            var participants = chatFull.participants.participants || []\n            for (var i = 0, length = participants.length; i < length; i++) {\n              if (participants[i].user_id == update.user_id) {\n                return\n              }\n            }\n            participants.push({\n              _: 'chatParticipant',\n              user_id: update.user_id,\n              inviter_id: update.inviter_id,\n              date: tsNow(true)\n            })\n            chatFull.participants.version = update.version\n            $rootScope.$broadcast('chat_full_update', update.chat_id)\n          }\n          break\n\n        case 'updateChatParticipantDelete':\n          var chatFull = chatsFull[update.chat_id]\n          if (chatFull !== undefined) {\n            var participants = chatFull.participants.participants || []\n            for (var i = 0, length = participants.length; i < length; i++) {\n              if (participants[i].user_id == update.user_id) {\n                participants.splice(i, 1)\n                chatFull.participants.version = update.version\n                $rootScope.$broadcast('chat_full_update', update.chat_id)\n                return\n              }\n            }\n          }\n          break\n\n      }\n    })\n\n    $rootScope.$on('chat_update', function (e, chatID) {\n      var fullChat = chatsFull[chatID]\n      var chat = AppChatsManager.getChat(chatID)\n      if (!chat.photo || !fullChat) {\n        return\n      }\n      var emptyPhoto = chat.photo._ == 'chatPhotoEmpty'\n      if (emptyPhoto != (fullChat.chat_photo._ == 'photoEmpty')) {\n        delete chatsFull[chatID]\n        $rootScope.$broadcast('chat_full_update', chatID)\n        return\n      }\n      if (emptyPhoto) {\n        return\n      }\n      var smallUserpic = chat.photo.photo_small\n      var smallPhotoSize = AppPhotosManager.choosePhotoSize(fullChat.chat_photo, 0, 0)\n      if (!angular.equals(smallUserpic, smallPhotoSize.location)) {\n        delete chatsFull[chatID]\n        $rootScope.$broadcast('chat_full_update', chatID)\n      }\n    })\n\n    return {\n      getPeerBots: getPeerBots,\n      getProfile: getProfile,\n      getChatInviteLink: getChatInviteLink,\n      getChatFull: getChatFull,\n      getChannelFull: getChannelFull\n    }\n  })\n\n  .service('AppPhotosManager', function ($modal, $window, $rootScope, MtpApiManager, MtpApiFileManager, AppUsersManager, FileManager) {\n    var photos = {}\n    var windowW = $(window).width()\n    var windowH = $(window).height()\n\n    function savePhoto (apiPhoto, context) {\n      if (context) {\n        angular.extend(apiPhoto, context)\n      }\n      photos[apiPhoto.id] = apiPhoto\n\n      angular.forEach(apiPhoto.sizes, function (photoSize) {\n        if (photoSize._ == 'photoCachedSize') {\n          MtpApiFileManager.saveSmallFile(photoSize.location, photoSize.bytes)\n\n          // Memory\n          photoSize.size = photoSize.bytes.length\n          delete photoSize.bytes\n          photoSize._ = 'photoSize'\n        }\n      })\n    }\n\n    function choosePhotoSize (photo, width, height) {\n      if (Config.Navigator.retina) {\n        width *= 2\n        height *= 2\n      }\n      var bestPhotoSize = {_: 'photoSizeEmpty'}\n      var bestDiff = 0xFFFFFF\n\n      angular.forEach(photo.sizes, function (photoSize) {\n        var diff = Math.abs(photoSize.w * photoSize.h - width * height)\n        if (diff < bestDiff) {\n          bestPhotoSize = photoSize\n          bestDiff = diff\n        }\n      })\n\n      // console.log('choosing', photo, width, height, bestPhotoSize)\n\n      return bestPhotoSize\n    }\n\n    function getUserPhotos (userID, maxID, limit) {\n      var inputUser = AppUsersManager.getUserInput(userID)\n      return MtpApiManager.invokeApi('photos.getUserPhotos', {\n        user_id: inputUser,\n        offset: 0,\n        limit: limit || 20,\n        max_id: maxID || 0\n      }).then(function (photosResult) {\n        AppUsersManager.saveApiUsers(photosResult.users)\n        var photoIDs = []\n        var context = {user_id: userID}\n        for (var i = 0; i < photosResult.photos.length; i++) {\n          savePhoto(photosResult.photos[i], context)\n          photoIDs.push(photosResult.photos[i].id)\n        }\n\n        return {\n          count: photosResult.count || photosResult.photos.length,\n          photos: photoIDs\n        }\n      })\n    }\n\n    function preloadPhoto (photoID) {\n      if (!photos[photoID]) {\n        return\n      }\n      var photo = photos[photoID]\n      var fullWidth = $(window).width() - (Config.Mobile ? 20 : 32)\n      var fullHeight = $($window).height() - (Config.Mobile ? 150 : 116)\n      if (fullWidth > 800) {\n        fullWidth -= 208\n      }\n      var fullPhotoSize = choosePhotoSize(photo, fullWidth, fullHeight)\n\n      if (fullPhotoSize && !fullPhotoSize.preloaded) {\n        fullPhotoSize.preloaded = true\n        if (fullPhotoSize.size) {\n          MtpApiFileManager.downloadFile(fullPhotoSize.location.dc_id, {\n            _: 'inputFileLocation',\n            volume_id: fullPhotoSize.location.volume_id,\n            local_id: fullPhotoSize.location.local_id,\n            secret: fullPhotoSize.location.secret\n          }, fullPhotoSize.size)\n        } else {\n          MtpApiFileManager.downloadSmallFile(fullPhotoSize.location)\n        }\n      }\n    }\n    $rootScope.preloadPhoto = preloadPhoto\n\n    function getPhoto (photoID) {\n      return photos[photoID] || {_: 'photoEmpty'}\n    }\n\n    function wrapForHistory (photoID, options) {\n      options = options || {}\n      var photo = angular.copy(photos[photoID]) || {_: 'photoEmpty'}\n      var width = options.website ? 64 : Math.min(windowW - 80, Config.Mobile ? 210 : 260)\n      var height = options.website ? 64 : Math.min(windowH - 100, Config.Mobile ? 210 : 260)\n      var thumbPhotoSize = choosePhotoSize(photo, width, height)\n      var thumb = {\n        placeholder: 'img/placeholders/PhotoThumbConversation.gif',\n        width: width,\n        height: height\n      }\n\n      if (options.website && Config.Mobile) {\n        width = 50\n        height = 50\n      }\n\n      // console.log('chosen photo size', photoID, thumbPhotoSize)\n      if (thumbPhotoSize && thumbPhotoSize._ != 'photoSizeEmpty') {\n        var dim = calcImageInBox(thumbPhotoSize.w, thumbPhotoSize.h, width, height)\n        thumb.width = dim.w\n        thumb.height = dim.h\n        thumb.location = thumbPhotoSize.location\n        thumb.size = thumbPhotoSize.size\n      } else {\n        thumb.width = 100\n        thumb.height = 100\n      }\n\n      photo.thumb = thumb\n\n      return photo\n    }\n\n    function wrapForFull (photoID) {\n      var photo = wrapForHistory(photoID)\n      var fullWidth = $(window).width() - (Config.Mobile ? 0 : 32)\n      var fullHeight = $($window).height() - (Config.Mobile ? 0 : 116)\n      if (!Config.Mobile && fullWidth > 800) {\n        fullWidth -= 208\n      }\n      var fullPhotoSize = choosePhotoSize(photo, fullWidth, fullHeight)\n      var full = {\n        placeholder: 'img/placeholders/PhotoThumbModal.gif'\n      }\n\n      full.width = fullWidth\n      full.height = fullHeight\n\n      if (fullPhotoSize && fullPhotoSize._ != 'photoSizeEmpty') {\n        var wh = calcImageInBox(fullPhotoSize.w, fullPhotoSize.h, fullWidth, fullHeight, true)\n        full.width = wh.w\n        full.height = wh.h\n\n        full.modalWidth = Math.max(full.width, Math.min(400, fullWidth))\n\n        full.location = fullPhotoSize.location\n        full.size = fullPhotoSize.size\n      }\n\n      photo.full = full\n\n      return photo\n    }\n\n    function openPhoto (photoID, list) {\n      if (!photoID || photoID === '0') {\n        return false\n      }\n\n      var scope = $rootScope.$new(true)\n\n      scope.photoID = photoID\n\n      var controller = 'PhotoModalController'\n      if (list && list.p > 0) {\n        controller = 'UserpicModalController'\n        scope.userID = list.p\n      }\n      else if (list && list.p < 0) {\n        controller = 'ChatpicModalController'\n        scope.chatID = -list.p\n      }\n      else if (list && list.m > 0) {\n        scope.messageID = list.m\n        if (list.w) {\n          scope.webpageID = list.w\n        }\n      }\n\n      var modalInstance = $modal.open({\n        templateUrl: templateUrl('photo_modal'),\n        windowTemplateUrl: templateUrl('media_modal_layout'),\n        controller: controller,\n        scope: scope,\n        windowClass: 'photo_modal_window'\n      })\n    }\n\n    function downloadPhoto (photoID) {\n      var photo = photos[photoID]\n      var ext = 'jpg'\n      var mimeType = 'image/jpeg'\n      var fileName = 'photo' + photoID + '.' + ext\n      var fullWidth = Math.max(screen.width || 0, $(window).width() - 36, 800)\n      var fullHeight = Math.max(screen.height || 0, $($window).height() - 150, 800)\n      var fullPhotoSize = choosePhotoSize(photo, fullWidth, fullHeight)\n      var inputFileLocation = {\n        _: 'inputFileLocation',\n        volume_id: fullPhotoSize.location.volume_id,\n        local_id: fullPhotoSize.location.local_id,\n        secret: fullPhotoSize.location.secret\n      }\n\n      FileManager.chooseSave(fileName, ext, mimeType).then(function (writableFileEntry) {\n        if (writableFileEntry) {\n          MtpApiFileManager.downloadFile(\n            fullPhotoSize.location.dc_id, inputFileLocation, fullPhotoSize.size, {\n              mime: mimeType,\n              toFileEntry: writableFileEntry\n            }).then(function () {\n            // console.log('file save done')\n          }, function (e) {\n            console.log('photo download failed', e)\n          })\n        }\n      }, function () {\n        var cachedBlob = MtpApiFileManager.getCachedFile(inputFileLocation)\n        if (cachedBlob) {\n          return FileManager.download(cachedBlob, mimeType, fileName)\n        }\n\n        MtpApiFileManager.downloadFile(\n          fullPhotoSize.location.dc_id, inputFileLocation, fullPhotoSize.size, {mime: mimeType}\n        ).then(function (blob) {\n          FileManager.download(blob, mimeType, fileName)\n        }, function (e) {\n          console.log('photo download failed', e)\n        })\n      })\n    }\n\n    $rootScope.openPhoto = openPhoto\n\n    return {\n      savePhoto: savePhoto,\n      preloadPhoto: preloadPhoto,\n      getUserPhotos: getUserPhotos,\n      getPhoto: getPhoto,\n      choosePhotoSize: choosePhotoSize,\n      wrapForHistory: wrapForHistory,\n      wrapForFull: wrapForFull,\n      openPhoto: openPhoto,\n      downloadPhoto: downloadPhoto\n    }\n  })\n\n  .service('AppWebPagesManager', function ($modal, $sce, $window, $rootScope, MtpApiManager, AppPhotosManager, AppDocsManager, RichTextProcessor) {\n    var webpages = {}\n    var pendingWebPages = {}\n\n    function saveWebPage (apiWebPage, messageID, mediaContext) {\n      if (apiWebPage.photo && apiWebPage.photo._ === 'photo') {\n        AppPhotosManager.savePhoto(apiWebPage.photo, mediaContext)\n      } else {\n        delete apiWebPage.photo\n      }\n      if (apiWebPage.document && apiWebPage.document._ === 'document') {\n        AppDocsManager.saveDoc(apiWebPage.document, mediaContext)\n      } else {\n        if (apiWebPage.type == 'document') {\n          delete apiWebPage.type\n        }\n        delete apiWebPage.document\n      }\n\n      var siteName = apiWebPage.site_name\n      var shortTitle = apiWebPage.title || apiWebPage.author || siteName || ''\n      if (siteName &&\n        shortTitle == siteName) {\n        delete apiWebPage.site_name\n      }\n      if (shortTitle.length > 100) {\n        shortTitle = shortTitle.substr(0, 80) + '...'\n      }\n      apiWebPage.rTitle = RichTextProcessor.wrapRichText(shortTitle, {noLinks: true, noLinebreaks: true})\n      var contextHashtag = ''\n      if (siteName == 'GitHub') {\n        var matches = apiWebPage.url.match(/(https?:\\/\\/github\\.com\\/[^\\/]+\\/[^\\/]+)/)\n        if (matches) {\n          contextHashtag = matches[0] + '/issues/{1}'\n        }\n      }\n      // delete apiWebPage.description\n      var shortDescriptionText = (apiWebPage.description || '')\n      if (shortDescriptionText.length > 180) {\n        shortDescriptionText = shortDescriptionText.substr(0, 150).replace(/(\\n|\\s)+$/, '') + '...'\n      }\n      apiWebPage.rDescription = RichTextProcessor.wrapRichText(\n        shortDescriptionText, {\n          contextSite: siteName || 'external',\n          contextHashtag: contextHashtag\n        }\n      )\n\n      if (apiWebPage.type != 'photo' &&\n        apiWebPage.type != 'video' &&\n        apiWebPage.type != 'gif' &&\n        apiWebPage.type != 'document' &&\n        !apiWebPage.description &&\n        apiWebPage.photo) {\n        apiWebPage.type = 'photo'\n      }\n\n      if (messageID) {\n        if (pendingWebPages[apiWebPage.id] === undefined) {\n          pendingWebPages[apiWebPage.id] = {}\n        }\n        pendingWebPages[apiWebPage.id][messageID] = true\n        webpages[apiWebPage.id] = apiWebPage\n      }\n\n      if (webpages[apiWebPage.id] === undefined) {\n        webpages[apiWebPage.id] = apiWebPage\n      } else {\n        safeReplaceObject(webpages[apiWebPage.id], apiWebPage)\n      }\n\n      if (!messageID &&\n        pendingWebPages[apiWebPage.id] !== undefined) {\n        var msgs = []\n        angular.forEach(pendingWebPages[apiWebPage.id], function (t, msgID) {\n          msgs.push(msgID)\n        })\n        $rootScope.$broadcast('webpage_updated', {\n          id: apiWebPage.id,\n          msgs: msgs\n        })\n      }\n    }\n\n    function openEmbed (webpageID, messageID) {\n      var scope = $rootScope.$new(true)\n\n      scope.webpageID = webpageID\n      scope.messageID = messageID\n\n      $modal.open({\n        templateUrl: templateUrl('embed_modal'),\n        windowTemplateUrl: templateUrl('media_modal_layout'),\n        controller: 'EmbedModalController',\n        scope: scope,\n        windowClass: 'photo_modal_window'\n      })\n    }\n\n    function wrapForHistory (webPageID) {\n      var webPage = angular.copy(webpages[webPageID]) || {_: 'webPageEmpty'}\n\n      if (webPage.photo && webPage.photo.id) {\n        webPage.photo = AppPhotosManager.wrapForHistory(webPage.photo.id, {website: webPage.type != 'photo' && webPage.type != 'video'})\n      }\n      if (webPage.document && webPage.document.id) {\n        webPage.document = AppDocsManager.wrapForHistory(webPage.document.id)\n      }\n\n      return webPage\n    }\n\n    function wrapForFull (webPageID) {\n      var webPage = wrapForHistory(webPageID)\n\n      if (!webPage.embed_url) {\n        return webPage\n      }\n\n      var fullWidth = $(window).width() - (Config.Mobile ? 0 : 10)\n      var fullHeight = $($window).height() - (Config.Mobile ? 92 : 150)\n\n      if (!Config.Mobile && fullWidth > 800) {\n        fullWidth -= 208\n      }\n\n      var full = {\n        width: fullWidth,\n        height: fullHeight\n      }\n\n      if (!webPage.embed_width || !webPage.embed_height) {\n        full.height = full.width = Math.min(fullWidth, fullHeight)\n      } else {\n        var wh = calcImageInBox(webPage.embed_width, webPage.embed_height, fullWidth, fullHeight)\n        full.width = wh.w\n        full.height = wh.h\n      }\n\n      var embedTag = Config.Modes.chrome_packed ? 'webview' : 'iframe'\n\n      var embedType = webPage.embed_type != 'iframe' ? webPage.embed_type || 'text/html' : 'text/html'\n\n      var embedHtml = '<' + embedTag + ' src=\"' + encodeEntities(webPage.embed_url) + '\" type=\"' + encodeEntities(embedType) + '\" frameborder=\"0\" border=\"0\" webkitallowfullscreen mozallowfullscreen allowfullscreen width=\"' + full.width + '\" height=\"' + full.height + '\" style=\"width: ' + full.width + 'px; height: ' + full.height + 'px;\"></' + embedTag + '>'\n\n      full.html = $sce.trustAs('html', embedHtml)\n\n      webPage.full = full\n\n      return webPage\n    }\n\n    $rootScope.$on('apiUpdate', function (e, update) {\n      switch (update._) {\n        case 'updateWebPage':\n          saveWebPage(update.webpage)\n          break\n      }\n    })\n\n    return {\n      saveWebPage: saveWebPage,\n      openEmbed: openEmbed,\n      wrapForFull: wrapForFull,\n      wrapForHistory: wrapForHistory\n    }\n  })\n\n  .service('AppGamesManager', function ($modal, $sce, $window, $rootScope, MtpApiManager, AppPhotosManager, AppDocsManager, RichTextProcessor) {\n    var games = {}\n\n    function saveGame (apiGame, messageID, mediaContext) {\n      if (apiGame.photo && apiGame.photo._ === 'photo') {\n        AppPhotosManager.savePhoto(apiGame.photo, mediaContext)\n      } else {\n        delete apiGame.photo\n      }\n      if (apiGame.document && apiGame.document._ === 'document') {\n        AppDocsManager.saveDoc(apiGame.document, mediaContext)\n      } else {\n        delete apiGame.document\n      }\n\n      apiGame.rTitle = RichTextProcessor.wrapRichText(apiGame.title, {noLinks: true, noLinebreaks: true})\n      apiGame.rDescription = RichTextProcessor.wrapRichText(\n        apiGame.description || '', {}\n      )\n\n      if (games[apiGame.id] === undefined) {\n        games[apiGame.id] = apiGame\n      } else {\n        safeReplaceObject(games[apiGame.id], apiGame)\n      }\n    }\n\n    function openGame (gameID, messageID, embedUrl) {\n      var scope = $rootScope.$new(true)\n\n      scope.gameID = gameID\n      scope.messageID = messageID\n      scope.embedUrl = embedUrl\n\n      $modal.open({\n        templateUrl: templateUrl('game_modal'),\n        windowTemplateUrl: templateUrl('media_modal_layout'),\n        controller: 'GameModalController',\n        scope: scope,\n        windowClass: 'photo_modal_window mobile_modal'\n      })\n    }\n\n    function wrapForHistory (gameID) {\n      var game = angular.copy(games[gameID]) || {_: 'gameEmpty'}\n\n      if (game.photo && game.photo.id) {\n        game.photo = AppPhotosManager.wrapForHistory(game.photo.id)\n      }\n      if (game.document && game.document.id) {\n        game.document = AppDocsManager.wrapForHistory(game.document.id)\n      }\n\n      return game\n    }\n\n    function wrapForFull (gameID, msgID, embedUrl) {\n      var game = wrapForHistory(gameID)\n\n      var fullWidth = $(window).width() - (Config.Mobile ? 0 : 10)\n      var fullHeight = $($window).height() - (Config.Mobile ? 51 : 150)\n\n      if (!Config.Mobile && fullWidth > 800) {\n        fullWidth -= 208\n      }\n\n      var full = {\n        width: fullWidth,\n        height: fullHeight\n      }\n\n      var embedTag = Config.Modes.chrome_packed ? 'webview' : 'iframe'\n\n      var embedType = 'text/html'\n\n      var embedHtml = '<' + embedTag + ' src=\"' + encodeEntities(embedUrl) + '\" type=\"' + encodeEntities(embedType) + '\" frameborder=\"0\" border=\"0\" webkitallowfullscreen mozallowfullscreen allowfullscreen width=\"' + full.width + '\" height=\"' + full.height + '\" style=\"width: ' + full.width + 'px; height: ' + full.height + 'px;\"></' + embedTag + '>'\n\n      full.html = $sce.trustAs('html', embedHtml)\n\n      game.full = full\n\n      return game\n    }\n\n    return {\n      saveGame: saveGame,\n      openGame: openGame,\n      wrapForFull: wrapForFull,\n      wrapForHistory: wrapForHistory\n    }\n  })\n\n  .service('AppDocsManager', function ($sce, $rootScope, $modal, $window, $q, $timeout, RichTextProcessor, MtpApiFileManager, FileManager, qSync) {\n    var docs = {}\n    var docsForHistory = {}\n    var windowW = $(window).width()\n    var windowH = $(window).height()\n\n    function saveDoc (apiDoc, context) {\n      docs[apiDoc.id] = apiDoc\n\n      if (context) {\n        angular.extend(apiDoc, context)\n      }\n      if (apiDoc.thumb && apiDoc.thumb._ == 'photoCachedSize') {\n        MtpApiFileManager.saveSmallFile(apiDoc.thumb.location, apiDoc.thumb.bytes)\n\n        // Memory\n        apiDoc.thumb.size = apiDoc.thumb.bytes.length\n        delete apiDoc.thumb.bytes\n        apiDoc.thumb._ = 'photoSize'\n      }\n      if (apiDoc.thumb && apiDoc.thumb._ == 'photoSizeEmpty') {\n        delete apiDoc.thumb\n      }\n      angular.forEach(apiDoc.attributes, function (attribute) {\n        switch (attribute._) {\n          case 'documentAttributeFilename':\n            apiDoc.file_name = attribute.file_name\n            break\n          case 'documentAttributeAudio':\n            apiDoc.duration = attribute.duration\n            apiDoc.audioTitle = attribute.title\n            apiDoc.audioPerformer = attribute.performer\n            apiDoc.type = attribute.pFlags.voice ? 'voice' : 'audio'\n            break\n          case 'documentAttributeVideo':\n            apiDoc.duration = attribute.duration\n            apiDoc.w = attribute.w\n            apiDoc.h = attribute.h\n            if (apiDoc.thumb) {\n              apiDoc.type = 'video'\n            }\n            break\n          case 'documentAttributeSticker':\n            apiDoc.sticker = true\n            if (attribute.alt !== undefined) {\n              apiDoc.stickerEmojiRaw = attribute.alt\n              apiDoc.stickerEmoji = RichTextProcessor.wrapRichText(apiDoc.stickerEmojiRaw, {noLinks: true, noLinebreaks: true})\n            }\n            if (attribute.stickerset) {\n              if (attribute.stickerset._ == 'inputStickerSetEmpty') {\n                delete attribute.stickerset\n              }\n              else if (attribute.stickerset._ == 'inputStickerSetID') {\n                apiDoc.stickerSetInput = attribute.stickerset\n              }\n            }\n            if (apiDoc.thumb && apiDoc.mime_type == 'image/webp') {\n              apiDoc.type = 'sticker'\n            }\n            break\n          case 'documentAttributeImageSize':\n            apiDoc.w = attribute.w\n            apiDoc.h = attribute.h\n            break\n          case 'documentAttributeAnimated':\n            if ((apiDoc.mime_type == 'image/gif' || apiDoc.mime_type == 'video/mp4') &&\n              apiDoc.thumb) {\n              apiDoc.type = 'gif'\n            }\n            apiDoc.animated = true\n            break\n        }\n      })\n\n      if (!apiDoc.mime_type) {\n        switch (apiDoc.type) {\n          case 'gif':\n            apiDoc.mime_type = 'video/mp4'\n            break\n          case 'video':\n            apiDoc.mime_type = 'video/mp4'\n            break\n          case 'sticker':\n            apiDoc.mime_type = 'image/webp'\n            break\n          case 'audio':\n            apiDoc.mime_type = 'audio/mpeg'\n            break\n          case 'voice':\n            apiDoc.mime_type = 'audio/ogg'\n            break\n          default:\n            apiDoc.mime_type = 'application/octet-stream'\n            break\n        }\n      }\n\n      if (!apiDoc.file_name) {\n        apiDoc.file_name = ''\n      }\n\n      if (apiDoc._ == 'documentEmpty') {\n        apiDoc.size = 0\n      }\n    }\n\n    function getDoc (docID) {\n      return docs[docID] || {_: 'documentEmpty'}\n    }\n\n    function hasDoc (docID) {\n      return docs[docID] !== undefined\n    }\n\n    function getFileName (doc) {\n      if (doc.file_name) {\n        return doc.file_name\n      }\n      var fileExt = '.' + doc.mime_type.split('/')[1]\n      if (fileExt == '.octet-stream') {\n        fileExt = ''\n      }\n      return 't_' + (doc.type || 'file') + doc.id + fileExt\n    }\n\n    function wrapForHistory (docID) {\n      if (docsForHistory[docID] !== undefined) {\n        return docsForHistory[docID]\n      }\n\n      var doc = angular.copy(docs[docID])\n      var thumbPhotoSize = doc.thumb\n      var inlineImage = false,\n        boxWidth\n      var boxHeight, thumb\n      var dim\n\n      switch (doc.type) {\n        case 'video':\n          boxWidth = Math.min(windowW - 80, Config.Mobile ? 210 : 150),\n          boxHeight = Math.min(windowH - 100, Config.Mobile ? 210 : 150)\n          break\n\n        case 'sticker':\n          inlineImage = true\n          boxWidth = Math.min(windowW - 80, Config.Mobile ? 128 : 192)\n          boxHeight = Math.min(windowH - 100, Config.Mobile ? 128 : 192)\n          break\n\n        case 'gif':\n          inlineImage = true\n          boxWidth = Math.min(windowW - 80, Config.Mobile ? 210 : 260)\n          boxHeight = Math.min(windowH - 100, Config.Mobile ? 210 : 260)\n          break\n\n        default:\n          boxWidth = boxHeight = 100\n      }\n\n      if (inlineImage && doc.w && doc.h) {\n        dim = calcImageInBox(doc.w, doc.h, boxWidth, boxHeight)\n      }\n      else if (thumbPhotoSize) {\n        dim = calcImageInBox(thumbPhotoSize.w, thumbPhotoSize.h, boxWidth, boxHeight)\n      }\n\n      if (dim) {\n        thumb = {\n          width: dim.w,\n          height: dim.h\n        }\n        if (thumbPhotoSize) {\n          thumb.location = thumbPhotoSize.location\n          thumb.size = thumbPhotoSize.size\n        }\n      } else {\n        thumb = false\n      }\n      doc.thumb = thumb\n\n      doc.withPreview = !Config.Mobile && doc.mime_type.match(/^image\\/(gif|png|jpeg|jpg|bmp|tiff)/) ? 1 : 0\n\n      return docsForHistory[docID] = doc\n    }\n\n    function updateDocDownloaded (docID) {\n      var doc = docs[docID]\n      var historyDoc = docsForHistory[docID] || doc || {}\n      var inputFileLocation = {\n        _: 'inputDocumentFileLocation',\n        id: docID,\n        access_hash: doc.access_hash,\n        version: doc.version,\n        file_name: getFileName(doc)\n      }\n\n      if (historyDoc.downloaded === undefined) {\n        MtpApiFileManager.getDownloadedFile(inputFileLocation, doc.size).then(function () {\n          historyDoc.downloaded = true\n        }, function () {\n          historyDoc.downloaded = false\n        })\n      }\n    }\n\n    function downloadDoc (docID, toFileEntry) {\n      var doc = docs[docID]\n      var historyDoc = docsForHistory[docID] || doc || {}\n      var inputFileLocation = {\n        _: 'inputDocumentFileLocation',\n        id: docID,\n        access_hash: doc.access_hash,\n        version: doc.version,\n        file_name: getFileName(doc)\n      }\n\n      if (doc._ == 'documentEmpty') {\n        return $q.reject()\n      }\n\n      if (historyDoc.downloaded && !toFileEntry) {\n        var cachedBlob = MtpApiFileManager.getCachedFile(inputFileLocation)\n        if (cachedBlob) {\n          return qSync.when(cachedBlob)\n        }\n      }\n\n      historyDoc.progress = {enabled: !historyDoc.downloaded, percent: 1, total: doc.size}\n\n      var downloadPromise = MtpApiFileManager.downloadFile(doc.dc_id, inputFileLocation, doc.size, {\n        mime: doc.mime_type || 'application/octet-stream',\n        toFileEntry: toFileEntry\n      })\n\n      downloadPromise.then(function (blob) {\n        if (blob) {\n          FileManager.getFileCorrectUrl(blob, doc.mime_type).then(function (url) {\n            var trustedUrl = $sce.trustAsResourceUrl(url)\n            historyDoc.url = trustedUrl\n            doc.url = trustedUrl\n          })\n          historyDoc.downloaded = true\n        }\n        historyDoc.progress.percent = 100\n        $timeout(function () {\n          delete historyDoc.progress\n        })\n      // console.log('file save done')\n      }, function (e) {\n        console.log('document download failed', e)\n        historyDoc.progress.enabled = false\n      }, function (progress) {\n        console.log('dl progress', progress)\n        historyDoc.progress.enabled = true\n        historyDoc.progress.done = progress.done\n        historyDoc.progress.percent = Math.max(1, Math.floor(100 * progress.done / progress.total))\n        $rootScope.$broadcast('history_update')\n      })\n\n      historyDoc.progress.cancel = downloadPromise.cancel\n\n      return downloadPromise\n    }\n\n    function openDoc (docID, messageID) {\n      var scope = $rootScope.$new(true)\n      scope.docID = docID\n      scope.messageID = messageID\n\n      var modalInstance = $modal.open({\n        templateUrl: templateUrl('document_modal'),\n        windowTemplateUrl: templateUrl('media_modal_layout'),\n        controller: 'DocumentModalController',\n        scope: scope,\n        windowClass: 'document_modal_window'\n      })\n    }\n\n    function saveDocFile (docID) {\n      var doc = docs[docID]\n      var historyDoc = docsForHistory[docID] || doc || {}\n      var mimeType = doc.mime_type\n      var fileName = getFileName(doc)\n      var ext = (fileName.split('.', 2) || [])[1] || ''\n\n      FileManager.chooseSave(getFileName(doc), ext, doc.mime_type).then(function (writableFileEntry) {\n        if (writableFileEntry) {\n          downloadDoc(docID, writableFileEntry)\n        }\n      }, function () {\n        downloadDoc(docID).then(function (blob) {\n          FileManager.download(blob, doc.mime_type, fileName)\n        })\n      })\n    }\n\n    function wrapVideoForFull (docID) {\n      var doc = wrapForHistory(docID)\n      var fullWidth = Math.min($(window).width() - (Config.Mobile ? 0 : 60), 542)\n      var fullHeight = $(window).height() - (Config.Mobile ? 92 : 150)\n      var full = {\n        placeholder: 'img/placeholders/docThumbModal.gif',\n        width: fullWidth,\n        height: fullHeight\n      }\n\n      if (!doc.w || !doc.h) {\n        full.height = full.width = Math.min(fullWidth, fullHeight)\n      } else {\n        var dim = calcImageInBox(doc.w, doc.h, fullWidth, fullHeight)\n        full.width = dim.w\n        full.height = dim.h\n      }\n\n      doc.full = full\n      doc.fullThumb = angular.copy(doc.thumb)\n      doc.fullThumb.width = full.width\n      doc.fullThumb.height = full.height\n\n      return doc\n    }\n\n    function openVideo (docID, messageID) {\n      var scope = $rootScope.$new(true)\n      scope.docID = docID\n      scope.messageID = messageID\n\n      return $modal.open({\n        templateUrl: templateUrl('video_modal'),\n        windowTemplateUrl: templateUrl('media_modal_layout'),\n        controller: 'VideoModalController',\n        scope: scope,\n        windowClass: 'video_modal_window'\n      })\n    }\n\n    return {\n      saveDoc: saveDoc,\n      getDoc: getDoc,\n      hasDoc: hasDoc,\n      wrapForHistory: wrapForHistory,\n      wrapVideoForFull: wrapVideoForFull,\n      updateDocDownloaded: updateDocDownloaded,\n      downloadDoc: downloadDoc,\n      openDoc: openDoc,\n      openVideo: openVideo,\n      saveDocFile: saveDocFile\n    }\n  })\n\n  .service('AppStickersManager', function ($q, $rootScope, $modal, _, FileManager, MtpApiManager, AppDocsManager, Storage, ApiUpdatesManager) {\n    var started = false\n    var applied = false\n    var currentStickerSets = []\n\n    $rootScope.$on('apiUpdate', function (e, update) {\n      if (update._ != 'updateStickerSets' &&\n        update._ != 'updateNewStickerSet' &&\n        update._ != 'updateDelStickerSet' &&\n        update._ != 'updateStickerSetsOrder') {\n        return false\n      }\n\n      return Storage.get('all_stickers').then(function (stickers) {\n        if (!stickers ||\n          stickers.layer != Config.Schema.API.layer) {\n          $rootScope.$broadcast('stickers_changed')\n        }\n        switch (update._) {\n          case 'updateNewStickerSet':\n            var fullSet = update.stickerset\n            var set = fullSet.set\n            if (set.pFlags.masks) {\n              return false\n            }\n            var pos = false\n            for (var i = 0, len = stickers.sets.length; i < len; i++) {\n              if (stickers.sets[i].id == set.id) {\n                pos = i\n                break\n              }\n            }\n            if (pos !== false) {\n              stickers.sets.splice(pos, 1)\n            }\n            set.pFlags.installed = true\n            stickers.sets.unshift(set)\n            stickers.fullSets[set.id] = fullSet\n            break\n\n          case 'updateDelStickerSet':\n            var set\n            for (var i = 0, len = stickers.sets.length; i < len; i++) {\n              set = stickers.sets[i]\n              if (set.id == update.id) {\n                set.pFlags.installed = false\n                stickers.sets.splice(i, 1)\n                break\n              }\n            }\n            delete stickers.fullSets[update.id]\n            break\n\n          case 'updateStickerSetsOrder':\n            if (update.pFlags.masks) {\n              return\n            }\n            var order = update.order\n            stickers.sets.sort(function (a, b) {\n              return order.indexOf(a.id) - order.indexOf(b.id)\n            })\n            break\n        }\n        stickers.hash = getStickerSetsHash(stickers.sets)\n        stickers.date = 0\n        Storage.set({all_stickers: stickers}).then(function () {\n          $rootScope.$broadcast('stickers_changed')\n        })\n      })\n    })\n\n    return {\n      start: start,\n      getStickers: getStickers,\n      openStickersetLink: openStickersetLink,\n      openStickerset: openStickerset,\n      installStickerset: installStickerset,\n      pushPopularSticker: pushPopularSticker,\n      getStickerset: getStickerset\n    }\n\n    function start () {\n      if (!started) {\n        started = true\n        setTimeout(getStickers, 1000)\n      }\n    }\n\n    function getStickers (force) {\n      return Storage.get('all_stickers').then(function (stickers) {\n        var layer = Config.Schema.API.layer\n        if (stickers.layer != layer) {\n          stickers = false\n        }\n        if (stickers && stickers.date > tsNow(true) && !force) {\n          return processRawStickers(stickers)\n        }\n        return MtpApiManager.invokeApi('messages.getAllStickers', {\n          hash: stickers && stickers.hash || ''\n        }).then(function (newStickers) {\n          var notModified = newStickers._ == 'messages.allStickersNotModified'\n          if (notModified) {\n            newStickers = stickers\n          }\n          newStickers.date = tsNow(true) + 3600\n          newStickers.layer = layer\n          delete newStickers._\n\n          if (notModified) {\n            Storage.set({all_stickers: newStickers})\n            return processRawStickers(newStickers)\n          }\n\n          return getStickerSets(newStickers, stickers && stickers.fullSets).then(function () {\n            Storage.set({all_stickers: newStickers})\n            return processRawStickers(newStickers)\n          })\n        })\n      })\n    }\n\n    function processRawStickers (stickers) {\n      if (applied !== stickers.hash) {\n        applied = stickers.hash\n        var i\n        var j, len1\n        var len2, doc\n        var set, docIDs\n        var documents\n\n        currentStickerSets = []\n        len1 = stickers.sets.length\n        for (i = 0; i < len1; i++) {\n          set = stickers.sets[i]\n          if (set.pFlags.disabled) {\n            continue\n          }\n          documents = stickers.fullSets[set.id].documents\n          len2 = documents.length\n          docIDs = []\n          for (j = 0; j < len2; j++) {\n            doc = documents[j]\n            AppDocsManager.saveDoc(doc)\n            docIDs.push(doc.id)\n          }\n          set.docIDs = docIDs\n          currentStickerSets.push(set)\n        }\n      }\n\n      return getPopularStickers().then(function (popularStickers) {\n        var resultStickersets = currentStickerSets\n        if (popularStickers.length) {\n          resultStickersets = currentStickerSets.slice()\n          var docIDs = []\n          var i\n          var len\n          for (i = 0, len = popularStickers.length; i < len; i++) {\n            docIDs.push(popularStickers[i].id)\n          }\n          resultStickersets.unshift({\n            id: 0,\n            title: _('im_stickers_tab_recent_raw'),\n            short_name: '',\n            docIDs: docIDs\n          })\n        }\n        return resultStickersets\n      })\n    }\n\n    function getStickerSets (allStickers, prevCachedSets) {\n      var promises = []\n      var cachedSets = prevCachedSets || allStickers.fullSets || {}\n      allStickers.fullSets = {}\n      angular.forEach(allStickers.sets, function (shortSet) {\n        var fullSet = cachedSets[shortSet.id]\n        if (fullSet && fullSet.set.hash == shortSet.hash) {\n          allStickers.fullSets[shortSet.id] = fullSet\n        } else {\n          var promise = MtpApiManager.invokeApi('messages.getStickerSet', {\n            stickerset: {\n              _: 'inputStickerSetID',\n              id: shortSet.id,\n              access_hash: shortSet.access_hash\n            }\n          }).then(function (fullSet) {\n            allStickers.fullSets[shortSet.id] = fullSet\n          })\n          promises.push(promise)\n        }\n      })\n      return $q.all(promises)\n    }\n\n    function getPopularStickers () {\n      return Storage.get('stickers_popular').then(function (popStickers) {\n        var result = []\n        var i, len\n        var docID\n        if (popStickers && popStickers.length) {\n          for (i = 0, len = popStickers.length; i < len; i++) {\n            docID = popStickers[i][0]\n            if (AppDocsManager.hasDoc(docID)) {\n              result.push({id: docID, rate: popStickers[i][1]})\n            }\n          }\n        }\n        return result\n      })\n    }\n\n    function pushPopularSticker (id) {\n      getPopularStickers().then(function (popularStickers) {\n        var exists = false\n        var count = popularStickers.length\n        var result = []\n        for (var i = 0; i < count; i++) {\n          if (popularStickers[i].id == id) {\n            exists = true\n            popularStickers[i].rate++\n          }\n          result.push([popularStickers[i].id, popularStickers[i].rate])\n        }\n        if (exists) {\n          result.sort(function (a, b) {\n            return b[1] - a[1]\n          })\n        } else {\n          if (result.length > 15) {\n            result = result.slice(0, 15)\n          }\n          result.push([id, 1])\n        }\n        ConfigStorage.set({stickers_popular: result})\n      })\n    }\n\n    function getStickerset (inputStickerset) {\n      return MtpApiManager.invokeApi('messages.getStickerSet', {\n        stickerset: inputStickerset\n      }).then(function (result) {\n        for (var i = 0; i < result.documents.length; i++) {\n          AppDocsManager.saveDoc(result.documents[i])\n        }\n        return result\n      })\n    }\n\n    function installStickerset (fullSet, uninstall) {\n      var method = uninstall\n        ? 'messages.uninstallStickerSet'\n        : 'messages.installStickerSet'\n      var inputStickerset = {\n        _: 'inputStickerSetID',\n        id: fullSet.set.id,\n        access_hash: fullSet.set.access_hash\n      }\n      return MtpApiManager.invokeApi(method, {\n        stickerset: inputStickerset,\n        disabled: false\n      }).then(function (result) {\n        var update\n        if (uninstall) {\n          update = {_: 'updateDelStickerSet', id: fullSet.set.id}\n        } else {\n          update = {_: 'updateNewStickerSet', stickerset: fullSet}\n        }\n        ApiUpdatesManager.processUpdateMessage({\n          _: 'updateShort',\n          update: update\n        })\n      })\n    }\n\n    function openStickersetLink (shortName) {\n      return openStickerset({\n        _: 'inputStickerSetShortName',\n        short_name: shortName\n      })\n    }\n\n    function openStickerset (inputStickerset) {\n      var scope = $rootScope.$new(true)\n      scope.inputStickerset = inputStickerset\n      var modal = $modal.open({\n        templateUrl: templateUrl('stickerset_modal'),\n        controller: 'StickersetModalController',\n        scope: scope,\n        windowClass: 'stickerset_modal_window mobile_modal'\n      })\n    }\n\n    function getStickerSetsHash (stickerSets) {\n      var acc = 0\n      var set\n      for (var i = 0; i < stickerSets.length; i++) {\n        set = stickerSets[i]\n        if (set.pFlags.disabled || !set.pFlags.installed) {\n          continue\n        }\n        acc = ((acc * 20261) + 0x80000000 + set.hash) % 0x80000000\n      }\n      return acc\n    }\n  })\n\n  .service('AppInlineBotsManager', function (qSync, $q, $rootScope, toaster, Storage, ErrorService, MtpApiManager, AppMessagesManager, AppMessagesIDsManager, AppDocsManager, AppPhotosManager, AppGamesManager, RichTextProcessor, AppUsersManager, AppPeersManager, PeersSelectService, GeoLocationManager) {\n    var inlineResults = {}\n\n    return {\n      resolveInlineMention: resolveInlineMention,\n      getPopularBots: getPopularBots,\n      sendInlineResult: sendInlineResult,\n      getInlineResults: getInlineResults,\n      regroupWrappedResults: regroupWrappedResults,\n      switchToPM: switchToPM,\n      checkSwitchReturn: checkSwitchReturn,\n      switchInlineButtonClick: switchInlineButtonClick,\n      callbackButtonClick: callbackButtonClick,\n      gameButtonClick: gameButtonClick\n    }\n\n    function getPopularBots () {\n      return Storage.get('inline_bots_popular').then(function (bots) {\n        var result = []\n        var i, len\n        var userID\n        if (bots && bots.length) {\n          var now = tsNow(true)\n          for (i = 0, len = bots.length; i < len; i++) {\n            if ((now - bots[i][3]) > 14 * 86400) {\n              continue\n            }\n            userID = bots[i][0]\n            if (!AppUsersManager.hasUser(userID)) {\n              AppUsersManager.saveApiUser(bots[i][1])\n            }\n            result.push({id: userID, rate: bots[i][2], date: bots[i][3]})\n          }\n        }\n        return result\n      })\n    }\n\n    function pushPopularBot (id) {\n      getPopularBots().then(function (bots) {\n        var exists = false\n        var count = bots.length\n        var result = []\n        for (var i = 0; i < count; i++) {\n          if (bots[i].id == id) {\n            exists = true\n            bots[i].rate++\n            bots[i].date = tsNow(true)\n          }\n          var user = AppUsersManager.getUser(bots[i].id)\n          result.push([bots[i].id, user, bots[i].rate, bots[i].date])\n        }\n        if (exists) {\n          result.sort(function (a, b) {\n            return b[2] - a[2]\n          })\n        } else {\n          if (result.length > 15) {\n            result = result.slice(0, 15)\n          }\n          result.push([id, AppUsersManager.getUser(id), 1, tsNow(true)])\n        }\n        ConfigStorage.set({inline_bots_popular: result})\n\n        $rootScope.$broadcast('inline_bots_popular')\n      })\n    }\n\n    function resolveInlineMention (username) {\n      return AppPeersManager.resolveUsername(username).then(function (peerID) {\n        if (peerID > 0) {\n          var bot = AppUsersManager.getUser(peerID)\n          if (bot.pFlags.bot && bot.bot_inline_placeholder !== undefined) {\n            var resolvedBot = {\n              username: username,\n              id: peerID,\n              placeholder: bot.bot_inline_placeholder\n            }\n            if (bot.pFlags.bot_inline_geo &&\n              GeoLocationManager.isAvailable()) {\n              return checkGeoLocationAccess(peerID).then(function () {\n                return GeoLocationManager.getPosition().then(function (coords) {\n                  resolvedBot.geo = coords\n                  return qSync.when(resolvedBot)\n                })\n              })['catch'](function () {\n                return qSync.when(resolvedBot)\n              })\n            }\n            return qSync.when(resolvedBot)\n          }\n        }\n        return $q.reject()\n      }, function (error) {\n        error.handled = true\n        return $q.reject(error)\n      })\n    }\n\n    function getInlineResults (peerID, botID, query, geo, offset) {\n      return MtpApiManager.invokeApi('messages.getInlineBotResults', {\n        flags: 0 | (geo ? 1 : 0),\n        bot: AppUsersManager.getUserInput(botID),\n        peer: AppPeersManager.getInputPeerByID(peerID),\n        query: query,\n        geo_point: geo && {_: 'inputGeoPoint', lat: geo['lat'], long: geo['long']},\n        offset: offset\n      }, {timeout: 1, stopTime: -1, noErrorBox: true}).then(function (botResults) {\n        var queryID = botResults.query_id\n        delete botResults._\n        delete botResults.flags\n        delete botResults.query_id\n\n        if (botResults.switch_pm) {\n          botResults.switch_pm.rText = RichTextProcessor.wrapRichText(botResults.switch_pm.text, {noLinebreaks: true, noLinks: true})\n        }\n\n        angular.forEach(botResults.results, function (result) {\n          var qID = queryID + '_' + result.id\n          result.qID = qID\n          result.botID = botID\n\n          result.rTitle = RichTextProcessor.wrapRichText(result.title, {noLinebreaks: true, noLinks: true})\n          result.rDescription = RichTextProcessor.wrapRichText(result.description, {noLinebreaks: true, noLinks: true})\n          result.initials = (result.url || result.title || result.type || '').substr(0, 1)\n\n          if (result.document) {\n            AppDocsManager.saveDoc(result.document)\n          }\n          if (result.photo) {\n            AppPhotosManager.savePhoto(result.photo)\n          }\n\n          inlineResults[qID] = result\n        })\n        return botResults\n      })\n    }\n\n    function regroupWrappedResults (results, rowW, rowH) {\n      if (!results ||\n        !results[0] ||\n        results[0].type != 'photo' && results[0].type != 'gif' && results[0].type != 'sticker') {\n        return\n      }\n      var ratios = []\n      angular.forEach(results, function (result) {\n        var w\n        var h, doc\n        var photo\n        if (result._ == 'botInlineMediaResult') {\n          if (doc = result.document) {\n            w = result.document.w\n            h = result.document.h\n          }\n          else if (photo = result.photo) {\n            var photoSize = (photo.sizes || [])[0]\n            w = photoSize && photoSize.w\n            h = photoSize && photoSize.h\n          }\n        }else {\n          w = result.w\n          h = result.h\n        }\n        if (!w || !h) {\n          w = h = 1\n        }\n        ratios.push(w / h)\n      })\n\n      var rows = []\n      var curCnt = 0\n      var curW = 0\n      angular.forEach(ratios, function (ratio) {\n        var w = ratio * rowH\n        curW += w\n        if (!curCnt || curCnt < 4 && curW < (rowW * 1.1)) {\n          curCnt++\n        } else {\n          rows.push(curCnt)\n          curCnt = 1\n          curW = w\n        }\n      })\n      if (curCnt) {\n        rows.push(curCnt)\n      }\n\n      var i = 0\n      var thumbs = []\n      var lastRowI = rows.length - 1\n      angular.forEach(rows, function (rowCnt, rowI) {\n        var lastRow = rowI == lastRowI\n        var curRatios = ratios.slice(i, i + rowCnt)\n        var sumRatios = 0\n        angular.forEach(curRatios, function (ratio) {\n          sumRatios += ratio\n        })\n        angular.forEach(curRatios, function (ratio, j) {\n          var thumbH = rowH\n          var thumbW = rowW * ratio / sumRatios\n          var realW = thumbH * ratio\n          if (lastRow && thumbW > realW) {\n            thumbW = realW\n          }\n          var result = results[i + j]\n          result.thumbW = Math.floor(thumbW) - 2\n          result.thumbH = Math.floor(thumbH) - 2\n        })\n\n        i += rowCnt\n      })\n    }\n\n    function switchToPM (fromPeerID, botID, startParam) {\n      var peerString = AppPeersManager.getPeerString(fromPeerID)\n      var setHash = {}\n      setHash['inline_switch_pm' + botID] = {peer: peerString, time: tsNow()}\n      Storage.set(setHash)\n      $rootScope.$broadcast('history_focus', {peerString: AppPeersManager.getPeerString(botID)})\n      AppMessagesManager.startBot(botID, 0, startParam)\n    }\n\n    function checkSwitchReturn (botID) {\n      var bot = AppUsersManager.getUser(botID)\n      if (!bot || !bot.pFlags.bot || !bot.bot_inline_placeholder) {\n        return qSync.when(false)\n      }\n      var key = 'inline_switch_pm' + botID\n      return Storage.get(key).then(function (peerData) {\n        if (peerData) {\n          Storage.remove(key)\n          if (tsNow() - peerData.time < 3600000) {\n            return peerData.peer\n          }\n        }\n        return false\n      })\n    }\n\n    function switchInlineQuery (botID, toPeerString, query) {\n      $rootScope.$broadcast('history_focus', {\n        peerString: toPeerString,\n        attachment: {\n          _: 'inline_query',\n          mention: '@' + AppUsersManager.getUser(botID).username,\n          query: query\n        }\n      })\n    }\n\n    function switchInlineButtonClick (id, button) {\n      var message = AppMessagesManager.getMessage(id)\n      var botID = message.viaBotID || message.fromID\n      if (button.pFlags && button.pFlags.same_peer) {\n        var peerID = AppMessagesManager.getMessagePeer(message)\n        var toPeerString = AppPeersManager.getPeerString(peerID)\n        switchInlineQuery(botID, toPeerString, button.query)\n        return\n      }\n      return checkSwitchReturn(botID).then(function (retPeerString) {\n        if (retPeerString) {\n          return switchInlineQuery(botID, retPeerString, button.query)\n        }\n        PeersSelectService.selectPeer({\n          canSend: true\n        }).then(function (toPeerString) {\n          return switchInlineQuery(botID, toPeerString, button.query)\n        })\n      })\n    }\n\n    function callbackButtonClick (id, button) {\n      var message = AppMessagesManager.getMessage(id)\n      var botID = message.fromID\n      var peerID = AppMessagesManager.getMessagePeer(message)\n\n      return MtpApiManager.invokeApi('messages.getBotCallbackAnswer', {\n        flags: 1,\n        peer: AppPeersManager.getInputPeerByID(peerID),\n        msg_id: AppMessagesIDsManager.getMessageLocalID(id),\n        data: button.data\n      }, {timeout: 1, stopTime: -1, noErrorBox: true}).then(function (callbackAnswer) {\n        if (typeof callbackAnswer.message === 'string' &&\n            callbackAnswer.message.length) {\n          showCallbackMessage(callbackAnswer.message, callbackAnswer.pFlags.alert)\n        }\n        else if (typeof callbackAnswer.url === 'string') {\n          LocationParamsService.openUrl(callbackAnswer.url)\n        }\n      })\n    }\n\n    function gameButtonClick (id) {\n      console.trace()\n      var message = AppMessagesManager.getMessage(id)\n      var peerID = AppMessagesManager.getMessagePeer(message)\n\n      return MtpApiManager.invokeApi('messages.getBotCallbackAnswer', {\n        flags: 2,\n        peer: AppPeersManager.getInputPeerByID(peerID),\n        msg_id: AppMessagesIDsManager.getMessageLocalID(id)\n      }, {timeout: 1, stopTime: -1, noErrorBox: true}).then(function (callbackAnswer) {\n        if (typeof callbackAnswer.message === 'string' &&\n            callbackAnswer.message.length) {\n          showCallbackMessage(callbackAnswer.message, callbackAnswer.pFlags.alert)\n        }\n        else if (typeof callbackAnswer.url === 'string') {\n          AppGamesManager.openGame(message.media.game.id, id, callbackAnswer.url)\n        }\n      })\n    }\n\n    function showCallbackMessage(message, isAlert) {\n      if (typeof message != 'string' ||\n        !message.length) {\n        return\n      }\n      var html = RichTextProcessor.wrapRichText(message, {noLinks: true, noLinebreaks: true})\n      if (isAlert) {\n        ErrorService.show({\n          title_html: html,\n          alert: true\n        })\n      } else {\n        toaster.pop({\n          type: 'info',\n          body: html.valueOf(),\n          bodyOutputType: 'trustedHtml',\n          showCloseButton: false\n        })\n      }\n    }\n\n    function sendInlineResult (peerID, qID, options) {\n      var inlineResult = inlineResults[qID]\n      if (inlineResult === undefined) {\n        return false\n      }\n      pushPopularBot(inlineResult.botID)\n      var splitted = qID.split('_')\n      var queryID = splitted.shift()\n      var resultID = splitted.join('_')\n      options = options || {}\n      options.viaBotID = inlineResult.botID\n      options.queryID = queryID\n      options.resultID = resultID\n      if (inlineResult.send_message.reply_markup) {\n        options.reply_markup = inlineResult.send_message.reply_markup\n      }\n\n      if (inlineResult.send_message._ == 'botInlineMessageText') {\n        options.entities = inlineResult.send_message.entities\n        AppMessagesManager.sendText(peerID, inlineResult.send_message.message, options)\n      } else {\n        var caption = ''\n        var inputMedia = false\n        switch (inlineResult.send_message._) {\n          case 'botInlineMessageMediaAuto':\n            caption = inlineResult.send_message.caption\n            if (inlineResult._ == 'botInlineMediaResult') {\n              var doc = inlineResult.document\n              var photo = inlineResult.photo\n              if (doc) {\n                inputMedia = {\n                  _: 'inputMediaDocument',\n                  id: {_: 'inputDocument', id: doc.id, access_hash: doc.access_hash},\n                  caption: caption\n                }\n              } else {\n                inputMedia = {\n                  _: 'inputMediaPhoto',\n                  id: {_: 'inputPhoto', id: photo.id, access_hash: photo.access_hash},\n                  caption: caption\n                }\n              }\n            }\n            break\n\n          case 'botInlineMessageMediaGeo':\n            inputMedia = {\n              _: 'inputMediaGeoPoint',\n              geo_point: {\n                _: 'inputGeoPoint',\n                'lat': inlineResult.send_message.geo['lat'],\n                'long': inlineResult.send_message.geo['long']\n              }\n            }\n            break\n\n          case 'botInlineMessageMediaVenue':\n            inputMedia = {\n              _: 'inputMediaVenue',\n              geo_point: {\n                _: 'inputGeoPoint',\n                'lat': inlineResult.send_message.geo['lat'],\n                'long': inlineResult.send_message.geo['long']\n              },\n              title: inlineResult.send_message.title,\n              address: inlineResult.send_message.address,\n              provider: inlineResult.send_message.provider,\n              venue_id: inlineResult.send_message.venue_id\n            }\n            break\n\n          case 'botInlineMessageMediaContact':\n            inputMedia = {\n              _: 'inputMediaContact',\n              phone_number: inlineResult.send_message.phone_number,\n              first_name: inlineResult.send_message.first_name,\n              last_name: inlineResult.send_message.last_name\n            }\n            break\n        }\n        if (!inputMedia) {\n          inputMedia = {\n            _: 'messageMediaPending',\n            type: inlineResult.type,\n            file_name: inlineResult.title || inlineResult.content_url || inlineResult.url,\n            size: 0,\n            progress: {percent: 30, total: 0}\n          }\n        }\n        AppMessagesManager.sendOther(peerID, inputMedia, options)\n      }\n    }\n\n    function checkGeoLocationAccess (botID) {\n      var key = 'bot_access_geo' + botID\n      return Storage.get(key).then(function (geoAccess) {\n        if (geoAccess && geoAccess.granted) {\n          return true\n        }\n        return ErrorService.confirm({\n          type: 'BOT_ACCESS_GEO_INLINE'\n        }).then(function () {\n          var setHash = {}\n          setHash[key] = {granted: true, time: tsNow()}\n          Storage.set(setHash)\n          return true\n        }, function () {\n          var setHash = {}\n          setHash[key] = {denied: true, time: tsNow()}\n          Storage.set(setHash)\n          return $q.reject()\n        })\n      })\n    }\n  })\n\n  .service('ApiUpdatesManager', function ($rootScope, MtpNetworkerFactory, AppUsersManager, AppChatsManager, AppPeersManager, MtpApiManager) {\n    var updatesState = {\n      pendingPtsUpdates: [],\n      pendingSeqUpdates: {},\n      syncPending: false,\n      syncLoading: true\n    }\n    var channelStates = {}\n\n    var myID = 0\n    MtpApiManager.getUserID().then(function (id) {\n      myID = id\n    })\n\n    function popPendingSeqUpdate () {\n      var nextSeq = updatesState.seq + 1\n      var pendingUpdatesData = updatesState.pendingSeqUpdates[nextSeq]\n      if (!pendingUpdatesData) {\n        return false\n      }\n      var updates = pendingUpdatesData.updates\n      var i\n      var length\n      for (var i = 0, length = updates.length; i < length; i++) {\n        saveUpdate(updates[i])\n      }\n      updatesState.seq = pendingUpdatesData.seq\n      if (pendingUpdatesData.date && updatesState.date < pendingUpdatesData.date) {\n        updatesState.date = pendingUpdatesData.date\n      }\n      delete updatesState.pendingSeqUpdates[nextSeq]\n\n      if (!popPendingSeqUpdate() &&\n        updatesState.syncPending &&\n        updatesState.syncPending.seqAwaiting &&\n        updatesState.seq >= updatesState.syncPending.seqAwaiting) {\n        if (!updatesState.syncPending.ptsAwaiting) {\n          clearTimeout(updatesState.syncPending.timeout)\n          updatesState.syncPending = false\n        } else {\n          delete updatesState.syncPending.seqAwaiting\n        }\n      }\n\n      return true\n    }\n\n    function popPendingPtsUpdate (channelID) {\n      var curState = channelID ? getChannelState(channelID) : updatesState\n      if (!curState.pendingPtsUpdates.length) {\n        return false\n      }\n      curState.pendingPtsUpdates.sort(function (a, b) {\n        return a.pts - b.pts\n      })\n\n      var curPts = curState.pts\n      var goodPts = false\n      var goodIndex = false\n      var update\n      for (var i = 0, length = curState.pendingPtsUpdates.length; i < length; i++) {\n        update = curState.pendingPtsUpdates[i]\n        curPts += update.pts_count\n        if (curPts >= update.pts) {\n          goodPts = update.pts\n          goodIndex = i\n        }\n      }\n\n      if (!goodPts) {\n        return false\n      }\n\n      console.log(dT(), 'pop pending pts updates', goodPts, curState.pendingPtsUpdates.slice(0, goodIndex + 1))\n\n      curState.pts = goodPts\n      for (i = 0; i <= goodIndex; i++) {\n        update = curState.pendingPtsUpdates[i]\n        saveUpdate(update)\n      }\n      curState.pendingPtsUpdates.splice(0, goodIndex + 1)\n\n      if (!curState.pendingPtsUpdates.length && curState.syncPending) {\n        if (!curState.syncPending.seqAwaiting) {\n          clearTimeout(curState.syncPending.timeout)\n          curState.syncPending = false\n        } else {\n          delete curState.syncPending.ptsAwaiting\n        }\n      }\n\n      return true\n    }\n\n    function forceGetDifference () {\n      if (!updatesState.syncLoading) {\n        getDifference()\n      }\n    }\n\n    function processUpdateMessage (updateMessage, fromMTProto) {\n      // return forceGetDifference()\n      var processOpts = {\n        date: updateMessage.date,\n        seq: updateMessage.seq,\n        seqStart: updateMessage.seq_start\n      }\n\n      switch (updateMessage._) {\n        case 'updatesTooLong':\n        case 'new_session_created':\n          forceGetDifference()\n          break\n\n        case 'updateShort':\n          processUpdate(updateMessage.update, processOpts)\n          break\n\n        case 'updateShortMessage':\n        case 'updateShortChatMessage':\n          var isOut = updateMessage.flags & 2\n          var fromID = updateMessage.from_id || (isOut ? myID : updateMessage.user_id)\n          var toID = updateMessage.chat_id\n            ? -updateMessage.chat_id\n            : (isOut ? updateMessage.user_id : myID)\n\n          processUpdate({\n            _: 'updateNewMessage',\n            message: {\n              _: 'message',\n              flags: updateMessage.flags,\n              pFlags: updateMessage.pFlags,\n              id: updateMessage.id,\n              from_id: fromID,\n              to_id: AppPeersManager.getOutputPeer(toID),\n              date: updateMessage.date,\n              message: updateMessage.message,\n              fwd_from: updateMessage.fwd_from,\n              reply_to_msg_id: updateMessage.reply_to_msg_id,\n              entities: updateMessage.entities\n            },\n            pts: updateMessage.pts,\n            pts_count: updateMessage.pts_count\n          }, processOpts)\n          break\n\n        case 'updatesCombined':\n        case 'updates':\n          AppUsersManager.saveApiUsers(updateMessage.users)\n          AppChatsManager.saveApiChats(updateMessage.chats)\n\n          angular.forEach(updateMessage.updates, function (update) {\n            processUpdate(update, processOpts)\n          })\n          break\n\n        default:\n          console.warn(dT(), 'Unknown update message', updateMessage)\n      }\n    }\n\n    function getDifference () {\n      // console.trace(dT(), 'Get full diff')\n      if (!updatesState.syncLoading) {\n        updatesState.syncLoading = true\n        updatesState.pendingSeqUpdates = {}\n        updatesState.pendingPtsUpdates = []\n      }\n\n      if (updatesState.syncPending) {\n        clearTimeout(updatesState.syncPending.timeout)\n        updatesState.syncPending = false\n      }\n\n      MtpApiManager.invokeApi('updates.getDifference', {pts: updatesState.pts, date: updatesState.date, qts: -1}).then(function (differenceResult) {\n        if (differenceResult._ == 'updates.differenceEmpty') {\n          console.log(dT(), 'apply empty diff', differenceResult.seq)\n          updatesState.date = differenceResult.date\n          updatesState.seq = differenceResult.seq\n          updatesState.syncLoading = false\n          $rootScope.$broadcast('stateSynchronized')\n          return false\n        }\n\n        AppUsersManager.saveApiUsers(differenceResult.users)\n        AppChatsManager.saveApiChats(differenceResult.chats)\n\n        // Should be first because of updateMessageID\n        // console.log(dT(), 'applying', differenceResult.other_updates.length, 'other updates')\n\n        var channelsUpdates = []\n        angular.forEach(differenceResult.other_updates, function (update) {\n          switch (update._) {\n            case 'updateChannelTooLong':\n            case 'updateNewChannelMessage':\n            case 'updateEditChannelMessage':\n              processUpdate(update)\n              return\n          }\n          saveUpdate(update)\n        })\n\n        // console.log(dT(), 'applying', differenceResult.new_messages.length, 'new messages')\n        angular.forEach(differenceResult.new_messages, function (apiMessage) {\n          saveUpdate({\n            _: 'updateNewMessage',\n            message: apiMessage,\n            pts: updatesState.pts,\n            pts_count: 0\n          })\n        })\n\n        var nextState = differenceResult.intermediate_state || differenceResult.state\n        updatesState.seq = nextState.seq\n        updatesState.pts = nextState.pts\n        updatesState.date = nextState.date\n\n        // console.log(dT(), 'apply diff', updatesState.seq, updatesState.pts)\n\n        if (differenceResult._ == 'updates.differenceSlice') {\n          getDifference()\n        } else {\n          // console.log(dT(), 'finished get diff')\n          $rootScope.$broadcast('stateSynchronized')\n          updatesState.syncLoading = false\n        }\n      })\n    }\n\n    function getChannelDifference (channelID) {\n      var channelState = getChannelState(channelID)\n      if (!channelState.syncLoading) {\n        channelState.syncLoading = true\n        channelState.pendingPtsUpdates = []\n      }\n      if (channelState.syncPending) {\n        clearTimeout(channelState.syncPending.timeout)\n        channelState.syncPending = false\n      }\n      // console.log(dT(), 'Get channel diff', AppChatsManager.getChat(channelID), channelState.pts)\n      MtpApiManager.invokeApi('updates.getChannelDifference', {\n        channel: AppChatsManager.getChannelInput(channelID),\n        filter: {_: 'channelMessagesFilterEmpty'},\n        pts: channelState.pts,\n        limit: 30\n      }).then(function (differenceResult) {\n        // console.log(dT(), 'channel diff result', differenceResult)\n        channelState.pts = differenceResult.pts\n\n        if (differenceResult._ == 'updates.channelDifferenceEmpty') {\n          console.log(dT(), 'apply channel empty diff', differenceResult)\n          channelState.syncLoading = false\n          $rootScope.$broadcast('stateSynchronized')\n          return false\n        }\n\n        if (differenceResult._ == 'updates.channelDifferenceTooLong') {\n          console.log(dT(), 'channel diff too long', differenceResult)\n          channelState.syncLoading = false\n          delete channelStates[channelID]\n          saveUpdate({_: 'updateChannelReload', channel_id: channelID})\n          return false\n        }\n\n        AppUsersManager.saveApiUsers(differenceResult.users)\n        AppChatsManager.saveApiChats(differenceResult.chats)\n\n        // Should be first because of updateMessageID\n        console.log(dT(), 'applying', differenceResult.other_updates.length, 'channel other updates')\n        angular.forEach(differenceResult.other_updates, function (update) {\n          saveUpdate(update)\n        })\n\n        console.log(dT(), 'applying', differenceResult.new_messages.length, 'channel new messages')\n        angular.forEach(differenceResult.new_messages, function (apiMessage) {\n          saveUpdate({\n            _: 'updateNewChannelMessage',\n            message: apiMessage,\n            pts: channelState.pts,\n            pts_count: 0\n          })\n        })\n\n        console.log(dT(), 'apply channel diff', channelState.pts)\n\n        if (differenceResult._ == 'updates.channelDifference' &&\n          !differenceResult.pFlags['final']) {\n          getChannelDifference(channelID)\n        } else {\n          console.log(dT(), 'finished channel get diff')\n          $rootScope.$broadcast('stateSynchronized')\n          channelState.syncLoading = false\n        }\n      })\n    }\n\n    function addChannelState (channelID, pts) {\n      if (!pts) {\n        throw new Error('Add channel state without pts ' + channelID)\n      }\n      if (channelStates[channelID] === undefined) {\n        channelStates[channelID] = {\n          pts: pts,\n          pendingPtsUpdates: [],\n          syncPending: false,\n          syncLoading: false\n        }\n        return true\n      }\n      return false\n    }\n\n    function getChannelState (channelID, pts) {\n      if (channelStates[channelID] === undefined) {\n        addChannelState(channelID, pts)\n      }\n      return channelStates[channelID]\n    }\n\n    function processUpdate (update, options) {\n      options = options || {}\n      var channelID = false\n      switch (update._) {\n        case 'updateNewChannelMessage':\n        case 'updateEditChannelMessage':\n          channelID = -AppPeersManager.getPeerID(update.message.to_id)\n          break\n        case 'updateDeleteChannelMessages':\n          channelID = update.channel_id\n          break\n        case 'updateChannelTooLong':\n          channelID = update.channel_id\n          if (channelStates[channelID] === undefined) {\n            return false\n          }\n          break\n      }\n\n      var curState = channelID ? getChannelState(channelID, update.pts) : updatesState\n\n      // console.log(dT(), 'process', channelID, curState.pts, update)\n\n      if (curState.syncLoading) {\n        return false\n      }\n\n      if (update._ == 'updateChannelTooLong') {\n        getChannelDifference(channelID)\n        return false\n      }\n\n      if (update._ == 'updateNewMessage' ||\n        update._ == 'updateEditMessage' ||\n        update._ == 'updateNewChannelMessage' ||\n        update._ == 'updateEditChannelMessage') {\n        var message = update.message\n        var toPeerID = AppPeersManager.getPeerID(message.to_id)\n        var fwdHeader = message.fwd_from || {}\n        if (message.from_id && !AppUsersManager.hasUser(message.from_id, message.pFlags.post) ||\n          fwdHeader.from_id && !AppUsersManager.hasUser(fwdHeader.from_id, !!fwdHeader.channel_id) ||\n          fwdHeader.channel_id && !AppChatsManager.hasChat(fwdHeader.channel_id, true) ||\n          toPeerID > 0 && !AppUsersManager.hasUser(toPeerID) ||\n          toPeerID < 0 && !AppChatsManager.hasChat(-toPeerID)) {\n          console.warn(dT(), 'Not enough data for message update', message)\n          if (channelID && AppChatsManager.hasChat(channelID)) {\n            getChannelDifference(channelID)\n          } else {\n            forceGetDifference()\n          }\n          return false\n        }\n      }\n      else if (channelID && !AppChatsManager.hasChat(channelID)) {\n        // console.log(dT(), 'skip update, missing channel', channelID, update)\n        return false\n      }\n\n      var popPts\n      var popSeq\n\n      if (update.pts) {\n        var newPts = curState.pts + (update.pts_count || 0)\n        if (newPts < update.pts) {\n          console.warn(dT(), 'Pts hole', curState, update, channelID && AppChatsManager.getChat(channelID))\n          curState.pendingPtsUpdates.push(update)\n          if (!curState.syncPending) {\n            curState.syncPending = {\n              timeout: setTimeout(function () {\n                if (channelID) {\n                  getChannelDifference(channelID)\n                } else {\n                  getDifference()\n                }\n              }, 5000)\n            }\n          }\n          curState.syncPending.ptsAwaiting = true\n          return false\n        }\n        if (update.pts > curState.pts) {\n          curState.pts = update.pts\n          popPts = true\n        }\n        else if (update.pts_count) {\n          // console.warn(dT(), 'Duplicate update', update)\n          return false\n        }\n        if (channelID && options.date && updatesState.date < options.date) {\n          updatesState.date = options.date\n        }\n      }\n      else if (!channelID && options.seq > 0) {\n        var seq = options.seq\n        var seqStart = options.seqStart || seq\n\n        if (seqStart != curState.seq + 1) {\n          if (seqStart > curState.seq) {\n            console.warn(dT(), 'Seq hole', curState, curState.syncPending && curState.syncPending.seqAwaiting)\n\n            if (curState.pendingSeqUpdates[seqStart] === undefined) {\n              curState.pendingSeqUpdates[seqStart] = {seq: seq, date: options.date, updates: []}\n            }\n            curState.pendingSeqUpdates[seqStart].updates.push(update)\n\n            if (!curState.syncPending) {\n              curState.syncPending = {\n                timeout: setTimeout(function () {\n                  getDifference()\n                }, 5000)\n              }\n            }\n            if (!curState.syncPending.seqAwaiting ||\n              curState.syncPending.seqAwaiting < seqStart) {\n              curState.syncPending.seqAwaiting = seqStart\n            }\n            return false\n          }\n        }\n\n        if (curState.seq != seq) {\n          curState.seq = seq\n          if (options.date && curState.date < options.date) {\n            curState.date = options.date\n          }\n          popSeq = true\n        }\n      }\n\n      saveUpdate(update)\n\n      if (popPts) {\n        popPendingPtsUpdate(channelID)\n      }\n      else if (popSeq) {\n        popPendingSeqUpdate()\n      }\n    }\n\n    function saveUpdate (update) {\n      $rootScope.$broadcast('apiUpdate', update)\n    }\n\n    function attach () {\n      MtpNetworkerFactory.setUpdatesProcessor(processUpdateMessage)\n      MtpApiManager.invokeApi('updates.getState', {}, {noErrorBox: true}).then(function (stateResult) {\n        updatesState.seq = stateResult.seq\n        updatesState.pts = stateResult.pts\n        updatesState.date = stateResult.date\n        setTimeout(function () {\n          updatesState.syncLoading = false\n        }, 1000)\n\n      // updatesState.seq = 1\n      // updatesState.pts = stateResult.pts - 5000\n      // updatesState.date = 1\n      // getDifference()\n      })\n    }\n\n    return {\n      processUpdateMessage: processUpdateMessage,\n      addChannelState: addChannelState,\n      attach: attach\n    }\n  })\n\n  .service('StatusManager', function ($timeout, $rootScope, MtpApiManager, AppUsersManager, IdleManager) {\n    var toPromise\n    var lastOnlineUpdated = 0\n    var started = false\n    var myID = 0\n    var myOtherDeviceActive = false\n\n    MtpApiManager.getUserID().then(function (id) {\n      myID = id\n    })\n\n    $rootScope.$on('apiUpdate', function (e, update) {\n      if (update._ == 'updateUserStatus' && update.user_id == myID) {\n        myOtherDeviceActive = tsNow() + (update.status._ == 'userStatusOnline' ? 300000 : 0)\n      }\n    })\n\n    return {\n      start: start,\n      isOtherDeviceActive: isOtherDeviceActive\n    }\n\n    function start () {\n      if (!started) {\n        started = true\n        $rootScope.$watch('idle.isIDLE', checkIDLE)\n        $rootScope.$watch('offline', checkIDLE)\n      }\n    }\n\n    function sendUpdateStatusReq (offline) {\n      var date = tsNow()\n      if (offline && !lastOnlineUpdated ||\n        !offline && (date - lastOnlineUpdated) < 50000 ||\n        $rootScope.offline) {\n        return\n      }\n      lastOnlineUpdated = offline ? 0 : date\n      AppUsersManager.setUserStatus(myID, offline)\n      return MtpApiManager.invokeApi('account.updateStatus', {\n        offline: offline\n      }, {noErrorBox: true})\n    }\n\n    function checkIDLE () {\n      toPromise && $timeout.cancel(toPromise)\n      if ($rootScope.idle.isIDLE) {\n        toPromise = $timeout(function () {\n          sendUpdateStatusReq(true)\n        }, 5000)\n      } else {\n        sendUpdateStatusReq(false)\n        toPromise = $timeout(checkIDLE, 60000)\n      }\n    }\n\n    function isOtherDeviceActive () {\n      if (!myOtherDeviceActive) {\n        return false\n      }\n      if (tsNow() > myOtherDeviceActive) {\n        myOtherDeviceActive = false\n        return false\n      }\n      return true\n    }\n  })\n\n  .service('NotificationsManager', function ($rootScope, $window, $interval, $q, _, MtpApiManager, AppPeersManager, IdleManager, Storage, AppRuntimeManager, FileManager) {\n    navigator.vibrate = navigator.vibrate || navigator.mozVibrate || navigator.webkitVibrate\n\n    var notificationsMsSiteMode = false\n    try {\n      if (window.external && window.external.msIsSiteMode()) {\n        notificationsMsSiteMode = true\n      }\n    } catch (e) {}\n\n    var notificationsUiSupport = notificationsMsSiteMode ||\n      ('Notification' in window) ||\n      ('mozNotification' in navigator)\n    var notificationsShown = {}\n    var notificationIndex = 0\n    var notificationsCount = 0\n    var soundsPlayed = {}\n    var vibrateSupport = !!navigator.vibrate\n    var nextSoundAt = false\n    var prevSoundVolume = false\n    var peerSettings = {}\n    var faviconEl = $('link[rel=\"icon\"]:first')[0]\n    var langNotificationsPluralize = _.pluralize('page_title_pluralize_notifications')\n\n    var titleBackup = document.title\n    var titleChanged = false\n    var titlePromise\n    var prevFavicon\n    var stopped = false\n\n    var settings = {}\n\n    $rootScope.$watch('idle.deactivated', function (newVal) {\n      if (newVal) {\n        stop()\n      }\n    })\n\n    $rootScope.$watch('idle.isIDLE', function (newVal) {\n      if (stopped) {\n        return\n      }\n      if (!newVal) {\n        notificationsClear()\n      }\n      if (!Config.Navigator.mobile) {\n        $interval.cancel(titlePromise)\n        if (!newVal) {\n          titleChanged = false\n          document.title = titleBackup\n          setFavicon()\n        } else {\n          titleBackup = document.title\n\n          titlePromise = $interval(function () {\n            if (titleChanged || !notificationsCount) {\n              titleChanged = false\n              document.title = titleBackup\n              setFavicon()\n            } else {\n              titleChanged = true\n              document.title = langNotificationsPluralize(notificationsCount)\n              setFavicon('favicon_unread.ico')\n            }\n          }, 1000)\n        }\n      }\n    })\n\n    $rootScope.$on('apiUpdate', function (e, update) {\n      // console.log('on apiUpdate', update)\n      switch (update._) {\n        case 'updateNotifySettings':\n          if (update.peer._ == 'notifyPeer') {\n            var peerID = AppPeersManager.getPeerID(update.peer.peer)\n            savePeerSettings(peerID, update.notify_settings)\n          }\n          break\n      }\n    })\n\n    var registeredDevice = false\n    if (window.navigator.mozSetMessageHandler) {\n      window.navigator.mozSetMessageHandler('push', function (e) {\n        console.log(dT(), 'received push', e)\n        $rootScope.$broadcast('push_received')\n      })\n\n      window.navigator.mozSetMessageHandler('push-register', function (e) {\n        console.log(dT(), 'received push', e)\n        registeredDevice = false\n        registerDevice()\n      })\n    }\n\n    return {\n      start: start,\n      notify: notify,\n      cancel: notificationCancel,\n      clear: notificationsClear,\n      soundReset: notificationSoundReset,\n      getPeerSettings: getPeerSettings,\n      getPeerMuted: getPeerMuted,\n      savePeerSettings: savePeerSettings,\n      updatePeerSettings: updatePeerSettings,\n      updateNotifySettings: updateNotifySettings,\n      getNotifySettings: getNotifySettings,\n      getVibrateSupport: getVibrateSupport,\n      testSound: playSound\n    }\n\n    function updateNotifySettings () {\n      Storage.get('notify_nodesktop', 'notify_volume', 'notify_novibrate', 'notify_nopreview').then(function (updSettings) {\n        settings.nodesktop = updSettings[0]\n        settings.volume = updSettings[1] === false\n          ? 0.5\n          : updSettings[1]\n\n        settings.novibrate = updSettings[2]\n        settings.nopreview = updSettings[3]\n      })\n    }\n\n    function getNotifySettings () {\n      return settings\n    }\n\n    function getPeerSettings (peerID) {\n      if (peerSettings[peerID] !== undefined) {\n        return peerSettings[peerID]\n      }\n\n      return peerSettings[peerID] = MtpApiManager.invokeApi('account.getNotifySettings', {\n        peer: {\n          _: 'inputNotifyPeer',\n          peer: AppPeersManager.getInputPeerByID(peerID)\n        }\n      })\n    }\n\n    function setFavicon (href) {\n      href = href || 'favicon.ico'\n      if (prevFavicon === href) {\n        return\n      }\n      var link = document.createElement('link')\n      link.rel = 'shortcut icon'\n      link.type = 'image/x-icon'\n      link.href = href\n      faviconEl.parentNode.replaceChild(link, faviconEl)\n      faviconEl = link\n\n      prevFavicon = href\n    }\n\n    function savePeerSettings (peerID, settings) {\n      // console.trace(dT(), 'peer settings', peerID, settings)\n      peerSettings[peerID] = $q.when(settings)\n      $rootScope.$broadcast('notify_settings', {peerID: peerID})\n    }\n\n    function updatePeerSettings (peerID, settings) {\n      savePeerSettings(peerID, settings)\n\n      var inputSettings = angular.copy(settings)\n      inputSettings._ = 'inputPeerNotifySettings'\n\n      return MtpApiManager.invokeApi('account.updateNotifySettings', {\n        peer: {\n          _: 'inputNotifyPeer',\n          peer: AppPeersManager.getInputPeerByID(peerID)\n        },\n        settings: inputSettings\n      })\n    }\n\n    function getPeerMuted (peerID) {\n      return getPeerSettings(peerID).then(function (peerNotifySettings) {\n        return peerNotifySettings._ == 'peerNotifySettings' &&\n          peerNotifySettings.mute_until * 1000 > tsNow()\n      })\n    }\n\n    function start () {\n      updateNotifySettings()\n      $rootScope.$on('settings_changed', updateNotifySettings)\n      registerDevice()\n\n      if (!notificationsUiSupport) {\n        return false\n      }\n\n      if ('Notification' in window && Notification.permission !== 'granted' && Notification.permission !== 'denied') {\n        $($window).on('click', requestPermission)\n      }\n\n      try {\n        if ('onbeforeunload' in window) {\n          $($window).on('beforeunload', notificationsClear)\n        }\n      } catch (e) {}\n    }\n\n    function stop () {\n      notificationsClear()\n      $interval.cancel(titlePromise)\n      setFavicon()\n      stopped = true\n    }\n\n    function requestPermission () {\n      Notification.requestPermission()\n      $($window).off('click', requestPermission)\n    }\n\n    function notify (data) {\n      if (stopped) {\n        return\n      }\n      // console.log('notify', $rootScope.idle.isIDLE, notificationsUiSupport)\n\n      // FFOS Notification blob src bug workaround\n      if (Config.Navigator.ffos && !Config.Navigator.ffos2p) {\n        data.image = 'https://telegram.org/img/t_logo.png'\n      }\n      else if (data.image && !angular.isString(data.image)) {\n        if (Config.Navigator.ffos2p) {\n          FileManager.getDataUrl(data.image, 'image/jpeg').then(function (url) {\n            data.image = url\n            notify(data)\n          })\n          return false\n        } else {\n          data.image = FileManager.getUrl(data.image, 'image/jpeg')\n        }\n      }\n      else if (!data.image) {\n        data.image = 'img/icons/icon60.png'\n      }\n      // console.log('notify image', data.image)\n\n      notificationsCount++\n\n      var now = tsNow()\n      if (settings.volume > 0 &&\n        (\n        !data.tag ||\n        !soundsPlayed[data.tag] ||\n        now > soundsPlayed[data.tag] + 60000\n        )\n      ) {\n        playSound(settings.volume)\n        soundsPlayed[data.tag] = now\n      }\n\n      if (!notificationsUiSupport ||\n        'Notification' in window && Notification.permission !== 'granted') {\n        return false\n      }\n\n      if (settings.nodesktop) {\n        if (vibrateSupport && !settings.novibrate) {\n          navigator.vibrate([200, 100, 200])\n          return\n        }\n        return\n      }\n\n      var idx = ++notificationIndex\n      var key = data.key || 'k' + idx\n      var notification\n\n      if ('Notification' in window) {\n        notification = new Notification(data.title, {\n          icon: data.image || '',\n          body: data.message || '',\n          tag: data.tag || ''\n        })\n      }\n      else if ('mozNotification' in navigator) {\n        notification = navigator.mozNotification.createNotification(data.title, data.message || '', data.image || '')\n      }\n      else if (notificationsMsSiteMode) {\n        window.external.msSiteModeClearIconOverlay()\n        window.external.msSiteModeSetIconOverlay('img/icons/icon16.png', data.title)\n        window.external.msSiteModeActivate()\n        notification = {\n          index: idx\n        }\n      }else {\n        return\n      }\n\n      notification.onclick = function () {\n        notification.close()\n        AppRuntimeManager.focus()\n        notificationsClear()\n        if (data.onclick) {\n          data.onclick()\n        }\n      }\n\n      notification.onclose = function () {\n        if (!notification.hidden) {\n          delete notificationsShown[key]\n          notificationsClear()\n        }\n      }\n\n      if (notification.show) {\n        notification.show()\n      }\n      notificationsShown[key] = notification\n\n      if (!Config.Navigator.mobile) {\n        setTimeout(function () {\n          notificationHide(key)\n        }, 8000)\n      }\n    }\n\n    function playSound (volume) {\n      var now = tsNow()\n      if (nextSoundAt && now < nextSoundAt && prevSoundVolume == volume) {\n        return\n      }\n      nextSoundAt = now + 1000\n      prevSoundVolume = volume\n      var filename = 'img/sound_a.mp3'\n      var obj = $('#notify_sound').html('<audio autoplay=\"autoplay\" mozaudiochannel=\"notification\">' +\n        '<source src=\"' + filename + '\" type=\"audio/mpeg\" />' +\n        '<embed hidden=\"true\" autostart=\"true\" loop=\"false\" volume=\"' + (volume * 100) + '\" src=\"' + filename + '\" />' +\n        '</audio>')\n      obj.find('audio')[0].volume = volume\n    }\n\n    function notificationCancel (key) {\n      var notification = notificationsShown[key]\n      if (notification) {\n        if (notificationsCount > 0) {\n          notificationsCount--\n        }\n        try {\n          if (notification.close) {\n            notification.close()\n          }\n          else if (notificationsMsSiteMode &&\n            notification.index == notificationIndex) {\n            window.external.msSiteModeClearIconOverlay()\n          }\n        } catch (e) {}\n        delete notificationsCount[key]\n      }\n    }\n\n    function notificationHide (key) {\n      var notification = notificationsShown[key]\n      if (notification) {\n        try {\n          if (notification.close) {\n            notification.hidden = true\n            notification.close()\n          }\n        } catch (e) {}\n        delete notificationsCount[key]\n      }\n    }\n\n    function notificationSoundReset (tag) {\n      delete soundsPlayed[tag]\n    }\n\n    function notificationsClear () {\n      if (notificationsMsSiteMode) {\n        window.external.msSiteModeClearIconOverlay()\n      } else {\n        angular.forEach(notificationsShown, function (notification) {\n          try {\n            if (notification.close) {\n              notification.close()\n            }\n          } catch (e) {}\n        })\n      }\n      notificationsShown = {}\n      notificationsCount = 0\n    }\n\n    var registerDevicePeriod = 1000\n    var registerDeviceTO\n    function registerDevice () {\n      if (registeredDevice) {\n        return false\n      }\n      if (navigator.push && Config.Navigator.ffos && Config.Modes.packed) {\n        var req = navigator.push.register()\n\n        req.onsuccess = function (e) {\n          clearTimeout(registerDeviceTO)\n          console.log(dT(), 'Push registered', req.result)\n          registeredDevice = req.result\n          MtpApiManager.invokeApi('account.registerDevice', {\n            token_type: 4,\n            token: registeredDevice\n          })\n        }\n\n        req.onerror = function (e) {\n          console.error('Push register error', e, e.toString())\n          registerDeviceTO = setTimeout(registerDevice, registerDevicePeriod)\n          registerDevicePeriod = Math.min(30000, registerDevicePeriod * 1.5)\n        }\n      }\n    }\n\n    function unregisterDevice () {\n      if (!registeredDevice) {\n        return false\n      }\n      MtpApiManager.invokeApi('account.unregisterDevice', {\n        token_type: 4,\n        token: registeredDevice\n      }).then(function () {\n        registeredDevice = false\n      })\n    }\n\n    function getVibrateSupport () {\n      return vibrateSupport\n    }\n  })\n\n  .service('PasswordManager', function ($timeout, $q, $rootScope, MtpApiManager, CryptoWorker, MtpSecureRandom) {\n    return {\n      check: check,\n      getState: getState,\n      requestRecovery: requestRecovery,\n      recover: recover,\n      updateSettings: updateSettings\n    }\n\n    function getState (options) {\n      return MtpApiManager.invokeApi('account.getPassword', {}, options).then(function (result) {\n        return result\n      })\n    }\n\n    function updateSettings (state, settings) {\n      var currentHashPromise\n      var newHashPromise\n      var params = {\n        new_settings: {\n          _: 'account.passwordInputSettings',\n          flags: 0,\n          hint: settings.hint || ''\n        }\n      }\n\n      if (typeof settings.cur_password === 'string' &&\n        settings.cur_password.length > 0) {\n        currentHashPromise = makePasswordHash(state.current_salt, settings.cur_password)\n      } else {\n        currentHashPromise = $q.when([])\n      }\n\n      if (typeof settings.new_password === 'string' &&\n        settings.new_password.length > 0) {\n        var saltRandom = new Array(8)\n        var newSalt = bufferConcat(state.new_salt, saltRandom)\n        MtpSecureRandom.nextBytes(saltRandom)\n        newHashPromise = makePasswordHash(newSalt, settings.new_password)\n        params.new_settings.new_salt = newSalt\n        params.new_settings.flags |= 1\n      } else {\n        if (typeof settings.new_password === 'string') {\n          params.new_settings.flags |= 1\n          params.new_settings.new_salt = []\n        }\n        newHashPromise = $q.when([])\n      }\n\n      if (typeof settings.email === 'string') {\n        params.new_settings.flags |= 2\n        params.new_settings.email = settings.email || ''\n      }\n\n      return $q.all([currentHashPromise, newHashPromise]).then(function (hashes) {\n        params.current_password_hash = hashes[0]\n        params.new_settings.new_password_hash = hashes[1]\n\n        return MtpApiManager.invokeApi('account.updatePasswordSettings', params)\n      })\n    }\n\n    function check (state, password, options) {\n      return makePasswordHash(state.current_salt, password).then(function (passwordHash) {\n        return MtpApiManager.invokeApi('auth.checkPassword', {\n          password_hash: passwordHash\n        }, options)\n      })\n    }\n\n    function requestRecovery (state, options) {\n      return MtpApiManager.invokeApi('auth.requestPasswordRecovery', {}, options)\n    }\n\n    function recover (code, options) {\n      return MtpApiManager.invokeApi('auth.recoverPassword', {\n        code: code\n      }, options)\n    }\n\n    function makePasswordHash (salt, password) {\n      var passwordUTF8 = unescape(encodeURIComponent(password))\n\n      var buffer = new ArrayBuffer(passwordUTF8.length)\n      var byteView = new Uint8Array(buffer)\n      for (var i = 0, len = passwordUTF8.length; i < len; i++) {\n        byteView[i] = passwordUTF8.charCodeAt(i)\n      }\n\n      buffer = bufferConcat(bufferConcat(salt, byteView), salt)\n\n      return CryptoWorker.sha256Hash(buffer)\n    }\n  })\n\n  .service('ErrorService', function ($rootScope, $modal, $window) {\n    var shownBoxes = 0\n\n    function show (params, options) {\n      if (shownBoxes >= 1) {\n        console.log('Skip error box, too many open', shownBoxes, params, options)\n        return false\n      }\n\n      options = options || {}\n      var scope = $rootScope.$new()\n      angular.extend(scope, params)\n\n      shownBoxes++\n      var modal = $modal.open({\n        templateUrl: templateUrl('error_modal'),\n        scope: scope,\n        windowClass: options.windowClass || 'error_modal_window'\n      })\n\n      modal.result['finally'](function () {\n        shownBoxes--\n      })\n\n      return modal\n    }\n\n    function alert (title, description) {\n      return show({\n        title: title,\n        description: description\n      })\n    }\n\n    function confirm (params, options) {\n      options = options || {}\n      var scope = $rootScope.$new()\n      angular.extend(scope, params)\n\n      var modal = $modal.open({\n        templateUrl: templateUrl('confirm_modal'),\n        scope: scope,\n        windowClass: options.windowClass || 'confirm_modal_window'\n      })\n\n      return modal.result\n    }\n\n    $window.safeConfirm = function (params, callback) {\n      if (typeof params === 'string') {\n        params = {message: params}\n      }\n      confirm(params).then(function (result) {\n        callback(result || true)\n      }, function () {\n        callback(false)\n      })\n    }\n\n    return {\n      show: show,\n      alert: alert,\n      confirm: confirm\n    }\n  })\n\n  .service('PeersSelectService', function ($rootScope, $modal) {\n    function selectPeer (options) {\n      var scope = $rootScope.$new()\n      scope.multiSelect = false\n      scope.noMessages = true\n      if (options) {\n        angular.extend(scope, options)\n      }\n\n      return $modal.open({\n        templateUrl: templateUrl('peer_select'),\n        controller: 'PeerSelectController',\n        scope: scope,\n        windowClass: 'peer_select_window mobile_modal',\n        backdrop: 'single'\n      }).result\n    }\n\n    function selectPeers (options) {\n      if (Config.Mobile) {\n        return selectPeer(options).then(function (peerString) {\n          return [peerString]\n        })\n      }\n\n      var scope = $rootScope.$new()\n      scope.multiSelect = true\n      scope.noMessages = true\n      if (options) {\n        angular.extend(scope, options)\n      }\n\n      return $modal.open({\n        templateUrl: templateUrl('peer_select'),\n        controller: 'PeerSelectController',\n        scope: scope,\n        windowClass: 'peer_select_window mobile_modal',\n        backdrop: 'single'\n      }).result\n    }\n\n    return {\n      selectPeer: selectPeer,\n      selectPeers: selectPeers\n    }\n  })\n\n  .service('ContactsSelectService', function ($rootScope, $modal) {\n    function select (multiSelect, options) {\n      options = options || {}\n\n      var scope = $rootScope.$new()\n      scope.multiSelect = multiSelect\n      angular.extend(scope, options)\n      if (!scope.action && multiSelect) {\n        scope.action = 'select'\n      }\n\n      return $modal.open({\n        templateUrl: templateUrl('contacts_modal'),\n        controller: 'ContactsModalController',\n        scope: scope,\n        windowClass: 'contacts_modal_window mobile_modal',\n        backdrop: 'single'\n      }).result\n    }\n\n    return {\n      selectContacts: function (options) {\n        return select(true, options)\n      },\n      selectContact: function (options) {\n        return select(false, options)\n      }\n    }\n  })\n\n  .service('ChangelogNotifyService', function (Storage, $rootScope, $modal) {\n    function checkUpdate () {\n      Storage.get('last_version').then(function (lastVersion) {\n        if (lastVersion != Config.App.version) {\n          if (lastVersion) {\n            showChangelog(lastVersion)\n          }\n          Storage.set({last_version: Config.App.version})\n        }\n      })\n    }\n\n    function showChangelog (lastVersion) {\n      var $scope = $rootScope.$new()\n      $scope.lastVersion = lastVersion\n\n      $modal.open({\n        controller: 'ChangelogModalController',\n        templateUrl: templateUrl('changelog_modal'),\n        scope: $scope,\n        windowClass: 'changelog_modal_window mobile_modal'\n      })\n    }\n\n    return {\n      checkUpdate: checkUpdate,\n      showChangelog: showChangelog\n    }\n  })\n\n  .service('HttpsMigrateService', function (ErrorService, Storage) {\n    var started = false\n\n    function check () {\n      Storage.get('https_dismiss').then(function (ts) {\n        if (!ts || tsNow() > ts + 43200000) {\n          ErrorService.confirm({\n            type: 'MIGRATE_TO_HTTPS'\n          }).then(function () {\n            var popup\n            try {\n              popup = window.open('https://web.telegram.org', '_blank')\n            } catch (e) {}\n            if (!popup) {\n              location.href = 'https://web.telegram.org'\n            }\n          }, function () {\n            Storage.set({https_dismiss: tsNow()})\n          })\n        }\n      })\n    }\n\n    function start () {\n      if (started ||\n        location.protocol != 'http:' ||\n        Config.Modes.http ||\n        Config.App.domains.indexOf(location.hostname) == -1) {\n        return\n      }\n      started = true\n      setTimeout(check, 120000)\n    }\n\n    return {\n      start: start,\n      check: check\n    }\n  })\n\n  .service('LayoutSwitchService', function (ErrorService, Storage, AppRuntimeManager, $window) {\n    var started = false\n    var confirmShown = false\n\n    function switchLayout (mobile) {\n      ConfigStorage.noPrefix()\n      Storage.set({\n        layout_selected: mobile ? 'mobile' : 'desktop',\n        layout_width: $(window).width()\n      }).then(function () {\n        AppRuntimeManager.reload()\n      })\n    }\n\n    function layoutCheck (e) {\n      if (confirmShown) {\n        return\n      }\n      var width = $(window).width()\n      var newMobile = width < 600\n      if (!width ||\n        !e && (Config.Navigator.mobile ? width <= 800 : newMobile)) {\n        return\n      }\n      if (newMobile != Config.Mobile) {\n        ConfigStorage.noPrefix()\n        Storage.get('layout_width').then(function (confirmedWidth) {\n          if (width == confirmedWidth) {\n            return false\n          }\n          confirmShown = true\n          ErrorService.confirm({\n            type: newMobile ? 'SWITCH_MOBILE_VERSION' : 'SWITCH_DESKTOP_VERSION'\n          }).then(function () {\n            switchLayout(newMobile)\n          }, function () {\n            ConfigStorage.noPrefix()\n            Storage.set({layout_width: width})\n            confirmShown = false\n          })\n        })\n      }\n    }\n\n    function start () {\n      if (started || Config.Navigator.mobile) {\n        return\n      }\n      started = true\n      layoutCheck()\n      $($window).on('resize', layoutCheck)\n    }\n\n    return {\n      start: start,\n      switchLayout: switchLayout\n    }\n  })\n\n  .service('TelegramMeWebService', function (Storage) {\n    var disabled = Config.Modes.test ||\n      Config.App.domains.indexOf(location.hostname) == -1 ||\n      location.protocol != 'http:' && location.protocol != 'https:' ||\n      location.protocol == 'https:' && location.hostname != 'web.telegram.org'\n\n    function sendAsyncRequest (canRedirect) {\n      if (disabled) {\n        return false\n      }\n      Storage.get('tgme_sync').then(function (curValue) {\n        var ts = tsNow(true)\n        if (canRedirect &&\n          curValue &&\n          curValue.canRedirect == canRedirect &&\n          curValue.ts + 86400 > ts) {\n          return false\n        }\n        Storage.set({tgme_sync: {canRedirect: canRedirect, ts: ts}})\n\n        var script = $('<script>').appendTo('body')\n          .on('load error', function () {\n            script.remove()\n          })\n          .attr('src', '//telegram.me/_websync_?authed=' + (canRedirect ? '1' : '0'))\n      })\n    }\n\n    return {\n      setAuthorized: sendAsyncRequest\n    }\n  })\n\n  .service('LocationParamsService', function (qSync, $rootScope, $routeParams, AppPeersManager, AppUsersManager, AppChatsManager, AppMessagesManager, AppMessagesIDsManager, MtpApiManager, ApiUpdatesManager, PeersSelectService, AppStickersManager, ErrorService) {\n    var tgAddrRegExp = /^(web\\+)?tg:(\\/\\/)?(.+)/\n\n    function checkLocationTgAddr () {\n      var tgaddr = $routeParams.tgaddr\n      if (tgaddr) {\n        if (!tgaddr.match(/[=&?]/)) {\n          try {\n            tgaddr = decodeURIComponent(tgaddr)\n          } catch (e) {}\n        }\n        var matches = tgaddr.match(tgAddrRegExp)\n        if (matches) {\n          handleTgProtoAddr(matches[3])\n        }\n      }\n    }\n\n    function handleTgProtoAddr (url, inner) {\n      var matches\n\n      if (matches = url.match(/^resolve\\?domain=(.+?)(?:&(start|startgroup|post|game)=(.+))?$/)) {\n        AppPeersManager.resolveUsername(matches[1]).then(function (peerID) {\n          if (peerID > 0 && AppUsersManager.isBot(peerID) &&\n              (matches[2] == 'startgroup' || matches[2] == 'game')) {\n            var isStartGroup = matches[2] == 'startgroup'\n            PeersSelectService.selectPeer({\n              confirm_type: isStartGroup ? 'INVITE_TO_GROUP' : 'INVITE_TO_GAME',\n              noUsers: isStartGroup\n            }).then(function (toPeerString) {\n              var toPeerID = AppPeersManager.getPeerID(toPeerString)\n              var sendPromise\n              if (isStartGroup) {\n                var toChatID = toPeerID < 0 ? -toPeerID : 0\n                sendPromise = AppMessagesManager.startBot(peerID, toChatID, matches[3])\n              } else {\n                inputGame = {\n                  _: 'inputGameShortName',\n                  bot_id: AppUsersManager.getUserInput(peerID),\n                  short_name: matches[3]\n                }\n                sendPromise = AppMessagesManager.shareGame(peerID, toPeerID, inputGame)\n              }\n              sendPromise.then(function () {\n                $rootScope.$broadcast('history_focus', {peerString: toPeerString})\n              })\n            })\n            return true\n          }\n\n          var params = {\n            peerString: AppPeersManager.getPeerString(peerID)\n          }\n\n          if (matches[2] == 'start') {\n            params.startParam = matches[3]\n          }\n          else if (matches[2] == 'post') {\n            params.messageID = AppMessagesIDsManager.getFullMessageID(parseInt(matches[3]), -peerID)\n          }\n\n          $rootScope.$broadcast('history_focus', params)\n        })\n        return true\n      }\n\n      if (matches = url.match(/^join\\?invite=(.+)$/)) {\n        openChatInviteLink(matches[1])\n        return true\n      }\n\n      if (matches = url.match(/^addstickers\\?set=(.+)$/)) {\n        AppStickersManager.openStickersetLink(matches[1])\n        return true\n      }\n\n      if (matches = url.match(/^msg_url\\?url=([^&]+)(?:&text=(.*))?$/)) {\n        var url = decodeURIComponent(matches[1])\n        var text = matches[2] ? decodeURIComponent(matches[2]) : ''\n        shareUrl(url, text)\n        return true\n      }\n\n      if (inner &&\n        (matches = url.match(/^unsafe_url\\?url=([^&]+)/))) {\n        var url = decodeURIComponent(matches[1])\n        ErrorService.confirm({\n          type: 'JUMP_EXT_URL',\n          url: url\n        }).then(function () {\n          var target = '_blank'\n          if (url.search('https://telegram.me/') === 0) {\n            target = '_self'\n          }\n          window.open(url, target)\n        })\n        return true\n      }\n\n      if (matches = url.match(/^search_hashtag\\?hashtag=(.+?)$/)) {\n        $rootScope.$broadcast('dialogs_search', {query: '#' + decodeURIComponent(matches[1])})\n        if (Config.Mobile) {\n          $rootScope.$broadcast('history_focus', {\n            peerString: ''\n          })\n        }\n        return true\n      }\n\n      if (inner &&\n        (matches = url.match(/^bot_command\\?command=(.+?)(?:&bot=(.+))?$/))) {\n        var peerID = $rootScope.selectedPeerID\n        var text = '/' + matches[1]\n        if (peerID < 0 && matches[2]) {\n          text += '@' + matches[2]\n        }\n        AppMessagesManager.sendText(peerID, text)\n\n        $rootScope.$broadcast('history_focus', {\n          peerString: AppPeersManager.getPeerString(peerID)\n        })\n        return true\n      }\n\n      return false\n    }\n\n    function handleActivityMessage (name, data) {\n      console.log(dT(), 'Received activity', name, data)\n\n      if (name == 'share' && data.url) {\n        shareUrl(data.url, '')\n      }\n      else if (name == 'view' && data.url) {\n        var matches = data.url.match(tgAddrRegExp)\n        if (matches) {\n          handleTgProtoAddr(matches[3])\n        }\n      }\n      else if (name == 'webrtc-call' && data.contact) {\n        var contact = data.contact\n        var phones = []\n        if (contact.tel != undefined) {\n          for (var i = 0; i < contact.tel.length; i++) {\n            phones.push(contact.tel[i].value)\n          }\n        }\n        var firstName = (contact.givenName || []).join(' ')\n        var lastName = (contact.familyName || []).join(' ')\n\n        if (phones.length) {\n          AppUsersManager.importContact(phones[0], firstName, lastName).then(function (foundUserID) {\n            if (foundUserID) {\n              var peerString = AppPeersManager.getPeerString(foundUserID)\n              $rootScope.$broadcast('history_focus', {peerString: peerString})\n            } else {\n              ErrorService.show({\n                error: {code: 404, type: 'USER_NOT_USING_TELEGRAM'}\n              })\n            }\n          })\n        }\n      }\n      else if (name === 'share' && data.blobs && data.blobs.length > 0) {\n        PeersSelectService.selectPeers({confirm_type: 'EXT_SHARE_PEER', canSend: true}).then(function (peerStrings) {\n          angular.forEach(peerStrings, function (peerString) {\n            var peerID = AppPeersManager.getPeerID(peerString)\n            angular.forEach(data.blobs, function (blob) {\n              AppMessagesManager.sendFile(peerID, blob, {isMedia: true})\n            })\n          })\n          if (peerStrings.length == 1) {\n            $rootScope.$broadcast('history_focus', {peerString: peerStrings[0]})\n          }\n        })\n      }\n    }\n\n    var started = false\n    function start () {\n      if (started) {\n        return\n      }\n      started = true\n\n      if ('registerProtocolHandler' in navigator) {\n        try {\n          navigator.registerProtocolHandler('tg', '#im?tgaddr=%s', 'Telegram Web')\n        } catch (e) {}\n        try {\n          navigator.registerProtocolHandler('web+tg', '#im?tgaddr=%s', 'Telegram Web')\n        } catch (e) {}\n      }\n\n      if (window.navigator.mozSetMessageHandler) {\n        console.log(dT(), 'Set activity message handler')\n        window.navigator.mozSetMessageHandler('activity', function (activityRequest) {\n          handleActivityMessage(activityRequest.source.name, activityRequest.source.data)\n        })\n      }\n\n      $(document).on('click', function (event) {\n        var target = event.target\n        if (target &&\n          target.tagName == 'A' &&\n          !target.onclick &&\n          !target.onmousedown) {\n          var href = $(target).attr('href') || target.href || ''\n          var match = href.match(tgAddrRegExp)\n          if (match) {\n            if (handleTgProtoAddr(match[3], true)) {\n              return cancelEvent(event)\n            }\n          }\n        }\n      })\n\n      $rootScope.$on('$routeUpdate', checkLocationTgAddr)\n      checkLocationTgAddr()\n    }\n\n    function openUrl(url) {\n      var match = url.match(tgAddrRegExp)\n      if (match) {\n        if (handleTgProtoAddr(match[3], true)) {\n          return true\n        }\n      }\n      var wnd = window.open(url, '_blank')\n      return wnd ? true : false\n    }\n\n    function shareUrl (url, text, shareLink) {\n      var options = {}\n      if (shareLink) {\n        options.shareLinkPromise = qSync.when(url)\n      }\n      PeersSelectService.selectPeer(options).then(function (toPeerString) {\n        $rootScope.$broadcast('history_focus', {\n          peerString: toPeerString,\n          attachment: {\n            _: 'share_url',\n            url: url,\n            text: text\n          }\n        })\n      })\n    }\n\n    function openChatInviteLink (hash) {\n      return MtpApiManager.invokeApi('messages.checkChatInvite', {\n        hash: hash\n      }).then(function (chatInvite) {\n        var chatTitle\n        if (chatInvite._ == 'chatInviteAlready') {\n          AppChatsManager.saveApiChat(chatInvite.chat)\n          var canJump = !chatInvite.chat.pFlags.left ||\n            AppChatsManager.isChannel(chatInvite.chat.id) && chatInvite.chat.username\n          if (canJump) {\n            return $rootScope.$broadcast('history_focus', {\n              peerString: AppChatsManager.getChatString(chatInvite.chat.id)\n            })\n          }\n          chatTitle = chatInvite.chat.title\n        } else {\n          chatTitle = chatInvite.title\n        }\n        ErrorService.confirm({\n          type: (chatInvite.pFlags.channel && !chatInvite.pFlags.megagroup) ? 'JOIN_CHANNEL_BY_LINK' : 'JOIN_GROUP_BY_LINK',\n          title: chatTitle\n        }).then(function () {\n          return MtpApiManager.invokeApi('messages.importChatInvite', {\n            hash: hash\n          }).then(function (updates) {\n            ApiUpdatesManager.processUpdateMessage(updates)\n\n            if (updates.chats && updates.chats.length == 1) {\n              $rootScope.$broadcast('history_focus', {peerString: AppChatsManager.getChatString(updates.chats[0].id)\n              })\n            }\n            else if (updates.updates && updates.updates.length) {\n              for (var i = 0, len = updates.updates.length, update; i < len; i++) {\n                update = updates.updates[i]\n                if (update._ == 'updateNewMessage') {\n                  $rootScope.$broadcast('history_focus', {peerString: AppChatsManager.getChatString(update.message.to_id.chat_id)\n                  })\n                  break\n                }\n              }\n            }\n          })\n        })\n      })\n    }\n\n    return {\n      start: start,\n      shareUrl: shareUrl,\n      openUrl: openUrl\n    }\n  })\n\n  .service('DraftsManager', function ($rootScope, qSync, MtpApiManager, ApiUpdatesManager, AppMessagesIDsManager, AppChatsManager, AppPeersManager, RichTextProcessor, Storage, ServerTimeManager) {\n    var cachedServerDrafts = {}\n\n    $rootScope.$on('apiUpdate', function (e, update) {\n      if (update._ != 'updateDraftMessage') {\n        return\n      }\n      var peerID = AppPeersManager.getPeerID(update.peer)\n      saveDraft(peerID, update.draft, {notify: true, local: update.local})\n    })\n\n    return {\n      getDraft: getDraft,\n      getServerDraft: getServerDraft,\n      saveDraft: saveDraft,\n      changeDraft: changeDraft,\n      clearDraft: clearDraft,\n      syncDraft: syncDraft\n    }\n\n    function getDraft (peerID, unsyncOnly) {\n      console.warn(dT(), 'get draft', peerID, unsyncOnly)\n      return Storage.get('draft' + peerID).then(function (draft) {\n        if (typeof draft === 'string') {\n          if (draft.length > 0) {\n            draft = {\n              text: draft\n            }\n          } else {\n            draft = false\n          }\n        }\n        if (!draft && !unsyncOnly) {\n          draft = getServerDraft(peerID)\n          console.warn(dT(), 'server', draft)\n        } else {\n          console.warn(dT(), 'local', draft)\n        }\n        var replyToMsgID = draft && draft.replyToMsgID\n        if (replyToMsgID) {\n          var channelID = AppPeersManager.isChannel(peerID) ? -peerID : false\n          draft.replyToMsgID = AppMessagesIDsManager.getFullMessageID(replyToMsgID, channelID)\n        }\n        return draft\n      })\n    }\n\n    function getServerDraft (peerID) {\n      var cached = cachedServerDrafts[peerID]\n      if (cached !== undefined) {\n        return cached\n      }\n      return false\n    }\n\n    function saveDraft (peerID, apiDraft, options) {\n      options = options || {}\n      var draft = processApiDraft(apiDraft)\n      cachedServerDrafts[peerID] = draft\n\n      if (options.notify) {\n        console.warn(dT(), 'save draft', peerID, apiDraft, options)\n        changeDraft(peerID, draft)\n        $rootScope.$broadcast('draft_updated', {\n          peerID: peerID,\n          draft: draft,\n          local: options.local\n        })\n      }\n\n      return draft\n    }\n\n    function changeDraft (peerID, draft) {\n      console.warn(dT(), 'change draft', peerID, draft)\n      if (!peerID) {\n        console.trace('empty peerID')\n      }\n      if (peerID < 0 &&\n          AppChatsManager.hasRights(-peerID, 'send')) {\n        draft = false\n      }\n      if (!draft) {\n        draft = {\n          text: '',\n          replyToMsgID: 0\n        }\n      }\n      draft.replyToMsgID = draft.replyToMsgID\n        ? AppMessagesIDsManager.getMessageLocalID(draft.replyToMsgID)\n        : 0\n\n      var draftKey = 'draft' + peerID\n\n      if (!isEmptyDraft(draft)) {\n        var backupDraftObj = {}\n        backupDraftObj[draftKey] = draft\n        Storage.set(backupDraftObj)\n      } else {\n        Storage.remove(draftKey)\n      }\n    }\n\n    function clearDraft (peerID, alsoSync) {\n      changeDraft(peerID)\n      ApiUpdatesManager.processUpdateMessage({\n        _: 'updateShort',\n        update: {\n          _: 'updateDraftMessage',\n          peer: AppPeersManager.getOutputPeer(peerID),\n          draft: {_: 'draftMessageEmpty'},\n          local: true\n        }\n      })\n      if (alsoSync) {\n        syncDraft(peerID)\n      }\n    }\n\n    function draftsAreEqual (draft1, draft2) {\n      var isEmpty1 = isEmptyDraft(draft1)\n      var isEmpty2 = isEmptyDraft(draft2)\n      if (isEmpty1 && isEmpty2) {\n        return true\n      }\n      if (isEmpty1 != isEmpty2) {\n        return false\n      }\n      if (draft1.replyToMsgID != draft2.replyToMsgID) {\n        return false\n      }\n      if (draft1.text != draft2.text) {\n        return false\n      }\n      return true\n    }\n\n    function isEmptyDraft (draft) {\n      if (!draft) {\n        return true\n      }\n      if (draft.replyToMsgID > 0) {\n        return false\n      }\n      if (typeof draft.text !== 'string' || !draft.text.length) {\n        return true\n      }\n      return false\n    }\n\n    function processApiDraft (draft) {\n      if (!draft || draft._ != 'draftMessage') {\n        return false\n      }\n\n      var entities = RichTextProcessor.parseEntities(draft.message)\n      var serverEntities = draft.entities || []\n      entities = RichTextProcessor.mergeEntities(entities, serverEntities)\n\n      var text = RichTextProcessor.wrapDraftText(draft.message, {entities: entities})\n      var richMessage = RichTextProcessor.wrapRichText(draft.message, {noLinks: true, noLinebreaks: true})\n\n      return {\n        text: text,\n        richMessage: richMessage,\n        replyToMsgID: draft.reply_to_msg_id || 0,\n        date: draft.date - ServerTimeManager.serverTimeOffset\n      }\n    }\n\n    function syncDraft (peerID) {\n      console.warn(dT(), 'sync draft', peerID)\n      getDraft(peerID, true).then(function (localDraft) {\n        var serverDraft = cachedServerDrafts[peerID]\n        if (draftsAreEqual(serverDraft, localDraft)) {\n          console.warn(dT(), 'equal drafts', localDraft, serverDraft)\n          return\n        }\n        console.warn(dT(), 'changed draft', localDraft, serverDraft)\n        var params = {\n          flags: 0,\n          peer: AppPeersManager.getInputPeerByID(peerID)\n        }\n        var draftObj\n        if (isEmptyDraft(localDraft)) {\n          draftObj = {_: 'draftMessageEmpty'}\n          params.message = ''\n        } else {\n          draftObj = {_: 'draftMessage'}\n          var message = localDraft.text\n          var entities = []\n          message = RichTextProcessor.parseEmojis(message)\n          message = RichTextProcessor.parseMarkdown(message, entities, true)\n          if (localDraft.replyToMsgID > 0) {\n            params.flags |= 1\n            params.reply_to_msg_id = localDraft.replyToMsgID\n            draftObj.reply_to_msg_id = localDraft.replyToMsgID\n          }\n          if (entities.length) {\n            params.flags |= 8\n            params.entities = entities\n            draftObj.entities = entities\n          }\n          params.message = message\n          draftObj.message = message\n        }\n        MtpApiManager.invokeApi('messages.saveDraft', params).then(function () {\n          draftObj.date = tsNow(true) + ServerTimeManager.serverTimeOffset\n          saveDraft(peerID, draftObj, {notify: true, local: true})\n        })\n      })\n    }\n  })\n"]}