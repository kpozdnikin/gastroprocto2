{"version":3,"sources":["mtproto_wrapper.js"],"names":[],"mappings":"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","file":"mtproto_wrapper-compiled.js","sourcesContent":["/*!\n * Webogram v0.5.5 - messaging web application for MTProto\n * https://github.com/zhukov/webogram\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\n * https://github.com/zhukov/webogram/blob/master/LICENSE\n */\n\nangular.module('izhukov.mtproto.wrapper', ['izhukov.utils', 'izhukov.mtproto'])\n\n  .factory('MtpApiManager', function ($cookies, Storage, MtpAuthorizer, MtpNetworkerFactory, MtpSingleInstanceService, AppRuntimeManager, ErrorService, qSync, $rootScope, $q, TelegramMeWebService) {\n    var cachedNetworkers = {}\n    var cachedUploadNetworkers = {}\n    var cachedExportPromise = {}\n    var baseDcID = false\n\n    var telegramMeNotified\n\n    MtpSingleInstanceService.start()\n\n    Storage.get('dc').then(function (dcID) {\n      if (dcID) {\n        baseDcID = dcID\n      }\n    })\n\n    function telegramMeNotify (newValue) {\n      if (telegramMeNotified !== newValue) {\n        telegramMeNotified = newValue\n        TelegramMeWebService.setAuthorized(telegramMeNotified)\n      }\n    }\n\n    function mtpSetUserAuth (dcID, userAuth) {\n      var fullUserAuth = angular.extend({dcID: dcID}, userAuth)\n      Storage.set({\n        dc: dcID,\n        user_auth: fullUserAuth\n      })\n      telegramMeNotify(true)\n      //setting cookie to let us know that we are authorized\n      $cookies.putObject('user_auth', fullUserAuth);\n      $rootScope.$broadcast('user_auth', fullUserAuth);\n\n      baseDcID = dcID\n    }\n\n    function mtpLogOut () {\n      var storageKeys = []\n      for (var dcID = 1; dcID <= 5; dcID++) {\n        storageKeys.push('dc' + dcID + '_auth_key')\n      }\n      return Storage.get(storageKeys).then(function (storageResult) {\n        var logoutPromises = []\n        for (var i = 0; i < storageResult.length; i++) {\n          if (storageResult[i]) {\n            logoutPromises.push(mtpInvokeApi('auth.logOut', {}, {dcID: i + 1}))\n          }\n        }\n        return $q.all(logoutPromises).then(function () {\n          Storage.remove('dc', 'user_auth')\n          baseDcID = false\n          telegramMeNotify(false)\n          return mtpClearStorage()\n        }, function (error) {\n          storageKeys.push('dc', 'user_auth')\n          Storage.remove(storageKeys)\n          baseDcID = false\n          error.handled = true\n          telegramMeNotify(false)\n          return mtpClearStorage()\n        })\n      })\n    }\n\n    function mtpClearStorage () {\n      var saveKeys = []\n      for (var dcID = 1; dcID <= 5; dcID++) {\n        saveKeys.push('dc' + dcID + '_auth_key')\n        saveKeys.push('t_dc' + dcID + '_auth_key')\n      }\n      Storage.noPrefix()\n      Storage.get(saveKeys).then(function (values) {\n        Storage.clear().then(function () {\n          var restoreObj = {}\n          angular.forEach(saveKeys, function (key, i) {\n            var value = values[i]\n            if (value !== false && value !== undefined) {\n              restoreObj[key] = value\n            }\n          })\n          Storage.noPrefix()\n          return Storage.set(restoreObj)\n        })\n      })\n    }\n\n    function mtpGetNetworker (dcID, options) {\n      options = options || {}\n\n      var cache = (options.fileUpload || options.fileDownload)\n        ? cachedUploadNetworkers\n        : cachedNetworkers\n      if (!dcID) {\n        throw new Exception('get Networker without dcID')\n      }\n\n      if (cache[dcID] !== undefined) {\n        return qSync.when(cache[dcID])\n      }\n\n      var akk = 'dc' + dcID + '_auth_key'\n      var ssk = 'dc' + dcID + '_server_salt'\n\n      return Storage.get(akk, ssk).then(function (result) {\n        if (cache[dcID] !== undefined) {\n          return cache[dcID]\n        }\n\n        var authKeyHex = result[0]\n        var serverSaltHex = result[1]\n        // console.log('ass', dcID, authKeyHex, serverSaltHex)\n        if (authKeyHex && authKeyHex.length == 512) {\n          if (!serverSaltHex || serverSaltHex.length != 16) {\n            serverSaltHex = 'AAAAAAAAAAAAAAAA'\n          }\n          var authKey = bytesFromHex(authKeyHex)\n          var serverSalt = bytesFromHex(serverSaltHex)\n\n          return cache[dcID] = MtpNetworkerFactory.getNetworker(dcID, authKey, serverSalt, options)\n        }\n\n        if (!options.createNetworker) {\n          return $q.reject({type: 'AUTH_KEY_EMPTY', code: 401})\n        }\n\n        return MtpAuthorizer.auth(dcID).then(function (auth) {\n          var storeObj = {}\n          storeObj[akk] = bytesToHex(auth.authKey)\n          storeObj[ssk] = bytesToHex(auth.serverSalt)\n          Storage.set(storeObj)\n\n          return cache[dcID] = MtpNetworkerFactory.getNetworker(dcID, auth.authKey, auth.serverSalt, options)\n        }, function (error) {\n          console.log('Get networker error', error, error.stack)\n          return $q.reject(error)\n        })\n      })\n    }\n\n    function mtpInvokeApi (method, params, options) {\n      options = options || {}\n\n      var deferred = $q.defer()\n      var rejectPromise = function (error) {\n          if (!error) {\n            error = {type: 'ERROR_EMPTY'}\n          } else if (!angular.isObject(error)) {\n            error = {message: error}\n          }\n          deferred.reject(error)\n\n          if (!options.noErrorBox) {\n            error.input = method\n            error.stack = stack || (error.originalError && error.originalError.stack) || error.stack || (new Error()).stack\n            setTimeout(function () {\n              if (!error.handled) {\n                if (error.code == 401) {\n                  mtpLogOut()['finally'](function () {\n                    if (location.protocol == 'http:' &&\n                      !Config.Modes.http &&\n                      Config.App.domains.indexOf(location.hostname) != -1) {\n                      location.href = location.href.replace(/^http:/, 'https:')\n                    } else {\n                      location.hash = '/login'\n                      AppRuntimeManager.reload()\n                    }\n                  })\n                } else {\n                  ErrorService.show({error: error})\n                }\n                error.handled = true\n              }\n            }, 100)\n          }\n        },\n        dcID,\n        networkerPromise\n\n      var cachedNetworker\n      var stack = (new Error()).stack || 'empty stack'\n      var performRequest = function (networker) {\n        return (cachedNetworker = networker).wrapApiCall(method, params, options).then(\n          function (result) {\n            deferred.resolve(result)\n          },\n          function (error) {\n            console.error(dT(), 'Error', error.code, error.type, baseDcID, dcID)\n            if (error.code == 401 && baseDcID == dcID) {\n              Storage.remove('dc', 'user_auth')\n              telegramMeNotify(false)\n              rejectPromise(error)\n            }\n            else if (error.code == 401 && baseDcID && dcID != baseDcID) {\n              if (cachedExportPromise[dcID] === undefined) {\n                var exportDeferred = $q.defer()\n\n                mtpInvokeApi('auth.exportAuthorization', {dc_id: dcID}, {noErrorBox: true}).then(function (exportedAuth) {\n                  mtpInvokeApi('auth.importAuthorization', {\n                    id: exportedAuth.id,\n                    bytes: exportedAuth.bytes\n                  }, {dcID: dcID, noErrorBox: true}).then(function () {\n                    exportDeferred.resolve()\n                  }, function (e) {\n                    exportDeferred.reject(e)\n                  })\n                }, function (e) {\n                  exportDeferred.reject(e)\n                })\n\n                cachedExportPromise[dcID] = exportDeferred.promise\n              }\n\n              cachedExportPromise[dcID].then(function () {\n                (cachedNetworker = networker).wrapApiCall(method, params, options).then(function (result) {\n                  deferred.resolve(result)\n                }, rejectPromise)\n              }, rejectPromise)\n            }\n            else if (error.code == 303) {\n              var newDcID = error.type.match(/^(PHONE_MIGRATE_|NETWORK_MIGRATE_|USER_MIGRATE_)(\\d+)/)[2]\n              if (newDcID != dcID) {\n                if (options.dcID) {\n                  options.dcID = newDcID\n                } else {\n                  Storage.set({dc: baseDcID = newDcID})\n                }\n\n                mtpGetNetworker(newDcID, options).then(function (networker) {\n                  networker.wrapApiCall(method, params, options).then(function (result) {\n                    deferred.resolve(result)\n                  }, rejectPromise)\n                }, rejectPromise)\n              }\n            }\n            else if (!options.rawError && error.code == 420) {\n              var waitTime = error.type.match(/^FLOOD_WAIT_(\\d+)/)[1] || 10\n              if (waitTime > (options.timeout || 60)) {\n                return rejectPromise(error)\n              }\n              setTimeout(function () {\n                performRequest(cachedNetworker)\n              }, waitTime * 1000)\n            }\n            else if (!options.rawError && (error.code == 500 || error.type == 'MSG_WAIT_FAILED')) {\n              var now = tsNow()\n              if (options.stopTime) {\n                if (now >= options.stopTime) {\n                  return rejectPromise(error)\n                }\n              } else {\n                options.stopTime = now + (options.timeout !== undefined ? options.timeout : 10) * 1000\n              }\n              options.waitTime = options.waitTime ? Math.min(60, options.waitTime * 1.5) : 1\n              setTimeout(function () {\n                performRequest(cachedNetworker)\n              }, options.waitTime * 1000)\n            }else {\n              rejectPromise(error)\n            }\n          })\n      }\n\n      if (dcID = (options.dcID || baseDcID)) {\n        mtpGetNetworker(dcID, options).then(performRequest, rejectPromise)\n      } else {\n        Storage.get('dc').then(function (baseDcID) {\n          mtpGetNetworker(dcID = baseDcID || 2, options).then(performRequest, rejectPromise)\n        })\n      }\n\n      return deferred.promise\n    }\n\n    function mtpGetUserID () {\n      return Storage.get('user_auth').then(function (auth) {\n        telegramMeNotify(auth && auth.id > 0 || false)\n        return auth.id || 0\n      })\n    }\n\n    function getBaseDcID () {\n      return baseDcID || false\n    }\n\n    return {\n      getBaseDcID: getBaseDcID,\n      getUserID: mtpGetUserID,\n      invokeApi: mtpInvokeApi,\n      getNetworker: mtpGetNetworker,\n      setUserAuth: mtpSetUserAuth,\n      logOut: mtpLogOut\n    }\n  })\n\n  .factory('MtpApiFileManager', function (MtpApiManager, $q, qSync, FileManager, IdbFileStorage, TmpfsFileStorage, MemoryFileStorage, WebpManager) {\n    var cachedFs = false\n    var cachedFsPromise = false\n    var cachedSavePromises = {}\n    var cachedDownloadPromises = {}\n    var cachedDownloads = {}\n\n    var downloadPulls = {}\n    var downloadActives = {}\n\n    function downloadRequest (dcID, cb, activeDelta) {\n      if (downloadPulls[dcID] === undefined) {\n        downloadPulls[dcID] = []\n        downloadActives[dcID] = 0\n      }\n      var downloadPull = downloadPulls[dcID]\n      var deferred = $q.defer()\n      downloadPull.push({cb: cb, deferred: deferred, activeDelta: activeDelta})\n      setZeroTimeout(function () {\n        downloadCheck(dcID)\n      })\n\n      return deferred.promise\n    }\n\n    var index = 0\n\n    function downloadCheck (dcID) {\n      var downloadPull = downloadPulls[dcID]\n      var downloadLimit = dcID == 'upload' ? 11 : 5\n\n      if (downloadActives[dcID] >= downloadLimit || !downloadPull || !downloadPull.length) {\n        return false\n      }\n\n      var data = downloadPull.shift()\n      var activeDelta = data.activeDelta || 1\n\n      downloadActives[dcID] += activeDelta\n\n      var a = index++\n      data.cb()\n        .then(function (result) {\n          downloadActives[dcID] -= activeDelta\n          downloadCheck(dcID)\n\n          data.deferred.resolve(result)\n        }, function (error) {\n          downloadActives[dcID] -= activeDelta\n          downloadCheck(dcID)\n\n          data.deferred.reject(error)\n        })\n    }\n\n    function getFileName (location) {\n      switch (location._) {\n        case 'inputDocumentFileLocation':\n          var fileName = (location.file_name || '').split('.', 2)\n          var ext = fileName[1] || ''\n          if (location.sticker && !WebpManager.isWebpSupported()) {\n            ext += '.png'\n          }\n          var versionPart = location.version ? ('v' + location.version) : ''\n          return fileName[0] + '_' + location.id + versionPart + '.' + ext\n\n        default:\n          if (!location.volume_id) {\n            console.trace('Empty location', location)\n          }\n          var ext = 'jpg'\n          if (location.sticker) {\n            ext = WebpManager.isWebpSupported() ? 'webp' : 'png'\n          }\n          return location.volume_id + '_' + location.local_id + '_' + location.secret + '.' + ext\n      }\n    }\n\n    function getTempFileName (file) {\n      var size = file.size || -1\n      var random = nextRandomInt(0xFFFFFFFF)\n      return '_temp' + random + '_' + size\n    }\n\n    function getCachedFile (location) {\n      if (!location) {\n        return false\n      }\n      var fileName = getFileName(location)\n\n      return cachedDownloads[fileName] || false\n    }\n\n    function getFileStorage () {\n      if (!Config.Modes.memory_only) {\n        if (TmpfsFileStorage.isAvailable()) {\n          return TmpfsFileStorage\n        }\n        if (IdbFileStorage.isAvailable()) {\n          return IdbFileStorage\n        }\n      }\n      return MemoryFileStorage\n    }\n\n    function saveSmallFile (location, bytes) {\n      var fileName = getFileName(location)\n      var mimeType = 'image/jpeg'\n\n      if (!cachedSavePromises[fileName]) {\n        cachedSavePromises[fileName] = getFileStorage().saveFile(fileName, bytes).then(function (blob) {\n          return cachedDownloads[fileName] = blob\n        }, function (error) {\n          delete cachedSavePromises[fileName]\n        })\n      }\n      return cachedSavePromises[fileName]\n    }\n\n    function downloadSmallFile (location) {\n      if (!FileManager.isAvailable()) {\n        return $q.reject({type: 'BROWSER_BLOB_NOT_SUPPORTED'})\n      }\n      var fileName = getFileName(location)\n      var mimeType = location.sticker ? 'image/webp' : 'image/jpeg'\n      var cachedPromise = cachedSavePromises[fileName] || cachedDownloadPromises[fileName]\n\n      if (cachedPromise) {\n        return cachedPromise\n      }\n\n      var fileStorage = getFileStorage()\n\n      return cachedDownloadPromises[fileName] = fileStorage.getFile(fileName).then(function (blob) {\n        return cachedDownloads[fileName] = blob\n      }, function () {\n        var downloadPromise = downloadRequest(location.dc_id, function () {\n          var inputLocation = location\n          if (!inputLocation._ || inputLocation._ == 'fileLocation') {\n            inputLocation = angular.extend({}, location, {_: 'inputFileLocation'})\n          }\n          // console.log('next small promise')\n          return MtpApiManager.invokeApi('upload.getFile', {\n            location: inputLocation,\n            offset: 0,\n            limit: 1024 * 1024\n          }, {\n            dcID: location.dc_id,\n            fileDownload: true,\n            createNetworker: true,\n            noErrorBox: true\n          })\n        })\n\n        var processDownloaded = function (bytes) {\n          if (!location.sticker || WebpManager.isWebpSupported()) {\n            return qSync.when(bytes)\n          }\n          return WebpManager.getPngBlobFromWebp(bytes)\n        }\n\n        return fileStorage.getFileWriter(fileName, mimeType).then(function (fileWriter) {\n          return downloadPromise.then(function (result) {\n            return processDownloaded(result.bytes).then(function (proccessedResult) {\n              return FileManager.write(fileWriter, proccessedResult).then(function () {\n                return cachedDownloads[fileName] = fileWriter.finalize()\n              })\n            })\n          })\n        })\n      })\n    }\n\n    function getDownloadedFile (location, size) {\n      var fileStorage = getFileStorage()\n      var fileName = getFileName(location)\n\n      return fileStorage.getFile(fileName, size)\n    }\n\n    function downloadFile (dcID, location, size, options) {\n      if (!FileManager.isAvailable()) {\n        return $q.reject({type: 'BROWSER_BLOB_NOT_SUPPORTED'})\n      }\n\n      options = options || {}\n\n      var processSticker = false\n      if (location.sticker && !WebpManager.isWebpSupported()) {\n        if (options.toFileEntry || size > 524288) {\n          delete location.sticker\n        } else {\n          processSticker = true\n          options.mime = 'image/png'\n        }\n      }\n\n      // console.log(dT(), 'Dload file', dcID, location, size)\n      var fileName = getFileName(location)\n      var toFileEntry = options.toFileEntry || null\n      var cachedPromise = cachedSavePromises[fileName] || cachedDownloadPromises[fileName]\n\n      var fileStorage = getFileStorage()\n\n      // console.log(dT(), 'fs', fileStorage.name, fileName, cachedPromise)\n\n      if (cachedPromise) {\n        if (toFileEntry) {\n          return cachedPromise.then(function (blob) {\n            return FileManager.copy(blob, toFileEntry)\n          })\n        }\n        return cachedPromise\n      }\n\n      var deferred = $q.defer()\n      var canceled = false\n      var resolved = false\n      var mimeType = options.mime || 'image/jpeg',\n        cacheFileWriter\n      var errorHandler = function (error) {\n        deferred.reject(error)\n        errorHandler = angular.noop\n        if (cacheFileWriter &&\n          (!error || error.type != 'DOWNLOAD_CANCELED')) {\n          cacheFileWriter.truncate(0)\n        }\n      }\n\n      fileStorage.getFile(fileName, size).then(function (blob) {\n        if (toFileEntry) {\n          FileManager.copy(blob, toFileEntry).then(function () {\n            deferred.resolve()\n          }, errorHandler)\n        } else {\n          deferred.resolve(cachedDownloads[fileName] = blob)\n        }\n      }, function () {\n        var fileWriterPromise = toFileEntry ? FileManager.getFileWriter(toFileEntry) : fileStorage.getFileWriter(fileName, mimeType)\n\n        var processDownloaded = function (bytes) {\n          if (!processSticker) {\n            return qSync.when(bytes)\n          }\n          return WebpManager.getPngBlobFromWebp(bytes)\n        }\n\n        fileWriterPromise.then(function (fileWriter) {\n          cacheFileWriter = fileWriter\n          var limit = 524288,\n            offset\n          var startOffset = 0\n          var writeFilePromise = $q.when(),\n            writeFileDeferred\n          if (fileWriter.length) {\n            startOffset = fileWriter.length\n            if (startOffset >= size) {\n              if (toFileEntry) {\n                deferred.resolve()\n              } else {\n                deferred.resolve(cachedDownloads[fileName] = fileWriter.finalize())\n              }\n              return\n            }\n            fileWriter.seek(startOffset)\n            deferred.notify({done: startOffset, total: size})\n          }\n          for (offset = startOffset; offset < size; offset += limit) {\n            writeFileDeferred = $q.defer()\n            ;(function (isFinal, offset, writeFileDeferred, writeFilePromise) {\n              return downloadRequest(dcID, function () {\n                if (canceled) {\n                  return $q.when()\n                }\n                return MtpApiManager.invokeApi('upload.getFile', {\n                  location: location,\n                  offset: offset,\n                  limit: limit\n                }, {\n                  dcID: dcID,\n                  fileDownload: true,\n                  singleInRequest: window.safari !== undefined,\n                  createNetworker: true\n                })\n              }, 2).then(function (result) {\n                writeFilePromise.then(function () {\n                  if (canceled) {\n                    return $q.when()\n                  }\n                  return processDownloaded(result.bytes).then(function (processedResult) {\n                    return FileManager.write(fileWriter, processedResult).then(function () {\n                      writeFileDeferred.resolve()\n                    }, errorHandler).then(function () {\n                      if (isFinal) {\n                        resolved = true\n                        if (toFileEntry) {\n                          deferred.resolve()\n                        } else {\n                          deferred.resolve(cachedDownloads[fileName] = fileWriter.finalize())\n                        }\n                      } else {\n                        deferred.notify({done: offset + limit, total: size})\n                      }\n                    })\n                  })\n                })\n              })\n            })(offset + limit >= size, offset, writeFileDeferred, writeFilePromise)\n            writeFilePromise = writeFileDeferred.promise\n          }\n        })\n      })\n\n      deferred.promise.cancel = function () {\n        if (!canceled && !resolved) {\n          canceled = true\n          delete cachedDownloadPromises[fileName]\n          errorHandler({type: 'DOWNLOAD_CANCELED'})\n        }\n      }\n\n      if (!toFileEntry) {\n        cachedDownloadPromises[fileName] = deferred.promise\n      }\n\n      return deferred.promise\n    }\n\n    function uploadFile (file) {\n      var fileSize = file.size,\n        isBigFile = fileSize >= 10485760,\n        canceled = false,\n        resolved = false,\n        doneParts = 0,\n        partSize = 262144, // 256 Kb\n        activeDelta = 2\n\n      if (fileSize > 67108864) {\n        partSize = 524288\n        activeDelta = 4\n      }\n      else if (fileSize < 102400) {\n        partSize = 32768\n        activeDelta = 1\n      }\n      var totalParts = Math.ceil(fileSize / partSize)\n\n      if (totalParts > 3000) {\n        return $q.reject({type: 'FILE_TOO_BIG'})\n      }\n\n      var fileID = [nextRandomInt(0xFFFFFFFF), nextRandomInt(0xFFFFFFFF)]\n      var deferred = $q.defer()\n      var errorHandler = function (error) {\n          // console.error('Up Error', error)\n          deferred.reject(error)\n          canceled = true\n          errorHandler = angular.noop\n        },\n        part = 0,\n        offset,\n        resultInputFile = {\n          _: isBigFile ? 'inputFileBig' : 'inputFile',\n          id: fileID,\n          parts: totalParts,\n          name: file.name,\n          md5_checksum: ''\n      }\n\n      for (offset = 0; offset < fileSize; offset += partSize) {\n        (function (offset, part) {\n          downloadRequest('upload', function () {\n            var uploadDeferred = $q.defer()\n\n            var reader = new FileReader()\n            var blob = file.slice(offset, offset + partSize)\n\n            reader.onloadend = function (e) {\n              if (canceled) {\n                uploadDeferred.reject()\n                return\n              }\n              if (e.target.readyState != FileReader.DONE) {\n                return\n              }\n              MtpApiManager.invokeApi(isBigFile ? 'upload.saveBigFilePart' : 'upload.saveFilePart', {\n                file_id: fileID,\n                file_part: part,\n                file_total_parts: totalParts,\n                bytes: e.target.result\n              }, {\n                startMaxLength: partSize + 256,\n                fileUpload: true,\n                singleInRequest: true\n              }).then(function (result) {\n                doneParts++\n                uploadDeferred.resolve()\n                if (doneParts >= totalParts) {\n                  deferred.resolve(resultInputFile)\n                  resolved = true\n                } else {\n                  console.log(dT(), 'Progress', doneParts * partSize / fileSize)\n                  deferred.notify({done: doneParts * partSize, total: fileSize})\n                }\n              }, errorHandler)\n            }\n\n            reader.readAsArrayBuffer(blob)\n\n            return uploadDeferred.promise\n          }, activeDelta)\n        })(offset, part++)\n      }\n\n      deferred.promise.cancel = function () {\n        console.log('cancel upload', canceled, resolved)\n        if (!canceled && !resolved) {\n          canceled = true\n          errorHandler({type: 'UPLOAD_CANCELED'})\n        }\n      }\n\n      return deferred.promise\n    }\n\n    return {\n      getCachedFile: getCachedFile,\n      getDownloadedFile: getDownloadedFile,\n      downloadFile: downloadFile,\n      downloadSmallFile: downloadSmallFile,\n      saveSmallFile: saveSmallFile,\n      uploadFile: uploadFile\n    }\n  })\n\n  .service('MtpSingleInstanceService', function (_, $rootScope, $compile, $timeout, $interval, $modalStack, Storage, AppRuntimeManager, IdleManager, ErrorService, MtpNetworkerFactory) {\n    var instanceID = nextRandomInt(0xFFFFFFFF)\n    var started = false\n    var masterInstance = false\n    var deactivatePromise = false\n    var deactivated = false\n\n    function start () {\n      if (!started && !Config.Navigator.mobile && !Config.Modes.packed) {\n        started = true\n\n        IdleManager.start()\n\n        $rootScope.$watch('idle.isIDLE', checkInstance)\n        $interval(checkInstance, 5000)\n        checkInstance()\n\n        try {\n          $($window).on('beforeunload', clearInstance)\n        } catch (e) {}\n      }\n    }\n\n    function clearInstance () {\n      Storage.remove(masterInstance ? 'xt_instance' : 'xt_idle_instance')\n    }\n\n    function deactivateInstance () {\n      if (masterInstance || deactivated) {\n        return false\n      }\n      console.log(dT(), 'deactivate')\n      deactivatePromise = false\n      deactivated = true\n      clearInstance()\n      $modalStack.dismissAll()\n\n      document.title = _('inactive_tab_title_raw')\n\n      var inactivePageCompiled = $compile('<ng-include src=\"\\'partials/desktop/inactive.html\\'\"></ng-include>')\n\n      var scope = $rootScope.$new(true)\n      scope.close = function () {\n        AppRuntimeManager.close()\n      }\n      scope.reload = function () {\n        AppRuntimeManager.reload()\n      }\n      inactivePageCompiled(scope, function (clonedElement) {\n        $('.page_wrap').hide()\n        $(clonedElement).appendTo($('body'))\n      })\n      $rootScope.idle.deactivated = true\n    }\n\n    function checkInstance () {\n      if (deactivated) {\n        return false\n      }\n      var time = tsNow()\n      var idle = $rootScope.idle && $rootScope.idle.isIDLE\n      var newInstance = {id: instanceID, idle: idle, time: time}\n\n      Storage.get('xt_instance', 'xt_idle_instance').then(function (result) {\n        var curInstance = result[0]\n        var idleInstance = result[1]\n\n        // console.log(dT(), 'check instance', newInstance, curInstance, idleInstance)\n        if (!idle ||\n          !curInstance ||\n          curInstance.id == instanceID ||\n          curInstance.time < time - 60000) {\n          if (idleInstance &&\n            idleInstance.id == instanceID) {\n            Storage.remove('xt_idle_instance')\n          }\n          Storage.set({xt_instance: newInstance})\n          if (!masterInstance) {\n            MtpNetworkerFactory.startAll()\n            console.warn(dT(), 'now master instance', newInstance)\n          }\n          masterInstance = true\n          if (deactivatePromise) {\n            $timeout.cancel(deactivatePromise)\n            deactivatePromise = false\n          }\n        } else {\n          Storage.set({xt_idle_instance: newInstance})\n          if (masterInstance) {\n            MtpNetworkerFactory.stopAll()\n            console.warn(dT(), 'now idle instance', newInstance)\n            if (!deactivatePromise) {\n              deactivatePromise = $timeout(deactivateInstance, 30000)\n            }\n          }\n          masterInstance = false\n        }\n      })\n    }\n\n    return {\n      start: start\n    }\n  })\n"]}