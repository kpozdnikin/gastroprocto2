{"version":3,"sources":["ng_utils.js"],"names":[],"mappings":"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","file":"ng_utils-compiled.js","sourcesContent":["/*!\n * Webogram v0.5.5 - messaging web application for MTProto\n * https://github.com/zhukov/webogram\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\n * https://github.com/zhukov/webogram/blob/master/LICENSE\n */\n\nangular.module('izhukov.utils', [])\n\n  .provider('Storage', function () {\n    this.setPrefix = function (newPrefix) {\n      ConfigStorage.prefix(newPrefix)\n    }\n\n    this.$get = ['$q', function ($q) {\n      var methods = {}\n      angular.forEach(['get', 'set', 'remove', 'clear'], function (methodName) {\n        methods[methodName] = function () {\n          var deferred = $q.defer()\n          var args = Array.prototype.slice.call(arguments)\n\n          args.push(function (result) {\n            deferred.resolve(result)\n          })\n          ConfigStorage[methodName].apply(ConfigStorage, args)\n\n          return deferred.promise\n        }\n      })\n\n      methods.noPrefix = function () {\n        ConfigStorage.noPrefix()\n      }\n\n      return methods\n    }]\n  })\n\n  .service('qSync', function () {\n    return {\n      when: function (result) {\n        return {then: function (cb) {\n            return cb(result)\n        }}\n      },\n      reject: function (result) {\n        return {then: function (cb, badcb) {\n            if (badcb) {\n              return badcb(result)\n            }\n        }}\n      }\n    }\n  })\n\n  .service('FileManager', function ($window, $q, $timeout, qSync) {\n    $window.URL = $window.URL || $window.webkitURL\n    $window.BlobBuilder = $window.BlobBuilder || $window.WebKitBlobBuilder || $window.MozBlobBuilder\n    var buggyUnknownBlob = navigator.userAgent.indexOf('Safari') != -1 &&\n      navigator.userAgent.indexOf('Chrome') == -1\n\n    var blobSupported = true\n\n    try {\n      blobConstruct([], '')\n    } catch (e) {\n      blobSupported = false\n    }\n\n    function isBlobAvailable () {\n      return blobSupported\n    }\n\n    function fileCopyTo (fromFileEntry, toFileEntry) {\n      return getFileWriter(toFileEntry).then(function (fileWriter) {\n        return fileWriteData(fileWriter, fromFileEntry).then(function () {\n          return fileWriter\n        }, function (error) {\n          try {\n            fileWriter.truncate(0)\n          } catch (e) {}\n          return $q.reject(error)\n        })\n      })\n    }\n\n    function fileWriteData (fileWriter, bytes) {\n      var deferred = $q.defer()\n\n      fileWriter.onwriteend = function (e) {\n        deferred.resolve()\n      }\n      fileWriter.onerror = function (e) {\n        deferred.reject(e)\n      }\n\n      if (bytes.file) {\n        bytes.file(function (file) {\n          fileWriter.write(file)\n        }, function (error) {\n          deferred.reject(error)\n        })\n      }\n      else if (bytes instanceof Blob) { // is file bytes\n        fileWriter.write(bytes)\n      }else {\n        try {\n          var blob = blobConstruct([bytesToArrayBuffer(bytes)])\n          fileWriter.write(blob)\n        } catch (e) {\n          deferred.reject(e)\n        }\n      }\n\n      return deferred.promise\n    }\n\n    function chooseSaveFile (fileName, ext, mimeType) {\n      if (!$window.chrome || !chrome.fileSystem || !chrome.fileSystem.chooseEntry) {\n        return qSync.reject()\n      }\n      var deferred = $q.defer()\n\n      chrome.fileSystem.chooseEntry({\n        type: 'saveFile',\n        suggestedName: fileName,\n        accepts: [{\n          mimeTypes: [mimeType],\n          extensions: [ext]\n        }]\n      }, function (writableFileEntry) {\n        deferred.resolve(writableFileEntry)\n      })\n\n      return deferred.promise\n    }\n\n    function getFileWriter (fileEntry) {\n      var deferred = $q.defer()\n\n      fileEntry.createWriter(function (fileWriter) {\n        deferred.resolve(fileWriter)\n      }, function (error) {\n        deferred.reject(error)\n      })\n\n      return deferred.promise\n    }\n\n    function getFakeFileWriter (mimeType, saveFileCallback) {\n      var blobParts = []\n      var fakeFileWriter = {\n        write: function (blob) {\n          if (!blobSupported) {\n            if (fakeFileWriter.onerror) {\n              fakeFileWriter.onerror(new Error('Blob not supported by browser'))\n            }\n            return false\n          }\n          blobParts.push(blob)\n          setZeroTimeout(function () {\n            if (fakeFileWriter.onwriteend) {\n              fakeFileWriter.onwriteend()\n            }\n          })\n        },\n        truncate: function () {\n          blobParts = []\n        },\n        finalize: function () {\n          var blob = blobConstruct(blobParts, mimeType)\n          if (saveFileCallback) {\n            saveFileCallback(blob)\n          }\n          return blob\n        }\n      }\n\n      return fakeFileWriter\n    }\n\n    function getUrl (fileData, mimeType) {\n      // console.log(dT(), 'get url', fileData, mimeType, fileData.toURL !== undefined, fileData instanceof Blob)\n      if (fileData.toURL !== undefined) {\n        return fileData.toURL(mimeType)\n      }\n      if (fileData instanceof Blob) {\n        return URL.createObjectURL(fileData)\n      }\n      return 'data:' + mimeType + ';base64,' + bytesToBase64(fileData)\n    }\n\n    function getByteArray (fileData) {\n      if (fileData instanceof Blob) {\n        var deferred = $q.defer()\n        try {\n          var reader = new FileReader()\n          reader.onloadend = function (e) {\n            deferred.resolve(new Uint8Array(e.target.result))\n          }\n          reader.onerror = function (e) {\n            deferred.reject(e)\n          }\n          reader.readAsArrayBuffer(fileData)\n\n          return deferred.promise\n        } catch (e) {\n          return $q.reject(e)\n        }\n      }\n      else if (fileData.file) {\n        var deferred = $q.defer()\n        fileData.file(function (blob) {\n          getByteArray(blob).then(function (result) {\n            deferred.resolve(result)\n          }, function (error) {\n            deferred.reject(error)\n          })\n        }, function (error) {\n          deferred.reject(error)\n        })\n        return deferred.promise\n      }\n      return $q.when(fileData)\n    }\n\n    function getDataUrl (blob) {\n      var deferred\n      try {\n        var reader = new FileReader()\n        reader.onloadend = function () {\n          deferred.resolve(reader.result)\n        }\n        reader.readAsDataURL(blob)\n      } catch (e) {\n        return $q.reject(e)\n      }\n\n      deferred = $q.defer()\n\n      return deferred.promise\n    }\n\n    function getFileCorrectUrl (blob, mimeType) {\n      if (buggyUnknownBlob && blob instanceof Blob) {\n        var mimeType = blob.type || blob.mimeType || mimeType || ''\n        if (!mimeType.match(/image\\/(jpeg|gif|png|bmp)|video\\/quicktime/)) {\n          return getDataUrl(blob)\n        }\n      }\n      return qSync.when(getUrl(blob, mimeType))\n    }\n\n    function downloadFile (blob, mimeType, fileName) {\n      if (window.navigator && navigator.msSaveBlob !== undefined) {\n        window.navigator.msSaveBlob(blob, fileName)\n        return false\n      }\n\n      if (window.navigator && navigator.getDeviceStorage) {\n        var storageName = 'sdcard'\n        var subdir = 'telegram/'\n        switch (mimeType.split('/')[0]) {\n          case 'video':\n            storageName = 'videos'\n            break\n          case 'audio':\n            storageName = 'music'\n            break\n          case 'image':\n            storageName = 'pictures'\n            break\n        }\n        var deviceStorage = navigator.getDeviceStorage(storageName)\n\n        var request = deviceStorage.addNamed(blob, subdir + fileName)\n\n        request.onsuccess = function () {\n          console.log('Device storage save result', this.result)\n        }\n        request.onerror = function () {}\n        return\n      }\n\n      var popup = false\n      if (window.safari) {\n        popup = window.open()\n      }\n\n      getFileCorrectUrl(blob, mimeType).then(function (url) {\n        if (popup) {\n          try {\n            popup.location.href = url\n            return\n          } catch (e) {}\n        }\n        var anchor = document.createElementNS('http://www.w3.org/1999/xhtml', 'a')\n        anchor.href = url\n        anchor.target = '_blank'\n        anchor.download = fileName\n        if (anchor.dataset) {\n          anchor.dataset.downloadurl = ['video/quicktime', fileName, url].join(':')\n        }\n        $(anchor).css({position: 'absolute', top: 1, left: 1}).appendTo('body')\n\n        try {\n          var clickEvent = document.createEvent('MouseEvents')\n          clickEvent.initMouseEvent(\n            'click', true, false, window, 0, 0, 0, 0, 0\n            , false, false, false, false, 0, null\n          )\n          anchor.dispatchEvent(clickEvent)\n        } catch (e) {\n          console.error('Download click error', e)\n          try {\n            anchor[0].click()\n          } catch (e) {\n            window.open(url, '_blank')\n          }\n        }\n        $timeout(function () {\n          $(anchor).remove()\n        }, 100)\n      })\n    }\n\n    return {\n      isAvailable: isBlobAvailable,\n      copy: fileCopyTo,\n      write: fileWriteData,\n      getFileWriter: getFileWriter,\n      getFakeFileWriter: getFakeFileWriter,\n      chooseSave: chooseSaveFile,\n      getUrl: getUrl,\n      getDataUrl: getDataUrl,\n      getByteArray: getByteArray,\n      getFileCorrectUrl: getFileCorrectUrl,\n      download: downloadFile\n    }\n  })\n\n  .service('IdbFileStorage', function ($q, $window, FileManager) {\n    $window.indexedDB = $window.indexedDB || $window.webkitIndexedDB || $window.mozIndexedDB || $window.OIndexedDB || $window.msIndexedDB\n    $window.IDBTransaction = $window.IDBTransaction || $window.webkitIDBTransaction || $window.OIDBTransaction || $window.msIDBTransaction\n\n    var dbName = 'cachedFiles'\n    var dbStoreName = 'files'\n    var dbVersion = 2\n    var openDbPromise\n    var storageIsAvailable = $window.indexedDB !== undefined &&\n      $window.IDBTransaction !== undefined\n\n    // IndexedDB is REALLY slow without blob support in Safari 8, no point in it\n    if (storageIsAvailable &&\n      navigator.userAgent.indexOf('Safari') != -1 &&\n      navigator.userAgent.indexOf('Chrome') == -1 &&\n      navigator.userAgent.match(/Version\\/[678]/)\n    ) {\n      storageIsAvailable = false\n    }\n\n    var storeBlobsAvailable = storageIsAvailable || false\n\n    function isAvailable () {\n      return storageIsAvailable\n    }\n\n    function openDatabase () {\n      if (openDbPromise) {\n        return openDbPromise\n      }\n\n      try {\n        var request = indexedDB.open(dbName, dbVersion)\n        var deferred = $q.defer()\n        var createObjectStore = function (db) {\n          db.createObjectStore(dbStoreName)\n        }\n        if (!request) {\n          throw new Exception()\n        }\n      } catch (error) {\n        console.error('error opening db', error.message)\n        storageIsAvailable = false\n        return $q.reject(error)\n      }\n\n      var finished = false\n      setTimeout(function () {\n        if (!finished) {\n          request.onerror({type: 'IDB_CREATE_TIMEOUT'})\n        }\n      }, 3000)\n\n      request.onsuccess = function (event) {\n        finished = true\n        db = request.result\n\n        db.onerror = function (error) {\n          storageIsAvailable = false\n          console.error('Error creating/accessing IndexedDB database', error)\n          deferred.reject(error)\n        }\n\n        deferred.resolve(db)\n      }\n\n      request.onerror = function (event) {\n        finished = true\n        storageIsAvailable = false\n        console.error('Error creating/accessing IndexedDB database', event)\n        deferred.reject(event)\n      }\n\n      request.onupgradeneeded = function (event) {\n        finished = true\n        console.warn('performing idb upgrade from', event.oldVersion, 'to', event.newVersion)\n        var db = event.target.result\n        if (event.oldVersion == 1) {\n          db.deleteObjectStore(dbStoreName)\n        }\n        createObjectStore(db)\n      }\n\n      return openDbPromise = deferred.promise\n    }\n\n    function saveFile (fileName, blob) {\n      return openDatabase().then(function (db) {\n        if (!storeBlobsAvailable) {\n          return saveFileBase64(db, fileName, blob)\n        }\n\n        if (!(blob instanceof Blob)) {\n          blob = blobConstruct([blob])\n        }\n\n        try {\n          var objectStore = db.transaction([dbStoreName], IDBTransaction.READ_WRITE || 'readwrite').objectStore(dbStoreName)\n          var request = objectStore.put(blob, fileName)\n        } catch (error) {\n          if (storeBlobsAvailable) {\n            storeBlobsAvailable = false\n            return saveFileBase64(db, fileName, blob)\n          }\n          storageIsAvailable = false\n          return $q.reject(error)\n        }\n\n        var deferred = $q.defer()\n\n        request.onsuccess = function (event) {\n          deferred.resolve(blob)\n        }\n\n        request.onerror = function (error) {\n          deferred.reject(error)\n        }\n\n        return deferred.promise\n      })\n    }\n\n    function saveFileBase64 (db, fileName, blob) {\n      if (getBlobSize(blob) > 10 * 1024 * 1024) {\n        return $q.reject()\n      }\n      if (!(blob instanceof Blob)) {\n        var mimeType = blob.type || 'image/jpeg'\n        var address = 'data:' + mimeType + ';base64,' + bytesToBase64(blob)\n        return storagePutB64String(db, fileName, address).then(function () {\n          return blob\n        })\n      }\n\n      try {\n        var reader = new FileReader()\n      } catch (e) {\n        storageIsAvailable = false\n        return $q.reject()\n      }\n\n      var deferred = $q.defer()\n\n      reader.onloadend = function () {\n        storagePutB64String(db, fileName, reader.result).then(function () {\n          deferred.resolve(blob)\n        }, function (error) {\n          deferred.reject(error)\n        })\n      }\n\n      reader.onerror = function (error) {\n        deferred.reject(error)\n      }\n\n      try {\n        reader.readAsDataURL(blob)\n      } catch (e) {\n        storageIsAvailable = false\n        return $q.reject()\n      }\n\n      return deferred.promise\n    }\n\n    function storagePutB64String (db, fileName, b64string) {\n      try {\n        var objectStore = db.transaction([dbStoreName], IDBTransaction.READ_WRITE || 'readwrite').objectStore(dbStoreName)\n        var request = objectStore.put(b64string, fileName)\n      } catch (error) {\n        storageIsAvailable = false\n        return $q.reject(error)\n      }\n\n      var deferred = $q.defer()\n\n      request.onsuccess = function (event) {\n        deferred.resolve()\n      }\n\n      request.onerror = function (error) {\n        deferred.reject(error)\n      }\n\n      return deferred.promise\n    }\n\n    function getBlobSize (blob) {\n      return blob.size || blob.byteLength || blob.length\n    }\n\n    function getFile (fileName) {\n      return openDatabase().then(function (db) {\n        var deferred = $q.defer()\n        var objectStore = db.transaction([dbStoreName], IDBTransaction.READ || 'readonly').objectStore(dbStoreName)\n        var request = objectStore.get(fileName)\n\n        request.onsuccess = function (event) {\n          var result = event.target.result\n          if (result === undefined) {\n            deferred.reject()\n          } else if (typeof result === 'string' &&\n            result.substr(0, 5) === 'data:') {\n            deferred.resolve(dataUrlToBlob(result))\n          } else {\n            deferred.resolve(result)\n          }\n        }\n\n        request.onerror = function (error) {\n          deferred.reject(error)\n        }\n\n        return deferred.promise\n      })\n    }\n\n    function getFileWriter (fileName, mimeType) {\n      var fakeWriter = FileManager.getFakeFileWriter(mimeType, function (blob) {\n        saveFile(fileName, blob)\n      })\n      return $q.when(fakeWriter)\n    }\n\n    openDatabase()\n\n    return {\n      name: 'IndexedDB',\n      isAvailable: isAvailable,\n      saveFile: saveFile,\n      getFile: getFile,\n      getFileWriter: getFileWriter\n    }\n  })\n\n  .service('TmpfsFileStorage', function ($q, $window, FileManager) {\n    $window.requestFileSystem = $window.requestFileSystem || $window.webkitRequestFileSystem\n\n    var reqFsPromise,\n      fileSystem\n    var storageIsAvailable = $window.requestFileSystem !== undefined\n\n    function requestFS () {\n      if (reqFsPromise) {\n        return reqFsPromise\n      }\n\n      if (!$window.requestFileSystem) {\n        return reqFsPromise = $q.reject({type: 'FS_BROWSER_UNSUPPORTED', description: 'requestFileSystem not present'})\n      }\n\n      var deferred = $q.defer()\n\n      $window.requestFileSystem($window.TEMPORARY, 500 * 1024 * 1024, function (fs) {\n        cachedFs = fs\n        deferred.resolve()\n      }, function (e) {\n        storageIsAvailable = false\n        deferred.reject(e)\n      })\n\n      return reqFsPromise = deferred.promise\n    }\n\n    function isAvailable () {\n      return storageIsAvailable\n    }\n\n    function getFile (fileName, size) {\n      size = size || 1\n      return requestFS().then(function () {\n        // console.log(dT(), 'get file', fileName)\n        var deferred = $q.defer()\n        cachedFs.root.getFile(fileName, {create: false}, function (fileEntry) {\n          fileEntry.file(function (file) {\n            // console.log(dT(), 'aa', file)\n            if (file.size >= size) {\n              deferred.resolve(fileEntry)\n            } else {\n              deferred.reject(new Error('FILE_NOT_FOUND'))\n            }\n          }, function (error) {\n            console.log(dT(), 'error', error)\n            deferred.reject(error)\n          })\n        }, function () {\n          deferred.reject(new Error('FILE_NOT_FOUND'))\n        })\n        return deferred.promise\n      })\n    }\n\n    function saveFile (fileName, blob) {\n      return getFileWriter(fileName).then(function (fileWriter) {\n        return FileManager.write(fileWriter, blob).then(function () {\n          return fileWriter.finalize()\n        })\n      })\n    }\n\n    function getFileWriter (fileName) {\n      // console.log(dT(), 'get file writer', fileName)\n      return requestFS().then(function () {\n        var deferred = $q.defer()\n        cachedFs.root.getFile(fileName, {create: true}, function (fileEntry) {\n          FileManager.getFileWriter(fileEntry).then(function (fileWriter) {\n            fileWriter.finalize = function () {\n              return fileEntry\n            }\n            deferred.resolve(fileWriter)\n          }, function (error) {\n            storageIsAvailable = false\n            deferred.reject(error)\n          })\n        }, function (error) {\n          storageIsAvailable = false\n          deferred.reject(error)\n        })\n\n        return deferred.promise\n      })\n    }\n\n    requestFS()\n\n    return {\n      name: 'TmpFS',\n      isAvailable: isAvailable,\n      saveFile: saveFile,\n      getFile: getFile,\n      getFileWriter: getFileWriter\n    }\n  })\n\n  .service('MemoryFileStorage', function ($q, FileManager) {\n    var storage = {}\n\n    function isAvailable () {\n      return true\n    }\n\n    function getFile (fileName, size) {\n      if (storage[fileName]) {\n        return $q.when(storage[fileName])\n      }\n      return $q.reject(new Error('FILE_NOT_FOUND'))\n    }\n\n    function saveFile (fileName, blob) {\n      return $q.when(storage[fileName] = blob)\n    }\n\n    function getFileWriter (fileName, mimeType) {\n      var fakeWriter = FileManager.getFakeFileWriter(mimeType, function (blob) {\n        saveFile(fileName, blob)\n      })\n      return $q.when(fakeWriter)\n    }\n\n    return {\n      name: 'Memory',\n      isAvailable: isAvailable,\n      saveFile: saveFile,\n      getFile: getFile,\n      getFileWriter: getFileWriter\n    }\n  })\n\n  .service('WebpManager', function (qSync, $q) {\n    var nativeWebpSupport = false\n\n    var image = new Image()\n    image.onload = function () {\n      nativeWebpSupport = this.width === 2 && this.height === 1\n    }\n    image.onerror = function () {\n      nativeWebpSupport = false\n    }\n    image.src = 'data:image/webp;base64,UklGRjIAAABXRUJQVlA4ICYAAACyAgCdASoCAAEALmk0mk0iIiIiIgBoSygABc6zbAAA/v56QAAAAA=='\n\n    var canvas\n    var context\n\n    function getCanvasFromWebp (data) {\n      var start = tsNow()\n\n      var decoder = new WebPDecoder()\n\n      var config = decoder.WebPDecoderConfig\n      var buffer = config.j || config.output\n      var bitstream = config.input\n\n      if (!decoder.WebPInitDecoderConfig(config)) {\n        console.error('[webpjs] Library version mismatch!')\n        return false\n      }\n\n      // console.log('[webpjs] status code', decoder.VP8StatusCode)\n      var StatusCode = decoder.VP8StatusCode\n\n      status = decoder.WebPGetFeatures(data, data.length, bitstream)\n      if (status != (StatusCode.VP8_STATUS_OK || 0)) {\n        console.error('[webpjs] status error', status, StatusCode)\n      }\n\n      var mode = decoder.WEBP_CSP_MODE\n      buffer.colorspace = mode.MODE_RGBA\n      buffer.J = 4\n\n      try {\n        status = decoder.WebPDecode(data, data.length, config)\n      } catch (e) {\n        status = e\n      }\n\n      ok = (status == 0)\n      if (!ok) {\n        console.error('[webpjs] decoding failed', status, StatusCode)\n        return false\n      }\n\n      // console.log('[webpjs] decoded: ', buffer.width, buffer.height, bitstream.has_alpha, 'Now saving...')\n      var bitmap = buffer.c.RGBA.ma\n\n      // console.log('[webpjs] done in ', tsNow() - start)\n\n      if (!bitmap) {\n        return false\n      }\n      var biHeight = buffer.height\n      var biWidth = buffer.width\n\n      if (!canvas || !context) {\n        canvas = document.createElement('canvas')\n        context = canvas.getContext('2d')\n      } else {\n        context.clearRect(0, 0, canvas.width, canvas.height)\n      }\n      canvas.height = biHeight\n      canvas.width = biWidth\n\n      var output = context.createImageData(canvas.width, canvas.height)\n      var outputData = output.data\n\n      for (var h = 0; h < biHeight; h++) {\n        for (var w = 0; w < biWidth; w++) {\n          outputData[0 + w * 4 + (biWidth * 4) * h] = bitmap[1 + w * 4 + (biWidth * 4) * h]\n          outputData[1 + w * 4 + (biWidth * 4) * h] = bitmap[2 + w * 4 + (biWidth * 4) * h]\n          outputData[2 + w * 4 + (biWidth * 4) * h] = bitmap[3 + w * 4 + (biWidth * 4) * h]\n          outputData[3 + w * 4 + (biWidth * 4) * h] = bitmap[0 + w * 4 + (biWidth * 4) * h]\n        }\n      }\n\n      context.putImageData(output, 0, 0)\n\n      return true\n    }\n\n    function getPngBlobFromWebp (data) {\n      if (!getCanvasFromWebp(data)) {\n        return $q.reject({type: 'WEBP_PROCESS_FAILED'})\n      }\n      if (canvas.toBlob === undefined) {\n        return qSync.when(dataUrlToBlob(canvas.toDataURL('image/png')))\n      }\n\n      var deferred = $q.defer()\n      canvas.toBlob(function (blob) {\n        deferred.resolve(blob)\n      }, 'image/png')\n      return deferred.promise\n    }\n\n    return {\n      isWebpSupported: function () {\n        return nativeWebpSupport\n      },\n      getPngBlobFromWebp: getPngBlobFromWebp\n    }\n  })\n\n  .service('CryptoWorker', function ($timeout, $q) {\n    var webWorker = false\n    var naClEmbed = false\n    var taskID = 0\n    var awaiting = {}\n    var webCrypto = Config.Modes.webcrypto && window.crypto && (window.crypto.subtle || window.crypto.webkitSubtle) /* || window.msCrypto && window.msCrypto.subtle*/\n    var useSha1Crypto = webCrypto && webCrypto.digest !== undefined\n    var useSha256Crypto = webCrypto && webCrypto.digest !== undefined\n    var finalizeTask = function (taskID, result) {\n      var deferred = awaiting[taskID]\n      if (deferred !== undefined) {\n        // console.log(dT(), 'CW done')\n        deferred.resolve(result)\n        delete awaiting[taskID]\n      }\n    }\n\n    if (Config.Modes.nacl &&\n      navigator.mimeTypes &&\n      navigator.mimeTypes['application/x-pnacl'] !== undefined) {\n      var listener = $('<div id=\"nacl_listener\"><embed id=\"mtproto_crypto\" width=\"0\" height=\"0\" src=\"nacl/mtproto_crypto.nmf\" type=\"application/x-pnacl\" /></div>').appendTo($('body'))[0]\n      listener.addEventListener('load', function (e) {\n        naClEmbed = listener.firstChild\n        console.log(dT(), 'NaCl ready')\n      }, true)\n      listener.addEventListener('message', function (e) {\n        finalizeTask(e.data.taskID, e.data.result)\n      }, true)\n      listener.addEventListener('error', function (e) {\n        console.error('NaCl error', e)\n      }, true)\n    }\n\n    if (window.Worker) {\n      var tmpWorker = new Worker('js/lib/crypto_worker.js')\n      tmpWorker.onmessage = function (e) {\n        if (!webWorker) {\n          webWorker = tmpWorker\n        } else {\n          finalizeTask(e.data.taskID, e.data.result)\n        }\n      }\n      tmpWorker.onerror = function (error) {\n        console.error('CW error', error, error.stack)\n        webWorker = false\n      }\n    }\n\n    function performTaskWorker (task, params, embed) {\n      // console.log(dT(), 'CW start', task)\n      var deferred = $q.defer()\n\n      awaiting[taskID] = deferred\n\n      params.task = task\n      params.taskID = taskID\n      ;(embed || webWorker).postMessage(params)\n\n      taskID++\n\n      return deferred.promise\n    }\n\n    return {\n      sha1Hash: function (bytes) {\n        if (useSha1Crypto) {\n          // We don't use buffer since typedArray.subarray(...).buffer gives the whole buffer and not sliced one. webCrypto.digest supports typed array\n          var deferred = $q.defer()\n          var bytesTyped = Array.isArray(bytes) ? convertToUint8Array(bytes) : bytes\n          // console.log(dT(), 'Native sha1 start')\n          webCrypto.digest({name: 'SHA-1'}, bytesTyped).then(function (digest) {\n            // console.log(dT(), 'Native sha1 done')\n            deferred.resolve(digest)\n          }, function (e) {\n            console.error('Crypto digest error', e)\n            useSha1Crypto = false\n            deferred.resolve(sha1HashSync(bytes))\n          })\n\n          return deferred.promise\n        }\n        return $timeout(function () {\n          return sha1HashSync(bytes)\n        })\n      },\n      sha256Hash: function (bytes) {\n        if (useSha256Crypto) {\n          var deferred = $q.defer()\n          var bytesTyped = Array.isArray(bytes) ? convertToUint8Array(bytes) : bytes\n          // console.log(dT(), 'Native sha1 start')\n          webCrypto.digest({name: 'SHA-256'}, bytesTyped).then(function (digest) {\n            // console.log(dT(), 'Native sha1 done')\n            deferred.resolve(digest)\n          }, function (e) {\n            console.error('Crypto digest error', e)\n            useSha256Crypto = false\n            deferred.resolve(sha256HashSync(bytes))\n          })\n\n          return deferred.promise\n        }\n        return $timeout(function () {\n          return sha256HashSync(bytes)\n        })\n      },\n      aesEncrypt: function (bytes, keyBytes, ivBytes) {\n        if (naClEmbed) {\n          return performTaskWorker('aes-encrypt', {\n            bytes: addPadding(convertToArrayBuffer(bytes)),\n            keyBytes: convertToArrayBuffer(keyBytes),\n            ivBytes: convertToArrayBuffer(ivBytes)\n          }, naClEmbed)\n        }\n        return $timeout(function () {\n          return convertToArrayBuffer(aesEncryptSync(bytes, keyBytes, ivBytes))\n        })\n      },\n      aesDecrypt: function (encryptedBytes, keyBytes, ivBytes) {\n        if (naClEmbed) {\n          return performTaskWorker('aes-decrypt', {\n            encryptedBytes: addPadding(convertToArrayBuffer(encryptedBytes)),\n            keyBytes: convertToArrayBuffer(keyBytes),\n            ivBytes: convertToArrayBuffer(ivBytes)\n          }, naClEmbed)\n        }\n        return $timeout(function () {\n          return convertToArrayBuffer(aesDecryptSync(encryptedBytes, keyBytes, ivBytes))\n        })\n      },\n      factorize: function (bytes) {\n        bytes = convertToByteArray(bytes)\n        if (naClEmbed && bytes.length <= 8) {\n          return performTaskWorker('factorize', {bytes: bytes}, naClEmbed)\n        }\n        if (webWorker) {\n          return performTaskWorker('factorize', {bytes: bytes})\n        }\n        return $timeout(function () {\n          return pqPrimeFactorization(bytes)\n        })\n      },\n      modPow: function (x, y, m) {\n        if (webWorker) {\n          return performTaskWorker('mod-pow', {\n            x: x,\n            y: y,\n            m: m\n          })\n        }\n        return $timeout(function () {\n          return bytesModPow(x, y, m)\n        })\n      }\n    }\n  })\n\n  .service('ExternalResourcesManager', function ($q, $http, $sce) {\n    var urlPromises = {}\n\n    function downloadByURL (url) {\n      if (urlPromises[url] !== undefined) {\n        return urlPromises[url]\n      }\n\n      return urlPromises[url] = $http.get(url, {responseType: 'blob', transformRequest: null})\n        .then(function (response) {\n          window.URL = window.URL || window.webkitURL\n          var url = window.URL.createObjectURL(response.data)\n          return $sce.trustAsResourceUrl(url)\n        }, function (error) {\n          if (!Config.Modes.chrome_packed) {\n            return $q.when($sce.trustAsResourceUrl(url))\n          }\n          return $q.reject(error)\n        })\n    }\n\n    return {\n      downloadByURL: downloadByURL\n    }\n  })\n\n  .service('IdleManager', function ($rootScope, $window, $timeout) {\n\n    $rootScope.idle = {isIDLE: false, initial: true}\n\n    var toPromise\n    var debouncePromise\n    var started = false\n\n    var hidden = 'hidden'\n    var visibilityChange = 'visibilitychange'\n    if (typeof document.hidden !== 'undefined') {\n      // default\n    } else if (typeof document.mozHidden !== 'undefined') {\n      hidden = 'mozHidden'\n      visibilityChange = 'mozvisibilitychange'\n    } else if (typeof document.msHidden !== 'undefined') {\n      hidden = 'msHidden'\n      visibilityChange = 'msvisibilitychange'\n    } else if (typeof document.webkitHidden !== 'undefined') {\n      hidden = 'webkitHidden'\n      visibilityChange = 'webkitvisibilitychange'\n    }\n\n    return {\n      start: start\n    }\n\n    function start () {\n      if (!started) {\n        started = true\n        $($window).on(visibilityChange + ' blur focus keydown mousedown touchstart', onEvent)\n\n        setTimeout(function () {\n          onEvent({type: 'blur', fake_initial: true})\n        }, 0)\n      }\n    }\n\n    function onEvent (e) {\n      // console.log('event', e.type)\n      if (e.type == 'mousemove') {\n        var e = e.originalEvent || e\n        if (e && e.movementX === 0 && e.movementY === 0) {\n          return\n        }\n        $($window).off('mousemove', onEvent)\n      }\n\n      var isIDLE = e.type == 'blur' || e.type == 'timeout' ? true : false\n      if (hidden && document[hidden]) {\n        isIDLE = true\n      }\n\n      $timeout.cancel(toPromise)\n      if (!isIDLE) {\n        // console.log('update timeout')\n        toPromise = $timeout(function () {\n          onEvent({type: 'timeout'})\n        }, 30000)\n      }\n\n      if (e.type == 'focus' && !$rootScope.idle.afterFocus) {\n        $rootScope.idle.afterFocus = true\n        setTimeout(function () {\n          delete $rootScope.idle.afterFocus\n        }, 10)\n      }\n\n      var debounceTimeout = $rootScope.idle.initial ? 0 : 1000\n      if (e && !e.fake_initial) {\n        delete $rootScope.idle.initial\n      }\n\n      $timeout.cancel(debouncePromise)\n\n      if ($rootScope.idle.isIDLE == isIDLE) {\n        return\n      }\n\n      debouncePromise = $timeout(function () {\n        // console.log(dT(), 'IDLE changed', isIDLE)\n        $rootScope.idle.isIDLE = isIDLE\n        if (isIDLE && e.type == 'timeout') {\n          $($window).on('mousemove', onEvent)\n        }\n      }, debounceTimeout)\n\n    }\n  })\n\n  .service('GeoLocationManager', function ($q) {\n    var lastCoords = false\n\n    function isAvailable () {\n      return navigator.geolocation !== undefined\n    }\n\n    function getPosition (force) {\n      if (!force && lastCoords) {\n        return $q.when(lastCoords)\n      }\n      if (!isAvailable()) {\n        return $q.reject()\n      }\n      var deferred = $q.defer()\n      navigator.geolocation.getCurrentPosition(function (position) {\n        lastCoords = {\n          lat: position.coords.latitude,\n          long: position.coords.longitude\n        }\n        deferred.resolve(lastCoords)\n      }, function (error) {\n        deferred.reject(error)\n      })\n\n      return deferred.promise\n    }\n\n    return {\n      getPosition: getPosition,\n      isAvailable: isAvailable\n    }\n  })\n\n  .service('AppRuntimeManager', function ($window) {\n    return {\n      reload: function () {\n        try {\n          location.reload()\n        } catch (e) {}\n\n        if ($window.chrome && chrome.runtime && chrome.runtime.reload) {\n          chrome.runtime.reload()\n        }\n      },\n      close: function () {\n        try {\n          $window.close()\n        } catch (e) {}\n      },\n      focus: function () {\n        if (window.navigator.mozApps && document.hidden) {\n          // Get app instance and launch it to bring app to foreground\n          window.navigator.mozApps.getSelf().onsuccess = function () {\n            this.result.launch()\n          }\n        } else {\n          if (window.chrome && chrome.app && chrome.app.window) {\n            chrome.app.window.current().focus()\n          }\n          window.focus()\n        }\n      }\n    }\n  })\n\n  .service('RichTextProcessor', function ($sce, $sanitize) {\n    var emojiMap = {}\n    var emojiData = Config.Emoji\n    var emojiIconSize = 18\n    var emojiSupported = navigator.userAgent.search(/OS X|iPhone|iPad|iOS|Android/i) != -1,\n      emojiCode\n\n    var emojiRegExp = '\\\\u0023\\\\u20E3|\\\\u00a9|\\\\u00ae|\\\\u203c|\\\\u2049|\\\\u2139|[\\\\u2194-\\\\u2199]|\\\\u21a9|\\\\u21aa|\\\\u231a|\\\\u231b|\\\\u23e9|[\\\\u23ea-\\\\u23ec]|\\\\u23f0|\\\\u24c2|\\\\u25aa|\\\\u25ab|\\\\u25b6|\\\\u2611|\\\\u2614|\\\\u26fd|\\\\u2705|\\\\u2709|[\\\\u2795-\\\\u2797]|\\\\u27a1|\\\\u27b0|\\\\u27bf|\\\\u2934|\\\\u2935|[\\\\u2b05-\\\\u2b07]|\\\\u2b1b|\\\\u2b1c|\\\\u2b50|\\\\u2b55|\\\\u3030|\\\\u303d|\\\\u3297|\\\\u3299|[\\\\uE000-\\\\uF8FF\\\\u270A-\\\\u2764\\\\u2122\\\\u25C0\\\\u25FB-\\\\u25FE\\\\u2615\\\\u263a\\\\u2648-\\\\u2653\\\\u2660-\\\\u2668\\\\u267B\\\\u267F\\\\u2693\\\\u261d\\\\u26A0-\\\\u26FA\\\\u2708\\\\u2702\\\\u2601\\\\u260E]|[\\\\u2600\\\\u26C4\\\\u26BE\\\\u23F3\\\\u2764]|\\\\uD83D[\\\\uDC00-\\\\uDFFF]|\\\\uD83C[\\\\uDDE8-\\\\uDDFA\\uDDEC]\\\\uD83C[\\\\uDDEA-\\\\uDDFA\\uDDE7]|[0-9]\\\\u20e3|\\\\uD83C[\\\\uDC00-\\\\uDFFF]'\n\n    for (emojiCode in emojiData) {\n      emojiMap[emojiData[emojiCode][0]] = emojiCode\n    }\n\n    var alphaCharsRegExp = 'a-z' +\n      '\\\\u00c0-\\\\u00d6\\\\u00d8-\\\\u00f6\\\\u00f8-\\\\u00ff' + // Latin-1\n      '\\\\u0100-\\\\u024f' + // Latin Extended A and B\n      '\\\\u0253\\\\u0254\\\\u0256\\\\u0257\\\\u0259\\\\u025b\\\\u0263\\\\u0268\\\\u026f\\\\u0272\\\\u0289\\\\u028b' + // IPA Extensions\n      '\\\\u02bb' + // Hawaiian\n      '\\\\u0300-\\\\u036f' + // Combining diacritics\n      '\\\\u1e00-\\\\u1eff' + // Latin Extended Additional (mostly for Vietnamese)\n      '\\\\u0400-\\\\u04ff\\\\u0500-\\\\u0527' + // Cyrillic\n      '\\\\u2de0-\\\\u2dff\\\\ua640-\\\\ua69f' + // Cyrillic Extended A/B\n      '\\\\u0591-\\\\u05bf\\\\u05c1-\\\\u05c2\\\\u05c4-\\\\u05c5\\\\u05c7' +\n      '\\\\u05d0-\\\\u05ea\\\\u05f0-\\\\u05f4' + // Hebrew\n      '\\\\ufb1d-\\\\ufb28\\\\ufb2a-\\\\ufb36\\\\ufb38-\\\\ufb3c\\\\ufb3e\\\\ufb40-\\\\ufb41' +\n      '\\\\ufb43-\\\\ufb44\\\\ufb46-\\\\ufb4f' + // Hebrew Pres. Forms\n      '\\\\u0610-\\\\u061a\\\\u0620-\\\\u065f\\\\u066e-\\\\u06d3\\\\u06d5-\\\\u06dc' +\n      '\\\\u06de-\\\\u06e8\\\\u06ea-\\\\u06ef\\\\u06fa-\\\\u06fc\\\\u06ff' + // Arabic\n      '\\\\u0750-\\\\u077f\\\\u08a0\\\\u08a2-\\\\u08ac\\\\u08e4-\\\\u08fe' + // Arabic Supplement and Extended A\n      '\\\\ufb50-\\\\ufbb1\\\\ufbd3-\\\\ufd3d\\\\ufd50-\\\\ufd8f\\\\ufd92-\\\\ufdc7\\\\ufdf0-\\\\ufdfb' + // Pres. Forms A\n      '\\\\ufe70-\\\\ufe74\\\\ufe76-\\\\ufefc' + // Pres. Forms B\n      '\\\\u200c' + // Zero-Width Non-Joiner\n      '\\\\u0e01-\\\\u0e3a\\\\u0e40-\\\\u0e4e' + // Thai\n      '\\\\u1100-\\\\u11ff\\\\u3130-\\\\u3185\\\\uA960-\\\\uA97F\\\\uAC00-\\\\uD7AF\\\\uD7B0-\\\\uD7FF' + // Hangul (Korean)\n      '\\\\u3003\\\\u3005\\\\u303b' + // Kanji/Han iteration marks\n      '\\\\uff21-\\\\uff3a\\\\uff41-\\\\uff5a' + // full width Alphabet\n      '\\\\uff66-\\\\uff9f' + // half width Katakana\n      '\\\\uffa1-\\\\uffdc'; // half width Hangul (Korean)\n\n    var alphaNumericRegExp = '0-9\\_' + alphaCharsRegExp\n\n    var domainAddChars = '\\u00b7'\n\n    // Based on Regular Expression for URL validation by Diego Perini\n    var urlRegExp = '((?:https?|ftp)://|mailto:)?' +\n      // user:pass authentication\n      '(?:\\\\S{1,64}(?::\\\\S{0,64})?@)?' +\n      '(?:' +\n      // sindresorhus/ip-regexp\n      '(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])(?:\\\\.(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])){3}' +\n      '|' +\n      // host name\n      '[' + alphaCharsRegExp + '0-9][' + alphaCharsRegExp + domainAddChars + '0-9\\-]{0,64}' +\n      // domain name\n      '(?:\\\\.[' + alphaCharsRegExp + '0-9][' + alphaCharsRegExp + domainAddChars + '0-9\\-]{0,64}){0,10}' +\n\n      // TLD identifier\n      '(?:\\\\.(xn--[0-9a-z]{2,16}|[' + alphaCharsRegExp + ']{2,24}))' +\n      ')' +\n      // port number\n      '(?::\\\\d{2,5})?' +\n      // resource path\n      '(?:/(?:\\\\S{0,255}[^\\\\s.;,(\\\\[\\\\]{}<>\"\\'])?)?'\n\n    var usernameRegExp = '[a-zA-Z\\\\d_]{5,32}'\n    var botCommandRegExp = '\\\\/([a-zA-Z\\\\d_]{1,32})(?:@(' + usernameRegExp + '))?(\\\\b|$)'\n\n    var fullRegExp = new RegExp('(^| )(@)(' + usernameRegExp + ')|(' + urlRegExp + ')|(\\\\n)|(' + emojiRegExp + ')|(^|[\\\\s\\\\(\\\\]])(#[' + alphaNumericRegExp + ']{2,64})|(^|\\\\s)' + botCommandRegExp, 'i')\n\n    var emailRegExp = /^(([^<>()[\\]\\\\.,;:\\s@\\\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\\\"]+)*)|(\\\".+\\\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/\n    var youtubeRegExp = /^(?:https?:\\/\\/)?(?:www\\.)?youtu(?:|\\.be|be\\.com|\\.b)(?:\\/v\\/|\\/watch\\\\?v=|e\\/|(?:\\/\\??#)?\\/watch(?:.+)v=)(.{11})(?:\\&[^\\s]*)?/\n    var vimeoRegExp = /^(?:https?:\\/\\/)?(?:www\\.)?vimeo\\.com\\/(\\d+)/\n    var instagramRegExp = /^https?:\\/\\/(?:instagr\\.am\\/p\\/|instagram\\.com\\/p\\/)([a-zA-Z0-9\\-\\_]+)/i\n    var vineRegExp = /^https?:\\/\\/vine\\.co\\/v\\/([a-zA-Z0-9\\-\\_]+)/i\n    var twitterRegExp = /^https?:\\/\\/twitter\\.com\\/.+?\\/status\\/\\d+/i\n    var facebookRegExp = /^https?:\\/\\/(?:www\\.|m\\.)?facebook\\.com\\/(?:.+?\\/posts\\/\\d+|(?:story\\.php|permalink\\.php)\\?story_fbid=(\\d+)(?:&substory_index=\\d+)?&id=(\\d+))/i\n    var gplusRegExp = /^https?:\\/\\/plus\\.google\\.com\\/\\d+\\/posts\\/[a-zA-Z0-9\\-\\_]+/i\n    var soundcloudRegExp = /^https?:\\/\\/(?:soundcloud\\.com|snd\\.sc)\\/([a-zA-Z0-9%\\-\\_]+)\\/([a-zA-Z0-9%\\-\\_]+)/i\n    var spotifyRegExp = /(https?:\\/\\/(open\\.spotify\\.com|play\\.spotify\\.com|spoti\\.fi)\\/(.+)|spotify:(.+))/i\n\n    var markdownTestRegExp = /[`_*@]/;\n    var markdownRegExp = /(^|\\s)(````?)([\\s\\S]+?)(````?)([\\s\\n\\.,:?!;]|$)|(^|\\s)([`*_])([^\\n]+?)\\7([\\s\\.,:?!;]|$)|@(\\d+)\\s*\\((.+?)\\)/\n\n    var siteHashtags = {\n      Telegram: 'tg://search_hashtag?hashtag={1}',\n      Twitter: 'https://twitter.com/hashtag/{1}',\n      Instagram: 'https://instagram.com/explore/tags/{1}/',\n      'Google Plus': 'https://plus.google.com/explore/{1}'\n    }\n\n    var siteMentions = {\n      Telegram: '#/im?p=%40{1}',\n      Twitter: 'https://twitter.com/{1}',\n      Instagram: 'https://instagram.com/{1}/',\n      GitHub: 'https://github.com/{1}'\n    }\n\n    var markdownEntities = {\n      '`': 'messageEntityCode',\n      '*': 'messageEntityBold',\n      '_': 'messageEntityItalic'\n    }\n\n    return {\n      wrapRichText: wrapRichText,\n      wrapPlainText: wrapPlainText,\n      wrapDraftText: wrapDraftText,\n      wrapUrl: wrapUrl,\n      parseEntities: parseEntities,\n      parseMarkdown: parseMarkdown,\n      parseEmojis: parseEmojis,\n      mergeEntities: mergeEntities\n    }\n\n    function getEmojiSpritesheetCoords (emojiCode) {\n      var i\n      var row, column\n      var totalColumns\n      for (var cat = 0; cat < Config.EmojiCategories.length; cat++) {\n        totalColumns = Config.EmojiCategorySpritesheetDimens[cat][1]\n        i = Config.EmojiCategories[cat].indexOf(emojiCode)\n        if (i > -1) {\n          row = Math.floor(i / totalColumns)\n          column = (i % totalColumns)\n          return { category: cat, row: row, column: column }\n        }\n      }\n      console.error('emoji not found in spritesheet', emojiCode)\n      return null\n    }\n\n    function parseEntities (text, options) {\n      options = options || {}\n\n      var match\n      var raw = text,\n        url\n      var entities = [],\n        emojiCode,\n        emojiCoords,\n        matchIndex\n      var rawOffset = 0\n\n      // var start = tsNow()\n\n      while ((match = raw.match(fullRegExp))) {\n        matchIndex = rawOffset + match.index\n\n        if (match[3]) { // mentions\n          entities.push({\n            _: 'messageEntityMention',\n            offset: matchIndex + match[1].length,\n            length: match[2].length + match[3].length\n          })\n        }\n        else if (match[4]) {\n          if (emailRegExp.test(match[4])) { // email\n            entities.push({\n              _: 'messageEntityEmail',\n              offset: matchIndex,\n              length: match[4].length\n            })\n          } else {\n            var url = false\n            var protocol = match[5]\n            var tld = match[6]\n            var excluded = ''\n\n            if (tld) { // URL\n              if (!protocol && (tld.substr(0, 4) === 'xn--' || Config.TLD.indexOf(tld.toLowerCase()) !== -1)) {\n                protocol = 'http://'\n              }\n\n              if (protocol) {\n                var balanced = checkBrackets(match[4])\n\n                if (balanced.length !== match[4].length) {\n                  excluded = match[4].substring(balanced.length)\n                  match[4] = balanced\n                }\n\n                url = (match[5] ? '' : protocol) + match[4]\n              }\n            } else { // IP address\n              url = (match[5] ? '' : 'http://') + match[4]\n            }\n\n            if (url) {\n              entities.push({\n                _: 'messageEntityUrl',\n                offset: matchIndex,\n                length: match[4].length\n              })\n            }\n          }\n        }\n        else if (match[7]) { // New line\n          entities.push({\n            _: 'messageEntityLinebreak',\n            offset: matchIndex,\n            length: 1\n          })\n        }\n        else if (match[8]) { // Emoji\n          if ((emojiCode = emojiMap[match[8]]) &&\n            (emojiCoords = getEmojiSpritesheetCoords(emojiCode))) {\n            entities.push({\n              _: 'messageEntityEmoji',\n              offset: matchIndex,\n              length: match[0].length,\n              coords: emojiCoords,\n              title: emojiData[emojiCode][1][0]\n            })\n          }\n        }\n        else if (match[10]) { // Hashtag\n          entities.push({\n            _: 'messageEntityHashtag',\n            offset: matchIndex + match[9].length,\n            length: match[10].length\n          })\n        }\n        else if (match[12]) { // Bot command\n          entities.push({\n            _: 'messageEntityBotCommand',\n            offset: matchIndex + match[11].length,\n            length: 1 + match[12].length + (match[13] ? 1 + match[13].length : 0)\n          })\n        }\n        raw = raw.substr(match.index + match[0].length)\n        rawOffset += match.index + match[0].length\n      }\n\n      // if (entities.length) {\n      //   console.log('parse entities', text, entities.slice())\n      // }\n\n      return entities\n    }\n\n    function parseEmojis (text) {\n      return text.replace(/:([a-z0-9\\-\\+\\*_]+?):/gi, function (all, shortcut) {\n        var emojiCode = EmojiHelper.shortcuts[shortcut]\n        if (emojiCode !== undefined) {\n          return EmojiHelper.emojis[emojiCode][0]\n        }\n        return all\n      })\n    }\n\n    function parseMarkdown (text, entities, noTrim) {\n    if (!markdownTestRegExp.test(text)) {\n        return noTrim ? text : text.trim()\n      }\n      var raw = text\n      var match\n      var newText = []\n      var rawOffset = 0\n      var matchIndex\n      while (match = raw.match(markdownRegExp)) {\n        matchIndex = rawOffset + match.index\n        newText.push(raw.substr(0, match.index))\n\n        var text = (match[3] || match[8] || match[11])\n        rawOffset -= text.length\n        text = text.replace(/^\\s+|\\s+$/g, '')\n        rawOffset += text.length\n\n        if (text.match(/^`*$/)) {\n          newText.push(match[0])\n        }\n        else if (match[3]) { // pre\n          if (match[5] == '\\n') {\n            match[5] = ''\n            rawOffset -= 1\n          }\n          newText.push(match[1] + text + match[5])\n          entities.push({\n            _: 'messageEntityPre',\n            language: '',\n            offset: matchIndex + match[1].length,\n            length: text.length\n          })\n          rawOffset -= match[2].length + match[4].length\n        } else if (match[7]) { // code\n          newText.push(match[6] + text + match[9])\n          entities.push({\n            _: markdownEntities[match[7]],\n            offset: matchIndex + match[6].length,\n            length: text.length\n          })\n          rawOffset -= 2\n        } else if (match[11]) { // custom mention\n          newText.push(text)\n          entities.push({\n            _: 'messageEntityMentionName',\n            user_id: match[10],\n            offset: matchIndex,\n            length: text.length\n          })\n          rawOffset -= match[0].length - text.length\n        }\n        raw = raw.substr(match.index + match[0].length)\n        rawOffset += match.index + match[0].length\n      }\n      newText.push(raw)\n      newText = newText.join('')\n\n      if (!newText.replace(/\\s+/g, '').length) {\n        newText = text\n        entities.splice(0, entities.length)\n      }\n      if (!entities.length && !noTrim) {\n        newText = newText.trim()\n      }\n      return newText\n    }\n\n    function mergeEntities (currentEntities, newEntities, fromApi) {\n      var totalEntities = newEntities.slice()\n\n      var i\n      var len = currentEntities.length\n      var j\n      var len2 = newEntities.length\n      var startJ = 0\n      var curEntity\n      var newEntity\n      var start, end\n      var cStart, cEnd\n      var bad\n      for (i = 0; i < len; i++) {\n        curEntity = currentEntities[i]\n        if (fromApi &&\n          curEntity._ != 'messageEntityLinebreak' &&\n          curEntity._ != 'messageEntityEmoji') {\n          continue\n        }\n        // console.log('s', curEntity, newEntities)\n        start = curEntity.offset\n        end = start + curEntity.length\n        bad = false\n        for (j = startJ; j < len2; j++) {\n          newEntity = newEntities[j]\n          cStart = newEntity.offset\n          cEnd = cStart + newEntity.length\n          if (cStart <= start) {\n            startJ = j\n          }\n          if (start >= cStart && start < cEnd ||\n            end > cStart && end <= cEnd) {\n            // console.log('bad', curEntity, newEntity)\n            if (fromApi &&\n              start >= cStart && end <= cEnd) {\n              if (newEntity.nested === undefined) {\n                newEntity.nested = []\n              }\n              curEntity.offset -= cStart\n              newEntity.nested.push(angular.copy(curEntity))\n            }\n            bad = true\n            break\n          }\n          if (cStart >= end) {\n            break\n          }\n        }\n        if (bad) {\n          continue\n        }\n        totalEntities.push(curEntity)\n      }\n\n      totalEntities.sort(function (a, b) {\n        return a.offset - b.offset\n      })\n\n      // console.log('merge', currentEntities, newEntities, totalEntities)\n\n      return totalEntities\n    }\n\n    function wrapRichNestedText (text, nested, options) {\n      if (nested === undefined) {\n        return encodeEntities(text)\n      }\n      options.hasNested = true\n\n      return wrapRichText(text, {entities: nested, nested: true})\n    }\n\n    function wrapRichText (text, options) {\n      if (!text || !text.length) {\n        return ''\n      }\n\n      options = options || {}\n\n      var entities = options.entities\n      var contextSite = options.contextSite || 'Telegram'\n      var contextExternal = contextSite != 'Telegram'\n      var emojiFound = false\n\n      if (entities === undefined) {\n        entities = parseEntities(text, options)\n      }\n\n      var i = 0\n      var len = entities.length\n      var entity\n      var entityText\n      var skipEntity\n      var url\n      var html = []\n      var lastOffset = 0\n      var curEmojiSize = options.emojiIconSize || emojiIconSize\n      for (i = 0; i < len; i++) {\n        entity = entities[i]\n        if (entity.offset > lastOffset) {\n          html.push(\n            encodeEntities(text.substr(lastOffset, entity.offset - lastOffset))\n          )\n        }\n        else if (entity.offset < lastOffset) {\n          continue\n        }\n        skipEntity = false\n        entityText = text.substr(entity.offset, entity.length)\n        switch (entity._) {\n          case 'messageEntityMention':\n            var contextUrl = !options.noLinks && siteMentions[contextSite]\n            if (!contextUrl) {\n              skipEntity = true\n              break\n            }\n            var username = entityText.substr(1)\n            var attr = ''\n            if (options.highlightUsername &&\n              options.highlightUsername.toLowerCase() == username.toLowerCase()) {\n              attr = 'class=\"im_message_mymention\"'\n            }\n            html.push(\n              '<a ',\n              attr,\n              contextExternal ? ' target=\"_blank\" rel=\"noopener noreferrer\" ' : '',\n              ' href=\"',\n              contextUrl.replace('{1}', encodeURIComponent(username)),\n              '\">',\n              encodeEntities(entityText),\n              '</a>'\n            )\n            break\n\n          case 'messageEntityMentionName':\n            if (options.noLinks) {\n              skipEntity = true\n              break\n            }\n            html.push(\n              '<a href=\"#/im?p=u',\n              encodeURIComponent(entity.user_id),\n              '\">',\n              encodeEntities(entityText),\n              '</a>'\n            )\n            break\n\n          case 'messageEntityHashtag':\n            var contextUrl = !options.noLinks && siteHashtags[contextSite]\n            if (!contextUrl) {\n              skipEntity = true\n              break\n            }\n            var hashtag = entityText.substr(1)\n            html.push(\n              '<a ',\n              contextExternal ? ' target=\"_blank\" rel=\"noopener noreferrer\" ' : '',\n              'href=\"',\n              contextUrl.replace('{1}', encodeURIComponent(hashtag))\n              ,\n              '\">',\n              encodeEntities(entityText),\n              '</a>'\n            )\n            break\n\n          case 'messageEntityEmail':\n            if (options.noLinks) {\n              skipEntity = true\n              break\n            }\n            html.push(\n              '<a href=\"',\n              encodeEntities('mailto:' + entityText),\n              '\" target=\"_blank\" rel=\"noopener noreferrer\">',\n              encodeEntities(entityText),\n              '</a>'\n            )\n            break\n\n          case 'messageEntityUrl':\n          case 'messageEntityTextUrl':\n            if (options.noLinks) {\n              skipEntity = true\n              break\n            }\n            var url = entity.url || entityText\n            url = wrapUrl(url, entity._ == 'messageEntityTextUrl' ? true : false)\n            html.push(\n              '<a href=\"',\n              encodeEntities(url),\n              '\" target=\"_blank\" rel=\"noopener noreferrer\">',\n              wrapRichNestedText(entityText, entity.nested, options),\n              '</a>'\n            )\n            break\n\n          case 'messageEntityLinebreak':\n            html.push(options.noLinebreaks ? ' ' : '<br/>')\n            break\n\n          case 'messageEntityEmoji':\n            html.push(\n              '<span class=\"emoji emoji-',\n              entity.coords.category,\n              '-',\n              (curEmojiSize * entity.coords.column),\n              '-',\n              (curEmojiSize * entity.coords.row),\n              '\" ',\n              'title=\"', entity.title, '\">',\n              ':', entity.title, ':</span>'\n            )\n            emojiFound = true\n            break\n\n          case 'messageEntityBotCommand':\n            if (options.noLinks || options.noCommands || contextExternal) {\n              skipEntity = true\n              break\n            }\n            var command = entityText.substr(1)\n            var bot\n            var atPos\n            if ((atPos = command.indexOf('@')) != -1) {\n              bot = command.substr(atPos + 1)\n              command = command.substr(0, atPos)\n            } else {\n              bot = options.fromBot\n            }\n            html.push(\n              '<a href=\"',\n              encodeEntities('tg://bot_command?command=' + encodeURIComponent(command) + (bot ? '&bot=' + encodeURIComponent(bot) : '')),\n              '\">',\n              encodeEntities(entityText),\n              '</a>'\n            )\n            break\n\n          case 'messageEntityBold':\n            html.push(\n              '<strong>',\n              wrapRichNestedText(entityText, entity.nested, options),\n              '</strong>'\n            )\n            break\n\n          case 'messageEntityItalic':\n            html.push(\n              '<em>',\n              wrapRichNestedText(entityText, entity.nested, options),\n              '</em>'\n            )\n            break\n\n          case 'messageEntityCode':\n            html.push(\n              '<code>',\n              encodeEntities(entityText),\n              '</code>'\n            )\n            break\n\n          case 'messageEntityPre':\n            html.push(\n              '<pre><code', (entity.language ? ' class=\"language-' + encodeEntities(entity.language) + '\"' : ''), '>',\n              encodeEntities(entityText),\n              '</code></pre>'\n            )\n            break\n\n          default:\n            skipEntity = true\n        }\n        lastOffset = entity.offset + (skipEntity ? 0 : entity.length)\n      }\n      html.push(encodeEntities(text.substr(lastOffset)))\n\n      text = $sanitize(html.join(''))\n\n      if (!options.nested && (emojiFound || options.hasNested)) {\n        text = text.replace(/\\ufe0f|&#65039;|&#65533;|&#8205;/g, '', text)\n        var emojiSizeClass = curEmojiSize == 18 ? '' : (' emoji-w' + curEmojiSize)\n        text = text.replace(/<span((?: [^>]*)?) class=\"emoji emoji-(\\d)-(\\d+)-(\\d+)\"(.+?)<\\/span>/g,\n          '<span$1 class=\"emoji ' + emojiSizeClass + ' emoji-spritesheet-$2\" style=\"background-position: -$3px -$4px;\" $5</span>')\n      }\n\n      return $sce.trustAs('html', text)\n    }\n\n    function wrapDraftText (text, options) {\n      if (!text || !text.length) {\n        return ''\n      }\n\n      options = options || {}\n\n      var entities = options.entities\n\n      if (entities === undefined) {\n        entities = parseEntities(text, options)\n      }\n\n      var i = 0\n      var len = entities.length\n      var entity\n      var entityText\n      var skipEntity\n      var code = []\n      var lastOffset = 0\n      for (i = 0; i < len; i++) {\n        entity = entities[i]\n        if (entity.offset > lastOffset) {\n          code.push(\n            text.substr(lastOffset, entity.offset - lastOffset)\n          )\n        }\n        else if (entity.offset < lastOffset) {\n          continue\n        }\n        skipEntity = false\n        entityText = text.substr(entity.offset, entity.length)\n        switch (entity._) {\n          case 'messageEntityEmoji':\n            code.push(\n              ':',\n              entity.title,\n              ':'\n            )\n            break\n\n          case 'messageEntityCode':\n            code.push(\n              '`', entityText, '`'\n            )\n            break\n\n          case 'messageEntityBold':\n            code.push(\n              '*', entityText, '*'\n            )\n            break\n\n          case 'messageEntityItalic':\n            code.push(\n              '_', entityText, '_'\n            )\n            break\n\n          case 'messageEntityPre':\n            code.push(\n              '```', entityText, '```'\n            )\n            break\n\n          case 'messageEntityMentionName':\n            code.push(\n              '@', entity.user_id, ' (', entityText, ')'\n            )\n            break\n\n          default:\n            skipEntity = true\n        }\n        lastOffset = entity.offset + (skipEntity ? 0 : entity.length)\n      }\n\n      code.push(text.substr(lastOffset))\n\n      return code.join('')\n    }\n\n    function checkBrackets (url) {\n      var urlLength = url.length\n      var urlOpenBrackets = url.split('(').length - 1\n      var urlCloseBrackets = url.split(')').length - 1\n\n      while (urlCloseBrackets > urlOpenBrackets &&\n        url.charAt(urlLength - 1) === ')') {\n        url = url.substr(0, urlLength - 1)\n        urlCloseBrackets--\n        urlLength--\n      }\n      if (urlOpenBrackets > urlCloseBrackets) {\n        url = url.replace(/\\)+$/, '')\n      }\n      return url\n    }\n\n    function wrapPlainText (text, options) {\n      if (emojiSupported) {\n        return text\n      }\n      if (!text || !text.length) {\n        return ''\n      }\n\n      options = options || {}\n\n      text = text.replace(/\\ufe0f/g, '', text)\n\n      var match\n      var raw = text\n      var text = [],\n        emojiTitle\n\n      while ((match = raw.match(fullRegExp))) {\n        text.push(raw.substr(0, match.index))\n\n        if (match[8]) {\n          if ((emojiCode = emojiMap[match[8]]) &&\n            (emojiTitle = emojiData[emojiCode][1][0])) {\n            text.push(':' + emojiTitle + ':')\n          } else {\n            text.push(match[0])\n          }\n        } else {\n          text.push(match[0])\n        }\n        raw = raw.substr(match.index + match[0].length)\n      }\n      text.push(raw)\n\n      return text.join('')\n    }\n\n    function wrapUrl (url, unsafe) {\n      if (!url.match(/^https?:\\/\\//i)) {\n        url = 'http://' + url\n      }\n      var tgMeMatch\n      if (unsafe == 2) {\n        url = 'tg://unsafe_url?url=' + encodeURIComponent(url)\n      }\n      else if ( (tgMeMatch = url.match(/^https?:\\/\\/telegram\\.me\\/(.+)/))) {\n        var path = tgMeMatch[1].split('/')\n        switch (path[0]) {\n          case 'joinchat':\n            url = 'tg://join?invite=' + path[1]\n            break\n          case 'addstickers':\n            url = 'tg://addstickers?set=' + path[1]\n            break\n          default:\n            if (path[1] && path[1].match(/^\\d+$/)) {\n              url = 'tg://resolve?domain=' + path[0] + '&post=' + path[1]\n            }\n            else if (!path[1]) {\n              var domainQuery = path[0].split('?')\n              url = 'tg://resolve?domain=' + domainQuery[0] + (domainQuery[1] ? '&' + domainQuery[1] : '')\n            }\n        }\n      }\n      else if (unsafe) {\n        url = 'tg://unsafe_url?url=' + encodeURIComponent(url)\n      }\n      return url\n    }\n  })\n\n  .service('ServerTimeManager', function (Storage) {\n    var timestampNow = tsNow(true)\n    var midnightNoOffset = timestampNow - (timestampNow % 86400)\n    var midnightOffseted = new Date()\n    midnightOffseted.setHours(0)\n    midnightOffseted.setMinutes(0)\n    midnightOffseted.setSeconds(0)\n\n    var midnightOffset = midnightNoOffset - (Math.floor(+midnightOffseted / 1000))\n\n    var serverTimeOffset = 0\n    var timeParams = {\n      midnightOffset: midnightOffset,\n      serverTimeOffset: serverTimeOffset\n    }\n\n    Storage.get('server_time_offset').then(function (to) {\n      if (to) {\n        serverTimeOffset = to\n        timeParams.serverTimeOffset = to\n      }\n    })\n\n    return timeParams\n  })\n"]}