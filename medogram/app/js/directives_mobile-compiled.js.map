{"version":3,"sources":["directives_mobile.js"],"names":[],"mappings":"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","file":"directives_mobile-compiled.js","sourcesContent":["/*!\n * Webogram v0.5.5 - messaging web application for MTProto\n * https://github.com/zhukov/webogram\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\n * https://github.com/zhukov/webogram/blob/master/LICENSE\n */\n\n'use strict'\n\n/* Directives */\n\nangular.module('myApp.directives')\n\n  .directive('myDialogsListMobile', function ($window, $timeout) {\n    return {\n      link: link\n    }\n\n    function link ($scope, element, attrs) {\n      var dialogsColWrap = $('.im_dialogs_col_wrap')[0]\n      var scrollableWrap = element[0]\n      var headWrap = $('.tg_page_head')[0]\n      var panelWrapSelector = attrs.modal\n        ? '.mobile_modal_body .im_dialogs_panel'\n        : '.im_dialogs_panel'\n      var panelWrap = $(panelWrapSelector)[0]\n      var moreNotified = false\n\n      $scope.$on('ui_dialogs_search', updateSizes)\n      $scope.$on('ui_dialogs_update', updateSizes)\n\n      $scope.$on('ui_dialogs_append', function () {\n        onContentLoaded(function () {\n          moreNotified = false\n\n          $timeout(function () {\n            $(scrollableWrap).trigger('scroll')\n          })\n        })\n      })\n\n      $scope.$on('ui_dialogs_change', function () {\n        onContentLoaded(function () {\n          moreNotified = false\n\n          $timeout(function () {\n            $(scrollableWrap).trigger('scroll')\n          })\n        })\n      })\n\n      $(scrollableWrap).on('scroll', function (e) {\n        if (!element.is(':visible')) return\n        if (!moreNotified && scrollableWrap.scrollTop >= scrollableWrap.scrollHeight - scrollableWrap.clientHeight - 300) {\n          $scope.$emit('dialogs_need_more')\n          moreNotified = true\n        }\n      })\n\n      function updateSizes () {\n        if (!panelWrap || !panelWrap.offsetHeight) {\n          panelWrap = $(panelWrapSelector)[0]\n        }\n\n        if (attrs.modal) {\n          $(element).css({\n            height: $($window).height() -\n              (panelWrap ? panelWrap.offsetHeight : 58) - 46\n          })\n          return\n        }\n\n        if (!headWrap || !headWrap.offsetHeight) {\n          headWrap = $('.tg_page_head')[0]\n        }\n\n        if (!dialogsColWrap || !dialogsColWrap.offsetHeight) {\n          dialogsColWrap = $('.im_dialogs_col_wrap')[0]\n        }\n        $(element).css({\n          height: $($window).height() -\n            (headWrap ? headWrap.offsetHeight : 46) -\n            (panelWrap ? panelWrap.offsetHeight : 58) -\n            parseInt($(dialogsColWrap).css('paddingBottom') || 0)\n        })\n      }\n\n      $($window).on('resize', updateSizes)\n\n      updateSizes()\n      setTimeout(updateSizes, 1000)\n    }\n  })\n\n  .directive('myHistoryMobile', function ($window, $timeout, $rootScope, $transition) {\n    return {\n      link: link\n    }\n\n    function link ($scope, element, attrs) {\n      var historyWrap = $('.im_history_wrap', element)[0]\n      var historyMessagesEl = $('.im_history_messages', element)[0]\n      var scrollableWrap = $('.im_history_scrollable_wrap', element)[0]\n      var scrollable = $('.im_history_scrollable', element)[0]\n      var bottomPanelWrap = $('.im_bottom_panel_wrap', element)[0]\n      var sendFormWrap = $('.im_send_form_wrap', element)[0]\n      var headWrap = $('.tg_page_head')[0]\n      var sendForm = $('.im_send_form', element)[0]\n      var moreNotified = false\n      var lessNotified = false\n\n      onContentLoaded(function () {\n        scrollableWrap.scrollTop = scrollableWrap.scrollHeight\n      })\n\n      $scope.$on('ui_history_append_new', function (e, options) {\n        if (!atBottom && !options.my) {\n          return\n        }\n\n        var pr = parseInt($(scrollableWrap).css('paddingRight'))\n        $(scrollableWrap).addClass('im_history_to_bottom')\n        $(scrollable).css({bottom: 0, marginLeft: -Math.ceil(pr / 2)})\n\n        onContentLoaded(function () {\n          $(scrollableWrap).removeClass('im_history_to_bottom')\n          $(scrollable).css({bottom: '', marginLeft: ''})\n          scrollableWrap.scrollTop = scrollableWrap.scrollHeight\n          updateBottomizer()\n        })\n      })\n\n      function changeScroll () {\n        var unreadSplit\n        var focusMessage\n\n        // console.trace('change scroll')\n        if (focusMessage = $('.im_message_focus:visible', scrollableWrap)[0]) {\n          var ch = scrollableWrap.clientHeight\n          var st = scrollableWrap.scrollTop\n          var ot = focusMessage.offsetTop\n          var h = focusMessage.clientHeight\n          if (!st || st + ch < ot || st > ot + h) {\n            scrollableWrap.scrollTop = Math.max(0, ot - Math.floor(ch / 2) + 26)\n          }\n          atBottom = false\n        } else if (unreadSplit = $('.im_message_unread_split:visible', scrollableWrap)[0]) {\n          // console.log('change scroll unread', unreadSplit.offsetTop)\n          scrollableWrap.scrollTop = Math.max(0, unreadSplit.offsetTop - 52)\n          atBottom = false\n        } else {\n          // console.log('change scroll bottom')\n          scrollableWrap.scrollTop = scrollableWrap.scrollHeight\n          atBottom = true\n        }\n        $timeout(function () {\n          $(scrollableWrap).trigger('scroll')\n          scrollTopInitial = scrollableWrap.scrollTop\n        })\n      }\n\n      $scope.$on('ui_history_change', function () {\n        var pr = parseInt($(scrollableWrap).css('paddingRight'))\n        $(scrollableWrap).addClass('im_history_to_bottom')\n        $(scrollable).css({bottom: 0, marginLeft: -Math.ceil(pr / 2)})\n        onContentLoaded(function () {\n          $(scrollableWrap).removeClass('im_history_to_bottom')\n          $(scrollable).css({bottom: '', marginLeft: ''})\n          updateSizes(true)\n          moreNotified = false\n          lessNotified = false\n          changeScroll()\n        })\n      })\n\n      $scope.$on('ui_history_change_scroll', function () {\n        onContentLoaded(changeScroll)\n      })\n\n      $scope.$on('ui_history_focus', function () {\n        if (!atBottom) {\n          scrollableWrap.scrollTop = scrollableWrap.scrollHeight\n          atBottom = true\n        }\n      })\n\n      $scope.$on('ui_history_prepend', function () {\n        var sh = scrollableWrap.scrollHeight\n        var st = scrollableWrap.scrollTop\n        var pr = parseInt($(scrollableWrap).css('paddingRight'))\n        var ch = scrollableWrap.clientHeight\n\n        $(scrollableWrap).addClass('im_history_to_bottom')\n        scrollableWrap.scrollHeight // Some strange Chrome bug workaround\n        $(scrollable).css({bottom: -(sh - st - ch), marginLeft: -Math.ceil(pr / 2)})\n\n        var upd = function () {\n            $(scrollableWrap).removeClass('im_history_to_bottom')\n            $(scrollable).css({bottom: '', marginLeft: ''})\n            if (scrollTopInitial >= 0) {\n              changeScroll()\n            } else {\n              scrollableWrap.scrollTop = st + scrollableWrap.scrollHeight - sh\n            }\n\n            updateBottomizer()\n            moreNotified = false\n\n            $timeout(function () {\n              if (scrollableWrap.scrollHeight != sh) {\n                $(scrollableWrap).trigger('scroll')\n              }\n            })\n\n            clearTimeout(timer)\n            unreg()\n          },\n          timer = setTimeout(upd, 0),\n          unreg = $scope.$on('$viewContentLoaded', upd)\n      })\n\n      $scope.$on('ui_history_append', function () {\n        var sh = scrollableWrap.scrollHeight\n        onContentLoaded(function () {\n          atBottom = false\n          updateBottomizer()\n          lessNotified = false\n\n          if (scrollTopInitial >= 0) {\n            changeScroll()\n          }\n\n          $timeout(function () {\n            if (scrollableWrap.scrollHeight != sh) {\n              $(scrollableWrap).trigger('scroll')\n            }\n          })\n        })\n      })\n\n      $scope.$on('ui_panel_update', function (e, data) {\n        onContentLoaded(function () {\n          updateSizes()\n          if (data && data.blur) {\n            $scope.$broadcast('ui_message_blur')\n          } else {\n            $scope.$broadcast('ui_message_send')\n          }\n\n          $timeout(function () {\n            $(scrollableWrap).trigger('scroll')\n          })\n        })\n      })\n\n      $scope.$on('ui_selection_clear', function () {\n        if (window.getSelection) {\n          if (window.getSelection().empty) { // Chrome\n            window.getSelection().empty()\n          } else if (window.getSelection().removeAllRanges) { // Firefox\n            window.getSelection().removeAllRanges()\n          }\n        } else if (document.selection) { // IE?\n          document.selection.empty()\n        }\n      })\n\n      $scope.$on('ui_editor_resize', updateSizes)\n      $scope.$on('ui_height', function () {\n        onContentLoaded(updateSizes)\n      })\n\n      var atBottom = true\n      var scrollTopInitial = -1\n      $(scrollableWrap).on('scroll', function (e) {\n        if (!element.is(':visible') ||\n          $(scrollableWrap).hasClass('im_history_to_bottom')) {\n          return\n        }\n        var st = scrollableWrap.scrollTop\n        atBottom = st >= scrollableWrap.scrollHeight - scrollableWrap.clientHeight\n        if (scrollTopInitial >= 0 && scrollTopInitial != st) {\n          scrollTopInitial = -1\n        }\n\n        if (!moreNotified && st <= 300) {\n          moreNotified = true\n          $scope.$emit('history_need_more')\n        }\n        else if (!lessNotified && st >= scrollableWrap.scrollHeight - scrollableWrap.clientHeight - 300) {\n          lessNotified = true\n          $scope.$emit('history_need_less')\n        }\n      })\n\n      function updateSizes (heightOnly) {\n        if (!element.is(':visible') && !$(element[0].parentNode.parentNode).is(':visible')) {\n          return\n        }\n        if ($(sendFormWrap).is(':visible')) {\n          $(sendFormWrap).css({\n            height: $(sendForm).height()\n          })\n        }\n\n        if (!headWrap || !headWrap.offsetHeight) {\n          headWrap = $('.tg_page_head')[0]\n        }\n        var historyH = $($window).height() - bottomPanelWrap.offsetHeight - (headWrap ? headWrap.offsetHeight : 46)\n        $(historyWrap).css({\n          height: historyH\n        })\n\n        updateBottomizer()\n\n        if (heightOnly === true) return\n        if (atBottom) {\n          onContentLoaded(function () {\n            scrollableWrap.scrollTop = scrollableWrap.scrollHeight\n          })\n        }\n      }\n\n      function updateBottomizer () {}\n\n      $($window).on('resize', updateSizes)\n\n      updateSizes()\n      onContentLoaded(updateSizes)\n    }\n  })\n\n  .directive('myContactsListMobile', function ($window, $timeout) {\n    return {\n      link: link\n    }\n\n    function link ($scope, element, attrs) {\n      var searchWrap = $('.contacts_modal_search')[0]\n      var panelWrap = $('.contacts_modal_panel')[0]\n\n      function updateSizes () {\n        $(element).css({\n          height: $($window).height() -\n            (panelWrap && panelWrap.offsetHeight || 0) -\n            (searchWrap && searchWrap.offsetHeight || 0) -\n            64\n        })\n      }\n\n      $($window).on('resize', updateSizes)\n      $scope.$on('contacts_change', function () {\n        onContentLoaded(updateSizes)\n      })\n      onContentLoaded(updateSizes)\n    }\n  })\n\n  .directive('myCountriesListMobile', function ($window, $timeout) {\n    return {\n      link: link\n    }\n\n    function link ($scope, element, attrs) {\n      var searchWrap = $('.countries_modal_search')[0]\n      var panelWrap = $('.countries_modal_panel')[0]\n\n      function updateSizes () {\n        $(element).css({\n          height: $($window).height()\n            - (panelWrap && panelWrap.offsetHeight || 0)\n            - (searchWrap && searchWrap.offsetHeight || 0)\n            - (46 + 18)\n        })\n      }\n\n      $($window).on('resize', updateSizes)\n      onContentLoaded(updateSizes)\n    }\n  })\n\n  .directive('myInfiniteScrollerMobile', function () {\n    return {\n      link: link,\n      scope: true\n    }\n\n    function link ($scope, element, attrs) {\n      var scrollableWrap = element[0]\n      var moreNotified = false\n\n      $(scrollableWrap).on('scroll', function (e) {\n        if (!element.is(':visible')) return\n        if (!moreNotified &&\n          scrollableWrap.scrollTop >= scrollableWrap.scrollHeight - scrollableWrap.clientHeight - 300) {\n          moreNotified = true\n          $scope.$apply(function () {\n            $scope.slice.limit += ($scope.slice.limitDelta || 20)\n          })\n\n          onContentLoaded(function () {\n            moreNotified = false\n          })\n        }\n      })\n    }\n  })\n"]}