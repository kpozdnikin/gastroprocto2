{"version":3,"sources":["controllers.js"],"names":[],"mappings":"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","file":"controllers-compiled.js","sourcesContent":["/*!\n * Webogram v0.5.5 - messaging web application for MTProto\n * https://github.com/zhukov/webogram\n * Copyright (C) 2014 Igor Zhukov <igor.beatle@gmail.com>\n * https://github.com/zhukov/webogram/blob/master/LICENSE\n */\n\n'use strict'\n\n/* Controllers */\n\nangular.module('myApp.controllers', ['myApp.i18n'])\n\n  .controller('AppWelcomeController', function ($scope, $location, MtpApiManager, ErrorService, ChangelogNotifyService, LayoutSwitchService) {\n    MtpApiManager.getUserID().then(function (id) {\n      //if has id, go to user page\n      if (id) {\n        $location.url('/im')\n        return\n      }\n      //if http, go https\n      if (location.protocol == 'http:' &&\n        !Config.Modes.http &&\n        Config.App.domains.indexOf(location.hostname) != -1) {\n        location.href = location.href.replace(/^http:/, 'https:')\n        return\n      }\n      //go login\n      $location.url('/login')\n    })\n\n    ChangelogNotifyService.checkUpdate()\n    LayoutSwitchService.start()\n  })\n\n  .controller('AppLoginController', function ($scope, $rootScope, $location, $timeout, $modal, $modalStack, $cookies, MtpApiManager, ErrorService, NotificationsManager, PasswordManager, ChangelogNotifyService, IdleManager, LayoutSwitchService, TelegramMeWebService, _) {\n    $modalStack.dismissAll()\n    IdleManager.start()\n\n    MtpApiManager.getUserID().then(function (id) {\n      if (id) {\n        $location.url('/im')\n        return\n      }\n      else{\n        //removing cookie to let us know that we are not authorized\n        $cookies.remove('user_auth');\n      }\n      if (location.protocol == 'http:' &&\n        !Config.Modes.http &&\n        Config.App.domains.indexOf(location.hostname) != -1) {\n        location.href = location.href.replace(/^http:/, 'https:')\n        return\n      }\n      TelegramMeWebService.setAuthorized(false)\n    })\n\n    var options = {dcID: 2, createNetworker: true}\n    var countryChanged = false\n    var selectedCountry = false\n\n    $scope.credentials = {phone_country: '', phone_country_name: '', phone_number: '', phone_full: ''}\n    $scope.progress = {}\n    $scope.nextPending = {}\n    $scope.about = {}\n\n    $scope.chooseCountry = function () {\n      var modal = $modal.open({\n        templateUrl: templateUrl('country_select_modal'),\n        controller: 'CountrySelectModalController',\n        windowClass: 'countries_modal_window mobile_modal',\n        backdrop: 'single'\n      })\n\n      modal.result.then(selectCountry)\n    }\n\n    function initPhoneCountry () {\n      var langCode = (navigator.language || '').toLowerCase()\n      var countryIso2 = Config.LangCountries[langCode]\n      var shouldPregenerate = !Config.Navigator.mobile\n\n      if (['en', 'en-us', 'en-uk'].indexOf(langCode) == -1) {\n        if (countryIso2 !== undefined) {\n          selectPhoneCountryByIso2(countryIso2)\n        } else if (langCode.indexOf('-') > 0) {\n          selectPhoneCountryByIso2(langCode.split('-')[1].toUpperCase())\n        } else {\n          selectPhoneCountryByIso2('US')\n        }\n      } else {\n        selectPhoneCountryByIso2('US')\n      }\n\n      if (!shouldPregenerate) {\n        return\n      }\n      var wasCountry = $scope.credentials.phone_country\n      MtpApiManager.invokeApi('help.getNearestDc', {}, {dcID: 2, createNetworker: true}).then(function (nearestDcResult) {\n        if (wasCountry == $scope.credentials.phone_country) {\n          selectPhoneCountryByIso2(nearestDcResult.country)\n        }\n        if (nearestDcResult.nearest_dc != nearestDcResult.this_dc) {\n          MtpApiManager.getNetworker(nearestDcResult.nearest_dc, {createNetworker: true})\n        }\n      })\n    }\n\n    function selectPhoneCountryByIso2 (countryIso2) {\n      if (countryIso2) {\n        var i, country\n        for (i = 0; i < Config.CountryCodes.length; i++) {\n          country = Config.CountryCodes[i]\n          if (country[0] == countryIso2) {\n            return selectCountry({name: _(country[1] + '_raw'), code: country[2]})\n          }\n        }\n      }\n      return selectCountry({name: _('country_select_modal_country_us_raw'), code: '+1'})\n    }\n\n    function selectCountry (country) {\n      selectedCountry = country\n      if ($scope.credentials.phone_country != country.code) {\n        $scope.credentials.phone_country = country.code\n      } else {\n        updateCountry()\n      }\n      $scope.$broadcast('country_selected')\n      $scope.$broadcast('value_updated')\n    }\n\n    function updateCountry () {\n      var phoneNumber = (\n        ($scope.credentials.phone_country || '') +\n        ($scope.credentials.phone_number || '')\n          ).replace(/\\D+/g, ''),\n        i, j, code\n      var maxLength = 0\n      var maxName = false\n\n      if (phoneNumber.length) {\n        if (selectedCountry && !phoneNumber.indexOf(selectedCountry.code.replace(/\\D+/g, ''))) {\n          maxName = selectedCountry.name\n        } else {\n          for (i = 0; i < Config.CountryCodes.length; i++) {\n            for (j = 2; j < Config.CountryCodes[i].length; j++) {\n              code = Config.CountryCodes[i][j].replace(/\\D+/g, '')\n              if (code.length > maxLength && !phoneNumber.indexOf(code)) {\n                maxLength = code.length\n                maxName = _(Config.CountryCodes[i][1] + '_raw')\n              }\n            }\n          }\n        }\n      }\n\n      $scope.credentials.phone_full = phoneNumber\n      $scope.credentials.phone_country_name = maxName || _('login_controller_unknown_country_raw')\n    }\n\n    $scope.$watch('credentials.phone_country', updateCountry)\n    $scope.$watch('credentials.phone_number', updateCountry)\n    initPhoneCountry()\n\n    var nextTimeout\n    var updatePasswordTimeout = false\n\n    function saveAuth (result) {\n      MtpApiManager.setUserAuth(options.dcID, {\n        id: result.user.id\n      })\n      $timeout.cancel(nextTimeout)\n\n      $location.url('/im')\n    }\n\n    $scope.sendCode = function () {\n      $timeout.cancel(nextTimeout)\n\n      var fullPhone = ($scope.credentials.phone_country || '') + ($scope.credentials.phone_number || '')\n      var badPhone = !fullPhone.match(/^[\\d\\-+\\s]+$/);\n      if (!badPhone) {\n        fullPhone = fullPhone.replace(/\\D/g, '');\n        if (fullPhone.length < 7) {\n          badPhone = true;\n        }\n      }\n      if (badPhone) {\n        $scope.progress.enabled = false\n        $scope.error = {field: 'phone'}\n        return\n      }\n\n      ErrorService.confirm({\n        type: 'LOGIN_PHONE_CORRECT',\n        country_code: $scope.credentials.phone_country,\n        phone_number: $scope.credentials.phone_number\n      }).then(function () {\n        $scope.progress.enabled = true\n\n        onContentLoaded(function () {\n          $scope.$broadcast('ui_height')\n        })\n\n        var authKeyStarted = tsNow()\n        MtpApiManager.invokeApi('auth.sendCode', {\n          flags: 0,\n          phone_number: $scope.credentials.phone_full,\n          api_id: Config.App.id,\n          api_hash: Config.App.hash,\n          lang_code: navigator.language || 'en'\n        }, options).then(function (sentCode) {\n          $scope.progress.enabled = false\n\n          $scope.error = {}\n          $scope.about = {}\n          $scope.credentials.phone_code_hash = sentCode.phone_code_hash\n          applySentCode(sentCode)\n        }, function (error) {\n          $scope.progress.enabled = false\n          console.log('sendCode error', error)\n          switch (error.type) {\n            case 'PHONE_NUMBER_INVALID':\n              $scope.error = {field: 'phone'}\n              error.handled = true\n              break\n          }\n        })['finally'](function () {\n          if ($rootScope.idle.isIDLE || tsNow() - authKeyStarted > 60000) {\n            NotificationsManager.notify({\n              title: 'Telegram',\n              message: 'Your authorization key was successfully generated! Open the app to log in.',\n              tag: 'auth_key'\n            })\n          }\n        })\n      })\n    }\n\n    function applySentCode (sentCode) {\n      $scope.credentials.type = sentCode.type\n      $scope.nextPending.type = sentCode.next_type || false\n      $scope.nextPending.remaining = sentCode.timeout || false\n      delete $scope.nextPending.progress\n\n      nextTimeoutCheck()\n\n      onContentLoaded(function () {\n        $scope.$broadcast('ui_height')\n      })\n    }\n\n    $scope.sendNext = function () {\n      if (!$scope.nextPending.type ||\n        $scope.nextPending.remaining > 0) {\n        return\n      }\n      $scope.nextPending.progress = true\n      MtpApiManager.invokeApi('auth.resendCode', {\n        phone_number: $scope.credentials.phone_full,\n        phone_code_hash: $scope.credentials.phone_code_hash\n      }, options).then(applySentCode)\n    }\n\n    function nextTimeoutCheck () {\n      $timeout.cancel(nextTimeout)\n      if (!$scope.nextPending.type ||\n        $scope.nextPending.remaining === false) {\n        return\n      }\n      if ((--$scope.nextPending.remaining) > 0) {\n        nextTimeout = $timeout(nextTimeoutCheck, 1000)\n      }\n    }\n\n    $scope.editPhone = function () {\n      $timeout.cancel(nextTimeout)\n\n      if ($scope.credentials.phone_full &&\n        $scope.credentials.phone_code_hash) {\n        MtpApiManager.invokeApi('auth.cancelCode', {\n          phone_number: $scope.credentials.phone_full,\n          phone_code_hash: $scope.credentials.phone_code_hash\n        }, options)\n      }\n\n      delete $scope.credentials.phone_code_hash\n      delete $scope.credentials.phone_unoccupied\n      delete $scope.credentials.phone_code_valid\n      delete $scope.nextPending.remaining\n    }\n\n    $scope.$watch('credentials.phone_code', function (newVal) {\n      if (newVal &&\n        newVal.match(/^\\d+$/) &&\n        $scope.credentials.type &&\n        $scope.credentials.type.length &&\n        newVal.length == $scope.credentials.type.length) {\n        $scope.logIn()\n      }\n    })\n\n    $scope.logIn = function (forceSignUp) {\n      if ($scope.progress.enabled &&\n          $scope.progress.forceSignUp == forceSignUp) {\n        return\n      }\n      var method = 'auth.signIn'\n      var params = {\n        phone_number: $scope.credentials.phone_full,\n        phone_code_hash: $scope.credentials.phone_code_hash,\n        phone_code: $scope.credentials.phone_code\n      }\n      if (forceSignUp) {\n        method = 'auth.signUp'\n        angular.extend(params, {\n          first_name: $scope.credentials.first_name || '',\n          last_name: $scope.credentials.last_name || ''\n        })\n      }\n\n      $scope.progress.forceSignUp = forceSignUp;\n      $scope.progress.enabled = true\n      MtpApiManager.invokeApi(method, params, options).then(saveAuth, function (error) {\n        $scope.progress.enabled = false\n        if (error.code == 400 && error.type == 'PHONE_NUMBER_UNOCCUPIED') {\n          error.handled = true\n          $scope.credentials.phone_code_valid = true\n          $scope.credentials.phone_unoccupied = true\n          $scope.about = {}\n          return\n        } else if (error.code == 400 && error.type == 'PHONE_NUMBER_OCCUPIED') {\n          error.handled = true\n          return $scope.logIn(false)\n        } else if (error.code == 401 && error.type == 'SESSION_PASSWORD_NEEDED') {\n          $scope.progress.enabled = true\n          updatePasswordState().then(function () {\n            $scope.progress.enabled = false\n            $scope.credentials.phone_code_valid = true\n            $scope.credentials.password_needed = true\n            $scope.about = {}\n          })\n          error.handled = true\n          return\n        }\n\n        switch (error.type) {\n          case 'FIRSTNAME_INVALID':\n            $scope.error = {field: 'first_name'}\n            error.handled = true\n            break\n          case 'LASTNAME_INVALID':\n            $scope.error = {field: 'last_name'}\n            error.handled = true\n            break\n          case 'PHONE_CODE_INVALID':\n            $scope.error = {field: 'phone_code'}\n            delete $scope.credentials.phone_code_valid\n            error.handled = true\n            break\n          case 'PHONE_CODE_EXPIRED':\n            $scope.editPhone()\n            error.handled = true\n            break\n        }\n      })\n    }\n\n    $scope.checkPassword = function () {\n      $scope.progress.enabled = true\n      return PasswordManager.check($scope.password, $scope.credentials.password, options).then(saveAuth, function (error) {\n        $scope.progress.enabled = false\n        switch (error.type) {\n          case 'PASSWORD_HASH_INVALID':\n            $scope.error = {field: 'password'}\n            error.handled = true\n            break\n        }\n      })\n    }\n\n    $scope.forgotPassword = function (event) {\n      PasswordManager.requestRecovery($scope.password, options).then(function (emailRecovery) {\n        var scope = $rootScope.$new()\n        scope.recovery = emailRecovery\n        scope.options = options\n        var modal = $modal.open({\n          scope: scope,\n          templateUrl: templateUrl('password_recovery_modal'),\n          controller: 'PasswordRecoveryModalController',\n          windowClass: 'md_simple_modal_window mobile_modal'\n        })\n\n        modal.result.then(function (result) {\n          if (result && result.user) {\n            saveAuth(result)\n          } else {\n            $scope.canReset = true\n          }\n        })\n      }, function (error) {\n        switch (error.type) {\n          case 'PASSWORD_EMPTY':\n            $scope.logIn()\n            error.handled = true\n            break\n          case 'PASSWORD_RECOVERY_NA':\n            $timeout(function () {\n              $scope.canReset = true\n            }, 1000)\n            error.handled = true\n            break\n        }\n      })\n\n      return cancelEvent(event)\n    }\n\n    $scope.resetAccount = function () {\n      ErrorService.confirm({\n        type: 'RESET_ACCOUNT'\n      }).then(function () {\n        $scope.progress.enabled = true\n        MtpApiManager.invokeApi('account.deleteAccount', {\n          reason: 'Forgot password'\n        }, options).then(function () {\n          delete $scope.progress.enabled\n          delete $scope.credentials.password_needed\n          $scope.credentials.phone_unoccupied = true\n        }, function (error) {\n          if (error.type &&\n                   error.type.substr(0, 17) == '2FA_CONFIRM_WAIT_') {\n            error.waitTime = error.type.substr(17)\n            error.type = '2FA_CONFIRM_WAIT_TIME'\n          }          \n          \n          delete $scope.progress.enabled\n        })\n      })\n    }\n\n    function updatePasswordState () {\n      // $timeout.cancel(updatePasswordTimeout)\n      // updatePasswordTimeout = false\n      return PasswordManager.getState(options).then(function (result) {\n        return $scope.password = result\n      // if (result._ == 'account.noPassword' && result.email_unconfirmed_pattern) {\n      //   updatePasswordTimeout = $timeout(updatePasswordState, 5000)\n      // }\n      })\n    }\n\n    ChangelogNotifyService.checkUpdate()\n    LayoutSwitchService.start()\n  })\n\n  .controller('AppIMController', function ($cookies, $q, qSync, $scope, $location, $routeParams, $modal, $rootScope, $modalStack, MtpApiManager, AppUsersManager, AppChatsManager, AppMessagesManager, AppPeersManager, ContactsSelectService, ChangelogNotifyService, ErrorService, AppRuntimeManager, HttpsMigrateService, LayoutSwitchService, LocationParamsService, AppStickersManager) {\n    $scope.$on('$routeUpdate', updateCurDialog)\n\n    var pendingParams = false\n    var pendingAttachment = false\n    console.log('user_auth = ');\n    console.log($cookies.getObject('user_auth'));\n    $scope.$on('history_focus', function (e, peerData) {\n      if (peerData.peerString == $scope.curDialog.peer &&\n        peerData.messageID == $scope.curDialog.messageID &&\n        !peerData.startParam) {\n        if (peerData.messageID) {\n          $scope.$broadcast('ui_history_change_scroll', true)\n        } else {\n          $scope.$broadcast('ui_history_focus')\n        }\n      } else {\n        var peerID = AppPeersManager.getPeerID(peerData.peerString)\n        var username = AppPeersManager.getPeer(peerID).username\n        var peer = username ? '@' + username : peerData.peerString\n        if (peerData.messageID || peerData.startParam) {\n          pendingParams = {\n            messageID: peerData.messageID,\n            startParam: peerData.startParam\n          }\n        } else {\n          pendingParams = false\n        }\n        if (peerData.attachment) {\n          pendingAttachment = peerData.attachment\n        }\n        if ($routeParams.p != peer) {\n          $location.url('/im?p=' + peer)\n        } else {\n          updateCurDialog()\n        }\n      }\n    })\n\n    $scope.$on('esc_no_more', function () {\n      $rootScope.$apply(function () {\n        $location.url('/im')\n      })\n    })\n\n    $scope.isLoggedIn = true\n    $scope.isEmpty = {}\n    $scope.search = {}\n    $scope.historyFilter = {mediaType: false}\n    $scope.historyPeer = {}\n    $scope.historyState = {\n      selectActions: false,\n      botActions: false,\n      channelActions: false,\n      canReply: false,\n      canDelete: false,\n      actions: function () {\n        return $scope.historyState.selectActions ? 'selected' : ($scope.historyState.botActions ? 'bot' : ($scope.historyState.channelActions ? 'channel' : false))\n      },\n      typing: [],\n      missedCount: 0,\n      skipped: false\n    }\n\n    $scope.openSettings = function () {\n      $modal.open({\n        templateUrl: templateUrl('settings_modal'),\n        controller: 'SettingsModalController',\n        windowClass: 'settings_modal_window mobile_modal',\n        backdrop: 'single'\n      })\n    }\n\n    // setTimeout($scope.openSettings, 1000)\n\n    $scope.openFaq = function () {\n      var url = 'https://telegram.org/faq'\n      switch (Config.I18n.locale) {\n        case 'es-es':\n          url += '/es'\n          break\n        case 'it-it':\n          url += '/it'\n          break\n        case 'de-de':\n          url += '/de'\n          break\n        case 'ko-ko':\n          url += '/ko'\n          break\n        case 'pt-br':\n          url += '/br'\n          break\n      }\n      window.open(url, '_blank')\n    }\n\n    $scope.openContacts = function () {\n      ContactsSelectService.selectContact().then(function (userID) {\n        $scope.dialogSelect(AppUsersManager.getUserString(userID))\n      })\n    }\n\n    $scope.openGroup = function () {\n      ContactsSelectService.selectContacts({action: 'new_group'}).then(function (userIDs) {\n        if (userIDs.length == 1) {\n          $scope.dialogSelect(AppUsersManager.getUserString(userIDs[0]))\n        } else if (userIDs.length > 1) {\n          var scope = $rootScope.$new()\n          scope.userIDs = userIDs\n\n          $modal.open({\n            templateUrl: templateUrl('chat_create_modal'),\n            controller: 'ChatCreateModalController',\n            scope: scope,\n            windowClass: 'md_simple_modal_window mobile_modal',\n            backdrop: 'single'\n          })\n        }\n      })\n    }\n\n    $scope.importContact = function () {\n      AppUsersManager.openImportContact().then(function (foundContact) {\n        if (foundContact) {\n          $rootScope.$broadcast('history_focus', {\n            peerString: AppUsersManager.getUserString(foundContact)\n          })\n        }\n      })\n    }\n\n    $scope.searchClear = function () {\n      $scope.search.query = ''\n      $scope.$broadcast('search_clear')\n    }\n\n    $scope.dialogSelect = function (peerString, messageID) {\n      var params = {peerString: peerString}\n      if (messageID) {\n        params.messageID = messageID\n      }\n      else if ($scope.search.query) {\n        $scope.searchClear()\n      }\n      var peerID = AppPeersManager.getPeerID(peerString)\n      var converted = AppMessagesManager.convertMigratedPeer(peerID)\n      if (converted) {\n        params.peerString = AppPeersManager.getPeerString(converted)\n      }\n      $rootScope.$broadcast('history_focus', params)\n    }\n\n    $scope.logOut = function () {\n      ErrorService.confirm({type: 'LOGOUT'}).then(function () {\n        MtpApiManager.logOut().then(function () {\n          location.hash = '/login'\n          AppRuntimeManager.reload()\n        })\n      })\n    }\n\n    $scope.openChangelog = function () {\n      ChangelogNotifyService.showChangelog(false)\n    }\n\n    $scope.showPeerInfo = function () {\n      if ($scope.curDialog.peerID > 0) {\n        AppUsersManager.openUser($scope.curDialog.peerID)\n      } else if ($scope.curDialog.peerID < 0) {\n        AppChatsManager.openChat(-$scope.curDialog.peerID)\n      }\n    }\n\n    $scope.toggleEdit = function () {\n      $scope.$broadcast('history_edit_toggle')\n    }\n    $scope.selectedFlush = function () {\n      $scope.$broadcast('history_edit_flush')\n    }\n    $scope.toggleMedia = function (mediaType) {\n      $scope.$broadcast('history_media_toggle', mediaType)\n    }\n    $scope.returnToRecent = function () {\n      $scope.$broadcast('history_return_recent')\n    }\n    $scope.toggleSearch = function () {\n      $scope.$broadcast('dialogs_search_toggle')\n    }\n\n    updateCurDialog()\n\n    function updateCurDialog () {\n      $modalStack.dismissAll()\n      var addParams = pendingParams || {}\n      pendingParams = false\n      addParams.messageID = parseInt(addParams.messageID) || false\n      addParams.startParam = addParams.startParam\n\n      var peerStringPromise\n      if ($routeParams.p && $routeParams.p.charAt(0) == '@') {\n        if ($scope.curDialog === undefined) {\n          $scope.curDialog = {\n            peer: '',\n            peerID: 0\n          }\n        }\n        peerStringPromise = AppPeersManager.resolveUsername($routeParams.p.substr(1)).then(function (peerID) {\n          return qSync.when(AppPeersManager.getPeerString(peerID))\n        })\n      } else {\n        peerStringPromise = qSync.when($routeParams.p)\n      }\n      peerStringPromise.then(function (peerString) {\n        $scope.curDialog = angular.extend({\n          peer: peerString,\n          peerID: AppPeersManager.getPeerID(peerString || '')\n        }, addParams)\n        if (pendingAttachment) {\n          $scope.$broadcast('peer_draft_attachment', pendingAttachment)\n          pendingAttachment = false\n        }\n      })\n    }\n\n    ChangelogNotifyService.checkUpdate()\n    HttpsMigrateService.start()\n    LayoutSwitchService.start()\n    LocationParamsService.start()\n    AppStickersManager.start()\n  })\n\n  .controller('AppImDialogsController', function ($scope, $location, $q, $timeout, $routeParams, MtpApiManager, AppUsersManager, AppChatsManager, AppMessagesManager, AppProfileManager, AppPeersManager, PhonebookContactsService, ErrorService, AppRuntimeManager) {\n    $scope.dialogs = []\n    $scope.contacts = []\n    $scope.foundPeers = []\n    $scope.foundMessages = []\n\n    if ($scope.search === undefined) {\n      $scope.search = {}\n    }\n    if ($scope.isEmpty === undefined) {\n      $scope.isEmpty = {}\n    }\n    $scope.phonebookAvailable = PhonebookContactsService.isAvailable()\n\n    var searchMessages = false\n    var offsetIndex = 0\n    var maxID = 0\n    var hasMore = false\n    var jump = 0\n    var contactsJump = 0\n    var peersInDialogs = {}\n    var typingTimeouts = {}\n    var contactsShown\n\n    $scope.$on('dialogs_need_more', function () {\n      // console.log('on need more')\n      showMoreDialogs()\n    })\n\n    $scope.$on('dialog_unread', function (e, dialog) {\n      angular.forEach($scope.dialogs, function (curDialog) {\n        if (curDialog.peerID == dialog.peerID) {\n          curDialog.unreadCount = dialog.count\n        }\n      })\n    })\n\n    $scope.$on('dialogs_multiupdate', function (e, dialogsUpdated) {\n      if ($scope.search.query !== undefined && $scope.search.query.length) {\n        return false\n      }\n\n      var i\n      var dialog\n      var newPeer = false\n      var len = $scope.dialogs.length\n      for (i = 0; i < len; i++) {\n        dialog = $scope.dialogs[i]\n        if (dialogsUpdated[dialog.peerID]) {\n          $scope.dialogs.splice(i, 1)\n          i--\n          len--\n          AppMessagesManager.clearDialogCache(dialog.mid)\n        }\n      }\n\n      angular.forEach(dialogsUpdated, function (dialog, peerID) {\n        if ($scope.noUsers && peerID > 0) {\n          return\n        }\n        if (!peersInDialogs[peerID]) {\n          peersInDialogs[peerID] = true\n          newPeer = true\n        }\n        $scope.dialogs.unshift(\n          AppMessagesManager.wrapForDialog(dialog.top_message, dialog)\n        )\n      })\n\n      sortDialogs()\n\n      if (newPeer) {\n        delete $scope.isEmpty.dialogs\n        if (contactsShown) {\n          showMoreConversations()\n        }\n      }\n    })\n\n    function deleteDialog (peerID) {\n      for (var i = 0; i < $scope.dialogs.length; i++) {\n        if ($scope.dialogs[i].peerID == peerID) {\n          $scope.dialogs.splice(i, 1)\n          break\n        }\n      }\n    }\n\n    function sortDialogs() {\n      $scope.dialogs.sort(function (d1, d2) {\n        return d2.index - d1.index\n      })\n    }\n\n    $scope.$on('dialog_top', function (e, dialog) {\n      var curDialog, i\n      for (i = 0; i < $scope.dialogs.length; i++) {\n        curDialog = $scope.dialogs[i]\n        if (curDialog.peerID == dialog.peerID) {\n          var wrappedDialog = AppMessagesManager.wrapForDialog(dialog.top_message, dialog)\n          $scope.dialogs.splice(i, 1, wrappedDialog)\n          break\n        }\n      }\n    })\n    $scope.$on('dialog_flush', function (e, update) {\n      var curDialog, i\n      for (i = 0; i < $scope.dialogs.length; i++) {\n        curDialog = $scope.dialogs[i]\n        if (curDialog.peerID == update.peerID) {\n          curDialog.deleted = true\n          break\n        }\n      }\n    })\n    $scope.$on('dialog_drop', function (e, dialog) {\n      deleteDialog(dialog.peerID)\n    })\n\n    $scope.$on('dialog_draft', function (e, draftUpdate) {\n      var curDialog, i\n      for (i = 0; i < $scope.dialogs.length; i++) {\n        curDialog = $scope.dialogs[i]\n        if (curDialog.peerID == draftUpdate.peerID) {\n          curDialog.draft = draftUpdate.draft\n          if (draftUpdate.index) {\n            curDialog.index = draftUpdate.index\n          }\n          sortDialogs();\n          break\n        }\n      }\n    })\n\n    $scope.$on('history_delete', function (e, historyUpdate) {\n      for (var i = 0; i < $scope.dialogs.length; i++) {\n        if ($scope.dialogs[i].peerID == historyUpdate.peerID) {\n          if (historyUpdate.msgs[$scope.dialogs[i].mid]) {\n            $scope.dialogs[i].deleted = true\n          }\n          break\n        }\n      }\n    })\n\n    $scope.$on('apiUpdate', function (e, update) {\n      switch (update._) {\n        case 'updateUserTyping':\n        case 'updateChatUserTyping':\n          if (!AppUsersManager.hasUser(update.user_id)) {\n            if (update.chat_id &&\n              AppChatsManager.hasChat(update.chat_id) &&\n              !AppChatsManager.isChannel(update.chat_id)) {\n              AppProfileManager.getChatFull(update.chat_id)\n            }\n            return\n          }\n          var peerID = update._ == 'updateUserTyping' ? update.user_id : -update.chat_id\n          AppUsersManager.forceUserOnline(update.user_id)\n          for (var i = 0; i < $scope.dialogs.length; i++) {\n            if ($scope.dialogs[i].peerID == peerID) {\n              $scope.dialogs[i].typing = update.user_id\n              $timeout.cancel(typingTimeouts[peerID])\n\n              typingTimeouts[peerID] = $timeout(function () {\n                for (var i = 0; i < $scope.dialogs.length; i++) {\n                  if ($scope.dialogs[i].peerID == peerID) {\n                    if ($scope.dialogs[i].typing == update.user_id) {\n                      delete $scope.dialogs[i].typing\n                    }\n                  }\n                }\n              }, 6000)\n              break\n            }\n          }\n          break\n      }\n    })\n\n    $scope.$watchCollection('search', function () {\n      $scope.dialogs = []\n      $scope.foundMessages = []\n      searchMessages = false\n      contactsJump++\n      loadDialogs()\n    })\n\n    if (Config.Mobile) {\n      $scope.$watch('curDialog.peer', function () {\n        $scope.$broadcast('ui_dialogs_update')\n      })\n    }\n\n    $scope.importPhonebook = function () {\n      PhonebookContactsService.openPhonebookImport()\n    }\n\n    $scope.$on('contacts_update', function () {\n      if (contactsShown) {\n        showMoreConversations()\n      }\n    })\n\n    $scope.$on('ui_dialogs_search_clear', $scope.searchClear)\n\n    if (!$scope.noMessages) {\n      $scope.$on('dialogs_search', function (e, data) {\n        $scope.search.query = data.query || ''\n        $scope.toggleSearch()\n      })\n    }\n\n    var searchTimeoutPromise\n    function getDialogs (force) {\n      var curJump = ++jump\n\n      $timeout.cancel(searchTimeoutPromise)\n\n      if (searchMessages) {\n        searchTimeoutPromise = (force || maxID) ? $q.when() : $timeout(angular.noop, 500)\n        return searchTimeoutPromise.then(function () {\n          return AppMessagesManager.getSearch(false, $scope.search.query, {_: 'inputMessagesFilterEmpty'}, maxID).then(function (result) {\n            if (curJump != jump) {\n              return $q.reject()\n            }\n            var dialogs = []\n            angular.forEach(result.history, function (messageID) {\n              var message = AppMessagesManager.getMessage(messageID)\n              var peerID = AppMessagesManager.getMessagePeer(message)\n\n              dialogs.push({\n                peerID: peerID,\n                top_message: messageID,\n                unread_count: -1\n              })\n            })\n\n            return {\n              dialogs: dialogs\n            }\n          })\n        })\n      }\n\n      var query = $scope.search.query || ''\n      if ($scope.noUsers) {\n        query = '%pg ' + query\n      }\n      return AppMessagesManager.getConversations(query, offsetIndex).then(function (result) {\n        if (curJump != jump) {\n          return $q.reject()\n        }\n        return result\n      })\n    }\n\n    function loadDialogs (force) {\n      offsetIndex = 0\n      maxID = 0\n      hasMore = false\n      if (!searchMessages) {\n        peersInDialogs = {}\n        contactsShown = false\n      }\n\n      getDialogs(force).then(function (dialogsResult) {\n        if (!searchMessages) {\n          $scope.dialogs = []\n          $scope.contacts = []\n          $scope.foundPeers = []\n        }\n        $scope.foundMessages = []\n\n        var dialogsList = searchMessages ? $scope.foundMessages : $scope.dialogs\n\n        if (dialogsResult.dialogs.length) {\n          angular.forEach(dialogsResult.dialogs, function (dialog) {\n            if ($scope.canSend &&\n              AppPeersManager.isChannel(dialog.peerID) &&\n              !AppChatsManager.hasRights(-dialog.peerID, 'send')) {\n              return\n            }\n            var wrapDialog = searchMessages ? undefined : dialog\n            var wrappedDialog = AppMessagesManager.wrapForDialog(dialog.top_message, wrapDialog)\n            if (searchMessages) {\n              wrappedDialog.unreadCount = -1\n            } else {\n              peersInDialogs[dialog.peerID] = true\n            }\n            dialogsList.push(wrappedDialog)\n          })\n\n          if (searchMessages) {\n            maxID = dialogsResult.dialogs[dialogsResult.dialogs.length - 1].top_message\n          } else {\n            offsetIndex = dialogsResult.dialogs[dialogsResult.dialogs.length - 1].index\n            delete $scope.isEmpty.dialogs\n          }\n          hasMore = true\n        } else {\n          hasMore = false\n        }\n\n        $scope.$broadcast('ui_dialogs_change')\n\n        if (!$scope.search.query) {\n          AppMessagesManager.getConversations('', offsetIndex, 100)\n          if (!dialogsResult.dialogs.length) {\n            $scope.isEmpty.dialogs = true\n            showMoreDialogs()\n          }\n        } else {\n          showMoreDialogs()\n        }\n      })\n    }\n\n    function showMoreDialogs () {\n      if (contactsShown && (!hasMore || !offsetIndex && !maxID)) {\n        return\n      }\n\n      if (!hasMore &&\n        !searchMessages &&\n        !$scope.noUsers &&\n        ($scope.search.query || !$scope.dialogs.length)) {\n        showMoreConversations()\n        return\n      }\n\n      getDialogs().then(function (dialogsResult) {\n        if (dialogsResult.dialogs.length) {\n          var dialogsList = searchMessages ? $scope.foundMessages : $scope.dialogs\n\n          angular.forEach(dialogsResult.dialogs, function (dialog) {\n            if ($scope.canSend &&\n              AppPeersManager.isChannel(dialog.peerID) &&\n              !AppChatsManager.hasRights(-dialog.peerID, 'send')) {\n              return\n            }\n            var wrapDialog = searchMessages ? undefined : dialog\n            var wrappedDialog = AppMessagesManager.wrapForDialog(dialog.top_message, wrapDialog)\n            if (searchMessages) {\n              wrappedDialog.unreadCount = -1\n            } else {\n              peersInDialogs[dialog.peerID] = true\n            }\n            dialogsList.push(wrappedDialog)\n          })\n\n          if (searchMessages) {\n            maxID = dialogsResult.dialogs[dialogsResult.dialogs.length - 1].top_message\n          } else {\n            offsetIndex = dialogsResult.dialogs[dialogsResult.dialogs.length - 1].index\n          }\n\n          $scope.$broadcast('ui_dialogs_append')\n\n          hasMore = true\n        }else {\n          hasMore = false\n        }\n      })\n    }\n\n    function showMoreConversations () {\n      contactsShown = true\n\n      var curJump = ++contactsJump\n      AppUsersManager.getContacts($scope.search.query).then(function (contactsList) {\n        if (curJump != contactsJump) return\n        $scope.contacts = []\n        angular.forEach(contactsList, function (userID) {\n          if (peersInDialogs[userID] === undefined) {\n            $scope.contacts.push({\n              userID: userID,\n              user: AppUsersManager.getUser(userID),\n              peerString: AppUsersManager.getUserString(userID)\n            })\n          }\n        })\n\n        if (contactsList.length) {\n          delete $scope.isEmpty.contacts\n        } else if (!$scope.search.query) {\n          $scope.isEmpty.contacts = true\n        }\n        $scope.$broadcast('ui_dialogs_append')\n      })\n\n      if ($scope.search.query && $scope.search.query.length >= 5) {\n        $timeout(function () {\n          if (curJump != contactsJump) return\n          MtpApiManager.invokeApi('contacts.search', {q: $scope.search.query, limit: 10}).then(function (result) {\n            AppUsersManager.saveApiUsers(result.users)\n            AppChatsManager.saveApiChats(result.chats)\n            if (curJump != contactsJump) return\n            $scope.foundPeers = []\n            angular.forEach(result.results, function (contactFound) {\n              var peerID = AppPeersManager.getPeerID(contactFound)\n              if (peersInDialogs[peerID] === undefined) {\n                if ($scope.canSend &&\n                  AppPeersManager.isChannel(peerID) &&\n                  !AppChatsManager.hasRights(-peerID, 'send')) {\n                  return\n                }\n                $scope.foundPeers.push({\n                  id: peerID,\n                  username: AppPeersManager.getPeer(peerID).username,\n                  peerString: AppUsersManager.getUserString(peerID)\n                })\n              }\n            })\n          }, function (error) {\n            if (error.code == 400) {\n              error.handled = true\n            }\n          })\n        }, 500)\n      }\n\n      if ($scope.search.query && !$scope.noMessages) {\n        searchMessages = true\n        loadDialogs()\n      }\n    }\n  })\n\n  .controller('AppImHistoryController', function ($scope, $location, $timeout, $modal, $rootScope, toaster, _, MtpApiManager, AppUsersManager, AppChatsManager, AppMessagesManager, AppPeersManager, ApiUpdatesManager, PeersSelectService, IdleManager, StatusManager, NotificationsManager, ErrorService, GeoLocationManager) {\n    $scope.$watchCollection('curDialog', applyDialogSelect)\n\n    ApiUpdatesManager.attach()\n    IdleManager.start()\n    StatusManager.start()\n\n    $scope.peerHistories = []\n    $scope.selectedMsgs = {}\n    $scope.selectedCount = 0\n    $scope.historyState.selectActions = false\n    $scope.historyState.botActions = false\n    $scope.historyState.channelActions = false\n    $scope.historyState.canDelete = false\n    $scope.historyState.canReply = false\n    $scope.historyState.missedCount = 0\n    $scope.historyState.skipped = false\n    $scope.state = {}\n\n    $scope.toggleMessage = toggleMessage\n    $scope.selectedDelete = selectedDelete\n    $scope.selectedForward = selectedForward\n    $scope.selectedReply = selectedReply\n    $scope.selectedCancel = selectedCancel\n    $scope.selectedFlush = selectedFlush\n    $scope.selectInlineBot = selectInlineBot\n\n    $scope.startBot = startBot\n    $scope.cancelBot = cancelBot\n    $scope.joinChannel = joinChannel\n    $scope.togglePeerMuted = togglePeerMuted\n\n    $scope.toggleEdit = toggleEdit\n    $scope.toggleMedia = toggleMedia\n    $scope.returnToRecent = returnToRecent\n\n    $scope.$on('history_edit_toggle', toggleEdit)\n    $scope.$on('history_edit_flush', selectedFlush)\n    $scope.$on('history_media_toggle', function (e, mediaType) {\n      toggleMedia(mediaType)\n    })\n\n    $scope.$on('history_return_recent', returnToRecent)\n\n    var peerID\n    var peerHistory = false\n    var unreadAfterIdle = false\n    var hasMore = false\n    var hasLess = false\n    var maxID = 0\n    var minID = 0\n    var lastSelectID = false\n    var inputMediaFilters = {\n      photos: 'inputMessagesFilterPhotos',\n      video: 'inputMessagesFilterVideo',\n      documents: 'inputMessagesFilterDocument',\n      audio: 'inputMessagesFilterVoice'\n    }\n    var jump = 0\n    var moreJump = 0\n    var moreActive = false\n    var morePending = false\n    var lessJump = 0,\n      lessActive = false,\n      lessPending = false\n\n    function applyDialogSelect (newDialog, oldDialog) {\n      peerID = $rootScope.selectedPeerID = newDialog.peerID\n      $scope.historyFilter.mediaType = false\n\n      AppPeersManager.getInputPeer(newDialog.peer || $scope.curDialog.peer || '')\n\n      updateBotActions()\n      selectedCancel(true)\n\n      if (oldDialog.peer &&\n        oldDialog.peer == newDialog.peer &&\n        newDialog.messageID) {\n        messageFocusHistory()\n      }\n      else if (peerID) {\n        updateHistoryPeer(true)\n        loadHistory()\n      }else {\n        showEmptyHistory()\n      }\n    }\n\n    function historiesQueuePush (peerID) {\n      var pos = -1\n      var maxLen = 10,\n        i,\n        history,\n        diff\n\n      for (i = 0; i < $scope.peerHistories.length; i++) {\n        if ($scope.peerHistories[i].peerID == peerID) {\n          pos = i\n          break\n        }\n      }\n      if (pos > -1) {\n        history = $scope.peerHistories[pos]\n        return history\n      }\n      history = {peerID: peerID, messages: [], ids: []}\n      $scope.peerHistories.unshift(history)\n      diff = $scope.peerHistories.length - maxLen\n      if (diff > 0) {\n        $scope.peerHistories.splice(maxLen - 1, diff)\n      }\n\n      return history\n    }\n\n    function historiesQueueFind (peerID) {\n      var i\n      for (i = 0; i < $scope.peerHistories.length; i++) {\n        if ($scope.peerHistories[i].peerID == peerID) {\n          return $scope.peerHistories[i]\n        }\n      }\n      return false\n    }\n\n    function historiesQueuePop (peerID) {\n      var i\n      for (i = 0; i < $scope.peerHistories.length; i++) {\n        if ($scope.peerHistories[i].peerID == peerID) {\n          $scope.peerHistories.splice(i, 1)\n          return true\n        }\n      }\n      return false\n    }\n\n    function updateHistoryPeer (preload) {\n      var peerData = AppPeersManager.getPeer(peerID)\n      // console.log('update', preload, peerData)\n      if (!peerData || peerData.deleted) {\n        safeReplaceObject($scope.state, {loaded: false})\n        return false\n      }\n\n      peerHistory = historiesQueuePush(peerID)\n\n      safeReplaceObject($scope.historyPeer, {\n        id: peerID,\n        data: peerData\n      })\n\n      MtpApiManager.getUserID().then(function (myID) {\n        $scope.ownID = myID\n      })\n\n      if (preload) {\n        $scope.historyState.typing.splice(0, $scope.historyState.typing.length)\n        $scope.$broadcast('ui_peer_change')\n        $scope.$broadcast('ui_history_change')\n        safeReplaceObject($scope.state, {loaded: true, empty: !peerHistory.messages.length, mayBeHasMore: true})\n\n        updateBotActions()\n        updateChannelActions()\n      }\n    }\n\n    function updateBotActions () {\n      var wasBotActions = $scope.historyState.botActions\n      if (!peerID ||\n        peerID < 0 ||\n        !AppUsersManager.isBot(peerID) ||\n        $scope.historyFilter.mediaType ||\n        $scope.curDialog.messageID) {\n        $scope.historyState.botActions = false\n      }\n      else if (\n        $scope.state.empty || (\n        peerHistory &&\n        peerHistory.messages.length == 1 &&\n        peerHistory.messages[0].action &&\n        peerHistory.messages[0].action._ == 'messageActionBotIntro'\n        )\n      ) {\n        $scope.historyState.botActions = 'start'\n      }\n      else if ($scope.curDialog.startParam) {\n        $scope.historyState.botActions = 'param'\n      }else {\n        $scope.historyState.botActions = false\n      }\n      if (wasBotActions != $scope.historyState.botActions) {\n        $scope.$broadcast('ui_panel_update')\n      }\n    }\n\n    function updateChannelActions () {\n      var wasChannelActions = $scope.historyState.channelActions\n      var channel\n      if (peerID &&\n        AppPeersManager.isChannel(peerID) &&\n        (channel = AppChatsManager.getChat(-peerID))) {\n        var canSend = AppChatsManager.hasRights(-peerID, 'send')\n        if (!canSend) {\n          if (channel.pFlags.left) {\n            $scope.historyState.channelActions = 'join'\n          } else {\n            if (!$scope.historyState.channelActions) {\n              $scope.historyState.channelActions = 'mute'\n            }\n            NotificationsManager.getPeerMuted(peerID).then(function (muted) {\n              $scope.historyState.channelActions = muted ? 'unmute' : 'mute'\n            })\n          }\n        } else {\n          $scope.historyState.channelActions = false\n        }\n        $scope.historyState.canReply = canSend\n        $scope.historyState.canDelete = canSend || channel.pFlags.moderator\n      }else {\n        $scope.historyState.channelActions = false\n        $scope.historyState.canReply = true\n        $scope.historyState.canDelete = true\n      }\n      if (wasChannelActions != $scope.historyState.channelActions) {\n        $scope.$broadcast('ui_panel_update')\n      }\n    }\n\n    function messageFocusHistory () {\n      var history = historiesQueueFind(peerID)\n\n      if (history &&\n        history.ids.indexOf($scope.curDialog.messageID) != -1) {\n        $scope.historyUnread = {}\n        var focusedMsgID = $scope.curDialog.messageID || 0\n        $scope.$broadcast('messages_focus', focusedMsgID)\n        $scope.$broadcast('ui_history_change_scroll', true)\n      } else {\n        loadHistory()\n      }\n    }\n\n    function showLessHistory () {\n      if (!hasLess) {\n        return\n      }\n      if (moreActive) {\n        lessPending = true\n        return\n      }\n      lessPending = false\n      $scope.state.lessActive = lessActive = true\n\n      var curJump = jump\n      var curLessJump = ++lessJump\n      var limit = 0\n      var backLimit = 20\n      AppMessagesManager.getHistory($scope.curDialog.peerID, minID, limit, backLimit).then(function (historyResult) {\n        $scope.state.lessActive = lessActive = false\n        if (curJump != jump || curLessJump != lessJump) return\n\n        var i, id\n        for (i = historyResult.history.length - 1; i >= 0; i--) {\n          id = historyResult.history[i]\n          if (id > minID) {\n            peerHistory.messages.push(AppMessagesManager.wrapForHistory(id))\n            peerHistory.ids.push(id)\n          }\n        }\n\n        if (historyResult.history.length) {\n          minID = historyResult.history.length >= backLimit\n            ? historyResult.history[0]\n            : 0\n          if (AppMessagesManager.regroupWrappedHistory(peerHistory.messages, -backLimit)) {\n            $scope.$broadcast('messages_regroup')\n          }\n          delete $scope.state.empty\n          $scope.$broadcast('ui_history_append')\n        } else {\n          minID = 0\n        }\n        $scope.historyState.skipped = hasLess = minID > 0\n\n        if (morePending) {\n          showMoreHistory()\n        }\n      })\n    }\n\n    function showMoreHistory () {\n      if (!hasMore) {\n        return\n      }\n      if (lessActive) {\n        morePending = true\n        return\n      }\n      morePending = false\n      $scope.state.moreActive = moreActive = true\n\n      var curJump = jump\n      var curMoreJump = ++moreJump\n      var inputMediaFilter = $scope.historyFilter.mediaType && {_: inputMediaFilters[$scope.historyFilter.mediaType]}\n      var limit = Config.Mobile ? 20 : 0\n      var getMessagesPromise = inputMediaFilter\n        ? AppMessagesManager.getSearch($scope.curDialog.peerID, '', inputMediaFilter, maxID, limit)\n        : AppMessagesManager.getHistory($scope.curDialog.peerID, maxID, limit)\n\n      getMessagesPromise.then(function (historyResult) {\n        $scope.state.moreActive = moreActive = false\n        if (curJump != jump || curMoreJump != moreJump) return\n\n        angular.forEach(historyResult.history, function (id) {\n          peerHistory.messages.unshift(AppMessagesManager.wrapForHistory(id))\n          peerHistory.ids.unshift(id)\n        })\n\n        hasMore = historyResult.count === null ||\n          historyResult.history.length && peerHistory.messages.length < historyResult.count\n\n        if (historyResult.history.length) {\n          delete $scope.state.empty\n          maxID = historyResult.history[historyResult.history.length - 1]\n          $scope.$broadcast('ui_history_prepend')\n          if (AppMessagesManager.regroupWrappedHistory(peerHistory.messages, historyResult.history.length + 1)) {\n            $scope.$broadcast('messages_regroup')\n          }\n        }\n\n        if (lessPending) {\n          showLessHistory()\n        }\n      })\n    }\n\n    function loadHistory (forceRecent) {\n      $scope.historyState.missedCount = 0\n\n      hasMore = false\n      $scope.historyState.skipped = hasLess = false\n      maxID = 0\n      minID = 0\n      peerHistory = historiesQueuePush(peerID)\n\n      var limit = 0\n      var backLimit = 0\n\n      if ($scope.curDialog.messageID) {\n        maxID = parseInt($scope.curDialog.messageID)\n        limit = 20\n        backLimit = 20\n      }\n      else if (forceRecent) {\n        limit = 10\n      }\n\n      $scope.state.moreActive = moreActive = false\n      morePending = false\n      $scope.state.lessActive = lessActive = false\n      lessPending = false\n\n      var prerenderedLen = peerHistory.messages.length\n      if (prerenderedLen && (maxID || backLimit)) {\n        prerenderedLen = 0\n        peerHistory.messages = []\n        peerHistory.ids = []\n        $scope.state.empty = true\n      }\n\n      var curJump = ++jump\n      var inputMediaFilter = $scope.historyFilter.mediaType && {_: inputMediaFilters[$scope.historyFilter.mediaType]}\n      var getMessagesPromise = inputMediaFilter\n        ? AppMessagesManager.getSearch($scope.curDialog.peerID, '', inputMediaFilter, maxID)\n        : AppMessagesManager.getHistory($scope.curDialog.peerID, maxID, limit, backLimit, prerenderedLen)\n\n      $scope.state.mayBeHasMore = true\n      // console.log(dT(), 'start load history', $scope.curDialog)\n      getMessagesPromise.then(function (historyResult) {\n        if (curJump != jump) return\n        // console.log(dT(), 'history loaded', angular.copy(historyResult))\n\n        var fetchedLength = historyResult.history.length\n\n        minID = (historyResult.unreadSkip || maxID && historyResult.history.indexOf(maxID) >= backLimit - 1)\n          ? historyResult.history[0]\n          : 0\n        maxID = historyResult.history[historyResult.history.length - 1]\n\n        $scope.historyState.skipped = hasLess = minID > 0\n        hasMore = historyResult.count === null ||\n          fetchedLength && fetchedLength < historyResult.count\n\n        updateHistoryPeer()\n        safeReplaceObject($scope.state, {loaded: true, empty: !fetchedLength})\n\n        peerHistory.messages = []\n        peerHistory.ids = []\n        angular.forEach(historyResult.history, function (id) {\n          var message = AppMessagesManager.wrapForHistory(id)\n          if ($scope.historyState.skipped) {\n            delete message.pFlags.unread\n          }\n          if (historyResult.unreadOffset) {\n            message.unreadAfter = true\n          }\n          peerHistory.messages.push(message)\n          peerHistory.ids.push(id)\n        })\n        peerHistory.messages.reverse()\n        peerHistory.ids.reverse()\n\n        if (AppMessagesManager.regroupWrappedHistory(peerHistory.messages)) {\n          $scope.$broadcast('messages_regroup')\n        }\n\n        if (historyResult.unreadOffset) {\n          $scope.historyUnreadAfter = historyResult.history[historyResult.unreadOffset - 1]\n        }\n        else if ($scope.historyUnreadAfter) {\n          delete $scope.historyUnreadAfter\n        }\n        $scope.$broadcast('messages_unread_after')\n        var focusedMsgID = $scope.curDialog.messageID || 0\n        onContentLoaded(function () {\n          $scope.$broadcast('messages_focus', focusedMsgID)\n        })\n        $scope.$broadcast('ui_history_change')\n\n        if (!$rootScope.idle.isIDLE) {\n          AppMessagesManager.readHistory($scope.curDialog.peerID)\n        }\n\n        updateBotActions()\n        updateChannelActions()\n      }, function () {\n        safeReplaceObject($scope.state, {error: true, loaded: true})\n      })\n    }\n\n    function showEmptyHistory () {\n      jump++\n      safeReplaceObject($scope.historyPeer, {})\n      safeReplaceObject($scope.state, {notSelected: true})\n      peerHistory = false\n      hasMore = false\n\n      $scope.$broadcast('ui_history_change')\n    }\n\n    function startBot () {\n      AppMessagesManager.startBot(peerID, 0, $scope.curDialog.startParam)\n      $scope.curDialog.startParam = false\n    }\n\n    function cancelBot () {\n      delete $scope.curDialog.startParam\n    }\n\n    function joinChannel () {\n      MtpApiManager.invokeApi('channels.joinChannel', {\n        channel: AppChatsManager.getChannelInput(-peerID)\n      }).then(function (result) {\n        ApiUpdatesManager.processUpdateMessage(result)\n      })\n    }\n\n    function togglePeerMuted (muted) {\n      NotificationsManager.getPeerSettings(peerID).then(function (settings) {\n        settings.mute_until = !muted ? 0 : 2000000000\n        NotificationsManager.updatePeerSettings(peerID, settings)\n      })\n    }\n\n    function toggleMessage (messageID, $event) {\n      if ($scope.historyState.botActions ||\n        $rootScope.idle.afterFocus) {\n        return false\n      }\n      var message = AppMessagesManager.getMessage(messageID)\n      if (message._ == 'messageService') {\n        return false\n      }\n\n      if (!$scope.historyState.selectActions) {\n        if (getSelectedText()) {\n          return false\n        }\n\n        var target = $event.target\n        while (target) {\n          if (target instanceof SVGElement) {\n            target = target.parentNode\n            continue\n          }\n          if (target.className && target.className.indexOf('im_message_outer_wrap') != -1) {\n            if (Config.Mobile) {\n              return false\n            }\n            break\n          }\n          if (target.className &&\n            target.className.indexOf('im_message_date') != -1) {\n            if (AppPeersManager.isChannel(peerID) &&\n                !AppPeersManager.isMegagroup(peerID)) {\n              quickForward(messageID)\n            } else {\n              selectedReply(messageID)\n            }\n            return false\n          }\n          if (Config.Mobile &&\n            target.className &&\n            target.className.indexOf('im_message_body') != -1) {\n            break\n          }\n          if (target.tagName == 'A' || hasOnlick(target)) {\n            return false\n          }\n          target = target.parentNode\n        }\n\n        if (Config.Mobile) {\n          $modal.open({\n            templateUrl: templateUrl('message_actions_modal'),\n            windowClass: 'message_actions_modal_window',\n            scope: $scope.$new()\n          }).result.then(function (action) {\n            switch (action) {\n              case 'reply':\n                selectedReply(messageID)\n                break\n\n              case 'delete':\n                selectedDelete(messageID)\n                break\n\n              case 'forward':\n                selectedForward(messageID)\n                break\n\n              case 'select':\n                $scope.historyState.selectActions = 'selected'\n                $scope.$broadcast('ui_panel_update')\n                toggleMessage(messageID)\n                break\n            }\n          })\n          return false\n        }\n      }\n\n      var shiftClick = $event && $event.shiftKey\n      if (shiftClick) {\n        $scope.$broadcast('ui_selection_clear')\n      }\n\n      if ($scope.selectedMsgs[messageID]) {\n        lastSelectID = false\n        delete $scope.selectedMsgs[messageID]\n        $scope.selectedCount--\n        if (!$scope.selectedCount) {\n          $scope.historyState.selectActions = false\n          $scope.$broadcast('ui_panel_update')\n        }\n      } else {\n        if (!shiftClick) {\n          lastSelectID = messageID\n        } else if (lastSelectID != messageID) {\n          var dir = lastSelectID > messageID,\n            i, startPos, curMessageID\n\n          for (i = 0; i < peerHistory.messages.length; i++) {\n            if (peerHistory.messages[i].mid == lastSelectID) {\n              startPos = i\n              break\n            }\n          }\n\n          i = startPos\n          while (peerHistory.messages[i] &&\n            (curMessageID = peerHistory.messages[i].mid) != messageID) {\n            if (!$scope.selectedMsgs[curMessageID]) {\n              $scope.selectedMsgs[curMessageID] = true\n              $scope.selectedCount++\n            }\n            i += dir ? -1 : +1\n          }\n        }\n\n        $scope.selectedMsgs[messageID] = true\n        $scope.selectedCount++\n        if (!$scope.historyState.selectActions) {\n          $scope.historyState.selectActions = 'selected'\n          $scope.$broadcast('ui_panel_update')\n        }\n      }\n      $scope.$broadcast('messages_select')\n    }\n\n    function selectInlineBot (botID, $event) {\n      if ($scope.historyState.canReply) {\n        $scope.$broadcast('inline_bot_select', botID)\n      }\n      return cancelEvent($event)\n    }\n\n    function selectedCancel (noBroadcast) {\n      $scope.selectedMsgs = {}\n      $scope.selectedCount = 0\n      $scope.historyState.selectActions = false\n      lastSelectID = false\n      if (!noBroadcast) {\n        $scope.$broadcast('ui_panel_update')\n      }\n      $scope.$broadcast('messages_select')\n    }\n\n    function selectedFlush () {\n      ErrorService.confirm({type: 'HISTORY_FLUSH'}).then(function () {\n        AppMessagesManager.flushHistory($scope.curDialog.peerID, true).then(function () {\n          selectedCancel()\n        })\n      })\n    }\n\n    function selectedDelete (selectedMessageID) {\n      var selectedMessageIDs = []\n      if (selectedMessageID) {\n        selectedMessageIDs.push(selectedMessageID)\n      }\n      else if ($scope.selectedCount > 0) {\n        angular.forEach($scope.selectedMsgs, function (t, messageID) {\n          selectedMessageIDs.push(messageID)\n        })\n      }\n      if (selectedMessageIDs.length) {\n        ErrorService.confirm({type: 'MESSAGES_DELETE', count: selectedMessageIDs.length}).then(function () {\n          AppMessagesManager.deleteMessages(selectedMessageIDs).then(function () {\n            selectedCancel()\n          })\n        })\n      }\n    }\n\n    function quickForward (msgID) {\n      PeersSelectService.selectPeers({\n        canSend: true,\n        confirm_type: 'FORWARD_PEER',\n        shareLinkPromise: AppMessagesManager.getMessageShareLink(msgID)\n      }).then(function (peerStrings) {\n        angular.forEach(peerStrings, function (peerString) {\n          var peerID = AppPeersManager.getPeerID(peerString)\n          AppMessagesManager.forwardMessages(peerID, [msgID])\n        })\n        var toastData = toaster.pop({\n          type: 'info',\n          body: _('confirm_modal_forward_to_peer_success'),\n          bodyOutputType: 'trustedHtml',\n          clickHandler: function () {\n            $rootScope.$broadcast('history_focus', {\n              peerString: peerStrings[0]\n            })\n            toaster.clear(toastData)\n          },\n          showCloseButton: false\n        })\n      })\n    }\n\n    function selectedForward (selectedMessageID) {\n      var selectedMessageIDs = []\n      if (selectedMessageID) {\n        selectedMessageIDs.push(selectedMessageID)\n      }\n      else if ($scope.selectedCount > 0) {\n        angular.forEach($scope.selectedMsgs, function (t, messageID) {\n          selectedMessageIDs.push(messageID)\n        })\n      }\n      if (selectedMessageIDs.length) {\n        PeersSelectService.selectPeer({canSend: true}).then(function (peerString) {\n          selectedCancel()\n          $rootScope.$broadcast('history_focus', {\n            peerString: peerString,\n            attachment: {\n              _: 'fwd_messages',\n              id: selectedMessageIDs\n            }\n          })\n        })\n      }\n    }\n\n    function selectedReply (selectedMessageID) {\n      if (!selectedMessageID && $scope.selectedCount == 1) {\n        angular.forEach($scope.selectedMsgs, function (t, messageID) {\n          selectedMessageID = messageID\n        })\n      }\n      if (selectedMessageID) {\n        selectedCancel()\n        $scope.$broadcast('reply_selected', selectedMessageID)\n      }\n    }\n\n    function toggleEdit () {\n      if ($scope.historyState.selectActions) {\n        selectedCancel()\n      } else {\n        $scope.historyState.selectActions = 'selected'\n        $scope.$broadcast('ui_panel_update')\n      }\n    }\n\n    function toggleMedia (mediaType) {\n      $scope.historyFilter.mediaType = mediaType || false\n      $scope.curDialog.messageID = false\n      peerHistory.messages = []\n      peerHistory.ids = []\n      $scope.state.empty = true\n      loadHistory()\n    }\n\n    function returnToRecent () {\n      if ($scope.historyFilter.mediaType) {\n        toggleMedia()\n      } else {\n        if ($scope.curDialog.messageID) {\n          $rootScope.$broadcast('history_focus', {peerString: $scope.curDialog.peer})\n        } else {\n          loadHistory(true)\n        }\n      }\n    }\n\n    $scope.$on('history_update', angular.noop)\n\n    var loadAfterSync = false\n    $scope.$on('stateSynchronized', function () {\n      if (!loadAfterSync) {\n        return\n      }\n      if (loadAfterSync == $scope.curDialog.peerID) {\n        loadHistory()\n      }\n      loadAfterSync = false\n    })\n\n    $scope.$on('reply_button_press', function (e, button) {\n      var replyKeyboard = $scope.historyState.replyKeyboard\n      if (!replyKeyboard) {\n        return\n      }\n      var sendOptions = {\n        replyToMsgID: peerID < 0 && replyKeyboard.mid\n      }\n      switch (button._) {\n        case 'keyboardButtonRequestPhone':\n          ErrorService.confirm({type: 'BOT_ACCESS_PHONE'}).then(function () {\n            var user = AppUsersManager.getSelf()\n            AppMessagesManager.sendOther(peerID, {\n              _: 'inputMediaContact',\n              phone_number: user.phone,\n              first_name: user.first_name,\n              last_name: user.last_name\n            }, sendOptions)\n          })\n          break\n\n        case 'keyboardButtonRequestGeoLocation':\n          ErrorService.confirm({type: 'BOT_ACCESS_GEO'}).then(function () {\n            return GeoLocationManager.getPosition().then(function (coords) {\n              AppMessagesManager.sendOther(peerID, {\n                _: 'inputMediaGeoPoint',\n                geo_point: {\n                  _: 'inputGeoPoint',\n                  'lat': coords['lat'],\n                  'long': coords['long']\n                }\n              }, sendOptions)\n            }, function (error) {\n              ErrorService.alert(\n                _('error_modal_bad_request_title_raw'),\n                _('error_modal_gelocation_na_raw')\n              )\n            })\n          })\n          break\n\n        default:\n          AppMessagesManager.sendText(peerID, button.text, sendOptions)\n      }\n    })\n\n    $scope.$on('history_reload', function (e, updPeerID) {\n      if (updPeerID == $scope.curDialog.peerID) {\n        loadHistory()\n      }\n    })\n\n    $scope.$on('history_forbidden', function (e, updPeerID) {\n      if (updPeerID == $scope.curDialog.peerID) {\n        $location.url('/im')\n      }\n      historiesQueuePop(updPeerID)\n    })\n\n    $scope.$on('dialog_migrate', function (e, data) {\n      if (data.migrateFrom == $scope.curDialog.peerID) {\n        var peerString = AppPeersManager.getPeerString(data.migrateTo)\n        $rootScope.$broadcast('history_focus', {peerString: peerString})\n      }\n      historiesQueuePop(data.migrateFrom)\n    })\n\n    $scope.$on('notify_settings', function (e, data) {\n      if (data.peerID == $scope.curDialog.peerID) {\n        updateChannelActions()\n      }\n    })\n\n    $scope.$on('channel_settings', function (e, data) {\n      if (data.channelID == -$scope.curDialog.peerID) {\n        updateChannelActions()\n      }\n    })\n\n    var typingTimeouts = {}\n    $scope.$on('history_append', function (e, addedMessage) {\n      var history = historiesQueueFind(addedMessage.peerID)\n      if (!history) {\n        return\n      }\n      var curPeer = addedMessage.peerID == $scope.curDialog.peerID\n      if (curPeer) {\n        if ($scope.historyFilter.mediaType ||\n          $scope.historyState.skipped) {\n          if (addedMessage.my) {\n            returnToRecent()\n          } else {\n            $scope.historyState.missedCount++\n          }\n          return\n        }\n        if ($scope.curDialog.messageID && addedMessage.my) {\n          returnToRecent()\n        }\n        delete $scope.state.empty\n      }\n      // console.log('append', addedMessage)\n      // console.trace()\n      var historyMessage = AppMessagesManager.wrapForHistory(addedMessage.messageID)\n      history.messages.push(historyMessage)\n      history.ids.push(addedMessage.messageID)\n      if (AppMessagesManager.regroupWrappedHistory(history.messages, -3)) {\n        $scope.$broadcast('messages_regroup')\n      }\n\n      if (curPeer) {\n        $scope.historyState.typing.splice(0, $scope.historyState.typing.length)\n        $scope.$broadcast('ui_history_append_new', {\n          my: addedMessage.my,\n          idleScroll: unreadAfterIdle && !historyMessage.pFlags.out && $rootScope.idle.isIDLE\n        })\n        if (addedMessage.my && $scope.historyUnreadAfter) {\n          delete $scope.historyUnreadAfter\n          $scope.$broadcast('messages_unread_after')\n        }\n\n        // console.log('append check', $rootScope.idle.isIDLE, addedMessage.peerID, $scope.curDialog.peerID, historyMessage, history.messages[history.messages.length - 2])\n        if ($rootScope.idle.isIDLE) {\n          if (historyMessage.pFlags.unread &&\n            !historyMessage.pFlags.out &&\n            !(history.messages[history.messages.length - 2] || {}).pFlags.unread) {\n            $scope.historyUnreadAfter = historyMessage.mid\n            unreadAfterIdle = true\n            $scope.$broadcast('messages_unread_after')\n          }\n        } else {\n          $timeout(function () {\n            AppMessagesManager.readHistory($scope.curDialog.peerID)\n          })\n        }\n\n        updateBotActions()\n        updateChannelActions()\n      }\n    })\n\n    $scope.$on('history_multiappend', function (e, historyMultiAdded) {\n      // console.log(dT(), 'multiappend', angular.copy(historyMultiAdded))\n      var regroupped = false\n      var unreadAfterChanged = false\n      var isIDLE = $rootScope.idle.isIDLE\n      angular.forEach(historyMultiAdded, function (msgs, peerID) {\n        var history = historiesQueueFind(peerID)\n        // var history = historiesQueuePush(peerID)\n        if (!history) {\n          return\n        }\n        var curPeer = peerID == $scope.curDialog.peerID\n        var exlen = history.messages.length\n        var len = msgs.length\n\n        if (curPeer) {\n          if ($scope.historyFilter.mediaType ||\n            $scope.historyState.skipped) {\n            $scope.historyState.missedCount += len\n            return\n          }\n          delete $scope.state.empty\n        }\n\n        if ((!curPeer || isIDLE) &&\n          exlen > (len > 10 ? 10 : 100)) {\n          console.warn(dT(), 'Drop too many messages', len, exlen, isIDLE, curPeer, peerID)\n          if (curPeer) {\n            minID = history.messages[exlen - 1].mid\n            $scope.historyState.skipped = hasLess = minID > 0\n            if (hasLess) {\n              loadAfterSync = peerID\n              $scope.$broadcast('ui_history_append')\n            }\n          } else {\n            historiesQueuePop(peerID)\n          }\n          return\n        }\n\n        var messageID, historyMessage, i\n        var hasOut = false\n        var unreadAfterNew = false\n        var historyMessage = history.messages[history.messages.length - 1]\n        var lastIsRead = !historyMessage || !historyMessage.pFlags.unread\n        for (i = 0; i < len; i++) {\n          messageID = msgs[i]\n          if (messageID < maxID ||\n            history.ids.indexOf(messageID) !== -1) {\n            continue\n          }\n          historyMessage = AppMessagesManager.wrapForHistory(messageID)\n          history.messages.push(historyMessage)\n          history.ids.push(messageID)\n          if (!unreadAfterNew && isIDLE) {\n            if (historyMessage.pFlags.unread &&\n              !historyMessage.pFlags.out &&\n              lastIsRead) {\n              unreadAfterNew = messageID\n            } else {\n              lastIsRead = !historyMessage.pFlags.unread\n            }\n          }\n          if (!hasOut && historyMessage.pFlags.out) {\n            hasOut = true\n          }\n        }\n        // console.log('after append', angular.copy(history.messages), angular.copy(history.ids))\n\n        if (AppMessagesManager.regroupWrappedHistory(history.messages, -len - 2)) {\n          regroupped = true\n        }\n\n        if (curPeer) {\n          if ($scope.historyState.typing.length) {\n            $scope.historyState.typing.splice(0, $scope.historyState.typing.length)\n          }\n          $scope.$broadcast('ui_history_append_new', {\n            idleScroll: unreadAfterIdle && !hasOut && isIDLE\n          })\n\n          if (isIDLE) {\n            if (unreadAfterNew) {\n              $scope.historyUnreadAfter = unreadAfterNew\n              unreadAfterIdle = true\n              unreadAfterChanged = true\n            }\n          } else {\n            $timeout(function () {\n              AppMessagesManager.readHistory($scope.curDialog.peerID)\n            })\n          }\n\n          updateBotActions()\n          updateChannelActions()\n        }\n      })\n\n      if (regroupped) {\n        $scope.$broadcast('messages_regroup')\n      }\n      if (unreadAfterChanged) {\n        $scope.$broadcast('messages_unread_after')\n      }\n    })\n\n    $scope.$on('history_delete', function (e, historyUpdate) {\n      var history = historiesQueueFind(historyUpdate.peerID)\n      if (!history) {\n        return\n      }\n      var newMessages = [],\n        i\n\n      for (i = 0; i < history.messages.length; i++) {\n        if (!historyUpdate.msgs[history.messages[i].mid]) {\n          newMessages.push(history.messages[i])\n        }\n      }\n      history.messages = newMessages\n      AppMessagesManager.regroupWrappedHistory(history.messages)\n      $scope.$broadcast('messages_regroup')\n      if (historyUpdate.peerID == $scope.curDialog.peerID) {\n        $scope.state.empty = !newMessages.length\n        updateBotActions()\n      }\n    })\n\n    $scope.$on('dialog_flush', function (e, dialog) {\n      var history = historiesQueueFind(dialog.peerID)\n      if (history) {\n        history.messages = []\n        history.ids = []\n        if (dialog.peerID == $scope.curDialog.peerID) {\n          $scope.state.empty = true\n          updateBotActions()\n        }\n      }\n    })\n\n    $scope.$on('history_focus', function (e, peerData) {\n      if ($scope.historyFilter.mediaType) {\n        toggleMedia()\n      }\n    })\n\n    $scope.$on('apiUpdate', function (e, update) {\n      switch (update._) {\n        case 'updateUserTyping':\n        case 'updateChatUserTyping':\n          AppUsersManager.forceUserOnline(update.user_id)\n          if (AppUsersManager.hasUser(update.user_id) &&\n            $scope.curDialog.peerID == (update._ == 'updateUserTyping'\n              ? update.user_id\n              : -update.chat_id\n            )) {\n            if ($scope.historyState.typing.indexOf(update.user_id) == -1) {\n              $scope.historyState.typing.push(update.user_id)\n            }\n            $timeout.cancel(typingTimeouts[update.user_id])\n\n            typingTimeouts[update.user_id] = $timeout(function () {\n              var pos = $scope.historyState.typing.indexOf(update.user_id)\n              if (pos !== -1) {\n                $scope.historyState.typing.splice(pos, 1)\n              }\n            }, 6000)\n          }\n          break\n      }\n    })\n\n    $scope.$on('history_need_less', showLessHistory)\n    $scope.$on('history_need_more', showMoreHistory)\n\n    $rootScope.$watch('idle.isIDLE', function (newVal) {\n      if (!newVal &&\n          $scope.curDialog &&\n          $scope.curDialog.peerID &&\n          !$scope.historyFilter.mediaType &&\n          !$scope.historyState.skipped) {\n        AppMessagesManager.readHistory($scope.curDialog.peerID)\n      }\n      if (!newVal) {\n        unreadAfterIdle = false\n        if (loadAfterSync &&\n          loadAfterSync == $scope.curDialog.peerID) {\n          loadHistory()\n          loadAfterSync = false\n        }\n      }\n    })\n  })\n\n  .controller('AppImPanelController', function ($scope) {\n    $scope.$on('user_update', angular.noop)\n  })\n\n  .controller('AppImSendController', function ($rootScope, $q, $scope, $timeout, MtpApiManager, Storage, AppProfileManager, AppChatsManager, AppUsersManager, AppPeersManager, AppDocsManager, AppMessagesManager, AppInlineBotsManager, MtpApiFileManager, DraftsManager, RichTextProcessor) {\n    $scope.$watch('curDialog.peer', resetDraft)\n    $scope.$on('user_update', angular.noop)\n    $scope.$on('peer_draft_attachment', applyDraftAttachment)\n    $scope.$on('reply_selected', function (e, messageID) {\n      replySelect(messageID, true)\n    })\n    $scope.$on('ui_typing', onTyping)\n\n    $scope.draftMessage = {\n      text: '',\n      send: sendMessage,\n      replyClear: replyClear,\n      fwdsClear: fwdsClear\n    }\n    $scope.mentions = {}\n    $scope.commands = {}\n    $scope.$watch('draftMessage.text', onMessageChange)\n    $scope.$watch('draftMessage.files', onFilesSelected)\n    $scope.$watch('draftMessage.sticker', onStickerSelected)\n    $scope.$watch('draftMessage.command', onCommandSelected)\n    $scope.$watch('draftMessage.inlineResultID', onInlineResultSelected)\n\n    $scope.$on('history_reply_markup', function (e, peerData) {\n      if (peerData.peerID == $scope.curDialog.peerID) {\n        updateReplyKeyboard()\n      }\n    })\n\n    $scope.$on('inline_bot_select', function (e, botID) {\n      var bot = AppUsersManager.getUser(botID)\n      $scope.draftMessage.text = '@' + bot.username + ''\n      $scope.$broadcast('ui_peer_draft', {focus: true})\n    })\n\n    $scope.$on('inline_bots_popular', updateMentions)\n\n    $scope.replyKeyboardToggle = replyKeyboardToggle\n    $scope.toggleSlash = toggleSlash\n\n    $rootScope.$watch('idle.isIDLE', function (newVal) {\n      if ($rootScope.idle.initial) {\n        return\n      }\n      if (newVal && $scope.curDialog.peerID) {\n        $scope.$broadcast('ui_message_before_send')\n        $timeout(function () {\n          DraftsManager.syncDraft($scope.curDialog.peerID)\n        })\n      }\n    })\n\n    $scope.$on('draft_updated', function (e, draftUpdate) {\n      if (draftUpdate.peerID == $scope.curDialog.peerID &&\n          !draftUpdate.local &&\n          (!$scope.draftMessage.text || $rootScope.idle.isIDLE)) {\n        getDraft()\n      }\n    })\n\n    var replyToMarkup = false\n    var forceDraft = false\n\n    function sendMessage (e) {\n      $scope.$broadcast('ui_message_before_send')\n\n      $timeout(function () {\n        var text = $scope.draftMessage.text\n\n        if (angular.isString(text) && text.length > 0) {\n          text = RichTextProcessor.parseEmojis(text)\n\n          var options = {\n            replyToMsgID: $scope.draftMessage.replyToMsgID,\n            clearDraft: true\n          }\n          do {\n            AppMessagesManager.sendText($scope.curDialog.peerID, text.substr(0, 4096), options)\n            text = text.substr(4096)\n            options = angular.copy(options)\n            delete options.clearDraft\n          } while (text.length)\n        }\n        fwdsSend()\n\n        if (forceDraft == $scope.curDialog.peer) {\n          forceDraft = false\n        }\n\n        resetDraft()\n        $scope.$broadcast('ui_message_send')\n      })\n\n      return cancelEvent(e)\n    }\n\n    function updateMentions () {\n      var peerID = $scope.curDialog.peerID\n\n      if (!peerID) {\n        safeReplaceObject($scope.mentions, {})\n        $scope.$broadcast('mentions_update')\n        return\n      }\n\n      var mentionUsers = []\n      var mentionIndex = SearchIndexManager.createIndex()\n\n      var inlineBotsPromise = AppInlineBotsManager.getPopularBots().then(function (inlineBots) {\n        var ids = []\n        angular.forEach(inlineBots, function (bot) {\n          ids.push(bot.id)\n        })\n        return ids\n      })\n      var chatParticipantsPromise\n      if (peerID < 0) {\n        chatParticipantsPromise = AppProfileManager.getChatFull(-peerID).then(function (chatFull) {\n          var participantsVector = (chatFull.participants || {}).participants || []\n          var ids = []\n          angular.forEach(participantsVector, function (participant) {\n            ids.push(participant.user_id)\n          })\n          return ids\n        })\n      } else {\n        chatParticipantsPromise = $q.when([])\n      }\n\n      $q.all({pop: inlineBotsPromise, chat: chatParticipantsPromise}).then(function (result) {\n        var done = {}\n        var ids = result.pop.concat(result.chat)\n        angular.forEach(ids, function (userID) {\n          if (done[userID]) {\n            return\n          }\n          done[userID] = true\n          mentionUsers.push(AppUsersManager.getUser(userID))\n          SearchIndexManager.indexObject(userID, AppUsersManager.getUserSearchText(userID), mentionIndex)\n        })\n\n        safeReplaceObject($scope.mentions, {\n          users: mentionUsers,\n          index: mentionIndex\n        })\n        $scope.$broadcast('mentions_update')\n      })\n    }\n\n    function updateCommands () {\n      var peerID = $scope.curDialog.peerID\n      if (!peerID) {\n        safeReplaceObject($scope.commands, {})\n        $scope.$broadcast('mentions_update')\n        return\n      }\n\n      AppProfileManager.getPeerBots(peerID).then(function (peerBots) {\n        if (!peerBots.length) {\n          safeReplaceObject($scope.commands, {})\n          $scope.$broadcast('mentions_update')\n          return\n        }\n\n        var needMentions = peerID < 0\n        var commandsList = []\n        var commandsIndex = SearchIndexManager.createIndex()\n\n        angular.forEach(peerBots, function (peerBot) {\n          var mention = ''\n          if (needMentions) {\n            var bot = AppUsersManager.getUser(peerBot.id)\n            if (bot && bot.username) {\n              mention += '@' + bot.username\n            }\n          }\n          var botSearchText = AppUsersManager.getUserSearchText(peerBot.id)\n          angular.forEach(peerBot.commands, function (description, command) {\n            var value = '/' + command + mention\n            commandsList.push({\n              botID: peerBot.id,\n              value: value,\n              rDescription: RichTextProcessor.wrapRichText(description, {noLinks: true, noLineBreaks: true})\n            })\n            SearchIndexManager.indexObject(value, botSearchText + ' ' + command + ' ' + description, commandsIndex)\n          })\n        })\n\n        safeReplaceObject($scope.commands, {\n          list: commandsList,\n          index: commandsIndex\n        })\n        $scope.$broadcast('mentions_update')\n      })\n    }\n\n    function resetDraft (newPeer, prevPeer) {\n      var prevPeerID = prevPeer ? AppPeersManager.getPeerID(prevPeer) : 0\n      if (newPeer != prevPeer && prevPeerID) {\n        $scope.$broadcast('ui_message_before_send')\n        $timeout(function () {\n          DraftsManager.syncDraft(prevPeerID)\n          resetDraft()\n        })\n        return\n      }\n\n      updateMentions()\n      updateCommands()\n      replyClear()\n      updateReplyKeyboard()\n\n      delete $scope.draftMessage.inlineProgress\n      $scope.$broadcast('inline_results', false)\n\n      // console.log(dT(), 'reset draft', $scope.curDialog.peer, forceDraft)\n      if (forceDraft) {\n        if (forceDraft == $scope.curDialog.peer) {\n          $scope.draftMessage.isBroadcast = AppPeersManager.isChannel($scope.curDialog.peerID) && !AppPeersManager.isMegagroup($scope.curDialog.peerID)\n          $scope.$broadcast('ui_peer_draft')\n          return\n        } else {\n          forceDraft = false\n        }\n      }\n\n      fwdsClear()\n      getDraft()\n    }\n\n    function getDraft () {\n      if ($scope.curDialog.peerID) {\n        DraftsManager.getDraft($scope.curDialog.peerID).then(function (draftData) {\n          $scope.draftMessage.text = draftData ? draftData.text : ''\n          $scope.draftMessage.isBroadcast = AppPeersManager.isChannel($scope.curDialog.peerID) && !AppPeersManager.isMegagroup($scope.curDialog.peerID)\n          if (draftData.replyToMsgID) {\n            var replyToMsgID = draftData.replyToMsgID\n            replySelect(replyToMsgID)\n          } else {\n            replyClear()\n          }\n          $scope.$broadcast('ui_peer_draft')\n        })\n      } else {\n        // console.log('Reset peer')\n        $scope.draftMessage.text = ''\n        $scope.$broadcast('ui_peer_draft')\n      }\n    }\n\n    function applyDraftAttachment (e, attachment) {\n      console.log(dT(), 'apply draft attach', attachment)\n      if (!attachment || !attachment._) {\n        return\n      }\n\n      if (attachment._ == 'share_url') {\n        var url = attachment.url\n        var text = attachment.text || ' '\n        forceDraft = $scope.curDialog.peer\n\n        $timeout(function () {\n          $scope.draftMessage.text = url + '\\n' + text\n          $scope.$broadcast('ui_peer_draft', {\n            customSelection: [\n              url + '\\n',\n              text,\n              ''\n            ]\n          })\n        }, 1000)\n      }\n      else if (attachment._ == 'fwd_messages') {\n        forceDraft = $scope.curDialog.peer\n        $timeout(function () {\n          $scope.draftMessage.fwdMessages = attachment.id\n          $scope.$broadcast('ui_peer_reply')\n        }, 100)\n      }\n      else if (attachment._ == 'inline_query') {\n        var mention = attachment.mention\n        var query = attachment.query\n        forceDraft = $scope.curDialog.peer\n\n        $timeout(function () {\n          $scope.draftMessage.text = mention + ' ' + query\n          $scope.$broadcast('ui_peer_draft', {\n            customSelection: [\n              mention + ' ' + query,\n              '',\n              ''\n            ]\n          })\n        }, 1000)\n      }\n    }\n\n    function replySelect (messageID, byUser) {\n      $scope.draftMessage.replyToMsgID = messageID\n      $scope.$broadcast('ui_peer_reply')\n      replyToMarkup = false\n\n      if (byUser) {\n        DraftsManager.changeDraft($scope.curDialog.peerID, {\n          text: $scope.draftMessage.text,\n          replyToMsgID: messageID\n        })\n      }\n    }\n\n    function replyClear (byUser) {\n      var mid = $scope.draftMessage.replyToMsgID\n      if (mid &&\n        $scope.historyState.replyKeyboard &&\n        $scope.historyState.replyKeyboard.mid == mid &&\n        !$scope.historyState.replyKeyboard.pFlags.hidden) {\n        $scope.historyState.replyKeyboard.pFlags.hidden = true\n        $scope.$broadcast('ui_keyboard_update')\n      }\n      delete $scope.draftMessage.replyToMsgID\n      $scope.$broadcast('ui_peer_reply')\n\n      if (byUser) {\n        DraftsManager.changeDraft($scope.curDialog.peerID, {\n          text: $scope.draftMessage.text\n        })\n      }\n    }\n\n    function fwdsClear () {\n      if ($scope.draftMessage.fwdMessages &&\n        $scope.draftMessage.fwdMessages.length) {\n        delete $scope.draftMessage.fwdMessages\n        $scope.$broadcast('ui_peer_reply')\n\n        if (forceDraft == $scope.curDialog.peer) {\n          forceDraft = false\n        }\n      }\n    }\n\n    function fwdsSend () {\n      if ($scope.draftMessage.fwdMessages &&\n        $scope.draftMessage.fwdMessages.length) {\n        var ids = $scope.draftMessage.fwdMessages.slice()\n        fwdsClear()\n        setZeroTimeout(function () {\n          AppMessagesManager.forwardMessages($scope.curDialog.peerID, ids)\n        })\n      }\n    }\n\n    function toggleSlash ($event) {\n      if ($scope.draftMessage.text &&\n        $scope.draftMessage.text.charAt(0) == '/') {\n        $scope.draftMessage.text = ''\n      } else {\n        $scope.draftMessage.text = '/'\n      }\n      $scope.$broadcast('ui_peer_draft', {focus: true})\n      return cancelEvent($event)\n    }\n\n    function updateReplyKeyboard () {\n      var peerID = $scope.curDialog.peerID\n      var replyKeyboard = AppMessagesManager.getReplyKeyboard(peerID)\n      if (replyKeyboard) {\n        replyKeyboard = AppMessagesManager.wrapReplyMarkup(replyKeyboard)\n      }\n      // console.log('update reply markup', peerID, replyKeyboard)\n      $scope.historyState.replyKeyboard = replyKeyboard\n\n      var addReplyMessage =\n      replyKeyboard &&\n        !replyKeyboard.pFlags.hidden &&\n        (replyKeyboard._ == 'replyKeyboardForceReply' ||\n        (replyKeyboard._ == 'replyKeyboardMarkup' && peerID < 0))\n\n      if (addReplyMessage) {\n        replySelect(replyKeyboard.mid)\n        replyToMarkup = true\n      }\n      else if (replyToMarkup) {\n        replyClear()\n      }\n      var enabled = replyKeyboard &&\n        !replyKeyboard.pFlags.hidden &&\n        replyKeyboard._ == 'replyKeyboardMarkup'\n      $scope.$broadcast('ui_keyboard_update', {enabled: enabled})\n      $scope.$emit('ui_panel_update', {blur: enabled})\n    }\n\n    function replyKeyboardToggle ($event) {\n      var replyKeyboard = $scope.historyState.replyKeyboard\n      if (replyKeyboard) {\n        replyKeyboard.pFlags.hidden = !replyKeyboard.pFlags.hidden\n        updateReplyKeyboard()\n      }\n      return cancelEvent($event)\n    }\n\n    function onMessageChange (newVal, prevVal, a) {\n      // console.log('ctrl text changed', newVal, prevVal);\n      if (newVal === '' && prevVal === '') {\n        return\n      }\n\n      if (newVal && newVal.length) {\n        if (!$scope.historyFilter.mediaType && !$scope.historyState.skipped) {\n          AppMessagesManager.readHistory($scope.curDialog.peerID)\n        }\n      }\n      if ($scope.curDialog.peerID) {\n        var replyToMsgID = $scope.draftMessage.replyToMsgID\n        if (replyToMsgID &&\n            $scope.historyState.replyKeyboard &&\n            $scope.historyState.replyKeyboard.mid == replyToMsgID) {\n          replyToMsgID = 0;\n        }\n        DraftsManager.changeDraft($scope.curDialog.peerID, {\n          text: newVal,\n          replyToMsgID: replyToMsgID\n        })\n        checkInlinePattern(newVal)\n      }\n    }\n\n    var inlineUsernameRegex = /^@([a-zA-Z\\d_]{1,32})( |)([\\s\\S]*)$/\n    var getInlineResultsTO = false\n    var lastInlineBot = false\n    var jump = 0\n\n    function checkInlinePattern (message) {\n      if (getInlineResultsTO) {\n        $timeout.cancel(getInlineResultsTO)\n      }\n      var curJump = ++jump\n      if (!message || !message.length) {\n        delete $scope.draftMessage.inlineProgress\n        $scope.$broadcast('inline_results', false)\n        return\n      }\n      var matches = message.match(inlineUsernameRegex)\n      if (!matches) {\n        delete $scope.draftMessage.inlineProgress\n        $scope.$broadcast('inline_results', false)\n        return\n      }\n      var username = matches[1]\n      var inlineBotPromise\n      $scope.draftMessage.inlineProgress = true\n      if (lastInlineBot && lastInlineBot.username == username) {\n        inlineBotPromise = $q.when(lastInlineBot)\n      } else {\n        inlineBotPromise = AppInlineBotsManager.resolveInlineMention(username)\n      }\n      inlineBotPromise.then(function (inlineBot) {\n        if (curJump != jump) {\n          return\n        }\n        lastInlineBot = inlineBot\n        $scope.$broadcast('inline_placeholder', {\n          prefix: '@' + username + matches[2],\n          placeholder: inlineBot.placeholder\n        })\n        if (getInlineResultsTO) {\n          $timeout.cancel(getInlineResultsTO)\n        }\n        getInlineResultsTO = $timeout(function () {\n          var query = RichTextProcessor.parseEmojis(matches[3])\n          AppInlineBotsManager.getInlineResults($scope.curDialog.peerID, inlineBot.id, query, inlineBot.geo, '').then(function (botResults) {\n            getInlineResultsTO = false\n            if (curJump != jump) {\n              return\n            }\n            botResults.text = message\n            $scope.$broadcast('inline_results', botResults)\n            delete $scope.draftMessage.inlineProgress\n          }, function () {\n            $scope.$broadcast('inline_results', false)\n            delete $scope.draftMessage.inlineProgress\n          })\n        }, 500)\n      }, function (error) {\n        $scope.$broadcast('inline_results', false)\n        delete $scope.draftMessage.inlineProgress\n      })\n    }\n\n    function onTyping () {\n      if (AppPeersManager.isChannel($scope.curDialog.peerID) &&\n        !AppPeersManager.isMegagroup($scope.curDialog.peerID)) {\n        return false\n      }\n      MtpApiManager.invokeApi('messages.setTyping', {\n        peer: AppPeersManager.getInputPeerByID($scope.curDialog.peerID),\n        action: {_: 'sendMessageTypingAction'}\n      })['catch'](function (error) {\n        error.handled = true\n      })\n    }\n\n    function onFilesSelected (newVal) {\n      if (!angular.isArray(newVal) || !newVal.length) {\n        return\n      }\n      var options = {\n        replyToMsgID: $scope.draftMessage.replyToMsgID,\n        isMedia: $scope.draftMessage.isMedia\n      }\n\n      delete $scope.draftMessage.replyToMsgID\n\n      if (newVal[0].lastModified) {\n        newVal.sort(function (file1, file2) {\n          return file1.lastModified - file2.lastModified\n        })\n      }\n\n      for (var i = 0; i < newVal.length; i++) {\n        AppMessagesManager.sendFile($scope.curDialog.peerID, newVal[i], options)\n        $scope.$broadcast('ui_message_send')\n      }\n      fwdsSend()\n    }\n\n    function onStickerSelected (newVal) {\n      if (!newVal) {\n        return\n      }\n\n      var doc = AppDocsManager.getDoc(newVal)\n      if (doc.id && doc.access_hash) {\n        var inputMedia = {\n          _: 'inputMediaDocument',\n          id: {\n            _: 'inputDocument',\n            id: doc.id,\n            access_hash: doc.access_hash\n          }\n        }\n        var options = {\n          replyToMsgID: $scope.draftMessage.replyToMsgID\n        }\n        AppMessagesManager.sendOther($scope.curDialog.peerID, inputMedia, options)\n        $scope.$broadcast('ui_message_send')\n\n        fwdsSend()\n        replyClear(true)\n      }\n      delete $scope.draftMessage.sticker\n    }\n\n    function onCommandSelected (command) {\n      if (!command) {\n        return\n      }\n      AppMessagesManager.sendText($scope.curDialog.peerID, command, {\n        clearDraft: true\n      })\n\n      if (forceDraft == $scope.curDialog.peer) {\n        forceDraft = false\n      }\n\n      fwdsSend()\n      resetDraft()\n      delete $scope.draftMessage.sticker\n      delete $scope.draftMessage.text\n      delete $scope.draftMessage.command\n      delete $scope.draftMessage.inlineResultID\n      $scope.$broadcast('ui_message_send')\n      $scope.$broadcast('ui_peer_draft')\n    }\n\n    function onInlineResultSelected (qID) {\n      if (!qID) {\n        return\n      }\n\n      if (qID.substr(0, 11) == '_switch_pm_') {\n        var botID = lastInlineBot.id\n        var startParam = qID.substr(11)\n        return AppInlineBotsManager.switchToPM($scope.curDialog.peerID, botID, startParam)\n      }\n\n      var options = {\n        replyToMsgID: $scope.draftMessage.replyToMsgID,\n        clearDraft: true\n      }\n      AppInlineBotsManager.sendInlineResult($scope.curDialog.peerID, qID, options)\n\n      if (forceDraft == $scope.curDialog.peer) {\n        forceDraft = false\n      }\n\n      fwdsSend()\n      resetDraft()\n      delete $scope.draftMessage.sticker\n      delete $scope.draftMessage.text\n      delete $scope.draftMessage.command\n      delete $scope.draftMessage.inlineResultID\n      $scope.$broadcast('ui_message_send')\n      $scope.$broadcast('ui_peer_draft')\n    }\n  })\n\n  .controller('AppLangSelectController', function ($scope, _, Storage, ErrorService, AppRuntimeManager) {\n    $scope.supportedLocales = Config.I18n.supported\n    $scope.langNames = Config.I18n.languages\n    $scope.curLocale = Config.I18n.locale\n    $scope.form = {locale: Config.I18n.locale}\n\n    $scope.localeSelect = function localeSelect (newLocale) {\n      newLocale = newLocale || $scope.form.locale\n      if ($scope.curLocale !== newLocale) {\n        ErrorService.confirm({type: 'APPLY_LANG_WITH_RELOAD'}).then(function () {\n          Storage.set({i18n_locale: newLocale}).then(function () {\n            AppRuntimeManager.reload()\n          })\n        }, function () {\n          $scope.form.locale = $scope.curLocale\n        })\n      }\n    }\n  })\n\n  .controller('AppFooterController', function ($scope, LayoutSwitchService) {\n    $scope.switchLayout = function (mobile) {\n      LayoutSwitchService.switchLayout(mobile)\n    }\n  })\n\n  .controller('PhotoModalController', function ($q, $scope, $rootScope, $modalInstance, AppPhotosManager, AppMessagesManager, AppPeersManager, AppWebPagesManager, PeersSelectService, ErrorService) {\n    $scope.photo = AppPhotosManager.wrapForFull($scope.photoID)\n    $scope.nav = {}\n\n    $scope.download = function () {\n      AppPhotosManager.downloadPhoto($scope.photoID)\n    }\n\n    if (!$scope.messageID) {\n      return\n    }\n\n    $scope.forward = function () {\n      var messageID = $scope.messageID\n\n      PeersSelectService.selectPeer({canSend: true}).then(function (peerString) {\n        $rootScope.$broadcast('history_focus', {\n          peerString: peerString,\n          attachment: {\n            _: 'fwd_messages',\n            id: [messageID]\n          }\n        })\n      })\n    }\n\n    $scope.goToMessage = function () {\n      var messageID = $scope.messageID\n      var peerID = AppMessagesManager.getMessagePeer(AppMessagesManager.getMessage(messageID))\n      var peerString = AppPeersManager.getPeerString(peerID)\n      $modalInstance.dismiss()\n      $rootScope.$broadcast('history_focus', {peerString: peerString, messageID: messageID})\n    }\n\n    $scope['delete'] = function () {\n      var messageID = $scope.messageID\n      ErrorService.confirm({type: 'MESSAGE_DELETE'}).then(function () {\n        AppMessagesManager.deleteMessages([messageID])\n      })\n    }\n\n    var peerID = AppMessagesManager.getMessagePeer(AppMessagesManager.getMessage($scope.messageID))\n    var inputPeer = AppPeersManager.getInputPeerByID(peerID)\n    var inputQuery = ''\n    var inputFilter = {_: 'inputMessagesFilterPhotos'}\n    var list = [$scope.messageID]\n    var preloaded = {}\n    var maxID = $scope.messageID\n    var hasMore = true\n\n    preloaded[$scope.messageID] = true\n\n    updatePrevNext()\n\n    function preloadPhotos (sign) {\n      // var preloadOffsets = sign < 0 ? [-1,-2,1,-3,2] : [1,2,-1,3,-2]\n      var preloadOffsets = sign < 0 ? [-1, -2] : [1, 2]\n      var index = list.indexOf($scope.messageID)\n      angular.forEach(preloadOffsets, function (offset) {\n        var messageID = list[index + offset]\n        if (messageID !== undefined && preloaded[messageID] === undefined) {\n          preloaded[messageID] = true\n          var message = AppMessagesManager.getMessage(messageID)\n          var photoID = message.media.photo.id\n          AppPhotosManager.preloadPhoto(photoID)\n        }\n      })\n    }\n\n    function updatePrevNext (count) {\n      var index = list.indexOf($scope.messageID)\n      if (hasMore) {\n        if (count) {\n          $scope.count = Math.max(count, list.length)\n        }\n      } else {\n        $scope.count = list.length\n      }\n      $scope.pos = $scope.count - index\n      $scope.nav.hasNext = index > 0\n      $scope.nav.hasPrev = hasMore || index < list.length - 1\n      $scope.canForward = $scope.canDelete = $scope.messageID > 0\n    }\n\n    $scope.nav.next = function () {\n      if (!$scope.nav.hasNext) {\n        return false\n      }\n\n      movePosition(-1)\n    }\n\n    $scope.nav.prev = function () {\n      if (!$scope.nav.hasPrev) {\n        return false\n      }\n      movePosition(+1)\n    }\n\n    $scope.$on('history_delete', function (e, historyUpdate) {\n      if (historyUpdate.peerID == peerID) {\n        if (historyUpdate.msgs[$scope.messageID]) {\n          if ($scope.nav.hasNext) {\n            $scope.nav.next()\n          } else if ($scope.nav.hasPrev) {\n            $scope.nav.prev()\n          } else {\n            return $modalInstance.dismiss()\n          }\n        }\n        var newList = []\n        for (var i = 0; i < list.length; i++) {\n          if (!historyUpdate.msgs[list[i]]) {\n            newList.push(list[i])\n          }\n        }\n        list = newList\n      }\n    })\n\n    if ($scope.webpageID) {\n      $scope.webpage = AppWebPagesManager.wrapForHistory($scope.webpageID)\n      return\n    }\n\n    AppMessagesManager.getSearch(peerID, inputQuery, inputFilter, 0, 1000).then(function (searchCachedResult) {\n      if (searchCachedResult.history.indexOf($scope.messageID) >= 0) {\n        list = searchCachedResult.history\n        maxID = list[list.length - 1]\n\n        updatePrevNext()\n        preloadPhotos(+1)\n      }\n      loadMore()\n    }, loadMore)\n\n    var jump = 0\n    function movePosition (sign) {\n      var curIndex = list.indexOf($scope.messageID)\n      var index = curIndex >= 0 ? curIndex + sign : 0\n      var curJump = ++jump\n\n      var promise = index >= list.length ? loadMore() : $q.when()\n      promise.then(function () {\n        if (curJump != jump) {\n          return\n        }\n\n        var messageID = list[index]\n        var message = AppMessagesManager.getMessage(messageID)\n        var photoID = message && message.media && (message.media.photo && message.media.photo.id || message.media.webpage && message.media.webpage.photo && message.media.webpage.photo.id)\n        if (!photoID) {\n          console.error('Invalid photo message', index, list, messageID, message)\n          return\n        }\n\n        $scope.messageID = messageID\n        $scope.photoID = photoID\n        $scope.photo = AppPhotosManager.wrapForFull($scope.photoID)\n\n        preloaded[$scope.messageID] = true\n\n        updatePrevNext()\n\n        if (sign > 0 && hasMore && list.indexOf(messageID) + 1 >= list.length) {\n          loadMore()\n        } else {\n          preloadPhotos(sign)\n        }\n      })\n    }\n\n    var loadingPromise = false\n    function loadMore () {\n      if (loadingPromise) return loadingPromise\n\n      return loadingPromise = AppMessagesManager.getSearch(peerID, inputQuery, inputFilter, maxID).then(function (searchResult) {\n        if (searchResult.history.length) {\n          maxID = searchResult.history[searchResult.history.length - 1]\n          list = list.concat(searchResult.history)\n          hasMore = list.length < searchResult.count\n        } else {\n          hasMore = false\n        }\n\n        updatePrevNext(searchResult.count)\n        loadingPromise = false\n\n        if (searchResult.history.length) {\n          return $q.reject()\n        }\n\n        preloadPhotos(+1)\n      })\n    }\n  })\n\n  .controller('UserpicModalController', function ($q, $scope, $rootScope, $modalInstance, MtpApiManager, AppPhotosManager, AppUsersManager, AppPeersManager, AppMessagesManager, ApiUpdatesManager, PeersSelectService, ErrorService) {\n    $scope.photo = AppPhotosManager.wrapForFull($scope.photoID)\n    $scope.photo.thumb = {\n      location: AppPhotosManager.choosePhotoSize($scope.photo, 0, 0).location\n    }\n\n    $scope.nav = {}\n    $scope.canForward = true\n\n    var list = [$scope.photoID]\n    var maxID = $scope.photoID\n    var preloaded = {}\n    var myID = 0\n    var hasMore = true\n\n    updatePrevNext()\n\n    AppPhotosManager.getUserPhotos($scope.userID, 0, 1000).then(function (userpicCachedResult) {\n      if (userpicCachedResult.photos.indexOf($scope.photoID) >= 0) {\n        list = userpicCachedResult.photos\n        maxID = list[list.length - 1]\n      }\n      hasMore = list.length < userpicCachedResult.count\n      updatePrevNext()\n    })\n\n    MtpApiManager.getUserID().then(function (id) {\n      myID = id\n      $scope.canDelete = $scope.photo.user_id == myID\n    })\n\n    var jump = 0\n    function movePosition (sign, deleteCurrent) {\n      var curIndex = list.indexOf($scope.photoID)\n      var index = curIndex >= 0 ? curIndex + sign : 0\n      var curJump = ++jump\n\n      var promise = index >= list.length ? loadMore() : $q.when()\n      promise.then(function () {\n        if (curJump != jump) {\n          return\n        }\n\n        $scope.photoID = list[index]\n        $scope.photo = AppPhotosManager.wrapForFull($scope.photoID)\n        $scope.photo.thumb = {\n          location: AppPhotosManager.choosePhotoSize($scope.photo, 0, 0).location\n        }\n\n        var newCount\n        if (deleteCurrent) {\n          list.splice(curIndex, 1)\n          newCount = $scope.count - 1\n        }\n\n        updatePrevNext(newCount)\n\n        preloaded[$scope.photoID] = true\n\n        updatePrevNext()\n\n        if (sign > 0 && hasMore && list.indexOf($scope.photoID) + 1 >= list.length) {\n          loadMore()\n        } else {\n          preloadPhotos(sign)\n        }\n      })\n    }\n\n    function preloadPhotos (sign) {\n      var preloadOffsets = sign < 0 ? [-1, -2] : [1, 2]\n      var index = list.indexOf($scope.photoID)\n      angular.forEach(preloadOffsets, function (offset) {\n        var photoID = list[index + offset]\n        if (photoID !== undefined && preloaded[photoID] === undefined) {\n          preloaded[photoID] = true\n          AppPhotosManager.preloadPhoto(photoID)\n        }\n      })\n    }\n\n    var loadingPromise = false\n    function loadMore () {\n      if (loadingPromise) return loadingPromise\n\n      return loadingPromise = AppPhotosManager.getUserPhotos($scope.userID, maxID).then(function (userpicResult) {\n        if (userpicResult.photos.length) {\n          maxID = userpicResult.photos[userpicResult.photos.length - 1]\n          list = list.concat(userpicResult.photos)\n\n          hasMore = list.length < userpicResult.count\n        } else {\n          hasMore = false\n        }\n\n        updatePrevNext(userpicResult.count)\n        loadingPromise = false\n\n        if (userpicResult.photos.length) {\n          return $q.reject()\n        }\n\n        preloadPhotos(+1)\n      })\n    }\n\n    function updatePrevNext (count) {\n      var index = list.indexOf($scope.photoID)\n      if (hasMore) {\n        if (count) {\n          $scope.count = Math.max(count, list.length)\n        }\n      } else {\n        $scope.count = list.length\n      }\n      $scope.pos = $scope.count - index\n      $scope.nav.hasNext = index > 0\n      $scope.nav.hasPrev = hasMore || index < list.length - 1\n      $scope.canDelete = $scope.photo.user_id == myID\n    }\n\n    $scope.nav.next = function () {\n      if (!$scope.nav.hasNext) {\n        return false\n      }\n\n      movePosition(-1)\n    }\n\n    $scope.nav.prev = function () {\n      if (!$scope.nav.hasPrev) {\n        return false\n      }\n      movePosition(+1)\n    }\n\n    $scope.forward = function () {\n      PeersSelectService.selectPeer({confirm_type: 'FORWARD_PEER', canSend: true}).then(function (peerString) {\n        var peerID = AppPeersManager.getPeerID(peerString)\n        AppMessagesManager.sendOther(peerID, {\n          _: 'inputMediaPhoto',\n          id: {\n            _: 'inputPhoto',\n            id: $scope.photoID,\n            access_hash: $scope.photo.access_hash\n          }\n        })\n        $rootScope.$broadcast('history_focus', {peerString: peerString})\n      })\n    }\n\n    $scope['delete'] = function () {\n      var photoID = $scope.photoID\n      var myUser = AppUsersManager.getUser(myID)\n      var onDeleted = function () {\n        if (!$scope.nav.hasNext && !$scope.nav.hasPrev) {\n          return $modalInstance.dismiss()\n        }\n        movePosition($scope.nav.hasNext ? -1 : +1, true)\n      }\n\n      ErrorService.confirm({type: 'PHOTO_DELETE'}).then(function () {\n        if (myUser && myUser.photo && myUser.photo.photo_id == photoID) {\n          MtpApiManager.invokeApi('photos.updateProfilePhoto', {\n            id: {_: 'inputPhotoEmpty'}\n          }).then(function (updateResult) {\n            ApiUpdatesManager.processUpdateMessage({\n              _: 'updateShort',\n              update: {\n                _: 'updateUserPhoto',\n                user_id: myID,\n                date: tsNow(true),\n                photo: updateResult,\n                previous: true\n              }\n            })\n            onDeleted()\n          })\n        }else {\n          MtpApiManager.invokeApi('photos.deletePhotos', {\n            id: [{_: 'inputPhoto', id: photoID, access_hash: 0}]\n          }).then(onDeleted)\n        }\n      })\n    }\n\n    $scope.download = function () {\n      AppPhotosManager.downloadPhoto($scope.photoID)\n    }\n  })\n\n  .controller('ChatpicModalController', function ($q, $scope, $rootScope, $modalInstance, MtpApiManager, AppPhotosManager, AppChatsManager, AppPeersManager, AppMessagesManager, ApiUpdatesManager, PeersSelectService, ErrorService) {\n    $scope.photo = AppPhotosManager.wrapForFull($scope.photoID)\n    $scope.photo.thumb = {\n      location: AppPhotosManager.choosePhotoSize($scope.photo, 0, 0).location\n    }\n\n    var chat = AppChatsManager.getChat($scope.chatID)\n    var isChannel = AppChatsManager.isChannel($scope.chatID)\n\n    $scope.canForward = true\n    $scope.canDelete = isChannel ? chat.pFlags.creator : true\n\n    $scope.forward = function () {\n      PeersSelectService.selectPeer({confirm_type: 'FORWARD_PEER', canSend: true}).then(function (peerString) {\n        var peerID = AppPeersManager.getPeerID(peerString)\n        AppMessagesManager.sendOther(peerID, {\n          _: 'inputMediaPhoto',\n          id: {\n            _: 'inputPhoto',\n            id: $scope.photoID,\n            access_hash: $scope.photo.access_hash\n          }\n        })\n        $rootScope.$broadcast('history_focus', {peerString: peerString})\n      })\n    }\n\n    $scope['delete'] = function () {\n      ErrorService.confirm({type: 'PHOTO_DELETE'}).then(function () {\n        $scope.photo.updating = true\n        var apiPromise\n        if (AppChatsManager.isChannel($scope.chatID)) {\n          apiPromise = MtpApiManager.invokeApi('channels.editPhoto', {\n            channel: AppChatsManager.getChannelInput($scope.chatID),\n            photo: {_: 'inputChatPhotoEmpty'}\n          })\n        } else {\n          apiPromise = MtpApiManager.invokeApi('messages.editChatPhoto', {\n            chat_id: AppChatsManager.getChatInput($scope.chatID),\n            photo: {_: 'inputChatPhotoEmpty'}\n          })\n        }\n        apiPromise.then(function (updates) {\n          ApiUpdatesManager.processUpdateMessage(updates)\n          $modalInstance.dismiss()\n          $rootScope.$broadcast('history_focus', {peerString: AppChatsManager.getChatString($scope.chatID)})\n        })['finally'](function () {\n          $scope.photo.updating = false\n        })\n      })\n    }\n\n    $scope.download = function () {\n      AppPhotosManager.downloadPhoto($scope.photoID)\n    }\n  })\n\n  .controller('VideoModalController', function ($scope, $rootScope, $modalInstance, PeersSelectService, AppMessagesManager, AppDocsManager, AppPeersManager, ErrorService) {\n    $scope.video = AppDocsManager.wrapVideoForFull($scope.docID)\n\n    $scope.progress = {enabled: false}\n    $scope.player = {}\n\n    $scope.forward = function () {\n      var messageID = $scope.messageID\n      PeersSelectService.selectPeer({canSend: true}).then(function (peerString) {\n        $rootScope.$broadcast('history_focus', {\n          peerString: peerString,\n          attachment: {\n            _: 'fwd_messages',\n            id: [messageID]\n          }\n        })\n      })\n    }\n\n    $scope['delete'] = function () {\n      var messageID = $scope.messageID\n      ErrorService.confirm({type: 'MESSAGE_DELETE'}).then(function () {\n        AppMessagesManager.deleteMessages([messageID])\n      })\n    }\n\n    $scope.download = function () {\n      AppDocsManager.saveDocFile($scope.docID)\n    }\n\n    $scope.$on('history_delete', function (e, historyUpdate) {\n      if (historyUpdate.msgs[$scope.messageID]) {\n        $modalInstance.dismiss()\n      }\n    })\n  })\n\n  .controller('DocumentModalController', function ($scope, $rootScope, $modalInstance, PeersSelectService, AppMessagesManager, AppDocsManager, AppPeersManager, ErrorService) {\n    $scope.document = AppDocsManager.wrapForHistory($scope.docID)\n\n    $scope.forward = function () {\n      var messageID = $scope.messageID\n      PeersSelectService.selectPeer({canSend: true}).then(function (peerString) {\n        $rootScope.$broadcast('history_focus', {\n          peerString: peerString,\n          attachment: {\n            _: 'fwd_messages',\n            id: [messageID]\n          }\n        })\n      })\n    }\n\n    $scope['delete'] = function () {\n      var messageID = $scope.messageID\n      ErrorService.confirm({type: 'MESSAGE_DELETE'}).then(function () {\n        AppMessagesManager.deleteMessages([messageID])\n      })\n    }\n\n    $scope.download = function () {\n      AppDocsManager.saveDocFile($scope.docID)\n    }\n\n    $scope.$on('history_delete', function (e, historyUpdate) {\n      if (historyUpdate.msgs[$scope.messageID]) {\n        $modalInstance.dismiss()\n      }\n    })\n  })\n\n  .controller('EmbedModalController', function ($q, $scope, $rootScope, $modalInstance, AppPhotosManager, AppMessagesManager, AppPeersManager, AppWebPagesManager, PeersSelectService, ErrorService) {\n    $scope.webpage = AppWebPagesManager.wrapForFull($scope.webpageID)\n\n    $scope.nav = {}\n\n    $scope.forward = function () {\n      var messageID = $scope.messageID\n      PeersSelectService.selectPeer({canSend: true}).then(function (peerString) {\n        $rootScope.$broadcast('history_focus', {\n          peerString: peerString,\n          attachment: {\n            _: 'fwd_messages',\n            id: [messageID]\n          }\n        })\n      })\n    }\n\n    $scope['delete'] = function () {\n      var messageID = $scope.messageID\n      ErrorService.confirm({type: 'MESSAGE_DELETE'}).then(function () {\n        AppMessagesManager.deleteMessages([messageID])\n      })\n    }\n  })\n\n  .controller('GameModalController', function ($q, $scope, $rootScope, $modalInstance, AppPhotosManager, AppMessagesManager, AppPeersManager, AppGamesManager, PeersSelectService, ErrorService) {\n\n    $scope.game = AppGamesManager.wrapForFull($scope.gameID, $scope.messageID, $scope.embedUrl)\n    var messageID = $scope.messageID\n\n    var message = AppMessagesManager.getMessage(messageID)\n    $scope.botID = message.viaBotID || message.fromID\n\n    $scope.nav = {}\n\n    $scope.forward = function (withMyScore) {\n      PeersSelectService.selectPeer({canSend: true, confirm_type: 'INVITE_TO_GAME'}).then(function (peerString) {\n        var peerID = AppPeersManager.getPeerID(peerString)\n        AppMessagesManager.forwardMessages(peerID, [messageID], {\n          withMyScore: withMyScore\n        }).then(function () {\n          $rootScope.$broadcast('history_focus', {\n            peerString: peerString\n          })\n        })\n      })\n    }\n\n    $scope.$on('game_frame_event', function (e, eventData) {\n      if (eventData.eventType == 'share_score') {\n        $scope.forward(true)\n      }\n    })\n  })\n\n  .controller('UserModalController', function ($scope, $location, $rootScope, $modalInstance, AppProfileManager, $modal, AppUsersManager, MtpApiManager, NotificationsManager, AppPhotosManager, AppMessagesManager, AppPeersManager, PeersSelectService, ErrorService) {\n    var peerString = AppUsersManager.getUserString($scope.userID)\n\n    $scope.user = AppUsersManager.getUser($scope.userID)\n    $scope.blocked = false\n\n    $scope.settings = {notifications: true}\n\n    AppProfileManager.getProfile($scope.userID, $scope.override).then(function (userFull) {\n      $scope.blocked = userFull.pFlags.blocked\n      $scope.bot_info = userFull.bot_info\n      $scope.rAbout = userFull.rAbout\n\n      NotificationsManager.getPeerMuted($scope.userID).then(function (muted) {\n        $scope.settings.notifications = !muted\n\n        $scope.$watch('settings.notifications', function (newValue, oldValue) {\n          if (newValue === oldValue) {\n            return false\n          }\n          NotificationsManager.getPeerSettings($scope.userID).then(function (settings) {\n            settings.mute_until = newValue ? 0 : 2000000000\n            NotificationsManager.updatePeerSettings($scope.userID, settings)\n          })\n        })\n      })\n    })\n\n    $scope.goToHistory = function () {\n      $rootScope.$broadcast('history_focus', {peerString: peerString})\n    }\n\n    $scope.flushHistory = function (justClear) {\n      ErrorService.confirm({type: justClear ? 'HISTORY_FLUSH' : 'HISTORY_FLUSH_AND_DELETE'}).then(function () {\n        AppMessagesManager.flushHistory($scope.userID, justClear).then(function () {\n          if (justClear) {\n            $scope.goToHistory()\n          } else {\n            $modalInstance.close()\n            $location.url('/im')\n          }\n        })\n      })\n    }\n\n    $scope.importContact = function (edit) {\n      var scope = $rootScope.$new()\n      scope.importContact = {\n        phone: $scope.user.phone,\n        first_name: $scope.user.first_name,\n        last_name: $scope.user.last_name\n      }\n\n      $modal.open({\n        templateUrl: templateUrl(edit ? 'edit_contact_modal' : 'import_contact_modal'),\n        controller: 'ImportContactModalController',\n        windowClass: 'md_simple_modal_window mobile_modal',\n        scope: scope\n      }).result.then(function (foundUserID) {\n        if ($scope.userID == foundUserID) {\n          $scope.user = AppUsersManager.getUser($scope.userID)\n        }\n      })\n    }\n\n    $scope.deleteContact = function () {\n      AppUsersManager.deleteContacts([$scope.userID]).then(function () {\n        $scope.user = AppUsersManager.getUser($scope.userID)\n      })\n    }\n\n    $scope.inviteToGroup = function () {\n      PeersSelectService.selectPeer({\n        confirm_type: 'INVITE_TO_GROUP',\n        noUsers: true\n      }).then(function (peerString) {\n        var peerID = AppPeersManager.getPeerID(peerString)\n        var chatID = peerID < 0 ? -peerID : 0\n        AppMessagesManager.startBot($scope.user.id, chatID).then(function () {\n          $rootScope.$broadcast('history_focus', {peerString: peerString})\n        })\n      })\n    }\n\n    $scope.sendCommand = function (command) {\n      AppMessagesManager.sendText($scope.userID, '/' + command)\n      $rootScope.$broadcast('history_focus', {\n        peerString: peerString\n      })\n    }\n\n    $scope.toggleBlock = function (block) {\n      MtpApiManager.invokeApi(block ? 'contacts.block' : 'contacts.unblock', {\n        id: AppUsersManager.getUserInput($scope.userID)\n      }).then(function () {\n        $scope.blocked = block\n      })\n    }\n\n    $scope.shareContact = function () {\n      PeersSelectService.selectPeer({confirm_type: 'SHARE_CONTACT_PEER', canSend: true}).then(function (peerString) {\n        var peerID = AppPeersManager.getPeerID(peerString)\n        AppMessagesManager.sendOther(peerID, {\n          _: 'inputMediaContact',\n          phone_number: $scope.user.phone,\n          first_name: $scope.user.first_name,\n          last_name: $scope.user.last_name,\n          user_id: $scope.user.id\n        })\n        $rootScope.$broadcast('history_focus', {peerString: peerString})\n      })\n    }\n  })\n\n  .controller('ChatModalController', function ($scope, $modalInstance, $location, $timeout, $rootScope, $modal, AppUsersManager, AppChatsManager, AppProfileManager, AppPhotosManager, MtpApiManager, MtpApiFileManager, NotificationsManager, AppMessagesManager, AppPeersManager, ApiUpdatesManager, ContactsSelectService, ErrorService) {\n    $scope.chatFull = AppChatsManager.wrapForFull($scope.chatID, {})\n    $scope.settings = {notifications: true}\n\n    $scope.maxParticipants = 200\n\n    AppProfileManager.getChatFull($scope.chatID).then(function (chatFull) {\n      $scope.chatFull = AppChatsManager.wrapForFull($scope.chatID, chatFull)\n      $scope.$broadcast('ui_height')\n\n      $scope.needMigrate = $scope.chatFull &&\n        $scope.chatFull.participants &&\n        $scope.chatFull.participants.participants &&\n        $scope.chatFull.participants.participants.length >= 200\n\n      if (Config.Modes.test || Config.Modes.debug) {\n        $scope.needMigrate = true\n      }\n\n      NotificationsManager.savePeerSettings(-$scope.chatID, chatFull.notify_settings)\n\n      NotificationsManager.getPeerMuted(-$scope.chatID).then(function (muted) {\n        $scope.settings.notifications = !muted\n\n        $scope.$watch('settings.notifications', function (newValue, oldValue) {\n          if (newValue === oldValue) {\n            return false\n          }\n          NotificationsManager.getPeerSettings(-$scope.chatID).then(function (settings) {\n            if (newValue) {\n              settings.mute_until = 0\n            } else {\n              settings.mute_until = 2000000000\n            }\n            NotificationsManager.updatePeerSettings(-$scope.chatID, settings)\n          })\n        })\n      })\n    })\n\n    function onChatUpdated (updates) {\n      ApiUpdatesManager.processUpdateMessage(updates)\n      $rootScope.$broadcast('history_focus', {peerString: $scope.chatFull.peerString})\n    }\n\n    $scope.leaveGroup = function () {\n      ErrorService.confirm({type: 'HISTORY_LEAVE_AND_FLUSH'}).then(function () {\n        MtpApiManager.invokeApi('messages.deleteChatUser', {\n          chat_id: AppChatsManager.getChatInput($scope.chatID),\n          user_id: {_: 'inputUserSelf'}\n        }).then(function (updates) {\n          ApiUpdatesManager.processUpdateMessage(updates)\n          AppMessagesManager.flushHistory(-$scope.chatID).then(function () {\n            $modalInstance.close()\n            $location.url('/im')\n          })\n        })\n      })\n    }\n\n    $scope.inviteToGroup = function () {\n      var disabled = []\n      angular.forEach($scope.chatFull.participants.participants, function (participant) {\n        disabled.push(participant.user_id)\n      })\n\n      ContactsSelectService.selectContacts({disabled: disabled}).then(function (userIDs) {\n        angular.forEach(userIDs, function (userID) {\n          MtpApiManager.invokeApi('messages.addChatUser', {\n            chat_id: AppChatsManager.getChatInput($scope.chatID),\n            user_id: AppUsersManager.getUserInput(userID),\n            fwd_limit: 100\n          }).then(function (updates) {\n            ApiUpdatesManager.processUpdateMessage(updates)\n          })\n        })\n\n        $rootScope.$broadcast('history_focus', {peerString: $scope.chatFull.peerString})\n      })\n    }\n\n    $scope.migrateToSuperGroup = function () {\n      ErrorService.confirm({type: 'SUPERGROUP_MIGRATE'}).then(function () {\n        MtpApiManager.invokeApi('messages.migrateChat', {\n          chat_id: AppChatsManager.getChatInput($scope.chatID)\n        }).then(onChatUpdated)\n      })\n    }\n\n    $scope.kickFromGroup = function (userID) {\n      MtpApiManager.invokeApi('messages.deleteChatUser', {\n        chat_id: AppChatsManager.getChatInput($scope.chatID),\n        user_id: AppUsersManager.getUserInput(userID)\n      }).then(onChatUpdated)\n    }\n\n    $scope.flushHistory = function (justClear) {\n      ErrorService.confirm({type: justClear ? 'HISTORY_FLUSH' : 'HISTORY_FLUSH_AND_DELETE'}).then(function () {\n        AppMessagesManager.flushHistory(-$scope.chatID, justClear).then(function () {\n          if (justClear) {\n            $rootScope.$broadcast('history_focus', {peerString: $scope.chatFull.peerString})\n          } else {\n            $modalInstance.close()\n            $location.url('/im')\n          }\n        })\n      })\n    }\n\n    $scope.inviteViaLink = function () {\n      var scope = $rootScope.$new()\n      scope.chatID = $scope.chatID\n\n      $modal.open({\n        templateUrl: templateUrl('chat_invite_link_modal'),\n        controller: 'ChatInviteLinkModalController',\n        scope: scope,\n        windowClass: 'md_simple_modal_window'\n      })\n    }\n\n    $scope.photo = {}\n\n    $scope.$watch('photo.file', onPhotoSelected)\n\n    function onPhotoSelected (photo) {\n      if (!photo || !photo.type || photo.type.indexOf('image') !== 0) {\n        return\n      }\n      $scope.photo.updating = true\n      MtpApiFileManager.uploadFile(photo).then(function (inputFile) {\n        return MtpApiManager.invokeApi('messages.editChatPhoto', {\n          chat_id: AppChatsManager.getChatInput($scope.chatID),\n          photo: {\n            _: 'inputChatUploadedPhoto',\n            file: inputFile\n          }\n        }).then(onChatUpdated)\n      })['finally'](function () {\n        $scope.photo.updating = false\n      })\n    }\n\n    $scope.deletePhoto = function () {\n      $scope.photo.updating = true\n      MtpApiManager.invokeApi('messages.editChatPhoto', {\n        chat_id: AppChatsManager.getChatInput($scope.chatID),\n        photo: {_: 'inputChatPhotoEmpty'}\n      }).then(onChatUpdated)['finally'](function () {\n        $scope.photo.updating = false\n      })\n    }\n\n    $scope.editTitle = function () {\n      var scope = $rootScope.$new()\n      scope.chatID = $scope.chatID\n\n      $modal.open({\n        templateUrl: templateUrl('chat_edit_modal'),\n        controller: 'ChatEditModalController',\n        scope: scope,\n        windowClass: 'md_simple_modal_window mobile_modal'\n      })\n    }\n\n    $scope.hasRights = function (action) {\n      return AppChatsManager.hasRights($scope.chatID, action)\n    }\n  })\n\n  .controller('ChannelModalController', function ($scope, $timeout, $rootScope, $modal, AppUsersManager, AppChatsManager, AppProfileManager, AppPhotosManager, MtpApiManager, MtpApiFileManager, NotificationsManager, AppMessagesManager, AppPeersManager, ApiUpdatesManager, ContactsSelectService, ErrorService) {\n    $scope.chatFull = AppChatsManager.wrapForFull($scope.chatID, {})\n    $scope.settings = {notifications: true}\n    $scope.isMegagroup = AppChatsManager.isMegagroup($scope.chatID)\n\n    AppProfileManager.getChannelFull($scope.chatID, true).then(function (chatFull) {\n      $scope.chatFull = AppChatsManager.wrapForFull($scope.chatID, chatFull)\n      $scope.$broadcast('ui_height')\n\n      NotificationsManager.savePeerSettings(-$scope.chatID, chatFull.notify_settings)\n\n      NotificationsManager.getPeerMuted(-$scope.chatID).then(function (muted) {\n        $scope.settings.notifications = !muted\n\n        $scope.$watch('settings.notifications', function (newValue, oldValue) {\n          if (newValue === oldValue) {\n            return false\n          }\n          NotificationsManager.getPeerSettings(-$scope.chatID).then(function (settings) {\n            if (newValue) {\n              settings.mute_until = 0\n            } else {\n              settings.mute_until = 2000000000\n            }\n            NotificationsManager.updatePeerSettings(-$scope.chatID, settings)\n          })\n        })\n      })\n\n      if ($scope.chatFull.chat &&\n        $scope.chatFull.chat.pFlags.creator &&\n        $scope.chatFull.exported_invite &&\n        $scope.chatFull.exported_invite._ == 'chatInviteEmpty') {\n        AppProfileManager.getChatInviteLink($scope.chatID, true).then(function (link) {\n          $scope.chatFull.exported_invite = {_: 'chatInviteExported', link: link}\n        })\n      }\n    })\n\n    function onChatUpdated (updates) {\n      ApiUpdatesManager.processUpdateMessage(updates)\n      $rootScope.$broadcast('history_focus', {peerString: $scope.chatFull.peerString})\n    }\n\n    $scope.leaveChannel = function () {\n      return ErrorService.confirm({type: $scope.isMegagroup ? 'MEGAGROUP_LEAVE' : 'CHANNEL_LEAVE'}).then(function () {\n        MtpApiManager.invokeApi('channels.leaveChannel', {\n          channel: AppChatsManager.getChannelInput($scope.chatID)\n        }).then(onChatUpdated)\n      })\n    }\n\n    $scope.deleteChannel = function () {\n      return ErrorService.confirm({type: $scope.isMegagroup ? 'MEGAGROUP_DELETE' : 'CHANNEL_DELETE'}).then(function () {\n        MtpApiManager.invokeApi('channels.deleteChannel', {\n          channel: AppChatsManager.getChannelInput($scope.chatID)\n        }).then(onChatUpdated)\n      })\n    }\n\n    $scope.joinChannel = function () {\n      MtpApiManager.invokeApi('channels.joinChannel', {\n        channel: AppChatsManager.getChannelInput($scope.chatID)\n      }).then(onChatUpdated)\n    }\n\n    $scope.inviteToChannel = function () {\n      var disabled = []\n      angular.forEach(($scope.chatFull.participants || {}).participants || [], function (participant) {\n        disabled.push(participant.user_id)\n      })\n\n      ContactsSelectService.selectContacts({disabled: disabled}).then(function (userIDs) {\n        var inputUsers = []\n        angular.forEach(userIDs, function (userID) {\n          inputUsers.push(AppUsersManager.getUserInput(userID))\n        })\n        MtpApiManager.invokeApi('channels.inviteToChannel', {\n          channel: AppChatsManager.getChannelInput($scope.chatID),\n          users: inputUsers\n        }).then(onChatUpdated)\n      })\n    }\n\n    $scope.kickFromChannel = function (userID) {\n      MtpApiManager.invokeApi('channels.kickFromChannel', {\n        channel: AppChatsManager.getChannelInput($scope.chatID),\n        user_id: AppUsersManager.getUserInput(userID),\n        kicked: true\n      }).then(onChatUpdated)\n    }\n\n    $scope.shareLink = function ($event) {\n      var scope = $rootScope.$new()\n      scope.chatID = $scope.chatID\n\n      $modal.open({\n        templateUrl: templateUrl('chat_invite_link_modal'),\n        controller: 'ChatInviteLinkModalController',\n        scope: scope,\n        windowClass: 'md_simple_modal_window'\n      })\n\n      return cancelEvent($event)\n    }\n\n    $scope.photo = {}\n\n    $scope.$watch('photo.file', onPhotoSelected)\n\n    function onPhotoSelected (photo) {\n      if (!photo || !photo.type || photo.type.indexOf('image') !== 0) {\n        return\n      }\n      $scope.photo.updating = true\n      MtpApiFileManager.uploadFile(photo).then(function (inputFile) {\n        return MtpApiManager.invokeApi('channels.editPhoto', {\n          channel: AppChatsManager.getChannelInput($scope.chatID),\n          photo: {\n            _: 'inputChatUploadedPhoto',\n            file: inputFile\n          }\n        }).then(onChatUpdated)\n      })['finally'](function () {\n        $scope.photo.updating = false\n      })\n    }\n\n    $scope.deletePhoto = function () {\n      $scope.photo.updating = true\n      MtpApiManager.invokeApi('channels.editPhoto', {\n        channel: AppChatsManager.getChannelInput($scope.chatID),\n        photo: {_: 'inputChatPhotoEmpty'}\n      }).then(onChatUpdated)['finally'](function () {\n        $scope.photo.updating = false\n      })\n    }\n\n    $scope.editChannel = function () {\n      var scope = $rootScope.$new()\n      scope.chatID = $scope.chatID\n\n      $modal.open({\n        templateUrl: templateUrl($scope.isMegagroup ? 'megagroup_edit_modal' : 'channel_edit_modal'),\n        controller: 'ChannelEditModalController',\n        scope: scope,\n        windowClass: 'md_simple_modal_window mobile_modal'\n      })\n    }\n\n    $scope.goToHistory = function () {\n      $rootScope.$broadcast('history_focus', {peerString: $scope.chatFull.peerString})\n    }\n\n    $scope.hasRights = function (action) {\n      return AppChatsManager.hasRights($scope.chatID, action)\n    }\n  })\n\n  .controller('SettingsModalController', function ($rootScope, $scope, $timeout, $modal, AppUsersManager, AppChatsManager, AppPhotosManager, MtpApiManager, Storage, NotificationsManager, MtpApiFileManager, PasswordManager, ApiUpdatesManager, ChangelogNotifyService, LayoutSwitchService, AppRuntimeManager, ErrorService, _) {\n    $scope.profile = {}\n    $scope.photo = {}\n    $scope.version = Config.App.version\n\n    MtpApiManager.getUserID().then(function (id) {\n      $scope.profile = AppUsersManager.getUser(id)\n    })\n\n    MtpApiManager.invokeApi('users.getFullUser', {\n      id: {_: 'inputUserSelf'}\n    }).then(function (userFullResult) {\n      AppUsersManager.saveApiUser(userFullResult.user)\n      if (userFullResult.profile_photo) {\n        AppPhotosManager.savePhoto(userFullResult.profile_photo, {\n          user_id: userFullResult.user.id\n        })\n      }\n    })\n\n    $scope.notify = {volume: 0.5}\n    $scope.send = {}\n\n    $scope.$watch('photo.file', onPhotoSelected)\n\n    $scope.password = {_: 'account.noPassword'}\n    updatePasswordState()\n    var updatePasswordTimeout = false\n    var stopped = false\n\n    $scope.changePassword = function (options) {\n      options = options || {}\n      if (options.action == 'cancel_email') {\n        return ErrorService.confirm({type: 'PASSWORD_ABORT_SETUP'}).then(function () {\n          PasswordManager.updateSettings($scope.password, {email: ''}).then(updatePasswordState)\n        })\n      }\n      var scope = $rootScope.$new()\n      scope.password = $scope.password\n      angular.extend(scope, options)\n      var modal = $modal.open({\n        scope: scope,\n        templateUrl: templateUrl('password_update_modal'),\n        controller: 'PasswordUpdateModalController',\n        windowClass: 'md_simple_modal_window mobile_modal'\n      })\n\n      modal.result['finally'](updatePasswordState)\n    }\n\n    $scope.showSessions = function () {\n      $modal.open({\n        templateUrl: templateUrl('sessions_list_modal'),\n        controller: 'SessionsListModalController',\n        windowClass: 'md_simple_modal_window mobile_modal'\n      })\n    }\n\n    function updatePasswordState () {\n      $timeout.cancel(updatePasswordTimeout)\n      updatePasswordTimeout = false\n      PasswordManager.getState().then(function (result) {\n        $scope.password = result\n        if (result._ == 'account.noPassword' && result.email_unconfirmed_pattern && !stopped) {\n          updatePasswordTimeout = $timeout(updatePasswordState, 5000)\n        }\n      })\n    }\n\n    $scope.$on('$destroy', function () {\n      $timeout.cancel(updatePasswordTimeout)\n      stopped = true\n    })\n\n    function onPhotoSelected (photo) {\n      if (!photo || !photo.type || photo.type.indexOf('image') !== 0) {\n        return\n      }\n      $scope.photo.updating = true\n      MtpApiFileManager.uploadFile(photo).then(function (inputFile) {\n        MtpApiManager.invokeApi('photos.uploadProfilePhoto', {\n          file: inputFile,\n          caption: '',\n          geo_point: {_: 'inputGeoPointEmpty'}\n        }).then(function (updateResult) {\n          AppUsersManager.saveApiUsers(updateResult.users)\n          MtpApiManager.getUserID().then(function (id) {\n            AppPhotosManager.savePhoto(updateResult.photo, {\n              user_id: id\n            })\n            ApiUpdatesManager.processUpdateMessage({\n              _: 'updateShort',\n              update: {\n                _: 'updateUserPhoto',\n                user_id: id,\n                date: tsNow(true),\n                photo: AppUsersManager.getUser(id).photo,\n                previous: true\n              }\n            })\n            $scope.photo = {}\n          })\n        })\n      })['finally'](function () {\n        delete $scope.photo.updating\n      })\n    }\n\n    $scope.deletePhoto = function () {\n      $scope.photo.updating = true\n      MtpApiManager.invokeApi('photos.updateProfilePhoto', {\n        id: {_: 'inputPhotoEmpty'}\n      }).then(function (updateResult) {\n        MtpApiManager.getUserID().then(function (id) {\n          ApiUpdatesManager.processUpdateMessage({\n            _: 'updateShort',\n            update: {\n              _: 'updateUserPhoto',\n              user_id: id,\n              date: tsNow(true),\n              photo: updateResult,\n              previous: true\n            }\n          })\n          $scope.photo = {}\n        })\n      })['finally'](function () {\n        delete $scope.photo.updating\n      })\n    }\n\n    $scope.editProfile = function () {\n      $modal.open({\n        templateUrl: templateUrl('profile_edit_modal'),\n        controller: 'ProfileEditModalController',\n        windowClass: 'md_simple_modal_window mobile_modal'\n      })\n    }\n\n    $scope.changeUsername = function () {\n      $modal.open({\n        templateUrl: templateUrl('username_edit_modal'),\n        controller: 'UsernameEditModalController',\n        windowClass: 'md_simple_modal_window mobile_modal'\n      })\n    }\n\n    $scope.terminateSessions = function () {\n      ErrorService.confirm({type: 'TERMINATE_SESSIONS'}).then(function () {\n        MtpApiManager.invokeApi('auth.resetAuthorizations', {})\n      })\n    }\n\n    Storage.get('notify_nodesktop', 'send_ctrlenter', 'notify_volume', 'notify_novibrate', 'notify_nopreview').then(function (settings) {\n      $scope.notify.desktop = !settings[0]\n      $scope.send.enter = settings[1] ? '' : '1'\n\n      if (settings[2] !== false) {\n        $scope.notify.volume = settings[2] > 0 && settings[2] <= 1.0 ? settings[2] : 0\n      } else {\n        $scope.notify.volume = 0.5\n      }\n\n      $scope.notify.canVibrate = NotificationsManager.getVibrateSupport()\n      $scope.notify.vibrate = !settings[3]\n\n      $scope.notify.preview = !settings[4]\n\n      $scope.notify.volumeOf4 = function () {\n        return 1 + Math.ceil(($scope.notify.volume - 0.1) / 0.33)\n      }\n\n      $scope.toggleSound = function () {\n        if ($scope.notify.volume) {\n          $scope.notify.volume = 0\n        } else {\n          $scope.notify.volume = 0.5\n        }\n      }\n\n      var testSoundPromise\n      $scope.$watch('notify.volume', function (newValue, oldValue) {\n        if (newValue !== oldValue) {\n          Storage.set({notify_volume: newValue})\n          $rootScope.$broadcast('settings_changed')\n          NotificationsManager.clear()\n\n          if (testSoundPromise) {\n            $timeout.cancel(testSoundPromise)\n          }\n          testSoundPromise = $timeout(function () {\n            NotificationsManager.testSound(newValue)\n          }, 500)\n        }\n      })\n\n      $scope.toggleDesktop = function () {\n        $scope.notify.desktop = !$scope.notify.desktop\n\n        if ($scope.notify.desktop) {\n          Storage.remove('notify_nodesktop')\n        } else {\n          Storage.set({notify_nodesktop: true})\n        }\n        $rootScope.$broadcast('settings_changed')\n      }\n\n      $scope.togglePreview = function () {\n        $scope.notify.preview = !$scope.notify.preview\n\n        if ($scope.notify.preview) {\n          Storage.remove('notify_nopreview')\n        } else {\n          Storage.set({notify_nopreview: true})\n        }\n        $rootScope.$broadcast('settings_changed')\n      }\n\n      $scope.toggleVibrate = function () {\n        $scope.notify.vibrate = !$scope.notify.vibrate\n\n        if ($scope.notify.vibrate) {\n          Storage.remove('notify_novibrate')\n        } else {\n          Storage.set({notify_novibrate: true})\n        }\n        $rootScope.$broadcast('settings_changed')\n      }\n\n      $scope.toggleCtrlEnter = function (newValue) {\n        $scope.send.enter = newValue\n\n        if ($scope.send.enter) {\n          Storage.remove('send_ctrlenter')\n        } else {\n          Storage.set({send_ctrlenter: true})\n        }\n        $rootScope.$broadcast('settings_changed')\n      }\n    })\n\n    $scope.openChangelog = function () {\n      ChangelogNotifyService.showChangelog(false)\n    }\n\n    $scope.logOut = function () {\n      ErrorService.confirm({type: 'LOGOUT'}).then(function () {\n        MtpApiManager.logOut().then(function () {\n          location.hash = '/login'\n          AppRuntimeManager.reload()\n        })\n      })\n    }\n\n    $scope.switchBackToDesktop = Config.Mobile && !Config.Navigator.mobile\n    $scope.switchToDesktop = function () {\n      LayoutSwitchService.switchLayout(false)\n    }\n  })\n\n  .controller('ChangelogModalController', function ($scope, $modal) {\n    $scope.currentVersion = Config.App.version\n    if (!$scope.lastVersion) {\n      var versionParts = $scope.currentVersion.split('.')\n      $scope.lastVersion = versionParts[0] + '.' + versionParts[1] + '.' + Math.max(0, versionParts[2] - 1)\n    }\n\n    $scope.changelogHidden = false\n    $scope.changelogShown = false\n\n    $scope.canShowVersion = function (curVersion) {\n      if ($scope.changelogShown) {\n        return true\n      }\n\n      var show = versionCompare(curVersion, $scope.lastVersion) >= 0\n      if (!show) {\n        $scope.changelogHidden = true\n      }\n\n      return show\n    }\n\n    $scope.showAllVersions = function () {\n      $scope.changelogShown = true\n      $scope.changelogHidden = false\n      $scope.$emit('ui_height')\n      $scope.$broadcast('ui_height')\n    }\n\n    $scope.changeUsername = function () {\n      $modal.open({\n        templateUrl: templateUrl('username_edit_modal'),\n        controller: 'UsernameEditModalController',\n        windowClass: 'md_simple_modal_window mobile_modal'\n      })\n    }\n  })\n\n  .controller('ProfileEditModalController', function ($scope, $modalInstance, AppUsersManager, MtpApiManager) {\n    $scope.profile = {}\n    $scope.error = {}\n\n    MtpApiManager.getUserID().then(function (id) {\n      var user = AppUsersManager.getUser(id)\n      $scope.profile = {\n        first_name: user.first_name,\n        last_name: user.last_name\n      }\n    })\n\n    $scope.updateProfile = function () {\n      $scope.profile.updating = true\n      var flags = (1 << 0) | (1 << 1)\n      MtpApiManager.invokeApi('account.updateProfile', {\n        flags: flags,\n        first_name: $scope.profile.first_name || '',\n        last_name: $scope.profile.last_name || ''\n      }).then(function (user) {\n        $scope.error = {}\n        AppUsersManager.saveApiUser(user)\n        $modalInstance.close()\n      }, function (error) {\n        switch (error.type) {\n          case 'FIRSTNAME_INVALID':\n            $scope.error = {field: 'first_name'}\n            error.handled = true\n            break\n\n          case 'LASTNAME_INVALID':\n            $scope.error = {field: 'last_name'}\n            error.handled = true\n            break\n\n          case 'NAME_NOT_MODIFIED':\n            error.handled = true\n            $modalInstance.close()\n            break\n        }\n      })['finally'](function () {\n        delete $scope.profile.updating\n      })\n    }\n  })\n\n  .controller('UsernameEditModalController', function ($scope, $modalInstance, AppUsersManager, MtpApiManager) {\n    $scope.profile = {}\n    $scope.error = {}\n\n    MtpApiManager.getUserID().then(function (id) {\n      var user = AppUsersManager.getUser(id)\n      $scope.profile = {\n        username: user.username\n      }\n    })\n\n    $scope.updateUsername = function () {\n      $scope.profile.updating = true\n\n      MtpApiManager.invokeApi('account.updateUsername', {\n        username: $scope.profile.username || ''\n      }).then(function (user) {\n        $scope.checked = {}\n        AppUsersManager.saveApiUser(user)\n        $modalInstance.close()\n      }, function (error) {\n        if (error.type == 'USERNAME_NOT_MODIFIED') {\n          error.handled = true\n          $modalInstance.close()\n        }\n      })['finally'](function () {\n        delete $scope.profile.updating\n      })\n    }\n\n    $scope.$watch('profile.username', function (newVal) {\n      if (!newVal || !newVal.length) {\n        $scope.checked = {}\n        return\n      }\n      MtpApiManager.invokeApi('account.checkUsername', {\n        username: newVal || ''\n      }).then(function (valid) {\n        if ($scope.profile.username != newVal) {\n          return\n        }\n        if (valid) {\n          $scope.checked = {success: true}\n        } else {\n          $scope.checked = {error: true}\n        }\n      }, function (error) {\n        if ($scope.profile.username != newVal) {\n          return\n        }\n        switch (error.type) {\n          case 'USERNAME_INVALID':\n            $scope.checked = {error: true}\n            error.handled = true\n            break\n        }\n      })\n    })\n  })\n\n  .controller('SessionsListModalController', function ($scope, $q, $timeout, _, MtpApiManager, ErrorService, $modalInstance) {\n    $scope.slice = {limit: 20, limitDelta: 20}\n\n    var updateSessionsTimeout = false\n    var stopped = false\n\n    function updateSessions () {\n      $timeout.cancel(updateSessionsTimeout)\n      MtpApiManager.invokeApi('account.getAuthorizations').then(function (result) {\n        $scope.sessionsLoaded = true\n        $scope.authorizations = result.authorizations\n\n        var authorization\n        for (var i = 0, len = $scope.authorizations.length; i < len; i++) {\n          authorization = $scope.authorizations[i]\n          authorization.current = (authorization.flags & 1) == 1\n        }\n        $scope.authorizations.sort(function (sA, sB) {\n          if (sA.current) {\n            return -1\n          }\n          if (sB.current) {\n            return 1\n          }\n          return sB.date_active - sA.date_active\n        })\n        if (!stopped) {\n          updateSessionsTimeout = $timeout(updateSessions, 5000)\n        }\n      })\n    }\n\n    $scope.terminateSession = function (hash) {\n      ErrorService.confirm({type: 'TERMINATE_SESSION'}).then(function () {\n        MtpApiManager.invokeApi('account.resetAuthorization', {hash: hash}).then(updateSessions)\n      })\n    }\n\n    $scope.terminateAllSessions = function () {\n      ErrorService.confirm({type: 'TERMINATE_SESSIONS'}).then(function () {\n        MtpApiManager.invokeApi('auth.resetAuthorizations', {})\n      })\n    }\n\n    updateSessions()\n\n    $scope.$on('apiUpdate', function (e, update) {\n      if (update._ == 'updateNewAuthorization') {\n        updateSessions()\n      }\n    })\n\n    $scope.$on('$destroy', function () {\n      $timeout.cancel(updateSessionsTimeout)\n      stopped = true\n    })\n  })\n\n  .controller('PasswordUpdateModalController', function ($scope, $q, _, PasswordManager, MtpApiManager, ErrorService, $modalInstance) {\n    $scope.passwordSettings = {}\n\n    $scope.updatePassword = function () {\n      delete $scope.passwordSettings.error_field\n\n      var confirmPromise\n      if ($scope.action == 'disable') {\n        confirmPromise = $q.when()\n      }else {\n        if (!$scope.passwordSettings.new_password) {\n          $scope.passwordSettings.error_field = 'new_password'\n          $scope.$broadcast('new_password_focus')\n          return false\n        }\n        if ($scope.passwordSettings.new_password != $scope.passwordSettings.confirm_password) {\n          $scope.passwordSettings.error_field = 'confirm_password'\n          $scope.$broadcast('confirm_password_focus')\n          return false\n        }\n        confirmPromise = $scope.passwordSettings.email\n          ? $q.when()\n          : ErrorService.confirm({type: 'RECOVERY_EMAIL_EMPTY'})\n      }\n\n      $scope.passwordSettings.loading = true\n\n      confirmPromise.then(function () {\n        PasswordManager.updateSettings($scope.password, {\n          cur_password: $scope.passwordSettings.cur_password || '',\n          new_password: $scope.passwordSettings.new_password,\n          email: $scope.passwordSettings.email,\n          hint: $scope.passwordSettings.hint\n        }).then(function (result) {\n          delete $scope.passwordSettings.loading\n          $modalInstance.close(true)\n          if ($scope.action == 'disable') {\n            ErrorService.alert(\n              _('error_modal_password_disabled_title_raw'),\n              _('error_modal_password_disabled_descripion_raw')\n            )\n          } else {\n            ErrorService.alert(\n              _('error_modal_password_success_title_raw'),\n              _('error_modal_password_success_descripion_raw')\n            )\n          }\n        }, function (error) {\n          switch (error.type) {\n            case 'PASSWORD_HASH_INVALID':\n            case 'NEW_PASSWORD_BAD':\n              $scope.passwordSettings.error_field = 'cur_password'\n              error.handled = true\n              $scope.$broadcast('cur_password_focus')\n              break\n            case 'NEW_PASSWORD_BAD':\n              $scope.passwordSettings.error_field = 'new_password'\n              error.handled = true\n              break\n            case 'EMAIL_INVALID':\n              $scope.passwordSettings.error_field = 'email'\n              error.handled = true\n              break\n            case 'EMAIL_UNCONFIRMED':\n              ErrorService.alert(\n                _('error_modal_email_unconfirmed_title_raw'),\n                _('error_modal_email_unconfirmed_descripion_raw')\n              )\n              $modalInstance.close(true)\n              error.handled = true\n              break\n          }\n          delete $scope.passwordSettings.loading\n        })\n      })\n    }\n\n    switch ($scope.action) {\n      case 'disable':\n        $scope.passwordSettings.new_password = ''\n        break\n      case 'create':\n        onContentLoaded(function () {\n          $scope.$broadcast('new_password_focus')\n        })\n        break\n\n    }\n\n    $scope.$watch('passwordSettings.new_password', function (newValue) {\n      var len = newValue && newValue.length || 0\n      if (!len) {\n        $scope.passwordSettings.hint = ''\n      }\n      else if (len <= 3) {\n        $scope.passwordSettings.hint = '***'\n      }else {\n        $scope.passwordSettings.hint = newValue.charAt(0) + (new Array(len - 1)).join('*') + newValue.charAt(len - 1)\n      }\n      $scope.$broadcast('value_updated')\n    })\n  })\n\n  .controller('PasswordRecoveryModalController', function ($scope, $q, _, PasswordManager, MtpApiManager, ErrorService, $modalInstance) {\n    $scope.checkCode = function () {\n      $scope.recovery.updating = true\n\n      PasswordManager.recover($scope.recovery.code, $scope.options).then(function (result) {\n        ErrorService.alert(\n          _('error_modal_password_disabled_title_raw'),\n          _('error_modal_password_disabled_descripion_raw')\n        )\n        $modalInstance.close(result)\n      }, function (error) {\n        delete $scope.recovery.updating\n        switch (error.type) {\n          case 'CODE_EMPTY':\n          case 'CODE_INVALID':\n            $scope.recovery.error_field = 'code'\n            error.handled = true\n            break\n\n          case 'PASSWORD_EMPTY':\n          case 'PASSWORD_RECOVERY_NA':\n          case 'PASSWORD_RECOVERY_EXPIRED':\n            $modalInstance.dismiss()\n            error.handled = true\n            break\n        }\n      })\n    }\n  })\n\n  .controller('ContactsModalController', function ($scope, $rootScope, $timeout, $modal, $modalInstance, MtpApiManager, AppUsersManager, ErrorService) {\n    $scope.contacts = []\n    $scope.foundPeers = []\n    $scope.search = {}\n    $scope.slice = {limit: 20, limitDelta: 20}\n\n    var jump = 0\n\n    resetSelected()\n    $scope.disabledContacts = {}\n\n    if ($scope.disabled) {\n      for (var i = 0; i < $scope.disabled.length; i++) {\n        $scope.disabledContacts[$scope.disabled[i]] = true\n      }\n    }\n\n    if ($scope.selected) {\n      for (var i = 0; i < $scope.selected.length; i++) {\n        if (!$scope.selectedContacts[$scope.selected[i]]) {\n          $scope.selectedContacts[$scope.selected[i]] = true\n          $scope.selectedCount++\n        }\n      }\n    }\n\n    function resetSelected () {\n      $scope.selectedContacts = {}\n      $scope.selectedCount = 0\n    }\n\n    function updateContacts (query) {\n      var curJump = ++jump\n      var doneIDs = []\n      AppUsersManager.getContacts(query).then(function (contactsList) {\n        if (curJump != jump) return\n        $scope.contacts = []\n        $scope.slice.limit = 20\n\n        angular.forEach(contactsList, function (userID) {\n          var contact = {\n            userID: userID,\n            user: AppUsersManager.getUser(userID)\n          }\n          doneIDs.push(userID)\n          $scope.contacts.push(contact)\n        })\n        $scope.contactsEmpty = query ? false : !$scope.contacts.length\n        $scope.$broadcast('contacts_change')\n      })\n\n      if (query && query.length >= 5) {\n        $timeout(function () {\n          if (curJump != jump) return\n          MtpApiManager.invokeApi('contacts.search', {q: query, limit: 10}).then(function (result) {\n            AppUsersManager.saveApiUsers(result.users)\n            if (curJump != jump) return\n            angular.forEach(result.results, function (contactFound) {\n              var userID = contactFound.user_id\n              if (doneIDs.indexOf(userID) != -1) return\n              $scope.contacts.push({\n                userID: userID,\n                user: AppUsersManager.getUser(userID),\n                peerString: AppUsersManager.getUserString(userID),\n                found: true\n              })\n            })\n          }, function (error) {\n            if (error.code == 400) {\n              error.handled = true\n            }\n          })\n        }, 500)\n      }\n    }\n\n    $scope.$watch('search.query', updateContacts)\n    $scope.$on('contacts_update', function () {\n      updateContacts($scope.search && $scope.search.query || '')\n    })\n\n    $scope.toggleEdit = function (enabled) {\n      $scope.action = enabled ? 'edit' : ''\n      $scope.multiSelect = enabled\n      resetSelected()\n    }\n\n    $scope.contactSelect = function (userID) {\n      if ($scope.disabledContacts[userID]) {\n        return false\n      }\n      if (!$scope.multiSelect) {\n        return $modalInstance.close(userID)\n      }\n      if ($scope.selectedContacts[userID]) {\n        delete $scope.selectedContacts[userID]\n        $scope.selectedCount--\n      } else {\n        $scope.selectedContacts[userID] = true\n        $scope.selectedCount++\n      }\n    }\n\n    $scope.submitSelected = function () {\n      if ($scope.selectedCount > 0) {\n        var selectedUserIDs = []\n        angular.forEach($scope.selectedContacts, function (t, userID) {\n          selectedUserIDs.push(userID)\n        })\n        return $modalInstance.close(selectedUserIDs)\n      }\n    }\n\n    $scope.deleteSelected = function () {\n      if ($scope.selectedCount > 0) {\n        var selectedUserIDs = []\n        angular.forEach($scope.selectedContacts, function (t, userID) {\n          selectedUserIDs.push(userID)\n        })\n        AppUsersManager.deleteContacts(selectedUserIDs).then(function () {\n          $scope.toggleEdit(false)\n        })\n      }\n    }\n\n    $scope.importContact = function () {\n      AppUsersManager.openImportContact().then(function (foundContact) {\n        if (foundContact) {\n          $rootScope.$broadcast('history_focus', {\n            peerString: AppUsersManager.getUserString(foundContact)\n          })\n        }\n      })\n    }\n  })\n\n  .controller('PeerSelectController', function ($scope, $modalInstance, $q, AppPeersManager, ErrorService) {\n    $scope.selectedPeers = {}\n    $scope.selectedPeerIDs = []\n    $scope.selectedCount = 0\n\n    if ($scope.shareLinkPromise) {\n      $scope.shareLink = {loading: true}\n      $scope.shareLinkPromise.then(function (url) {\n        $scope.shareLink = {url: url}\n      }, function () {\n        delete $scope.shareLink\n      })\n    }\n\n    $scope.dialogSelect = function (peerString) {\n      if (!$scope.multiSelect) {\n        var promise\n        if ($scope.confirm_type) {\n          var peerID = AppPeersManager.getPeerID(peerString)\n          var peerData = AppPeersManager.getPeer(peerID)\n          promise = ErrorService.confirm({\n            type: $scope.confirm_type,\n            peer_id: peerID,\n            peer_data: peerData\n          })\n        } else {\n          promise = $q.when()\n        }\n        promise.then(function () {\n          $modalInstance.close(peerString)\n        })\n        return\n      }\n\n      var peerID = AppPeersManager.getPeerID(peerString)\n      if ($scope.selectedPeers[peerID]) {\n        delete $scope.selectedPeers[peerID]\n        $scope.selectedCount--\n        var pos = $scope.selectedPeerIDs.indexOf(peerID)\n        if (pos >= 0) {\n          $scope.selectedPeerIDs.splice(pos, 1)\n        }\n      } else {\n        $scope.selectedPeers[peerID] = AppPeersManager.getPeer(peerID)\n        $scope.selectedCount++\n        $scope.selectedPeerIDs.unshift(peerID)\n      }\n    }\n\n    $scope.submitSelected = function () {\n      if ($scope.selectedCount > 0) {\n        var selectedPeerStrings = []\n        angular.forEach($scope.selectedPeers, function (t, peerID) {\n          selectedPeerStrings.push(AppPeersManager.getPeerString(peerID))\n        })\n        return $modalInstance.close(selectedPeerStrings)\n      }\n    }\n\n    $scope.toggleSearch = function () {\n      $scope.$broadcast('dialogs_search_toggle')\n    }\n  })\n\n  .controller('ChatCreateModalController', function ($scope, $modalInstance, $rootScope, MtpApiManager, AppUsersManager, AppChatsManager, ApiUpdatesManager) {\n    $scope.group = {name: ''}\n\n    $scope.createGroup = function () {\n      if (!$scope.group.name) {\n        return\n      }\n      $scope.group.creating = true\n      var inputUsers = []\n      angular.forEach($scope.userIDs, function (userID) {\n        inputUsers.push(AppUsersManager.getUserInput(userID))\n      })\n      return MtpApiManager.invokeApi('messages.createChat', {\n        title: $scope.group.name,\n        users: inputUsers\n      }).then(function (updates) {\n        ApiUpdatesManager.processUpdateMessage(updates)\n\n        if (updates.updates && updates.updates.length) {\n          for (var i = 0, len = updates.updates.length, update; i < len; i++) {\n            update = updates.updates[i]\n            if (update._ == 'updateNewMessage') {\n              $rootScope.$broadcast('history_focus', {peerString: AppChatsManager.getChatString(update.message.to_id.chat_id)\n              })\n              break\n            }\n          }\n          $modalInstance.close()\n        }\n      })['finally'](function () {\n        delete $scope.group.creating\n      })\n    }\n  })\n\n  .controller('ChatEditModalController', function ($scope, $modalInstance, $rootScope, MtpApiManager, AppUsersManager, AppChatsManager, ApiUpdatesManager) {\n    var chat = AppChatsManager.getChat($scope.chatID)\n    $scope.group = {name: chat.title}\n\n    $scope.updateGroup = function () {\n      if (!$scope.group.name) {\n        return\n      }\n      if ($scope.group.name == chat.title) {\n        return $modalInstance.close()\n      }\n\n      $scope.group.updating = true\n\n      var apiPromise\n      if (AppChatsManager.isChannel($scope.chatID)) {\n        apiPromise = MtpApiManager.invokeApi('channels.editTitle', {\n          channel: AppChatsManager.getChannelInput($scope.chatID),\n          title: $scope.group.name\n        })\n      } else {\n        apiPromise = MtpApiManager.invokeApi('messages.editChatTitle', {\n          chat_id: AppChatsManager.getChatInput($scope.chatID),\n          title: $scope.group.name\n        })\n      }\n\n      return apiPromise.then(function (updates) {\n        ApiUpdatesManager.processUpdateMessage(updates)\n        var peerString = AppChatsManager.getChatString($scope.chatID)\n        $rootScope.$broadcast('history_focus', {peerString: peerString})\n      })['finally'](function () {\n        delete $scope.group.updating\n      })\n    }\n  })\n\n  .controller('ChannelEditModalController', function ($q, $scope, $modalInstance, $rootScope, MtpApiManager, AppUsersManager, AppChatsManager, AppProfileManager, ApiUpdatesManager) {\n    var channel = AppChatsManager.getChat($scope.chatID)\n    var initial = {title: channel.title}\n    $scope.channel = {title: channel.title}\n\n    AppProfileManager.getChannelFull($scope.chatID).then(function (channelFull) {\n      initial.about = channelFull.about\n      $scope.channel.about = channelFull.about\n    })\n\n    $scope.updateChannel = function () {\n      if (!$scope.channel.title.length) {\n        return\n      }\n      var promises = []\n      if ($scope.channel.title != initial.title) {\n        promises.push(editTitle())\n      }\n      if ($scope.channel.about != initial.about) {\n        promises.push(editAbout())\n      }\n\n      $scope.channel.updating = true\n      return $q.all(promises).then(function () {\n        var peerString = AppChatsManager.getChatString($scope.chatID)\n        $rootScope.$broadcast('history_focus', {peerString: peerString})\n      })['finally'](function () {\n        delete $scope.channel.updating\n      })\n    }\n\n    function editTitle () {\n      return MtpApiManager.invokeApi('channels.editTitle', {\n        channel: AppChatsManager.getChannelInput($scope.chatID),\n        title: $scope.channel.title\n      }).then(function (updates) {\n        ApiUpdatesManager.processUpdateMessage(updates)\n      })\n    }\n\n    function editAbout () {\n      return MtpApiManager.invokeApi('channels.editAbout', {\n        channel: AppChatsManager.getChannelInput($scope.chatID),\n        about: $scope.channel.about\n      })\n    }\n  })\n\n  .controller('ChatInviteLinkModalController', function (_, $scope, $timeout, $modalInstance, AppChatsManager, AppProfileManager, ErrorService) {\n    $scope.exportedInvite = {link: _('group_invite_link_loading_raw')}\n\n    var isChannel = AppChatsManager.isChannel($scope.chatID)\n    var isMegagroup = AppChatsManager.isMegagroup($scope.chatID)\n\n    function selectLink () {\n      $timeout(function () {\n        $scope.$broadcast('ui_invite_select')\n      }, 100)\n    }\n\n    function updateLink (force) {\n      var chat = AppChatsManager.getChat($scope.chatID)\n      if (chat.username) {\n        $scope.exportedInvite = {link: 'https://telegram.me/' + chat.username, short: true}\n        selectLink()\n        return\n      }\n      if (force) {\n        $scope.exportedInvite.revoking = true\n      }\n      AppProfileManager.getChatInviteLink($scope.chatID, force).then(function (link) {\n        $scope.exportedInvite = {link: link, canRevoke: true}\n        selectLink()\n      })['finally'](function () {\n        delete $scope.exportedInvite.revoking\n      })\n    }\n\n    $scope.revokeLink = function () {\n      ErrorService.confirm({\n        type: isChannel && !isMegagroup ? 'REVOKE_CHANNEL_INVITE_LINK' : 'REVOKE_GROUP_INVITE_LINK'\n      }).then(function () {\n        updateLink(true)\n      })\n    }\n\n    updateLink()\n  })\n\n  .controller('ImportContactModalController', function ($scope, $modalInstance, $rootScope, AppUsersManager, ErrorService, PhonebookContactsService) {\n    if ($scope.importContact === undefined) {\n      $scope.importContact = {}\n    }\n\n    $scope.phonebookAvailable = PhonebookContactsService.isAvailable()\n\n    $scope.doImport = function () {\n      if ($scope.importContact && $scope.importContact.phone) {\n        $scope.progress = {enabled: true}\n        AppUsersManager.importContact(\n          $scope.importContact.phone,\n          $scope.importContact.first_name || '',\n          $scope.importContact.last_name || ''\n        ).then(function (foundUserID) {\n          if (!foundUserID) {\n            ErrorService.show({\n              error: {code: 404, type: 'USER_NOT_USING_TELEGRAM'}\n            })\n          }\n          $modalInstance.close(foundUserID)\n        })['finally'](function () {\n          delete $scope.progress.enabled\n        })\n      }\n    }\n\n    $scope.importPhonebook = function () {\n      PhonebookContactsService.openPhonebookImport().result.then(function (foundContacts) {\n        if (foundContacts) {\n          $modalInstance.close(foundContacts[0])\n        } else {\n          $modalInstance.dismiss()\n        }\n      })\n    }\n  })\n\n  .controller('CountrySelectModalController', function ($scope, $modalInstance, $rootScope, _) {\n    $scope.search = {}\n    $scope.slice = {limit: 20, limitDelta: 20}\n\n    var searchIndex = SearchIndexManager.createIndex()\n\n    for (var i = 0; i < Config.CountryCodes.length; i++) {\n      var searchString = Config.CountryCodes[i][0]\n      searchString += ' ' + _(Config.CountryCodes[i][1] + '_raw')\n      searchString += ' ' + Config.CountryCodes[i].slice(2).join(' ')\n      SearchIndexManager.indexObject(i, searchString, searchIndex)\n    }\n\n    $scope.$watch('search.query', function (newValue) {\n      var filtered = false\n      var results = {}\n\n      if (angular.isString(newValue) && newValue.length) {\n        filtered = true\n        results = SearchIndexManager.search(newValue, searchIndex)\n      }\n\n      $scope.countries = []\n      $scope.slice.limit = 20\n\n      var j\n      for (var i = 0; i < Config.CountryCodes.length; i++) {\n        if (!filtered || results[i]) {\n          for (j = 2; j < Config.CountryCodes[i].length; j++) {\n            $scope.countries.push({name: _(Config.CountryCodes[i][1] + '_raw'), code: Config.CountryCodes[i][j]})\n          }\n        }\n      }\n      if (String.prototype.localeCompare) {\n        $scope.countries.sort(function (a, b) {\n          return a.name.localeCompare(b.name)\n        })\n      }\n    })\n  })\n\n  .controller('PhonebookModalController', function ($scope, $modalInstance, $rootScope, AppUsersManager, PhonebookContactsService, ErrorService) {\n    $scope.search = {}\n    $scope.phonebook = []\n    $scope.selectedContacts = {}\n    $scope.selectedCount = 0\n    $scope.slice = {limit: 20, limitDelta: 20}\n    $scope.progress = {enabled: false}\n    $scope.multiSelect = true\n\n    var searchIndex = SearchIndexManager.createIndex()\n    var phonebookReady = false\n\n    PhonebookContactsService.getPhonebookContacts().then(function (phonebook) {\n      for (var i = 0; i < phonebook.length; i++) {\n        SearchIndexManager.indexObject(i, phonebook[i].first_name + ' ' + phonebook[i].last_name + ' ' + phonebook[i].phones.join(' '), searchIndex)\n      }\n      $scope.phonebook = phonebook\n      $scope.toggleSelection(true)\n      phonebookReady = true\n      updateList()\n    }, function (error) {\n      ErrorService.show({\n        error: {code: 403, type: 'PHONEBOOK_GET_CONTACTS_FAILED', originalError: error}\n      })\n    })\n\n    function updateList () {\n      var filtered = false\n      var results = {}\n\n      if (angular.isString($scope.search.query) && $scope.search.query.length) {\n        filtered = true\n        results = SearchIndexManager.search($scope.search.query, searchIndex)\n\n        $scope.contacts = []\n        delete $scope.contactsEmpty\n        for (var i = 0; i < $scope.phonebook.length; i++) {\n          if (!filtered || results[i]) {\n            $scope.contacts.push($scope.phonebook[i])\n          }\n        }\n      } else {\n        $scope.contacts = $scope.phonebook\n        $scope.contactsEmpty = !$scope.contacts.length\n      }\n\n      $scope.slice.limit = 20\n    }\n\n    $scope.$watch('search.query', function (newValue) {\n      if (phonebookReady) {\n        updateList()\n      }\n    })\n\n    $scope.contactSelect = function (i) {\n      if (!$scope.multiSelect) {\n        return $modalInstance.close($scope.phonebook[i])\n      }\n      if ($scope.selectedContacts[i]) {\n        delete $scope.selectedContacts[i]\n        $scope.selectedCount--\n      } else {\n        $scope.selectedContacts[i] = true\n        $scope.selectedCount++\n      }\n    }\n\n    $scope.toggleSelection = function (fill) {\n      if (!$scope.selectedCount || fill) {\n        $scope.selectedCount = $scope.phonebook.length\n        for (var i = 0; i < $scope.phonebook.length; i++) {\n          $scope.selectedContacts[i] = true\n        }\n      } else {\n        $scope.selectedCount = 0\n        $scope.selectedContacts = {}\n      }\n    }\n\n    $scope.submitSelected = function () {\n      if ($scope.selectedCount <= 0) {\n        $modalInstance.dismiss()\n      }\n\n      var selectedContacts = []\n      angular.forEach($scope.selectedContacts, function (t, i) {\n        selectedContacts.push($scope.phonebook[i])\n      })\n\n      ErrorService.confirm({\n        type: 'CONTACTS_IMPORT_PERFORM'\n      }).then(function () {\n        $scope.progress.enabled = true\n        AppUsersManager.importContacts(selectedContacts).then(function (foundContacts) {\n          if (!foundContacts.length) {\n            ErrorService.show({\n              error: {code: 404, type: 'USERS_NOT_USING_TELEGRAM'}\n            })\n          }\n          $modalInstance.close(foundContacts)\n        })['finally'](function () {\n          $scope.progress.enabled = false\n        })\n      })\n    }\n  })\n\n  .controller('StickersetModalController', function ($scope, $rootScope, $modalInstance, MtpApiManager, RichTextProcessor, AppStickersManager, AppDocsManager, AppMessagesManager, LocationParamsService) {\n    $scope.slice = {limit: 20, limitDelta: 20}\n\n    var fullSet\n\n    AppStickersManager.getStickerset($scope.inputStickerset).then(function (result) {\n      $scope.$broadcast('ui_height')\n      $scope.stickersetLoaded = true\n      fullSet = result\n      $scope.stickerset = result.set\n      $scope.stickersetInstalled = result.set.pFlags.installed == true\n      $scope.documents = result.documents\n\n      $scope.stickerEmojis = {}\n      $scope.stickerDimensions = {}\n      angular.forEach($scope.documents, function (doc) {\n        $scope.stickerEmojis[doc.id] = RichTextProcessor.wrapRichText(doc.stickerEmojiRaw, {\n          noLinks: true,\n          noLinebreaks: true,\n          emojiIconSize: 26\n        })\n        var dim = calcImageInBox(doc.w, doc.h, 192, 192)\n        $scope.stickerDimensions[doc.id] = {width: dim.w, height: dim.h}\n      })\n    })\n\n    $scope.toggleInstalled = function (installed) {\n      AppStickersManager.installStickerset(fullSet, !installed).then(function () {\n        $scope.stickersetInstalled = installed\n      })\n    }\n\n    $scope.chooseSticker = function (docID) {\n      var doc = AppDocsManager.getDoc(docID)\n      if (!doc.id || !doc.access_hash || !$rootScope.selectedPeerID) {\n        return\n      }\n      var inputMedia = {\n        _: 'inputMediaDocument',\n        id: {\n          _: 'inputDocument',\n          id: doc.id,\n          access_hash: doc.access_hash\n        }\n      }\n      AppMessagesManager.sendOther($rootScope.selectedPeerID, inputMedia)\n      $modalInstance.close(doc.id)\n    }\n\n    $scope.share = function () {\n      LocationParamsService.shareUrl('https://telegram.me/addstickers/' + $scope.stickerset.short_name, $scope.stickerset.title)\n    }\n  })\n"]}